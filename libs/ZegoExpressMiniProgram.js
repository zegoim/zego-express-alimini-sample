!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var o in r)("object"==typeof exports?exports:e)[o]=r[o]}}("undefined"!=typeof self?self:this,(()=>(()=>{var __webpack_modules__={537:e=>{"use strict";e.exports=function(e,t){var r=new Array(arguments.length-1),o=0,n=2,i=!0;for(;n<arguments.length;)r[o++]=arguments[n++];return new Promise((function(n,s){r[o]=function(e){if(i)if(i=!1,e)s(e);else{for(var t=new Array(arguments.length-1),r=0;r<t.length;)t[r++]=arguments[r];n.apply(null,t)}};try{e.apply(t||null,r)}catch(e){i&&(i=!1,s(e))}}))}},419:(e,t)=>{"use strict";var r=t;r.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&"="===e.charAt(t);)++r;return Math.ceil(3*e.length)/4-r};for(var o=new Array(64),n=new Array(123),i=0;i<64;)n[o[i]=i<26?i+65:i<52?i+71:i<62?i-4:i-59|43]=i++;r.encode=function(e,t,r){for(var n,i=null,s=[],a=0,u=0;t<r;){var l=e[t++];switch(u){case 0:s[a++]=o[l>>2],n=(3&l)<<4,u=1;break;case 1:s[a++]=o[n|l>>4],n=(15&l)<<2,u=2;break;case 2:s[a++]=o[n|l>>6],s[a++]=o[63&l],u=0}a>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),a=0)}return u&&(s[a++]=o[n],s[a++]=61,1===u&&(s[a++]=61)),i?(a&&i.push(String.fromCharCode.apply(String,s.slice(0,a))),i.join("")):String.fromCharCode.apply(String,s.slice(0,a))};var s="invalid encoding";r.decode=function(e,t,r){for(var o,i=r,a=0,u=0;u<e.length;){var l=e.charCodeAt(u++);if(61===l&&a>1)break;if(void 0===(l=n[l]))throw Error(s);switch(a){case 0:o=l,a=1;break;case 1:t[r++]=o<<2|(48&l)>>4,o=l,a=2;break;case 2:t[r++]=(15&o)<<4|(60&l)>>2,o=l,a=3;break;case 3:t[r++]=(3&o)<<6|l,a=0}}if(1===a)throw Error(s);return r-i},r.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},211:e=>{"use strict";function t(){this._listeners={}}e.exports=t,t.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this},t.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var r=this._listeners[e],o=0;o<r.length;)r[o].fn===t?r.splice(o,1):++o;return this},t.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],o=1;o<arguments.length;)r.push(arguments[o++]);for(o=0;o<t.length;)t[o].fn.apply(t[o++].ctx,r)}return this}},945:e=>{"use strict";function t(e){return"undefined"!=typeof Float32Array?function(){var t=new Float32Array([-0]),r=new Uint8Array(t.buffer),o=128===r[3];function n(e,o,n){t[0]=e,o[n]=r[0],o[n+1]=r[1],o[n+2]=r[2],o[n+3]=r[3]}function i(e,o,n){t[0]=e,o[n]=r[3],o[n+1]=r[2],o[n+2]=r[1],o[n+3]=r[0]}function s(e,o){return r[0]=e[o],r[1]=e[o+1],r[2]=e[o+2],r[3]=e[o+3],t[0]}function a(e,o){return r[3]=e[o],r[2]=e[o+1],r[1]=e[o+2],r[0]=e[o+3],t[0]}e.writeFloatLE=o?n:i,e.writeFloatBE=o?i:n,e.readFloatLE=o?s:a,e.readFloatBE=o?a:s}():function(){function t(e,t,r,o){var n=t<0?1:0;if(n&&(t=-t),0===t)e(1/t>0?0:2147483648,r,o);else if(isNaN(t))e(2143289344,r,o);else if(t>34028234663852886e22)e((n<<31|2139095040)>>>0,r,o);else if(t<11754943508222875e-54)e((n<<31|Math.round(t/1401298464324817e-60))>>>0,r,o);else{var i=Math.floor(Math.log(t)/Math.LN2);e((n<<31|i+127<<23|8388607&Math.round(t*Math.pow(2,-i)*8388608))>>>0,r,o)}}function s(e,t,r){var o=e(t,r),n=2*(o>>31)+1,i=o>>>23&255,s=8388607&o;return 255===i?s?NaN:n*(1/0):0===i?1401298464324817e-60*n*s:n*Math.pow(2,i-150)*(s+8388608)}e.writeFloatLE=t.bind(null,r),e.writeFloatBE=t.bind(null,o),e.readFloatLE=s.bind(null,n),e.readFloatBE=s.bind(null,i)}(),"undefined"!=typeof Float64Array?function(){var t=new Float64Array([-0]),r=new Uint8Array(t.buffer),o=128===r[7];function n(e,o,n){t[0]=e,o[n]=r[0],o[n+1]=r[1],o[n+2]=r[2],o[n+3]=r[3],o[n+4]=r[4],o[n+5]=r[5],o[n+6]=r[6],o[n+7]=r[7]}function i(e,o,n){t[0]=e,o[n]=r[7],o[n+1]=r[6],o[n+2]=r[5],o[n+3]=r[4],o[n+4]=r[3],o[n+5]=r[2],o[n+6]=r[1],o[n+7]=r[0]}function s(e,o){return r[0]=e[o],r[1]=e[o+1],r[2]=e[o+2],r[3]=e[o+3],r[4]=e[o+4],r[5]=e[o+5],r[6]=e[o+6],r[7]=e[o+7],t[0]}function a(e,o){return r[7]=e[o],r[6]=e[o+1],r[5]=e[o+2],r[4]=e[o+3],r[3]=e[o+4],r[2]=e[o+5],r[1]=e[o+6],r[0]=e[o+7],t[0]}e.writeDoubleLE=o?n:i,e.writeDoubleBE=o?i:n,e.readDoubleLE=o?s:a,e.readDoubleBE=o?a:s}():function(){function t(e,t,r,o,n,i){var s=o<0?1:0;if(s&&(o=-o),0===o)e(0,n,i+t),e(1/o>0?0:2147483648,n,i+r);else if(isNaN(o))e(0,n,i+t),e(2146959360,n,i+r);else if(o>17976931348623157e292)e(0,n,i+t),e((s<<31|2146435072)>>>0,n,i+r);else{var a;if(o<22250738585072014e-324)e((a=o/5e-324)>>>0,n,i+t),e((s<<31|a/4294967296)>>>0,n,i+r);else{var u=Math.floor(Math.log(o)/Math.LN2);1024===u&&(u=1023),e(4503599627370496*(a=o*Math.pow(2,-u))>>>0,n,i+t),e((s<<31|u+1023<<20|1048576*a&1048575)>>>0,n,i+r)}}}function s(e,t,r,o,n){var i=e(o,n+t),s=e(o,n+r),a=2*(s>>31)+1,u=s>>>20&2047,l=4294967296*(1048575&s)+i;return 2047===u?l?NaN:a*(1/0):0===u?5e-324*a*l:a*Math.pow(2,u-1075)*(l+4503599627370496)}e.writeDoubleLE=t.bind(null,r,0,4),e.writeDoubleBE=t.bind(null,o,4,0),e.readDoubleLE=s.bind(null,n,0,4),e.readDoubleBE=s.bind(null,i,4,0)}(),e}function r(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function o(e,t,r){t[r]=e>>>24,t[r+1]=e>>>16&255,t[r+2]=e>>>8&255,t[r+3]=255&e}function n(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function i(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}e.exports=t(t)},199:module=>{"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},662:e=>{"use strict";e.exports=function(e,t,r){var o=r||8192,n=o>>>1,i=null,s=o;return function(r){if(r<1||r>n)return e(r);s+r>o&&(i=e(o),s=0);var a=t.call(i,s,s+=r);return 7&s&&(s=1+(7|s)),a}}},997:(e,t)=>{"use strict";var r=t;r.length=function(e){for(var t=0,r=0,o=0;o<e.length;++o)(r=e.charCodeAt(o))<128?t+=1:r<2048?t+=2:55296==(64512&r)&&56320==(64512&e.charCodeAt(o+1))?(++o,t+=4):t+=3;return t},r.read=function(e,t,r){if(r-t<1)return"";for(var o,n=null,i=[],s=0;t<r;)(o=e[t++])<128?i[s++]=o:o>191&&o<224?i[s++]=(31&o)<<6|63&e[t++]:o>239&&o<365?(o=((7&o)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,i[s++]=55296+(o>>10),i[s++]=56320+(1023&o)):i[s++]=(15&o)<<12|(63&e[t++])<<6|63&e[t++],s>8191&&((n||(n=[])).push(String.fromCharCode.apply(String,i)),s=0);return n?(s&&n.push(String.fromCharCode.apply(String,i.slice(0,s))),n.join("")):String.fromCharCode.apply(String,i.slice(0,s))},r.write=function(e,t,r){for(var o,n,i=r,s=0;s<e.length;++s)(o=e.charCodeAt(s))<128?t[r++]=o:o<2048?(t[r++]=o>>6|192,t[r++]=63&o|128):55296==(64512&o)&&56320==(64512&(n=e.charCodeAt(s+1)))?(++s,t[r++]=(o=65536+((1023&o)<<10)+(1023&n))>>18|240,t[r++]=o>>12&63|128,t[r++]=o>>6&63|128,t[r++]=63&o|128):(t[r++]=o>>12|224,t[r++]=o>>6&63|128,t[r++]=63&o|128);return r-i}},100:(e,t,r)=>{"use strict";e.exports=r(482)},482:(e,t,r)=>{"use strict";var o=t;function n(){o.util._configure(),o.Writer._configure(o.BufferWriter),o.Reader._configure(o.BufferReader)}o.build="minimal",o.Writer=r(173),o.BufferWriter=r(155),o.Reader=r(408),o.BufferReader=r(593),o.util=r(693),o.rpc=r(994),o.roots=r(54),o.configure=n,n()},408:(e,t,r)=>{"use strict";e.exports=u;var o,n=r(693),i=n.LongBits,s=n.utf8;function a(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function u(e){this.buf=e,this.pos=0,this.len=e.length}var l,h="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new u(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new u(e);throw Error("illegal buffer")},c=function(){return n.Buffer?function(e){return(u.create=function(e){return n.Buffer.isBuffer(e)?new o(e):h(e)})(e)}:h};function d(){var e=new i(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw a(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw a(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function p(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function g(){if(this.pos+8>this.len)throw a(this,8);return new i(p(this.buf,this.pos+=4),p(this.buf,this.pos+=4))}u.create=c(),u.prototype._slice=n.Array.prototype.subarray||n.Array.prototype.slice,u.prototype.uint32=(l=4294967295,function(){if(l=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return l;if((this.pos+=5)>this.len)throw this.pos=this.len,a(this,10);return l}),u.prototype.int32=function(){return 0|this.uint32()},u.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},u.prototype.bool=function(){return 0!==this.uint32()},u.prototype.fixed32=function(){if(this.pos+4>this.len)throw a(this,4);return p(this.buf,this.pos+=4)},u.prototype.sfixed32=function(){if(this.pos+4>this.len)throw a(this,4);return 0|p(this.buf,this.pos+=4)},u.prototype.float=function(){if(this.pos+4>this.len)throw a(this,4);var e=n.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},u.prototype.double=function(){if(this.pos+8>this.len)throw a(this,4);var e=n.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},u.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw a(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,r):t===r?new this.buf.constructor(0):this._slice.call(this.buf,t,r)},u.prototype.string=function(){var e=this.bytes();return s.read(e,0,e.length)},u.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw a(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw a(this)}while(128&this.buf[this.pos++]);return this},u.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},u._configure=function(e){o=e,u.create=c(),o._configure();var t=n.Long?"toLong":"toNumber";n.merge(u.prototype,{int64:function(){return d.call(this)[t](!1)},uint64:function(){return d.call(this)[t](!0)},sint64:function(){return d.call(this).zzDecode()[t](!1)},fixed64:function(){return g.call(this)[t](!0)},sfixed64:function(){return g.call(this)[t](!1)}})}},593:(e,t,r)=>{"use strict";e.exports=i;var o=r(408);(i.prototype=Object.create(o.prototype)).constructor=i;var n=r(693);function i(e){o.call(this,e)}i._configure=function(){n.Buffer&&(i.prototype._slice=n.Buffer.prototype.slice)},i.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},i._configure()},54:e=>{"use strict";e.exports={}},994:(e,t,r)=>{"use strict";t.Service=r(948)},948:(e,t,r)=>{"use strict";e.exports=n;var o=r(693);function n(e,t,r){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");o.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(r)}(n.prototype=Object.create(o.EventEmitter.prototype)).constructor=n,n.prototype.rpcCall=function e(t,r,n,i,s){if(!i)throw TypeError("request must be specified");var a=this;if(!s)return o.asPromise(e,a,t,r,n,i);if(a.rpcImpl)try{return a.rpcImpl(t,r[a.requestDelimited?"encodeDelimited":"encode"](i).finish(),(function(e,r){if(e)return a.emit("error",e,t),s(e);if(null!==r){if(!(r instanceof n))try{r=n[a.responseDelimited?"decodeDelimited":"decode"](r)}catch(e){return a.emit("error",e,t),s(e)}return a.emit("data",r,t),s(null,r)}a.end(!0)}))}catch(e){return a.emit("error",e,t),void setTimeout((function(){s(e)}),0)}else setTimeout((function(){s(Error("already ended"))}),0)},n.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},630:(e,t,r)=>{"use strict";e.exports=n;var o=r(693);function n(e,t){this.lo=e>>>0,this.hi=t>>>0}var i=n.zero=new n(0,0);i.toNumber=function(){return 0},i.zzEncode=i.zzDecode=function(){return this},i.length=function(){return 1};var s=n.zeroHash="\0\0\0\0\0\0\0\0";n.fromNumber=function(e){if(0===e)return i;var t=e<0;t&&(e=-e);var r=e>>>0,o=(e-r)/4294967296>>>0;return t&&(o=~o>>>0,r=~r>>>0,++r>4294967295&&(r=0,++o>4294967295&&(o=0))),new n(r,o)},n.from=function(e){if("number"==typeof e)return n.fromNumber(e);if(o.isString(e)){if(!o.Long)return n.fromNumber(parseInt(e,10));e=o.Long.fromString(e)}return e.low||e.high?new n(e.low>>>0,e.high>>>0):i},n.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+4294967296*r)}return this.lo+4294967296*this.hi},n.prototype.toLong=function(e){return o.Long?new o.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var a=String.prototype.charCodeAt;n.fromHash=function(e){return e===s?i:new n((a.call(e,0)|a.call(e,1)<<8|a.call(e,2)<<16|a.call(e,3)<<24)>>>0,(a.call(e,4)|a.call(e,5)<<8|a.call(e,6)<<16|a.call(e,7)<<24)>>>0)},n.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},n.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},n.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},n.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}},693:function(e,t,r){"use strict";var o=t;function n(e,t,r){for(var o=Object.keys(t),n=0;n<o.length;++n)void 0!==e[o[n]]&&r||(e[o[n]]=t[o[n]]);return e}function i(e){function t(e,r){if(!(this instanceof t))return new t(e,r);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),r&&n(this,r)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}o.asPromise=r(537),o.base64=r(419),o.EventEmitter=r(211),o.float=r(945),o.inquire=r(199),o.utf8=r(997),o.pool=r(662),o.LongBits=r(630),o.isNode=Boolean(void 0!==r.g&&r.g&&r.g.process&&r.g.process.versions&&r.g.process.versions.node),o.global=o.isNode&&r.g||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,o.emptyArray=Object.freeze?Object.freeze([]):[],o.emptyObject=Object.freeze?Object.freeze({}):{},o.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},o.isString=function(e){return"string"==typeof e||e instanceof String},o.isObject=function(e){return e&&"object"==typeof e},o.isset=o.isSet=function(e,t){var r=e[t];return!(null==r||!e.hasOwnProperty(t))&&("object"!=typeof r||(Array.isArray(r)?r.length:Object.keys(r).length)>0)},o.Buffer=function(){try{var e=o.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),o._Buffer_from=null,o._Buffer_allocUnsafe=null,o.newBuffer=function(e){return"number"==typeof e?o.Buffer?o._Buffer_allocUnsafe(e):new o.Array(e):o.Buffer?o._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},o.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,o.Long=o.global.dcodeIO&&o.global.dcodeIO.Long||o.global.Long||o.inquire("long"),o.key2Re=/^true|false|0|1$/,o.key32Re=/^-?(?:0|[1-9][0-9]*)$/,o.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,o.longToHash=function(e){return e?o.LongBits.from(e).toHash():o.LongBits.zeroHash},o.longFromHash=function(e,t){var r=o.LongBits.fromHash(e);return o.Long?o.Long.fromBits(r.lo,r.hi,t):r.toNumber(Boolean(t))},o.merge=n,o.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},o.newError=i,o.ProtocolError=i("ProtocolError"),o.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var e=Object.keys(this),r=e.length-1;r>-1;--r)if(1===t[e[r]]&&null!=this[e[r]])return e[r]}},o.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}},o.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},o._configure=function(){var e=o.Buffer;e?(o._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,r){return new e(t,r)},o._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):o._Buffer_from=o._Buffer_allocUnsafe=null}},173:(e,t,r)=>{"use strict";e.exports=c;var o,n=r(693),i=n.LongBits,s=n.base64,a=n.utf8;function u(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}function l(){}function h(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function c(){this.len=0,this.head=new u(l,0,0),this.tail=this.head,this.states=null}var d=function(){return n.Buffer?function(){return(c.create=function(){return new o})()}:function(){return new c}};function p(e,t,r){t[r]=255&e}function g(e,t){this.len=e,this.next=void 0,this.val=t}function m(e,t,r){for(;e.hi;)t[r++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=127&e.lo|128,e.lo=e.lo>>>7;t[r++]=e.lo}function f(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}c.create=d(),c.alloc=function(e){return new n.Array(e)},n.Array!==Array&&(c.alloc=n.pool(c.alloc,n.Array.prototype.subarray)),c.prototype._push=function(e,t,r){return this.tail=this.tail.next=new u(e,t,r),this.len+=t,this},(g.prototype=Object.create(u.prototype)).fn=function(e,t,r){for(;e>127;)t[r++]=127&e|128,e>>>=7;t[r]=e},c.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new g((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},c.prototype.int32=function(e){return e<0?this._push(m,10,i.fromNumber(e)):this.uint32(e)},c.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},c.prototype.int64=c.prototype.uint64=function(e){var t=i.from(e);return this._push(m,t.length(),t)},c.prototype.sint64=function(e){var t=i.from(e).zzEncode();return this._push(m,t.length(),t)},c.prototype.bool=function(e){return this._push(p,1,e?1:0)},c.prototype.sfixed32=c.prototype.fixed32=function(e){return this._push(f,4,e>>>0)},c.prototype.sfixed64=c.prototype.fixed64=function(e){var t=i.from(e);return this._push(f,4,t.lo)._push(f,4,t.hi)},c.prototype.float=function(e){return this._push(n.float.writeFloatLE,4,e)},c.prototype.double=function(e){return this._push(n.float.writeDoubleLE,8,e)};var _=n.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var o=0;o<e.length;++o)t[r+o]=e[o]};c.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(p,1,0);if(n.isString(e)){var r=c.alloc(t=s.length(e));s.decode(e,r,0),e=r}return this.uint32(t)._push(_,t,e)},c.prototype.string=function(e){var t=a.length(e);return t?this.uint32(t)._push(a.write,t,e):this._push(p,1,0)},c.prototype.fork=function(){return this.states=new h(this),this.head=this.tail=new u(l,0,0),this.len=0,this},c.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new u(l,0,0),this.len=0),this},c.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this},c.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t},c._configure=function(e){o=e,c.create=d(),o._configure()}},155:(e,t,r)=>{"use strict";e.exports=i;var o=r(173);(i.prototype=Object.create(o.prototype)).constructor=i;var n=r(693);function i(){o.call(this)}function s(e,t,r){e.length<40?n.utf8.write(e,t,r):t.utf8Write?t.utf8Write(e,r):t.write(e,r)}i._configure=function(){i.alloc=n._Buffer_allocUnsafe,i.writeBytesBuffer=n.Buffer&&n.Buffer.prototype instanceof Uint8Array&&"set"===n.Buffer.prototype.set.name?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var o=0;o<e.length;)t[r++]=e[o++]}},i.prototype.bytes=function(e){n.isString(e)&&(e=n._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(i.writeBytesBuffer,t,e),this},i.prototype.string=function(e){var t=n.Buffer.byteLength(e);return this.uint32(t),t&&this._push(s,t,e),this},i._configure()},901:function(e,t,r){"undefined"!=typeof self&&self,e.exports=function(e){return r=[function(e,t,r){"use strict";r.d(t,"j",(function(){return c})),r.d(t,"d",(function(){return o})),r.d(t,"e",(function(){return d})),r.d(t,"c",(function(){return p})),r.d(t,"l",(function(){return n})),r.d(t,"b",(function(){return i})),r.d(t,"k",(function(){return s})),r.d(t,"a",(function(){return a})),r.d(t,"i",(function(){return u})),r.d(t,"g",(function(){return g})),r.d(t,"n",(function(){return m})),r.d(t,"m",(function(){return f})),r.d(t,"f",(function(){return v})),r.d(t,"h",(function(){return E})),r(6);var o,n,i,s,a,u,l,h,c="1.25.0",d=((t=o=o||{})[t.SWITCH_ONE=1]="SWITCH_ONE",t[t.SWITCH_TWO=2]="SWITCH_TWO",{debug:0,info:1,warn:2,error:3,report:99,disable:100}),p={ROOM_SESSION_ID_ERR:1000000152},g=((r=n=n||{})[r.TT_NONE=0]="TT_NONE",r[r.TT_PC=1]="TT_PC",r[r.TT_IOS=2]="TT_IOS",r[r.TT_ANDROID=3]="TT_ANDROID",r[r.TT_MAC=4]="TT_MAC",r[r.TT_LINUX=5]="TT_LINUX",r[r.TT_WEB=6]="TT_WEB",r[r.TT_MINIPROGRAM=7]="TT_MINIPROGRAM",r[r.TT_UNKNOWN=32]="TT_UNKNOWN",(t=i=i||{})[t.logout=0]="logout",t[t.trylogin=1]="trylogin",t[t.login=2]="login",(r=s=s||{})[r.I=0]="I",r[r.H=10]="H",r[r.M=100]="M",r[r.L=1e3]="L",(t=a=a||{})[t.offline=0]="offline",t[t.online=1]="online",(r=u=u||{})[r.NT_NONE=0]="NT_NONE",r[r.NT_LINE=1]="NT_LINE",r[r.NT_WIFI=2]="NT_WIFI",r[r.NT_2G=3]="NT_2G",r[r.NT_3G=4]="NT_3G",r[r.NT_4G=5]="NT_4G",r[r.NT_UNKNOWN=32]="NT_UNKNOWN",3e3),m=function(){return l++},f=(h=l=1,function(){return h++}),_=(Object.defineProperty(y.prototype,"id",{get:function(){return this._id||null},set:function(e){this._id=e},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"data",{get:function(){return this._data},set:function(e){this._data=e},enumerable:!1,configurable:!0}),y.prototype.hasNext=function(){return this.next&&this.next.id},y.prototype.hasPrev=function(){return this.prev&&this.prev.id},y);function y(e,t){void 0===e&&(e=null),void 0===t&&(t=null),this.next=null,this.prev=null,this._id=e,this._data=t}S.prototype.insertBefore=function(e,t){return(t=new _(this._idCounter,t)).next=e,t.prev=e.prev,e.prev&&(e.prev.next=t),e.prev=t,++this._idCounter,++this._numNodes,t},S.prototype.addLast=function(e){return this.insertBefore(this.end,e)},S.prototype.add=function(e){return this.addLast(e)},S.prototype.getFirst=function(){return 0===this._numNodes?null:this.start.next},S.prototype.getLast=function(){return 0===this._numNodes?null:this.end.prev},S.prototype.size=function(){return this._numNodes},S.prototype.getFromFirst=function(e){var t=0,r=this.start.next;if(0<=e)for(;t<e&&null!==r;)r=r.next,++t;else r=null;if(null===r)throw"Index out of bounds.";return r},S.prototype.get=function(e){return 0===e?this.getFirst():e===this._numNodes-1?this.getLast():this.getFromFirst(e)},S.prototype.remove=function(e){return e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),--this._numNodes,e},S.prototype.removeFirst=function(){var e=null;return 0<this._numNodes&&this.start.next?this.remove(this.start.next):e},S.prototype.removeLast=function(){var e=null;return 0<this._numNodes&&this.end.prev?this.remove(this.end.prev):e},S.prototype.removeAll=function(){this.start.next=this.end,this.end.prev=this.start,this._numNodes=0,this._idCounter=0},S.prototype.each=function(e){for(var t=this.start;t.hasNext();)e(t=t.next)},S.prototype.find=function(e){for(var t=this.start,r=!1,o=null;t.hasNext()&&!r;)e(t=t.next)&&(o=t,r=!0);return o},S.prototype.map=function(e){for(var t=this.start,r=[];t.hasNext();)e(t=t.next)&&r.push(t);return r},S.prototype.push=function(e){return this.addLast(e)},S.prototype.unshift=function(e){this.insertBefore(0<this._numNodes?this.start.next:this.end,e)},S.prototype.pop=function(){return this.removeLast()},S.prototype.shift=function(){return this.removeFirst()};var v=S;function S(){this.start=new _,this.end=new _,this._idCounter=0,this._numNodes=0,this.start.next=this.end,this.start.prev=null,this.end.prev=this.start,this.end.next=null}var E={MESSAGE:"未引入消息模块"}},function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var o={SERVER:{code:0,msg:"liverooom cmd error"},SUCCESS:{code:0,msg:"success."},INIT:{code:2000000001,msg:"init sdk wrong"},NOT_LOGIN:{code:1000002,msg:"not login"},APPID_INVALID:{code:1001004,msg:"appid invalid"},NETWORK_BROKEN:{code:1000017,msg:"network is broken"},GEO_SET_ERROR:{code:1000018,msg:"geo set error"},INPUT_PARAM:{code:1100001,msg:"input parm error."},TIMEOUT:{code:1100002,msg:"network timeout."},SOCKET_CLOSE:{code:1100003,msg:"socket close"},NET_SOCKET_TIMEOUT:{code:1100004,msg:"net agent timeout"},NET_HB_TIMEOUT:{code:1100005,msg:"net hb timeout"},INIT_SDK_WRONG:{code:1101e3,msg:"init sdk wrong"},ROOM_COUNT_EXCEED:{code:1002001,msg:"login rooms exceeds the upper limit"},USER_ID_NULL:{code:1002005,msg:"user ID is empty"},USER_ID_INVALID_CHARACTER:{code:1002006,msg:"user ID contains illegal characters"},USER_ID_TOO_LONG:{code:1002007,msg:"user ID is too long"},USER_NAME_NULL:{code:1002008,msg:"username is empty"},USER_NAME_TOO_LONG:{code:1002010,msg:"username is too long"},ROOM_ID_NULL:{code:1002011,msg:"room ID is empty"},ROOM_ID_INVALID_CHARACTER:{code:1002012,msg:"room ID contains illegal characters"},ROOM_ID_TOO_LONG:{code:1002013,msg:"room ID is too long"},ROOM_NOT_EXIST:{code:1002014,msg:"room not exist"},ROOM_EXTRA_INFO_KEY_LIMIT:{code:1002017,msg:"room extra info key exceed the limit"},LOGIN_TIMEOUT:{code:1002031,msg:"login timeout"},ROOM_MAX_USER_COUNT:{code:1002034,msg:"users logging into the room exceeds the maximum number"},MULTI_ROOM_UNABLE:{code:1002036,msg:"multi room unable"},MULTIPLE_LOGIN_KICKOUT:{code:1002050,msg:"kickout may be the same user ID login other"},NETWORK_RECOVERY:{code:1002051,msg:"network recovery"},ROOM_RETRY_TIMEOUT:{code:1002053,msg:"network is broken and login fail."},MANUAL_KICKOUT:{code:1002055,msg:"server has sent a signal to kick out"},REPEATEDLY_LOGIN:{code:1002056,msg:"user repeatedly login"},REPEATEDLY_ENTER_ROOM:{code:1002057,msg:"user repeatedly enter room"},ALREADY_LOGIN:{code:1002058,msg:"user already logged in"},FORBID_BLACK_USER:{code:1002066,msg:"forbid black user"},WHITE_BOARD_VERSION_ERROR:{code:1002098,msg:"Mismatch with RTC SDK version, please upgrade ZegoSuperBoard or ZegoWhiteboardView SDK to the latest version"},ROOM_INNER_ERROR:{code:1002099,msg:"room inner error"},HEARTBEAT_TIMEOUT:{code:1102001,msg:"heartbeat timeout."},PARSE_JSON_ERROR:{code:1102011,msg:"parse json error."},LOGIN_PROCESSING:{code:1102012,msg:"login is processing."},LIVEROMM_REQUEST_ERROR:{code:1102013,msg:"liveroom request error."},ZPUSH_REQUEST_FAIL:{code:1102014,msg:"zpush request fail."},LOGIN_STATE_WRONG:{code:1102015,msg:"user login state is wrong."},TOKEN_ERROR:{code:1102016,msg:"token error"},DIAPATCH_ERROR:{code:1102017,msg:"dispatch error"},TOKEN_EXPIRED:{code:1102018,msg:"token expired"},SUBCMD_ERROR:{code:1102019,msg:"subcmd error."},ZEGO_AUTH_ERROR:{code:1102020,msg:"zego auth error."},BIZ_CHANNEL_ERROR:{code:1102021,msg:"biz channel error."},UPLOAD_LOG_ERROR:{code:1102025,msg:"upload zip logs failed"}}},function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return u}));var o=r(10),n=r(0),i=r(1),s=r(5),a=function(){return(a=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},u=(l.checkConfigParam=function(e,t,r){return e&&"number"==typeof e&&this.checkInteger(e)?!(!t||"string"!=typeof t&&!Array.isArray(t)||""==t)||(r.error("ccp.0 server must be string or string array and not empty"),!1):(r.error("ccp.0 appid must be positive integer number and not empty"),!1)},l.checkPriConfigParam=function(e,t,r,o,n){return e&&"number"==typeof e&&this.checkInteger(e)?t&&"string"==typeof t?"object"!=typeof r||"string"!=typeof r.deviceID?(n.error("ccp.0 deviceID must be string and not empty"),!1):1===o||0===o||(n.error("ccp.0 anType must be 0 or 1"),!1):(n.error("ccp.0 dispatchServer must be string and not empty"),!1):(n.error("ccp.0 appid must be positive integer number and not empty"),!1)},l.checkIllegalCharacters=function(e){return/^([0-9a-zA-Z#!$%&()`'+-;<=.>@^_~,\\*])+$/.test(e)&&/^[^:/]*$/g.test(e)},l.registerCallback=function(e,t,r){t.success&&(r[e+"SuccessCallback"]=t.success),t.error&&(r[e+"ErrorCallback"]=t.error)},l.actionErrorCallback=function(e,t){return t[e+"ErrorCallback"]},l.actionSuccessCallback=function(e,t){return t[e+"SuccessCallback"]},l.logReportCallback=function(e,t,r,o){l.registerCallback(e,{success:function(e,o){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];l.dataReportEvent(t,r,e,o,n)}},o)},l.proxyRes=function(e,t,r,o){return{interResolve:function(o){e.uploadReport(t),r(o)},interReject:function(r,n){var i;void 0===n&&(n=""),(i=r.code<2e9&&1e9<r.code?l.decodeServerError(r.code,r.msg):{code:r.code,message:r.msg})&&e.addMsgInfo(t,{error:i.code,message:i.message+n}),e.uploadReport(t),o({errorCode:r.code||r.errorCode})}}},l.getServerError=function(e){var t,r,o={1:"parse json error.",1001:"login is processing.",1002:"liveroom request error.",1003:"zpush connect fail.",1004:"zpush handshake fail.",1005:"zpush login fail.",1006:"user login state is wrong.",1007:"got no zpush addr",1008:"token error",1009:"dispatch error",1010:"token expired",1011:"token format error",2002:"biz channel error",1e9:"liveroom cmd error, code:",1000002001:"need relogin",1000002002:"third token auth error",1000002003:"token nonce type should be int64",1000002004:"token appid type  should be uint32",1000002005:"token timeout type should be int64",1000002006:"token user_id type should be string",1000002007:"token room_id type should be string",1000002008:"token format error",1000002009:"token privilege type should be map",1000002010:"token expire_time type should be int64",1000002011:"token user_id type should be string",1000002012:"token not exist",1000002013:"token update error",1000002014:"token not need to check"};return 0===e?i.a.SUCCESS:((t=a({},i.a.ROOM_INNER_ERROR)).code=e,t.msg=1e9<e?(r=o[e])?"liveroom cmd error, code: "+e+", message: "+r:o[1e9]+e:o[e]?o[e]+" code:"+e:"unknown error code:"+e,t)},l.unregisterCallback=function(e,t){delete t[e+"SuccessCallback"],delete t[e+"ErrorCallback"]},l.decodeServerError=function(e,t){var r={code:-1,message:"server error"};return r.code=1e9<e?e-1e9+52e6:e+2002e6,t&&(r.message=t),r},l.getLiveRoomError=function(t,r){var o={1016:"MULTI_ROOM_UNABLE",1105:"ROOM_MAX_USER_COUNT",1012:"PUBLISHER_ERROR_REPETITIVE_PUBLISH_STREAM",2002:"TOKEN_ERROR",2003:"ROOM_ERROR_LOGIN_TIMEOUT",2010:"TOKEN_ERROR",5022:"ROOM_COUNT_EXCEED",5030:"FORBID_BLACK_USER"};return"WX"==e.env.platform||r?2e5<t&&t<3e5?o[t-2e5]:t<2e5?{50116:"TOKEN_ERROR",50117:"TOKEN_EXPIRED",50118:"TOKEN_ERROR",50119:"TOKEN_ERROR",50120:"TOKEN_ERROR",50121:"TOKEN_ERROR",50122:"TOKEN_ERROR",50123:"TOKEN_EXPIRED",50124:"TOKEN_ERROR",50125:"TOKEN_ERROR",50126:"TOKEN_ERROR",50127:"TOKEN_ERROR",50128:"TOKEN_ERROR"}[t]||o[t]||"ROOM_INNER_ERROR":o[t]||"ROOM_INNER_ERROR":1e9<t?o[t-1e9]||"":{1:"PARSE_JSON_ERROR",1001:"LOGIN_PROCESSING",1002:"LIVEROMM_REQUEST_ERROR",1003:"ZPUSH_REQUEST_FAIL",1004:"ZPUSH_REQUEST_FAIL",1005:"ZPUSH_REQUEST_FAIL",1006:"LOGIN_STATE_WRONG",1007:"ZPUSH_REQUEST_FAIL",1008:"TOKEN_ERROR",1009:"DIAPATCH_ERROR",1010:"TOKEN_EXPIRED",1011:"TOKEN_ERROR",1012:"SUBCMD_ERROR",1101:"ZEGO_AUTH_ERROR",2001:"BIZ_CHANNEL_ERROR",2002:"BIZ_CHANNEL_ERROR"}[t]||"ROOM_INNER_ERROR"},l.getKickoutError=function(e,t){var r={code:e,message:"kickout reason = "+e};if(t)switch(e){case 1:r.code=63000001,r.message="zpush multiple login kickout",r.name="MULTIPLE_LOGIN_KICKOUT";break;case 2:r.code=63000002,r.message="zpush manual kickout",r.name="MANUAL_KICKOUT";break;case 4:r.code=63000005,r.message="zpush token expired",r.name="TOKEN_EXPIRED";break;default:r.code=e,r.message="kickout reason = "+e}else switch(e){case 1:r.code=63000001,r.message="zpush multiple login kickout",r.name="MULTIPLE_LOGIN_KICKOUT";break;case 2:r.code=63000002,r.message="zpush manual kickout",r.name="MANUAL_KICKOUT";break;case 3:r.code=63000003,r.message="kickout reason = "+e;break;case 4:r.code=63000004,r.message="zpush multiple login kickout",r.name="MULTIPLE_LOGIN_KICKOUT";break;case 5:r.code=63000005,r.message="zpush token expired",r.name="TOKEN_EXPIRED";break;default:r.code=e,r.message="kickout reason = "+e}return r},l.dataReportEvent=function(e,t,r,o,n){switch(r){case"eventStart":e.eventStart(t,o);break;case"eventEndWithMsgInfo":e.eventEndWithMsgInfo(t,o,n[0]);break;case"addEventMsg":e.addEventMsg(t,o,n[0],n[1]);break;case"addEvent":e.addEvent(t,o);break;case"eventEnd":e.eventEnd(t,o);break;case"addMsgInfo":e.addMsgInfo(t,n[0])}},l.mergeUserList=function(e,t,r,o){e.debug("msl.0 call");var n=[],i=[];r=r||[];for(var s=0;s<r.length;s++){for(var a=!1,u=0;u<t.length;u++)if(r[s].userID===t[u].userID){a=!0;break}a||n.push(r[s])}for(var l=0;l<t.length;l++){a=!1;for(var h=0;h<r.length;h++)if(t[l].userID===r[h].userID){a=!0;break}a||i.push(t[l])}for(t.splice(0),s=0;s<r.length;s++)t.push(t[s]);o(n,i),e.debug("msl.0 call success")},l.checkInteger=function(e,t){return 0==t?"number"==typeof e&&e%1==0&&0<=e:"number"==typeof e&&e%1==0&&0<e},l.checkValidNumber=function(e,t,r){return t=t||1,r=r||1e4,"number"==typeof e&&e%1==0&&t<=e&&e<=r},l.generateRandumNumber=function(e){return parseInt(Math.random()*(e+1)+"",10)},l.uuid=function(e,t){var r,o,n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),i=[];if(t=t||n.length,e)for(r=0;r<e;r++)i[r]=n[0|Math.random()*t];else for(i[8]=i[13]=i[18]=i[23]="-",i[14]="4",r=0;r<36;r++)i[r]||(o=0|16*Math.random(),i[r]=n[19==r?3&o|8:o]);return i.join("")},l.isTestEnv=function(e){return!(!e.startsWith("wss")||-1===e.indexOf("test")||!e.endsWith("ws"))},l.getUint64=function(e,t,r){var o=r.getUint32(e,t);return r=r.getUint32(e+4,t),e=t?o+Math.pow(2,32)*r:Math.pow(2,32)*o+r,Number.isSafeInteger(e)||console.warn(e,"exceeds MAX_SAFE_INTEGER. Precision may be lost"),e},l.decodeTokenExpire=function(e){try{var t,r=Uint8Array.from(Object(o.a)(e),(function(e){return e.charCodeAt(0)})),n=new DataView(r.buffer);return 0<(t="function"==typeof n.getBigInt64?n.getBigUint64(0):l.getUint64(0,!1,n))?Number(t):Number(n.getBigUint64(0,!0))}catch(e){console.error("token error")}return-1},l.bin2hex=function(e){for(var t,r="",o=0,n=(e+="").length;o<n;o++)r+=(t=e.charCodeAt(o).toString(16)).length<2?"0"+t:t;return r},l.getCanvasFingerprint=function(e){var t=document.createElement("canvas"),r=((r=t.getContext("2d")).textBaseline="top",r.font="14px 'Arial'",r.fillStyle="#f60",r.fillRect(125,1,62,20),r.fillStyle="#069",r.fillText(e,2,15),r.fillStyle="rgba(102, 204, 0, 0.7)",r.fillText(e,4,17),t.toDataURL().replace("data:image/png;base64,",""));return e=atob(r),this.bin2hex(e.slice(-16,-12))},l.generateUUID=function(e){void 0===e&&(e=0);var t,r=Object(s.a)("z_deviceID");return r||(t=(new Date).getTime(),r="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var r=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?r:3&r|8).toString(36)})),0===e&&(r=this.getCanvasFingerprint("hello, zego")+r.slice(8)),Object(s.c)("z_deviceID",r),r)},l.getNetTypeNum=function(){var e=n.i.NT_UNKNOWN,t="";return-1<(t=(t=Object(s.a)("netType")||"").toLocaleUpperCase()).indexOf("4G")?e=n.i.NT_4G:-1<t.indexOf("2G")?e=n.i.NT_2G:-1<t.indexOf("3G")?e=n.i.NT_3G:-1<t.indexOf("WIFI")?e=n.i.NT_WIFI:-1<t.indexOf("LINE")?e=n.i.NT_LINE:-1<t.indexOf("NONE")&&(e=n.i.NT_NONE),e},l);function l(){}}).call(this,r(13))},function(e,t,r){var o=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=null;try{t=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(e){}function r(e,t,r){this.low=0|e,this.high=0|t,this.unsigned=!!r}function o(e){return!0===(e&&e.__isLong__)}function n(e){var t=Math.clz32(e&-e);return e?31-t:t}Object.defineProperty(r.prototype,"__isLong__",{value:!0}),r.isLong=o;var i={},s={};function a(e,t){var r,o,n;return t?(n=0<=(e>>>=0)&&e<256)&&(o=s[e])?o:(r=l(e,0,!0),n&&(s[e]=r),r):(n=-128<=(e|=0)&&e<128)&&(o=i[e])?o:(r=l(e,e<0?-1:0,!1),n&&(i[e]=r),r)}function u(e,t){if(isNaN(e))return t?y:_;if(t){if(e<0)return y;if(g<=e)return C}else{if(e<=-m)return R;if(m<=e+1)return b}return e<0?u(-e,t).neg():l(e%p|0,e/p|0,t)}function l(e,t,o){return new r(e,t,o)}r.fromInt=a,r.fromNumber=u,r.fromBits=l;var h=Math.pow;function c(e,t,r){if(0===e.length)throw Error("empty string");if(t="number"==typeof t?(r=t,!1):!!t,"NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return t?y:_;if((r=r||10)<2||36<r)throw RangeError("radix");var o;if(0<(o=e.indexOf("-")))throw Error("interior hyphen");if(0===o)return c(e.substring(1),t,r).neg();for(var n=u(h(r,8)),i=_,s=0;s<e.length;s+=8){var a=Math.min(8,e.length-s),l=parseInt(e.substring(s,s+a),r);i=(a<8?(a=u(h(r,a)),i.mul(a)):i=i.mul(n)).add(u(l))}return i.unsigned=t,i}function d(e,t){return"number"==typeof e?u(e,t):"string"==typeof e?c(e,t):l(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}r.fromString=c,r.fromValue=d;var p=4294967296,g=p*p,m=g/2,f=a(1<<24),_=a(0),y=(r.ZERO=_,a(0,!0)),v=(r.UZERO=y,a(1)),S=(r.ONE=v,a(1,!0)),E=(r.UONE=S,a(-1)),b=(r.NEG_ONE=E,l(-1,2147483647,!1)),C=(r.MAX_VALUE=b,l(-1,-1,!0)),R=(r.MAX_UNSIGNED_VALUE=C,l(0,-2147483648,!1)),T=(r.MIN_VALUE=R,r.prototype);return T.toInt=function(){return this.unsigned?this.low>>>0:this.low},T.toNumber=function(){return this.unsigned?(this.high>>>0)*p+(this.low>>>0):this.high*p+(this.low>>>0)},T.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";var t,r;if(this.isNegative())return this.eq(R)?(r=u(e),r=(t=this.div(r)).mul(r).sub(this),t.toString(e)+r.toInt().toString(e)):"-"+this.neg().toString(e);for(var o=u(h(e,6),this.unsigned),n=this,i="";;){var s=n.div(o),a=(n.sub(s.mul(o)).toInt()>>>0).toString(e);if((n=s).isZero())return a+i;for(;a.length<6;)a="0"+a;i=""+a+i}},T.getHighBits=function(){return this.high},T.getHighBitsUnsigned=function(){return this.high>>>0},T.getLowBits=function(){return this.low},T.getLowBitsUnsigned=function(){return this.low>>>0},T.getNumBitsAbs=function(){if(this.isNegative())return this.eq(R)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;0<t&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},T.isZero=function(){return 0===this.high&&0===this.low},T.eqz=T.isZero,T.isNegative=function(){return!this.unsigned&&this.high<0},T.isPositive=function(){return this.unsigned||0<=this.high},T.isOdd=function(){return 1==(1&this.low)},T.isEven=function(){return 0==(1&this.low)},T.equals=function(e){return o(e)||(e=d(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},T.eq=T.equals,T.notEquals=function(e){return!this.eq(e)},T.neq=T.notEquals,T.ne=T.notEquals,T.lessThan=function(e){return this.comp(e)<0},T.lt=T.lessThan,T.lessThanOrEqual=function(e){return this.comp(e)<=0},T.lte=T.lessThanOrEqual,T.le=T.lessThanOrEqual,T.greaterThan=function(e){return 0<this.comp(e)},T.gt=T.greaterThan,T.greaterThanOrEqual=function(e){return 0<=this.comp(e)},T.gte=T.greaterThanOrEqual,T.ge=T.greaterThanOrEqual,T.compare=function(e){var t,r;return o(e)||(e=d(e)),this.eq(e)?0:(t=this.isNegative(),r=e.isNegative(),t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1)},T.comp=T.compare,T.negate=function(){return!this.unsigned&&this.eq(R)?R:this.not().add(v)},T.neg=T.negate,T.add=function(e){o(e)||(e=d(e));var t=0,r=0,n=0,i=0;return r+=(n=n+((i+=(65535&this.low)+(65535&e.low))>>>16)+((this.low>>>16)+(e.low>>>16)))>>>16,l((n&=65535)<<16|(i&=65535),((t+=(r+=(65535&this.high)+(65535&e.high))>>>16)+((this.high>>>16)+(e.high>>>16))&65535)<<16|(r&=65535),this.unsigned)},T.subtract=function(e){return o(e)||(e=d(e)),this.add(e.neg())},T.sub=T.subtract,T.multiply=function(e){var r,n,i,s,a,h,c,p,g,m;return this.isZero()?this:(o(e)||(e=d(e)),t?l(t.mul(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):e.isZero()?this.unsigned?y:_:this.eq(R)?e.isOdd()?R:_:e.eq(R)?this.isOdd()?R:_:this.isNegative()?e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg():e.isNegative()?this.mul(e.neg()).neg():this.lt(f)&&e.lt(f)?u(this.toNumber()*e.toNumber(),this.unsigned):(s=e.high>>>16,a=65535&e.high,h=e.low>>>16,m=(m=g=p=c=0)+((p=p+((g+=(i=65535&this.low)*(e=65535&e.low))>>>16)+(n=this.low>>>16)*e)>>>16)+((p=(65535&p)+i*h)>>>16),l((p&=65535)<<16|(g&=65535),(c=(c=(c+=(m+=(r=65535&this.high)*e)>>>16)+((m=(65535&m)+n*h)>>>16)+((m=(65535&m)+i*a)>>>16))+((this.high>>>16)*e+r*h+n*a+i*s)&65535)<<16|(m&=65535),this.unsigned)))},T.mul=T.multiply,T.divide=function(e){if((e=o(e)?e:d(e)).isZero())throw Error("division by zero");var r,n,i;if(t)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?l((this.unsigned?t.div_u:t.div_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?y:_;if(this.unsigned){if((e=e.unsigned?e:e.toUnsigned()).gt(this))return y;if(e.gt(this.shru(1)))return S;n=y}else{if(this.eq(R))return e.eq(v)||e.eq(E)?R:e.eq(R)?v:(i=this.shr(1).div(e).shl(1)).eq(_)?e.isNegative()?v:E:(r=this.sub(e.mul(i)),i.add(r.div(e)));if(e.eq(R))return this.unsigned?y:_;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();n=_}for(r=this;r.gte(e);){i=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(i)/Math.LN2),a=s<=48?1:h(2,s-48),c=u(i),p=c.mul(e);p.isNegative()||p.gt(r);)p=(c=u(i-=a,this.unsigned)).mul(e);c.isZero()&&(c=v),n=n.add(c),r=r.sub(p)}return n},T.div=T.divide,T.modulo=function(e){return o(e)||(e=d(e)),t?l((this.unsigned?t.rem_u:t.rem_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},T.mod=T.modulo,T.rem=T.modulo,T.not=function(){return l(~this.low,~this.high,this.unsigned)},T.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},T.clz=T.countLeadingZeros,T.countTrailingZeros=function(){return this.low?n(this.low):n(this.high)+32},T.ctz=T.countTrailingZeros,T.and=function(e){return o(e)||(e=d(e)),l(this.low&e.low,this.high&e.high,this.unsigned)},T.or=function(e){return o(e)||(e=d(e)),l(this.low|e.low,this.high|e.high,this.unsigned)},T.xor=function(e){return o(e)||(e=d(e)),l(this.low^e.low,this.high^e.high,this.unsigned)},T.shiftLeft=function(e){return o(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?l(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):l(0,this.low<<e-32,this.unsigned)},T.shl=T.shiftLeft,T.shiftRight=function(e){return o(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?l(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):l(this.high>>e-32,0<=this.high?0:-1,this.unsigned)},T.shr=T.shiftRight,T.shiftRightUnsigned=function(e){return o(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?l(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):l(32===e?this.high:this.high>>>e-32,0,this.unsigned)},T.shru=T.shiftRightUnsigned,T.shr_u=T.shiftRightUnsigned,T.rotateLeft=function(e){var t;return o(e)&&(e=e.toInt()),0==(e&=63)?this:32===e?l(this.high,this.low,this.unsigned):e<32?l(this.low<<e|this.high>>>(t=32-e),this.high<<e|this.low>>>t,this.unsigned):l(this.high<<(e-=32)|this.low>>>(t=32-e),this.low<<e|this.high>>>t,this.unsigned)},T.rotl=T.rotateLeft,T.rotateRight=function(e){var t;return o(e)&&(e=e.toInt()),0==(e&=63)?this:32===e?l(this.high,this.low,this.unsigned):e<32?l(this.high<<(t=32-e)|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned):l(this.low<<(t=32-(e-=32))|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned)},T.rotr=T.rotateRight,T.toSigned=function(){return this.unsigned?l(this.low,this.high,!1):this},T.toUnsigned=function(){return this.unsigned?this:l(this.low,this.high,!0)},T.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},T.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},T.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},r.fromBytes=function(e,t,o){return o?r.fromBytesLE(e,t):r.fromBytesBE(e,t)},r.fromBytesLE=function(e,t){return new r(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},r.fromBytesBE=function(e,t){return new r(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)},e.default=r,"default"in e?e.default:e}({});void 0!==(t=function(){return o}.apply(t,[]))&&(e.exports=t)},function(e,t,r){"use strict";r.d(t,"f",(function(){return l})),r.d(t,"c",(function(){return o})),r.d(t,"a",(function(){return n})),r.d(t,"e",(function(){return i})),r.d(t,"d",(function(){return s})),r.d(t,"b",(function(){return a}));var o,n,i,s,a,u=r(9),l=(Object.defineProperty(h.prototype,"clientIP",{get:function(){var e;return(null==(e=this.connection)?void 0:e.clientIP)||""},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"timeOffset",{get:function(){var e;return null==(e=this.connection)?void 0:e.timeOffset},enumerable:!1,configurable:!0}),h.prototype.init=function(){var e;null!=(e=this.connection)&&e.init()},h.prototype.unInit=function(){var e;null!=(e=this.connection)&&e.unInit()},h.prototype.setAppInfo=function(e){var t;null!=(t=this.connection)&&t.setAppInfo(e)},h.prototype.setUserInfo=function(e){var t;null!=(t=this.connection)&&t.setUserInfo(e)},h.prototype.setNetAgentDefaultServers=function(e){var t;null!=(t=this.connection)&&t.setNetAgentDefaultServers(e)},h.prototype.setBackupDomains=function(e){var t;null!=(t=this.connection)&&t.setBackupDomains(e)},h.prototype.setDispatchConnectServers=function(e){var t;null!=(t=this.connection)&&t.setDispatchConnectServers(e)},h.prototype.setNetAgentSpecifiedServers=function(e){var t;null!=(t=this.connection)&&t.setNetAgentSpecifiedServers(e)},h.prototype.startHttpRequest=function(e,t,r,o,n){var i;null!=(i=this.connection)&&i.startHttpRequest(e,t,r,o,n)},h.prototype.startHttpRequest2=function(e,t,r,o,n){var i;null!=(i=this.connection)&&i.startHttpRequest2(e,t,r,o,n)},h.prototype.getAppConfigByAgent=function(e,t,r,o){var n;return null==(n=this.connection)?void 0:n.getAppConfigByAgent(e,t,r,o)},h.prototype.getPCRequest=function(e,t){var r;return(null==(r=this.connection)?void 0:r.getPCRequest(e,t))||null},h.prototype.connectUa=function(){var e;null!=(e=this.connection)&&e.connectUa()},h.prototype.destroyConnect=function(){var e;null!=(e=this.connection)&&e.destroyConnect()},h.prototype.destroy=function(){var e;null!=(e=this.connection)&&e.destroy()},h.prototype.isConnect=function(){return!!this.connection&&this.connection.isConnect()},h.prototype.on=function(e,t){var r;return(null==(r=this.connection)?void 0:r.on(e,t))||!0},h.prototype.off=function(e,t){var r;return null==(r=this.connection)?void 0:r.off(e,t)},h.prototype.setLogger=function(e){var t;return null==(t=this.connection)?void 0:t.setLogger(e)},h.prototype.setAccess=function(e){var t;return null==(t=this.connection)?void 0:t.setAccess(e)},h);function h(){this.connection=null,this.isLoad=!1,this.callBackList=[],this.connection=new u.ZegoConnectionAgent}(t=o=o||{})[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL",(r=n=n||{})[r.EMPTY=0]="EMPTY",r[r.CLOSE=1]="CLOSE",(t=i=i||{})[t.Mode_UNSET=0]="Mode_UNSET",t[t.MODE_ONLINE=1]="MODE_ONLINE",t[t.MODE_TEST=2]="MODE_TEST",t[t.MODE_ALPHA=3]="MODE_ALPHA",(r=s=s||{})[r.CLOSE=0]="CLOSE",r[r.TEMP=1]="TEMP",r[r.TIMEOUT=2]="TIMEOUT",(t=a=a||{})[t.SERVICE_UNSET=0]="SERVICE_UNSET",t[t.SERVICE_MEDIAGW=1]="SERVICE_MEDIAGW",t[t.SERVICE_LIVEROOM=2]="SERVICE_LIVEROOM",t[t.SERVICE_MIX=3]="SERVICE_MIX",t[t.SERVICE_ZEUS=4]="SERVICE_ZEUS",t[t.SERVICE_ZPUSH=5]="SERVICE_ZPUSH",t[t.SERVICE_L3=6]="SERVICE_L3",t[t.SERVICE_TALKLINE=7]="SERVICE_TALKLINE",t[t.SERVICE_EDUSUITE=8]="SERVICE_EDUSUITE",t[t.SERVICE_ZIM=9]="SERVICE_ZIM",t[t.SERVICE_ClOUD_SETTING=10]="SERVICE_ClOUD_SETTING",t[t.SERVICE_ZEUSHB=11]="SERVICE_ZEUSHB",t[t.SERVICE_USER_LOGIC=12]="SERVICE_USER_LOGIC",t[t.SERVICE_UNIFYDISPATCH=13]="SERVICE_UNIFYDISPATCH",t[t.SERVICE_QUALITY=14]="SERVICE_QUALITY",t[t.SERVICE_SECURITY=15]="SERVICE_SECURITY",t[t.SERVICE_KTVCPR=16]="SERVICE_KTVCPR",t[t.SERVICE_SWITCH4LIVEROOM=17]="SERVICE_SWITCH4LIVEROOM",t[t.SERVICE_WEBRTC_SIGNAL=18]="SERVICE_WEBRTC_SIGNAL",t[t.SERVICE_L3_WEBRTC_SIGNAL=19]="SERVICE_L3_WEBRTC_SIGNAL",t[t.SERVICE_VIDEOCPR=20]="SERVICE_VIDEOCPR",t[t.SERVICE_CDN=21]="SERVICE_CDN",t[t.SERVICE_CLOUDRECORD=22]="SERVICE_CLOUDRECORD",t[t.SERVICE_INNER_ECHO=23]="SERVICE_INNER_ECHO",t[t.SERVICE_OUTER_ECHO=24]="SERVICE_OUTER_ECHO",t[t.SERVICE_LOCALHOST_ECHO=25]="SERVICE_LOCALHOST_ECHO",t[t.SERVICE_ECHO=26]="SERVICE_ECHO",t[t.SERVICE_DOCSERVICE=27]="SERVICE_DOCSERVICE",t[t.SERVICE_AUTHSVR=28]="SERVICE_AUTHSVR"},function(e,t,r){"use strict";function o(e,t){my.setStorageSync({key:e,data:t})}function n(e){return my.getStorageSync({key:e}).data}function i(){my.getNetworkType({success:function(e){o("netType",(e="NOTREACHABLE"==(e=e.networkType)?"none":e).toLowerCase())}})}r.d(t,"c",(function(){return o})),r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return i})),r(0)},function(e,t,r){function o(e){var t;return(i[e]||(t=i[e]={i:e,l:!1,exports:{}},n[e].call(t.exports,t,t.exports,o),t.l=!0,t)).exports}var n,i;e.exports=(n=[function(e,t,r){"use strict";r.r(t),r.d(t,"ZegoLogger",(function(){return K})),r.d(t,"ZegoDataReport",(function(){return p})),r.d(t,"createZegoWebSocket",(function(){return c})),r.d(t,"LoggerStateCenter",(function(){return s})),a.getInstance=function(){return a.instance||(a.instance=new a).init(),a.instance},a.prototype.init=function(){},Object.defineProperty(a.prototype,"testEnvironment",{get:function(){return this._testEnvironment},set:function(e){this._testEnvironment=e},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"ENV",{get:function(){return this._ENV},set:function(e){this._ENV=e},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"debug",{get:function(){return this._debug},set:function(e){this._debug=e},enumerable:!1,configurable:!0}),a.instance=new a;var o,n,i,s=a;function a(){this._testEnvironment=!0,this._ENV=0,this._debug=!0}(r=o=o||{})[r.BROWSER=0]="BROWSER",r[r.WEIXINMINI=1]="WEIXINMINI",(n=n||{})[n.DEFAULT=0]="DEFAULT",(t=i=i||{})[t.DISABLE=0]="DISABLE",t[t.WEBSOCKET=1]="WEBSOCKET",t[t.HTTPS=2]="HTTPS";var u={DEBUG:0,INFO:1,WARN:2,ERROR:3,REPORT:99,DISABLE:100,debug:0,info:1,warn:2,error:3,report:99,disable:100},l=(h.prototype.init=function(){var e=this;this._websocket&&(this.readyState=0,this._websocket.onOpen((function(t){e.readyState=1,"function"==typeof e.onopen&&(e.onopen(t),e._websocket.onClose((function(t){e.readyState=3,"function"==typeof e.onclose&&e.onclose(t)})),e._websocket.onMessage((function(t){t=t.data,"function"==typeof e.onmessage&&e.onmessage(t)})))})),this._websocket.onError((function(t){e.readyState=3,"function"==typeof e.onerror&&e.onerror(t)})))},h.prototype.onopen=function(e){},h.prototype.onerror=function(e){},h.prototype.onclose=function(e){},h.prototype.onmessage=function(e){},h.prototype.send=function(e){this._websocket&&this._websocket.send({data:e})},h.prototype.close=function(){this._websocket&&this._websocket.close()},h);function h(e,t){this.url=e,this.readyState=3,this._websocket=my.connectSocket({url:e,multiple:!0}),this.init()}function c(e,t){return new(t%2===o.BROWSER?WebSocket:l)(e)}var d=function(){return(d=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},p=(g.prototype.newReport=function(e,t){this.dataStatistics[e]={event_time:Date.now(),time_consumed:0,seq:e,error:0,message:"success",event:t,events:[]}},g.prototype.addMsgExt=function(e,t){this.dataStatistics[e]?this.dataStatistics[e].msg_ext=t:console.warn("".concat(e," not exist"))},g.prototype.addMsgInfo=function(e,t){this.dataStatistics[e]?Object.assign(this.dataStatistics[e],t):console.warn("".concat(e," not exist"))},g.prototype.eventStart=function(e,t){this.dataStatistics[e]?null!=this.dataStatistics[e].events?this.dataStatistics[e].events.push({event:t,event_time:Date.now(),time_consumed:0}):this.logger.warn("zd.es.0 no events"):this.logger.warn("zd.es.0 no seq match")},g.prototype.eventEnd=function(e,t,r){if(this.dataStatistics[e]){var o=this.dataStatistics[e].events;if(o&&0!==o.length){for(var n=o.length-1;0<=n;n--)if(o[n].event==t&&0==o[n].time_consumed){o[n].time_consumed=Date.now()-o[n].event_time;break}}else this.logger.info("zd.ee.0 no events")}else this.logger.info("zd.ee.0 no seq match")},g.prototype.eventEndWithMsg=function(e,t,r){if(this.dataStatistics[e]){var o=this.dataStatistics[e].events;if(o){for(var n=o.length-1;0<=n;n--)if(o[n].event==t&&0==o[n].time_consumed){o[n].time_consumed=Date.now()-o[n].event_time,null==o[n].msg_ext&&(o[n].msg_ext={}),o[n].msg_ext=d({},r);break}}else this.logger.warn("zd.ee.0 no events")}else this.logger.warn("zd.ee.0 no seq match")},g.prototype.eventEndWithMsgInfo=function(e,t,r){if(this.dataStatistics[e]){var o=this.dataStatistics[e].events;if(o){for(var n=o.length-1;0<=n;n--)if(o[n].event==t&&0==o[n].time_consumed){o[n].time_consumed=Date.now()-o[n].event_time,Object.assign(o[n],r);break}}else this.logger.warn("zd.ee.0 no events")}else this.logger.warn("zd.ee.0 no seq match")},g.prototype.addEventInfo=function(e,t,r,o){if(this.dataStatistics[e]){var n=this.dataStatistics[e].events;if(null!=n){for(var i=n.length-1;0<=i;i--)if(n[i].event==t&&null!=n[i].time_consumed){null==n[i].msg_ext?n[i].msg_ext={}:n[i].msg_ext&&(n[i].msg_ext[r]=o);break}}else this.logger.warn("zd.aei.0 no events")}else this.logger.warn("zd.aei.0 no seq match")},g.prototype.addEventMsg=function(e,t,r,o){if(this.dataStatistics[e]){var n=this.dataStatistics[e].events;if(null!=n){for(var i=n.length-1;0<=i;i--)if(n[i].event==t){n[i][r]=o;break}}else this.logger.warn("zd.aem.0 no events")}else this.logger.warn("zd.aem.0 no seq match")},g.prototype.addEvent=function(e,t,r){this.dataStatistics[e]?this.dataStatistics[e].events&&this.dataStatistics[e].events.push(r?{event:t,event_time:Date.now(),msg_ext:r}:{event:t,event_time:Date.now()}):this.logger.warn("zd.ae.0 no seq match")},g.prototype.uploadReport=function(e,t,r,o){var n=this.dataStatistics[e];null!=n&&(t&&(n.event=t),n.time_consumed=Date.now()-n.event_time,r&&this.addMsgInfo(e,{error:r.code,message:r.message||r.msg+" "+(o||"")}),this.logger.report(n),delete this.dataStatistics[e])},g);function g(e){this.dataStatistics={},this.logger=e}var m,f=["00","01","02","03","04","05","06","07","08","09"];function _(){var e=new Date;return[e.getFullYear()+"/",(f[e.getMonth()+1]||e.getMonth()+1)+"/",(f[e.getDate()]||e.getDate())+" ",(f[e.getHours()]||e.getHours())+":",(f[e.getMinutes()]||e.getMinutes())+":",f[e.getSeconds()]||e.getSeconds(),"."+e.getTime()%1e3].join("")}function y(e){this.cache=e}(r=m=m||{}).WEBSOCKET_STATE_CHANGE="zl.net.wsc",r.OPEN_WS="zl.net.opws",Object.defineProperty(oe.prototype,"url",{get:function(){return this.configState.url},set:function(e){this.configState.url=e},enumerable:!1,configurable:!0}),Object.defineProperty(oe.prototype,"strategy",{get:function(){return this.senderBuilder.strategy},enumerable:!1,configurable:!0}),oe.prototype.setStrategy=function(e){this.senderBuilder.setStrategy(e),this.sender=this.senderBuilder.build()},oe.prototype.addRemoteWsLog=function(e){if(this.configState.env!=o.BROWSER)throw new Error("cannot use net strategy on alipay mini program");var t;this.closed()&&(t=this.url,this.url="",this.openWebSocketLogServer(t)),this.cache.push(e),this.connected()&&this.sender&&this.sender.active()},oe.prototype.stopWebSocketServer=function(){this.websocket&&(this.websocket.onclose=null,this.websocket.onerror=null,this.websocket.close(),this.websocket=null)},oe.prototype.updateSender=function(){this.websocket instanceof WebSocket&&this.configState.useStrategy&&(this.senderBuilder.setWs(this.websocket),this.senderBuilder.setCache(this.cache),this.sender=this.senderBuilder.build())},oe.prototype.updateWebSocketState=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var o=this.websocketState,n="";switch(e){case"onconnecting":this.websocketState="never_opened"===this.websocketState?"first_connecting":"reconnecting";break;case"onopen":this.websocketState="connected";break;case"onclosed":this.websocketState="closed";var i=t[0];i&&(n+=" close code=".concat(i.code));break;case"onerror":this.websocketState="error"}e=m.WEBSOCKET_STATE_CHANGE+" log ws state change: ".concat(o," -> ").concat(this.websocketState),n&&(e+=n),this.innerLogger.info(e)},oe.prototype.openWebSocketLogServer=function(e){var t=this;this.url!=e&&((this.url&&""!==this.url||"never_opened"===this.websocketState)&&this.innerLogger.info(m.OPEN_WS+" log url change to: ".concat(e)),this.url=e)&&(this.stopWebSocketServer(),this.websocket=c(e,this.configState.env),this.updateSender(),this.updateWebSocketState("onconnecting"),this.websocket.onopen=function(){var e;t.configState.useStrategy&&null!=(e=t.sender)&&e.active(),t.updateWebSocketState("onopen")},this.websocket.onclose=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];console.warn("onclose   websocket error:",e),t.updateWebSocketState.apply(t,function(e,t,r){if(r||2===arguments.length)for(var o,n=0,i=t.length;n<i;n++)!o&&n in t||((o=o||Array.prototype.slice.call(t,0,n))[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))}(["onclosed"],e,!1))},this.websocket.onmessage=function(){},this.websocket.onerror=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];console.warn("open log websocket error:",e),t.updateWebSocketState("onerror")})},oe.prototype.closed=function(){return null==this.websocket||2==this.websocket.readyState||3==this.websocket.readyState},oe.prototype.connected=function(){return null!==this.websocket&&1==this.websocket.readyState},oe.prototype.connecting=function(){return null!==this.websocket&&0==this.websocket.readyState},oe.prototype.wsSend=function(e){this.websocket&&this.websocket.send(e)},oe.prototype.destroy=function(){this.websocket=null};var v,S=oe,E=(re.prototype.active=function(){var e=this;this.ws&&1===this.ws.readyState&&0!==this.cache.size()&&this.strategy.canSendLog()&&(this.strategy.getLog().forEach((function(t){e.ws.send(t)})),this.strategy.onSendLog())},re),b=(v=function(e,t){return(v=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e){function t(t){return e.call(this,t)||this}var r=t,o=e;if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=r}return v(r,o),r.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n),t.prototype.getLog=function(){return this.cache.clear()},t.prototype.canSendLog=function(){return 0<this.cache.size()},t.prototype.onSendLog=function(){},t}(y));W=function(e,t){return(W=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}W(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(te,V=y),te.prototype.canSendLog=function(){return!this.locked&&0<this.cache.size()},te.prototype.getLog=function(){for(var e=[],t=0;t<this.maxPacketLen-4e3;){var r=this.cache.getOneLogPacket();if(!r||r.length<=0)break;t+=r.length||0,e.push(r)}return e},te.prototype.onSendLog=function(){var e=this;this.locked=!0,setTimeout((function(){e.locked=!1,e.onCanSendActive&&e.onCanSendActive()}),this.maxDelay)},z=function(e,t){return(z=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}z(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(ee,G=t=te);var C=ee,R=(B=function(e,t){return(B=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(){return null!==q&&q.apply(this,arguments)||this});if("function"!=typeof(r=q=t)&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function T(){this.constructor=R}B(R,r),R.prototype=null===r?Object.create(r):(T.prototype=r.prototype,new T),H=function(e,t){return(H=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)};var I=function(){return null!==x&&x.apply(this,arguments)||this};if("function"!=typeof(r=x=t)&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function P(){this.constructor=I}function M(){this.url="",this.env=o.BROWSER,this.useStrategy=!0,this.token="",this.deviceid=k.id()}H(I,r),I.prototype=null===r?Object.create(r):(P.prototype=r.prototype,new P),U=function(e,t){return(U=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}U(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}((function(){return null!==D&&D.apply(this,arguments)||this}),D=t),Object.defineProperty(J.prototype,"strategy",{get:function(){return this._strategy},enumerable:!1,configurable:!0}),J.prototype.setWs=function(e){this.ws=e},J.prototype.setCache=function(e){this.cache=e},J.prototype.setStrategy=function(e){e&&(this._strategy=e)},J.prototype.build=function(){if(this.ws&&this.cache)return new E(this.ws,this.cache,this._strategy!==n.DEFAULT?new b(this.cache):new C(this.cache));throw new Error("cannot build log sender")};var L=J,k=(Z.isEnvSupport=function(){return!(!window||!window.localStorage)},Z.bin2hex=function(e){for(var t,r="",o=0,n=(e+="").length;o<n;o++)r+=(t=e.charCodeAt(o).toString(16)).length<2?"0"+t:t;return r},Z.getCanvasFingerprint=function(e){var t=document.createElement("canvas"),r=((r=t.getContext("2d")).textBaseline="top",r.font="14px 'Arial'",r.fillStyle="#f60",r.fillRect(125,1,62,20),r.fillStyle="#069",r.fillText(e,2,15),r.fillStyle="rgba(102, 204, 0, 0.7)",r.fillText(e,4,17),t.toDataURL().replace("data:image/png;base64,",""));return e=atob(r),this.bin2hex(e.slice(-16,-12))},Z.generateUUID=function(){var e,t,r;return(t=localStorage.getItem(this.storageKey))||(e=(new Date).getTime(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?r:3&r|8).toString(36)})),r=this.getCanvasFingerprint("hello, zego")+t.slice(8),localStorage.setItem(this.storageKey,r),t)},Z.id=function(){var e;return Z.isEnvSupport()?((e=localStorage.getItem(this.storageKey))||(e=Z.generateUUID(),localStorage.setItem(this.storageKey,e)),e):""},Z.storageKey="z_deviceID",Z);function N(e,t,r,o){return new(r=r||Promise)((function(n,i){function s(e){try{u(o.next(e))}catch(e){i(e)}}function a(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?n(e.value):((t=e.value)instanceof r?t:new r((function(e){e(t)}))).then(s,a)}u((o=o.apply(e,t||[])).next())}))}function O(e,t){var r,o,n,i={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},s={next:a(0),throw:a(1),return:a(2)};return"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(u){var l=[a,u];if(r)throw new TypeError("Generator is already executing.");for(;i=s&&l[s=0]?0:i;)try{if(r=1,o&&(n=2&l[0]?o.return:l[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,l[1])).done)return n;switch(o=0,(l=n?[2&l[0],n.value]:l)[0]){case 0:case 1:n=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,o=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(!((n=0<(n=i.trys).length&&n[n.length-1])||6!==l[0]&&2!==l[0])){i=0;continue}if(3===l[0]&&(!n||l[1]>n[0]&&l[1]<n[3]))i.label=l[1];else if(6===l[0]&&i.label<n[1])i.label=n[1],n=l;else{if(!(n&&i.label<n[2])){n[2]&&i.ops.pop(),i.trys.pop();continue}i.label=n[2],i.ops.push(l)}}l=t.call(e,i)}catch(u){l=[6,u],o=0}finally{r=n=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}Object.defineProperty(X.prototype,"buffer",{get:function(){return this.queue},set:function(e){this.queue=e},enumerable:!1,configurable:!0}),X.prototype.push=function(e){if(!e)throw new Error("item null!");e&&this.queue.push(e)},X.prototype.pop=function(){return this.queue.shift()},X.prototype.front=function(){return this.queue[0]},w=function(e,t){return(w=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)};var A,w,D,U,x,H,q,B,G,z,V,W,j=function(){return(j=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},F=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}w(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(Q,A=r=X),Q.prototype.size=function(){return this.queue.length},Q.prototype.getOneLogPacket=function(){for(var e="";0<this.queue.length;){if(4e3<(e+this.queue[0]).length)return e;var t=JSON.parse(this.queue[0]);t=j(j({},t),{userid:t.userid||this.configState.roomid,roomid:t.roomid||this.configState.roomid,userName:t.userName||this.configState.userName}),e=e+JSON.stringify(t)+"\n",this.queue.shift()}return""===e?void 0:e},Q.prototype.clear=function(){for(var e=[];0<this.queue.length;){var t=this.getOneLogPacket();if(!t)break;e.push(t)}return e},Q),Y=function(){return(Y=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},K=(Object.defineProperty($.prototype,"url",{get:function(){return this.configState.url||""},set:function(e){this.configState.url=e},enumerable:!1,configurable:!0}),Object.defineProperty($.prototype,"logType",{get:function(){return this.configState.logType||i.DISABLE},set:function(e){this.configState.logType=e},enumerable:!1,configurable:!0}),Object.defineProperty($.prototype,"env",{get:function(){return this.configState.env},set:function(e){this.configState.env=e},enumerable:!1,configurable:!0}),Object.defineProperty($.prototype,"appid",{get:function(){return this.configState.appid},set:function(e){this.configState.appid=e},enumerable:!1,configurable:!0}),Object.defineProperty($.prototype,"roomid",{get:function(){return this.configState.roomid},set:function(e){this.configState.roomid=e},enumerable:!1,configurable:!0}),Object.defineProperty($.prototype,"sessionid",{get:function(){return this.configState.sessionid},set:function(e){this.configState.sessionid=e},enumerable:!1,configurable:!0}),Object.defineProperty($.prototype,"userid",{get:function(){return this.configState.userid},set:function(e){this.configState.userid=e},enumerable:!1,configurable:!0}),Object.defineProperty($.prototype,"userName",{get:function(){return this.configState.userName},set:function(e){this.configState.userName=e},enumerable:!1,configurable:!0}),Object.defineProperty($.prototype,"version",{get:function(){return this.configState.userName},set:function(e){this.configState.version=e},enumerable:!1,configurable:!0}),$.prototype.setLogLevel=function(e){return void 0!==(e=u[e])&&(this.logLevel=e,!0)},$.prototype.setRemoteLogLevel=function(e){return void 0!==(e=u[e])&&(this.logRemoteLevel=e,!0)},$.prototype.setSessionInfo=function(e,t,r,o,n,i){this.appid=e,this.roomid=t,this.sessionid=r,this.userid=o,this.userName=n,this.version=i},$.prototype.setTokenInfo=function(e,t){this.configState.token=e,t&&(this.configState.userid=t)},$.prototype.setZipLogConfig=function(e,t){},$.prototype.setZipLogUploadUrl=function(e){},$.prototype.makeZipLogSpaceUpload=function(){return N(this,void 0,void 0,(function(){return O(this,(function(e){return[2]}))}))},$.prototype.uploadStorageLog=function(){return N(this,void 0,void 0,(function(){return O(this,(function(e){return[2]}))}))},$.prototype.report=function(e){e=this.logReportParamList(u.REPORT,e),this.logLevel!==u.DISABLE&&this.logLevel<=u.REPORT&&console.debug(e),this.RemoteLog(u.REPORT,e,!0)},$.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.logParamList(u.DEBUG,e.join(""));this.logLevel!==u.DISABLE&&this.logLevel<=u.DEBUG&&console.debug(r),this.log(u.DEBUG,r)},$.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.logParamList(u.INFO,e.join(""));this.logLevel!==u.DISABLE&&this.logLevel<=u.INFO&&console.info(r),this.log(u.INFO,r)},$.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.logParamList(u.WARN,e.join(""));this.logLevel!==u.DISABLE&&this.logLevel<=u.WARN&&console.warn(r),this.log(u.WARN,r)},$.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=my,n=this.logParamList(u.ERROR,e.join(""));this.logLevel!==u.DISABLE&&this.logLevel<=u.ERROR&&(console.error(n),this.env%2===o.BROWSER&&window?this.stateCenter.debug&&window.alert(e.join("").substr(e.join("").indexOf(" ")+1,4500)):this.env%2===o.WEIXINMINI&&r&&this.stateCenter.debug&&my.confirm({title:"",content:e.join("").substr(e.join("").indexOf(" ")+1,4500)})),this.log(u.ERROR,n)},$.prototype.log=function(e,t){this.logRemoteLevel!==u.DISABLE&&this.logRemoteLevel<=e&&(this.RemoteLog(e,t),this.zipLogContext)&&this.zipLogContext.saveLog(t)},$.prototype.setLogServer=function(e){if(this.isDestroy)return!1;try{return e.startsWith("wss:")?(this.logType=i.WEBSOCKET,this.netContext.openWebSocketLogServer(e)):e.startsWith("https:")?(this.logType=i.HTTPS,this.openHttpsLogServer(e)):this.logType=i.DISABLE,!0}catch(e){return this.error(JSON.stringify(e)),!1}},$.prototype.stopLogServer=function(){this.logType==i.WEBSOCKET?this.stopWebSocketServer():this.logType==i.HTTPS&&(this.SendHttpsLog(),this.stopHttpsServer()),this.logType=i.DISABLE},$.prototype.stopWebSocketServer=function(){this.netContext.stopWebSocketServer()},$.prototype.openHttpsLogServer=function(e){var t=this;(this.url=e)&&(this.stopHttpsServer(),this.logUploadTimer||(this.logUploadTimer=setInterval((function(){t.SendHttpsLog()}),this.logUploadInterval)))},$.prototype.stopHttpsServer=function(){this.logUploadTimer&&(clearInterval(this.logUploadTimer),this.logUploadTimer=null)},$.prototype.RemoteLog=function(e,t,r){return void 0===r&&(r=!1),N(this,void 0,void 0,(function(){return O(this,(function(o){if(""!=this.url&&!this.isDestroy)if(this.logType==i.WEBSOCKET)this.RemoteWebSocketLog(e,t);else if(this.logType==i.HTTPS)this.RemoteHttpsLog(e,t,r);else if(this.logLevel!==u.DISABLE&&this.logLevel<=e)for(this.logCache.push(t);this.logCache.size()>this.logCacheMax;)this.logCache.pop();return[2]}))}))},$.prototype.clearLogCache=function(){var e=this;this.netContext.connected()&&this.logCache.clear().forEach((function(t){e.netContext.wsSend(t)}))},$.prototype.clearCache=function(){0!==this.logCache.size()&&this.clearLogCache()},$.prototype.saveLog=function(e){this.logCache.size()<this.logCacheMax&&this.logCache.push(e)},$.prototype.websocketSendLog=function(e){this.netContext.connected()?this.netContext.wsSend(e):this.saveLog(e)},$.prototype.RemoteWebSocketLog=function(e,t){return N(this,void 0,void 0,(function(){var e;return O(this,(function(r){return"string"==typeof t&&4e3<t.length?console.info("log over maximum, ignore"):this.configState.useStrategy&&this.env==o.BROWSER?this.netContext.addRemoteWsLog(t):this.netContext.closed()?(e=this.url,this.url="",this.setLogServer(e),this.saveLog(t)):this.netContext.connecting()?this.saveLog(t):this.netContext.connected()&&(this.clearCache(),this.websocketSendLog(t)),[2]}))}))},$.prototype.RemoteHttpsLog=function(e,t,r){this.logCache.push(t),(this.logCache.size()>=this.logCacheMax||!0===r)&&this.SendHttpsLog()},$.prototype.logParamList=function(e,t){var r={time:r=_(),level:e,action:(t=[t.substr(0,t.indexOf(" "))||t,t.substr(t.indexOf(" ")+1,4500)||t])[0],content:t[1],appid:this.appid,roomid:this.roomid,userid:this.userid,userName:this.userName,sessionid:this.sessionid};return JSON.stringify(r)},$.prototype.logReportParamList=function(e,t){var r=_(),n=this.env%2===o.BROWSER?"rtc":"ali";return t=Y(Y({},t),{time:r,level:e,console:n,appid:this.appid,room_id:this.roomid,roomid:this.roomid,userid:this.userid,id_name:this.userid,userName:this.userName,sessionid:this.sessionid,sdk_version:this.version,test_environment:this.stateCenter.testEnvironment,version:this.version,event_id:this.appid+"_"+this.userid+"_"+t.event_time+"_"+t.seq}),JSON.stringify(t)},$.prototype.SendHttpsLog=function(){0!=this.logCache.size()&&(this.env%2===o.BROWSER?this.SendHttpsLogWeb():this.SendHttpsLogWeChatMini())},$.prototype.SendHttpsLogWeb=function(){},$.prototype.SendHttpsLogWeChatMini=function(){var e=this;if(!this.existUserID){if(!this.userid)return void console.log("no userid");this.logCache.buffer.forEach((function(t,r){(t=JSON.parse(t))&&""==t.userid?(t.userid=e.userid,t.id_name=t.id_name||e.userid,t.roomid=t.roomid||e.roomid,t.userName=t.userName||e.userName,e.logCache.buffer[r]=JSON.stringify(t)):e.existUserID=!0}))}var t=this.logCache.buffer.join("\n"),r=this.logCache.buffer;t=1==this.env?t:JSON.stringify({user_id:this.userid,log:t}),(0,my.request)({url:this.url,data:t,method:"POST",success:function(t){0!=t.data.length&&("number"==typeof(t=t&&t.data&&t.data.interval)&&e.logUploadInterval!==t&&(e.timeInterval=t,e.openHttpsLogServer(e.url)),r=null)},fail:function(t){e.logCache.buffer=r.concat(e.logCache.buffer),console.log("send failed "+t.statusCode),r=null}}),this.logCache.buffer=[]},$.prototype.destroy=function(){this.stopLogServer(),this.logUploadTimer&&clearTimeout(this.logUploadTimer),s.instance=void 0,this.netContext.destroy(),this.zipLogContext&&this.zipLogContext.destroy(),this.url=""},$);function $(e){var t=this;this.logLevel=u.INFO,this.logRemoteLevel=0,this.logUploadTimer=null,this.logUploadInterval=1e4,this.existUserID=!1,this.isDestroy=!1,this.logCacheMax=8192,this.innerLogger={debug:function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];t.debug.apply(t,e)},info:function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];t.info.apply(t,e)},warn:function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];t.warn.apply(t,e)},error:function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];t.error.apply(t,e)}},this.stateCenter=s.getInstance(),this.configState=new M,this.configState.env=e,this.logCache=new F(this.configState),this.netContext=new S(this.logCache,this.configState,this.innerLogger)}function Q(e){var t=A.call(this)||this;return t.configState=e,t}function X(){this.queue=[]}function Z(){}function J(){this._strategy=n.DEFAULT}function ee(e){return(e=G.call(this,e)||this).maxDelay=10,e.maxPacketLen=20480,e}function te(){var e=null!==V&&V.apply(this,arguments)||this;return e.maxDelay=10,e.maxPacketLen=20480,e.locked=!1,e}function re(e,t,r){this.ws=e,this.cache=t,this.strategy=r,this.strategy.onCanSendActive=this.active.bind(this)}function oe(e,t,r){this.cache=e,this.configState=t,this.innerLogger=r,this.websocket=null,this.websocketState="never_opened",this.senderBuilder=new L,this.sender=null}}],i={},o.m=n,o.c=i,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(r,n,function(t){return e[t]}.bind(null,n));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0))},function(t,r){t.exports=e},function(e,t,r){(function(t){var o;e.exports=(o=function(e){var o;if("undefined"!=typeof window&&window.crypto&&(o=window.crypto),"undefined"!=typeof self&&self.crypto&&(o=self.crypto),!(o=!(o=!(o="undefined"!=typeof globalThis&&globalThis.crypto?globalThis.crypto:o)&&"undefined"!=typeof window&&window.msCrypto?window.msCrypto:o)&&void 0!==t&&t.crypto?t.crypto:o))try{o=r(15)}catch(s){}var n=Object.create||function(e){return i.prototype=e,e=new i,i.prototype=null,e};function i(){}var s={},a=s.lib={},u=a.Base={extend:function(e){var t=n(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),(t.init.prototype=t).$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},l=a.WordArray=u.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||c).stringify(this)},concat:function(e){var t=this.words,r=e.words,o=this.sigBytes,n=e.sigBytes;if(this.clamp(),o%4)for(var i=0;i<n;i++)t[o+i>>>2]|=(r[i>>>2]>>>24-i%4*8&255)<<24-(o+i)%4*8;else for(var s=0;s<n;s+=4)t[o+s>>>2]=r[s>>>2];return this.sigBytes+=n,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=u.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],r=0;r<e;r+=4)t.push(function(){if(o){if("function"==typeof o.getRandomValues)try{return o.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof o.randomBytes)try{return o.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")}());return new l.init(t,e)}}),h=s.enc={},c=h.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,o=[],n=0;n<r;n++){var i=t[n>>>2]>>>24-n%4*8&255;o.push((i>>>4).toString(16)),o.push((15&i).toString(16))}return o.join("")},parse:function(e){for(var t=e.length,r=[],o=0;o<t;o+=2)r[o>>>3]|=parseInt(e.substr(o,2),16)<<24-o%8*4;return new l.init(r,t/2)}},d=h.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,o=[],n=0;n<r;n++)o.push(String.fromCharCode(t[n>>>2]>>>24-n%4*8&255));return o.join("")},parse:function(e){for(var t=e.length,r=[],o=0;o<t;o++)r[o>>>2]|=(255&e.charCodeAt(o))<<24-o%4*8;return new l.init(r,t)}},p=h.Utf8={stringify:function(e){try{return decodeURIComponent(escape(d.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return d.parse(unescape(encodeURIComponent(e)))}},g=a.BufferedBlockAlgorithm=u.extend({reset:function(){this._data=new l.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=p.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r,o=this._data,n=o.words,i=o.sigBytes,s=this.blockSize,a=i/(4*s),u=(a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0))*s;if(t=e.min(4*u,i),u){for(var h=0;h<u;h+=s)this._doProcessBlock(n,h);r=n.splice(0,u),o.sigBytes-=t}return new l.init(r,t)},clone:function(){var e=u.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),m=(a.Hasher=g.extend({cfg:u.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){g.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new m.HMAC.init(e,r).finalize(t)}}}),s.algo={});return s}(Math),o)}).call(this,r(14))},function(e,t,r){function o(e){var t;return(a[e]||(t=a[e]={i:e,l:!1,exports:{}},s[e].call(t.exports,t,t.exports,o),t.l=!0,t)).exports}var n,i,s,a;e.exports=(n=r(3),i=r(7),s=[function(e,t){e.exports=n},function(e,t){e.exports=i},function(e,t,r){"use strict";var o,n,i,s,a,u,l,h;r.r(t),r.d(t,"ZegoConnectionAgent",(function(){return Ne})),r.d(t,"NetAgentPCRequest",(function(){return be})),r.d(t,"NetAgentHttpRequest",(function(){return Pe})),r.d(t,"BusinessService",(function(){return i})),r.d(t,"BrokenType",(function(){return m})),r.d(t,"NET_ACCESS_CONFIG",(function(){return le})),r.d(t,"ConnectedType",(function(){return g})),r.d(t,"DisconnectedType",(function(){return p})),r.d(t,"Mode",(function(){return a})),r.d(t,"Method",(function(){return d})),(t=o=o||{})[t.offline=0]="offline",t[t.online=1]="online",(t=n=n||{})[t.MSG_TYPE_STREAM_CLOSED=2]="MSG_TYPE_STREAM_CLOSED",t[t.MSG_TYPE_CLOSE_CONNECTION=3]="MSG_TYPE_CLOSE_CONNECTION",t[t.MSG_TYPE_HTTP_REQUEST=4]="MSG_TYPE_HTTP_REQUEST",t[t.MSG_TYPE_HTTP_RESPONSE=5]="MSG_TYPE_HTTP_RESPONSE",t[t.MSG_TYPE_HB_REQUEST=12]="MSG_TYPE_HB_REQUEST",t[t.MSG_TYPE_HB_RESPONSE=13]="MSG_TYPE_HB_RESPONSE",t[t.MSG_TYPE_GET_CONFIG_REQUEST=14]="MSG_TYPE_GET_CONFIG_REQUEST",t[t.MSG_TYPE_GET_CONFIG_RESPONSE=15]="MSG_TYPE_GET_CONFIG_RESPONSE",t[t.MSG_TYPE_HTTP_REQUEST_ACK=16]="MSG_TYPE_HTTP_REQUEST_ACK",t[t.MSG_TYPE_PC_UPWARD_MESSAGE=17]="MSG_TYPE_PC_UPWARD_MESSAGE",t[t.MSG_TYPE_PC_UPWARD_MESSAGE_ACK=18]="MSG_TYPE_PC_UPWARD_MESSAGE_ACK",t[t.MSG_TYPE_PC_ESTABLISHED=19]="MSG_TYPE_PC_ESTABLISHED",t[t.MSG_TYPE_PC_BROKEN=20]="MSG_TYPE_PC_BROKEN",t[t.MSG_TYPE_PC_DOWNWARD_MESSAGE=21]="MSG_TYPE_PC_DOWNWARD_MESSAGE",t[t.MSG_TYPE_REDIRECT=22]="MSG_TYPE_REDIRECT",t[t.MSG_TYPE_GET_APPCONFIG_REQUEST=23]="MSG_TYPE_GET_APPCONFIG_REQUEST",t[t.MSG_TYPE_GET_APPCONFIG_RESPONSE=24]="MSG_TYPE_GET_APPCONFIG_RESPONSE",t[t.MSG_TYPE_PUSH_APPCONFIG=25]="MSG_TYPE_PUSH_APPCONFIG",t[t.MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST=26]="MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST",t[t.MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE=27]="MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE",t[t.MSG_TYPE_PUSH_EXCEPTION=30]="MSG_TYPE_PUSH_EXCEPTION",t[t.MSG_TYPE_HTTP_REQUEST2=33]="MSG_TYPE_HTTP_REQUEST2",t[t.MSG_TYPE_REDIRECT2=34]="MSG_TYPE_REDIRECT2",t[t.MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST2=35]="MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST2",t[t.MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE2=36]="MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE2",t[t.MSG_TYPE_GET_SVRADDR_REQUEST=39]="MSG_TYPE_GET_SVRADDR_REQUEST",t[t.MSG_TYPE_GET_SVRADDR_RESPONSE=40]="MSG_TYPE_GET_SVRADDR_RESPONSE",(t=y=y||{})[t.ACCESSHUB_INVALID_FRAME=2e4]="ACCESSHUB_INVALID_FRAME",t[t.ACCESSHUB_NEED_ENCRYPT=20001]="ACCESSHUB_NEED_ENCRYPT",t[t.ACCESSHUB_DECRYPT=20002]="ACCESSHUB_DECRYPT",t[t.ACCESSHUB_MSGTYPE=20003]="ACCESSHUB_MSGTYPE",t[t.ACCESSHUB_UNMARSHAL=20004]="ACCESSHUB_UNMARSHAL",t[t.ACCESSHUB_TIMEOUT=20005]="ACCESSHUB_TIMEOUT",t[t.ACCESSHUB_CONNECT=20006]="ACCESSHUB_CONNECT",t[t.ACCESSHUB_BROKEN=20007]="ACCESSHUB_BROKEN",t[t.ACCESSHUB_INTERNAL_ERROR=20008]="ACCESSHUB_INTERNAL_ERROR",t[t.ACCESSHUB_MARSHAL=20009]="ACCESSHUB_MARSHAL",t[t.ACCESSHUB_UNSUPPORTED_SERVICE=20010]="ACCESSHUB_UNSUPPORTED_SERVICE",t[t.ACCESSHUB_TOO_FREQUENTLY=20011]="ACCESSHUB_TOO_FREQUENTLY",t[t.ACCESSHUB_INVALID_APPID=20012]="ACCESSHUB_INVALID_APPID",t[t.ACCESSHUB_HB_TIMEOUT=20013]="ACCESSHUB_HB_TIMEOUT",t[t.ACCESSHUB_INVALID_SIGNATURE=20014]="ACCESSHUB_INVALID_SIGNATURE",(t=i=i||{})[t.SERVICE_UNSET=0]="SERVICE_UNSET",t[t.SERVICE_MEDIAGW=1]="SERVICE_MEDIAGW",t[t.SERVICE_LIVEROOM=2]="SERVICE_LIVEROOM",t[t.SERVICE_MIX=3]="SERVICE_MIX",t[t.SERVICE_ZEUS=4]="SERVICE_ZEUS",t[t.SERVICE_ZPUSH=5]="SERVICE_ZPUSH",t[t.SERVICE_L3=6]="SERVICE_L3",t[t.SERVICE_TALKLINE=7]="SERVICE_TALKLINE",t[t.SERVICE_EDUSUITE=8]="SERVICE_EDUSUITE",t[t.SERVICE_ZIM=9]="SERVICE_ZIM",t[t.SERVICE_ClOUD_SETTING=10]="SERVICE_ClOUD_SETTING",t[t.SERVICE_ZEUSHB=11]="SERVICE_ZEUSHB",t[t.SERVICE_USER_LOGIC=12]="SERVICE_USER_LOGIC",t[t.SERVICE_UNIFYDISPATCH=13]="SERVICE_UNIFYDISPATCH",t[t.SERVICE_QUALITY=14]="SERVICE_QUALITY",t[t.SERVICE_SECURITY=15]="SERVICE_SECURITY",t[t.SERVICE_KTVCPR=16]="SERVICE_KTVCPR",t[t.SERVICE_SWITCH4LIVEROOM=17]="SERVICE_SWITCH4LIVEROOM",t[t.SERVICE_WEBRTC_SIGNAL=18]="SERVICE_WEBRTC_SIGNAL",t[t.SERVICE_L3_WEBRTC_SIGNAL=19]="SERVICE_L3_WEBRTC_SIGNAL",t[t.SERVICE_VIDEOCPR=20]="SERVICE_VIDEOCPR",t[t.SERVICE_CDN=21]="SERVICE_CDN",t[t.SERVICE_CLOUDRECORD=22]="SERVICE_CLOUDRECORD",t[t.SERVICE_INNER_ECHO=23]="SERVICE_INNER_ECHO",t[t.SERVICE_OUTER_ECHO=24]="SERVICE_OUTER_ECHO",t[t.SERVICE_LOCALHOST_ECHO=25]="SERVICE_LOCALHOST_ECHO",t[t.SERVICE_ECHO=26]="SERVICE_ECHO",t[t.SERVICE_DOCSERVICE=27]="SERVICE_DOCSERVICE",t[t.SERVICE_AUTHSVR=28]="SERVICE_AUTHSVR",(t=s=s||{})[t.ZEGOCONN_RUN_ENV_UNSET=0]="ZEGOCONN_RUN_ENV_UNSET",t[t.ZEGOCONN_RUN_ENV_BROWSER=1]="ZEGOCONN_RUN_ENV_BROWSER",t[t.ZEGOCONN_RUN_ENV_APPLET=2]="ZEGOCONN_RUN_ENV_APPLET",(t=a=a||{})[t.Mode_UNSET=0]="Mode_UNSET",t[t.MODE_ONLINE=1]="MODE_ONLINE",t[t.MODE_TEST=2]="MODE_TEST",t[t.MODE_ALPHA=3]="MODE_ALPHA",(t=u=u||{})[t.HTTP=0]="HTTP",t[t.PC=1]="PC",t[t.OTHER=2]="OTHER",(t=l=l||{})[t.NONE=0]="NONE",t[t.BROKEN=1]="BROKEN",t[t.DISCONNECT=2]="DISCONNECT",(t=h=h||{})[t.CONNECTED=0]="CONNECTED",t[t.DISCONNECT=1]="DISCONNECT",t[t.BROKEN=2]="BROKEN";var c,d,p,g,m,f=[y.ACCESSHUB_INVALID_APPID,y.ACCESSHUB_INVALID_SIGNATURE],_=((t=c=c||{})[t.ACTION_RESERVED=0]="ACTION_RESERVED",t[t.ACTION_DISPATCH=1]="ACTION_DISPATCH",t[t.ACTION_RETRY=2]="ACTION_RETRY",t[t.ACTION_NEXT_NODE=3]="ACTION_NEXT_NODE",t[t.ACTION_ABORT=4]="ACTION_ABORT",t[t.ACTION_NEXT_GROUP=5]="ACTION_NEXT_GROUP",(y=d=d||{})[y.METHOD_UNSET=0]="METHOD_UNSET",y[y.METHOD_GET=1]="METHOD_GET",y[y.METHOD_POST=2]="METHOD_POST",y[y.METHOD_PUT=3]="METHOD_PUT",y[y.METHOD_PATCH=4]="METHOD_PATCH",y[y.METHOD_DELETE=5]="METHOD_DELETE",y[y.METHOD_HEAD=6]="METHOD_HEAD",y[y.METHOD_OPTIONS=7]="METHOD_OPTIONS",(t=p=p||{})[t.CLOSE=0]="CLOSE",t[t.TEMP=1]="TEMP",t[t.TIMEOUT=2]="TIMEOUT",(y=g=g||{})[y.AUTO=0]="AUTO",y[y.MANUAL=1]="MANUAL",(t=m=m||{})[t.EMPTY=0]="EMPTY",t[t.CLOSE=1]="CLOSE",{2:"stream_closed",3:"close_connection",4:"http_request",5:"http_response",12:"hb_request",13:"hb_response",14:"get_config_request",15:"get_config_response",16:"http_request_ack",17:"pc_upward_message",18:"pc_upward_message_ack",19:"pc_established",20:"pc_broken",21:"pc_downward_message",22:"redirect",23:"get_appconfig_request",24:"get_appconfig_response",25:"push_appconfig",26:"accesshub_dispatch_request",27:"accesshub_dispatch_response",30:"push_exception",33:"http_request2",34:"redirect2",35:"accesshub_dispatch_request2",36:"accesshub_dispatch_response2",39:"get_svraddr_request",40:"get_svraddr_response"}),y=r(0),v=r.n(y),S=(t=r(1),r(1));const E=S.roots.default||(S.roots.default={});for(var b=S.types?S.types.basic:{double:1,float:5,int32:0,uint32:0,sint32:0,fixed32:5,sfixed32:5,int64:0,uint64:0,sint64:0,fixed64:1,sfixed64:1,bool:0,string:2,bytes:2},C=S.types?S.types.packed:{double:1,float:5,int32:0,uint32:0,sint32:0,fixed32:5,sfixed32:5,int64:0,uint64:0,sint64:0,fixed64:1,sfixed64:1,bool:0},R=Object.keys(b),T=S.util.Long?S.util.Long.fromBits:function(){return 0},I={$:function(e){return I[e]?I[e].call(this):E[e].decode?E[e].decode(this,this.uint32()):I.$.call(this,"int32")}},P={$:function(e,t,r){var o=b[e];return void 0===o?E[e].encode?(this.uint32((r<<3|2)>>0).fork(),E[e].encode(t,this).ldelim()):P.$.call(this,"int32",t,r):P[e].call(this.uint32(r<<3|o),t)}},M=0;M<R.length;M++)I[R[M]]=S.Reader.prototype[R[M]],P[R[M]]=S.Writer.prototype[R[M]];!function e(t,r,o,n){for(var i=0,s=Object.keys(t);i<s.length;i++){var a=s[i];if(t[a].$m&&Object.keys(t[a].$m).every((function(e){return Number(e)}))){if(o[a])throw Error(`nested type ${o}.${a} has already exist`);o[a]=function(t,o){function n(e){for(var r in t)"{"===(r=t[r])[1].charAt(0)?this[r[0]]={}:"["!==r[1].charAt(0)&&"<"!==r[1].charAt(0)||(this[r[0]]=[]);if(e)for(var o=Object.keys(e),n=0;n<o.length;++n)null!=e[o[n]]&&(this[o[n]]=e[o[n]])}var i,s={};for(i in t){var a=t[i],u=a[1];"{"===u.charAt(0)?(n.prototype[a[0]]=S.util.emptyObject,s[u]={$m:u.substring(1).split(",").map((function(e,t){return["$"+(t+1),e,null]})).reduce((function(e,t,r){return e[r+1]=t,e}),{})}):n.prototype[a[0]]="["===u.charAt(0)||"<"===u.charAt(0)?S.util.emptyArray:"bytes"===u?S.util.newBuffer([]):a[2]&&a[2].hasOwnProperty("low")&&a[2].hasOwnProperty("high")?T(a[2].low,a[2].high,a[2].unsigned):a[2]}return n.decode=function(e,r){e instanceof S.Reader||(e=S.Reader.create(e));for(var o=void 0===r?e.len:e.pos+r,i=new n;e.pos<o;){var s=e.uint32(),a=s>>>3;if(0<a&&t[a]){var u=t[a][0],l=t[a][1];if("{"===l.charAt(0))i[u]===S.util.emptyObject&&(i[u]={}),a=n.$namespace[l].decode(e,e.uint32()),i[u][a.$1]=a.$2;else if("["===l.charAt(0)||"<"===l.charAt(0))if(l=l.substring(1),i[u]&&i[u].length||(i[u]=[]),void 0!==C[l]&&2==(7&s))for(var h=e.uint32()+e.pos;e.pos<h;)i[u].push(I.$.call(e,l));else i[u].push(I.$.call(e,l));else i[u]=I.$.call(e,l)}else e.skipType(7&s)}return i},n.encode=function(e,r){for(var o in r=r||S.Writer.create(),t){var i=t[o][0];if("{"===(l=t[o][1]).charAt(0)){if(null!=e[i]&&e.hasOwnProperty(i))for(var s=0,a=Object.keys(e[i]);s<a.length;++s)r.uint32((o<<3|2)>>0).fork(),n.$namespace[l].encode({$1:a[s],$2:e[i][a[s]]},r).ldelim()}else if("["===l.charAt(0)||"<"===l.charAt(0)){var u="<"===l.charAt(0),l=l.substring(1),h=e[i];if(null!=h&&h.length)if(u&&void 0!==C[l]){for(r.uint32((o<<3|2)>>0).fork(),s=0;s<h.length;s++)P[l].call(r,h[s]);r.ldelim()}else for(s=0;s<h.length;s++)P.$.call(r,l,h[s],o)}else null!=e[i]&&e.hasOwnProperty(i)&&P.$.call(r,l,e[i],o)}return r},Object.keys(s).length&&(n.$namespace=e(s,r+"."+o,n.$namespace||{},!0)),n}(t[a].$m,a)}else t[a].$s?o[a]=function(e,t){function o(e,t,r){S.rpc.Service.call(this,e,t,r)}return(o.prototype=Object.create(S.rpc.Service.prototype)).constructor=o,Object.keys(e).forEach((function(n){var i=e[n];function s(e,t){return this.rpcCall(s,E[i[0]],E[i[1]],e,t)}Object.defineProperty(s,"name",{value:n}),Object.defineProperty(s,"path",{value:r+"."+t}),o.prototype[n]=s})),o}(t[a].$s,a):t[a].$e&&Object.values(t[a].$e).every((function(e){return Number(e)===e}))&&(o[a]=function(e){for(var t=Object.keys(e),r={},o=0;o<t.length;o++)r[r[t[o]]=e[t[o]]]=t[o];return r}(t[a].$e));o[a]&&!n&&(E[r+"."+a]=o[a]),delete t[a].$m,delete t[a].$s,delete t[a].$e,o[a]=e(t[a],r?r+"."+a:a,o[a]||{})}return o}({PB:{proto_accesshub:{AccesshubAddr:{$m:{1:["ipv4","fixed32",0],2:["ipv6","PB.proto_accesshub.IPV6Addr",null],3:["quic_port","uint32",0],4:["wss_port","uint32",0]}},AccesshubDispatchGroup:{$m:{1:["group","string",""],2:["quic_nodes","<string",null],3:["mtcp_nodes","<string",null],4:["wss_nodes","<string",null]}},AccesshubDispatchGroup2:{$m:{1:["group","string",""],2:["nodes","<PB.proto_accesshub.AccesshubAddr",null]}},AccesshubDispatchRequest2:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["appid","uint32",0],3:["biz_type","uint32",0],4:["mode_no","PB.proto_accesshub.Mode",0],5:["id_name","string",""],6:["sdk_type","PB.proto_accesshub.SdkType",0],7:["zegoconn_version","uint32",0],8:["zegoconn_run_env","PB.proto_accesshub.ZegoconnRunEnv",0],9:["device_id","string",""],10:["client_ip","string",""],11:["geofencing_type","uint32",0],12:["geofencings","[uint32",null]}},AccesshubDispatchResponse2:{$m:{1:["code","int32",0],2:["message","string",""],3:["data","PB.proto_accesshub.AccesshubDispatchResponseData2",null]}},AccesshubDispatchResponseData2:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["rand","string",""],3:["secret","string",""],4:["groups","<PB.proto_accesshub.AccesshubDispatchGroup2",null],5:["wss_groups","<PB.proto_accesshub.WssAccesshubDispatchGroup",null]}},BackendConnType:{$e:{BACKEND_CONN_TYPE_UNSET:0,BACKEND_CONN_TYPE_TCP:1,BACKEND_CONN_TYPE_WSS:2}},CloseConnection:{$m:{1:["reason","int32",0],2:["msg","string",""],3:["action","int32",0]},Action:{$e:{ACTION_RESERVED:0,ACTION_DISPATCH:1,ACTION_RETRY:2,ACTION_NEXT_NODE:3,ACTION_ABORT:4,ACTION_NEXT_GROUP:5}}},ConnectionClosed:{$m:{1:["code","int32",0],2:["msg","string",""]}},ErrorCode:{$e:{OK:0,DISPATCH_NO_AVAILABLE_NODE:1e4,DISPATCH_INTERNAL_ERROR:10001,DISPATCH_INVALID_FRAME:10002,DISPATCH_UNMARSHAL:10003,DISPATCH_MSGTYPE:10004,DISPATCH_MARSHAL:10005,DISPATCH_TOO_FREQUENTLY:10006,DISPATCH_EMPTY_GEOFENCING:10007,ACCESSHUB_INVALID_FRAME:2e4,ACCESSHUB_NEED_ENCRYPT:20001,ACCESSHUB_DECRYPT:20002,ACCESSHUB_MSGTYPE:20003,ACCESSHUB_UNMARSHAL:20004,ACCESSHUB_TIMEOUT:20005,ACCESSHUB_CONNECT:20006,ACCESSHUB_BROKEN:20007,ACCESSHUB_INTERNAL_ERROR:20008,ACCESSHUB_MARSHAL:20009,ACCESSHUB_UNSUPPORTED_SERVICE:20010,ACCESSHUB_TOO_FREQUENTLY:20011,ACCESSHUB_INVALID_APPID:20012,ACCESSHUB_HB_TIMEOUT:20013,ACCESSHUB_INVALID_SIGNATURE:20014,ACCESSHUB_AUTH_FAILED:20015,ACCESSHUB_UNSUPPORTED_INTERFACE:20016,ACCESSHUB_EMPTY_GEOFENCING:20017,ACCESSHUB_ACCESS_DENIED:20018,ACCESSHUB_SPECIAL_CUSTOMER:20019,ACCESSHUB_GET_STREAM_FAILED:3e4,ACCESSHUB_GET_CONN_FAILED:30001,ACCESSHUB_DO_HTTP_REQUEST_FAILED:30002,ACCESSHUB_UNMARSHAL_HB_FAILED:30003,ACCESSHUB_DO_BACKEND_DISPATCH_FAILED:30004}},GeoFencing:{$e:{CN:2,NA:3,EU:4,AS:5,IN:6,NCN:7}},GeoFencingType:{$e:{NONE:0,UNION:1,EXCLUDE:2}},GetAppConfigRequest:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["appid","uint32",0],3:["biz_type","uint32",0],4:["mode_no","PB.proto_accesshub.Mode",0],5:["id_name","string",""],6:["config_key","string",""],7:["ts","uint64",{low:0,high:0,unsigned:!0}],8:["signature","bytes",[]],9:["lite_sign","string",""],10:["token","string",""],11:["sdk_type","PB.proto_accesshub.SdkType",0],12:["zegoconn_version","uint32",0],13:["zegoconn_run_env","PB.proto_accesshub.ZegoconnRunEnv",0],14:["device_id","string",""],15:["etag","uint32",0],16:["is_special_customer","uint32",0]}},GetAppConfigResponse:{$m:{1:["code","int32",0],2:["message","string",""],3:["data","PB.proto_accesshub.GetAppConfigResponseData",null]}},GetAppConfigResponseData:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["data","bytes",[]],3:["ts","uint64",{low:0,high:0,unsigned:!0}],4:["etag","uint32",0]}},GetConfigRequest:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["appid","uint32",0],3:["biz_type","uint32",0],4:["mode","string",""],5:["id_name","string",""],6:["reqid","string",""],7:["zegoconn_version","uint32",0],8:["sdk_type","PB.proto_accesshub.SdkType",0],9:["zegoconn_run_env","PB.proto_accesshub.ZegoconnRunEnv",0],10:["device_id","string",""],11:["mode_no","PB.proto_accesshub.Mode",0],12:["geofencing_type","uint32",0],13:["geofencings","[uint32",null]}},GetConfigResponse:{$m:{1:["code","int32",0],2:["message","string",""],3:["data","PB.proto_accesshub.GetConfigResponseData",null]}},GetConfigResponseData:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["quic_hb_interval","uint32",0],3:["quic_hb_timeout","uint32",0],4:["logic_hb_interval","uint32",0],5:["logic_hb_timeout","uint32",0],6:["pc_establish_timeout","uint32",0],7:["sdk_link_detect_interval","uint32",0],8:["sdk_link_detect_duration","uint32",0],9:["client_outer_ip","string",""],10:["ntp_time","uint64",{low:0,high:0,unsigned:!0}],11:["root_rsa_certs_ver","uint32",0],12:["geofencing_id","uint32",0],13:["svraddr_ver","uint32",0],14:["root_ecc_certs_ver","uint32",0]}},HBRequest:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["ts","int64",{low:0,high:0,unsigned:!1}]}},HBResponse:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["ts","int64",{low:0,high:0,unsigned:!1}],3:["ntp_time","uint64",{low:0,high:0,unsigned:!0}]}},HTTPRequest:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["appid","uint32",0],3:["biz_type","uint32",0],4:["mode","string",""],5:["id_name","string",""],6:["reqid","string",""],7:["stick","string",""],8:["service","string",""],9:["location","string",""],10:["method","string",""],11:["headers","<PB.proto_accesshub.HTTPRequest.HTTPHeader",null],12:["body","bytes",[]],13:["ack","bool",!1],14:["mode_no","PB.proto_accesshub.Mode",0],15:["service_no","PB.proto_accesshub.Service",0],16:["method_no","PB.proto_accesshub.Method",0],17:["sdk_type","PB.proto_accesshub.SdkType",0],18:["zegoconn_run_env","PB.proto_accesshub.ZegoconnRunEnv",0],19:["zegoconn_version","uint32",0],20:["device_id","string",""]},HTTPHeader:{$m:{1:["name","string",""],2:["val","string",""]}}},HTTPRequest2:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["appid","uint32",0],3:["biz_type","uint32",0],4:["mode","PB.proto_accesshub.Mode",0],5:["id_name","string",""],6:["sdk_type","PB.proto_accesshub.SdkType",0],7:["zegoconn_run_env","PB.proto_accesshub.ZegoconnRunEnv",0],8:["zegoconn_version","uint32",0],9:["headers","<PB.proto_accesshub.HTTPRequest.HTTPHeader",null],10:["method","PB.proto_accesshub.Method",0],11:["interface_id","uint32",0],12:["res_id","string",""],13:["params","string",""],14:["body","bytes",[]],15:["ack","bool",!1],16:["device_id","string",""],17:["ts","uint64",{low:0,high:0,unsigned:!0}],18:["signature","bytes",[]],19:["token","string",""],20:["lite_sign","string",""]}},HTTPRequestAck:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}]}},HTTPRequestDroped:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["reason","int32",0],3:["msg","string",""]}},HTTPResponse:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["headers","<PB.proto_accesshub.HTTPRequest.HTTPHeader",null],3:["status_code","int32",0],4:["body","bytes",[]]}},IPAddr:{$m:{1:["ipv4","fixed32",0],2:["ipv6","PB.proto_accesshub.IPV6Addr",null]}},IPV6Addr:{$m:{1:["high","fixed64",{low:0,high:0,unsigned:!1}],2:["low","fixed64",{low:0,high:0,unsigned:!1}]}},MessageType:{$e:{MSG_TYPE_EMPTY:0,MSG_TYPE_CONNECTION_CLOSED:1,MSG_TYPE_STREAM_CLOSED:2,MSG_TYPE_CLOSE_CONNECTION:3,MSG_TYPE_HTTP_REQUEST:4,MSG_TYPE_HTTP_RESPONSE:5,MSG_TYPE_HTTP_REQUEST_DROPED:6,MSG_TYPE_PROXY_CONNECT:7,MSG_TYPE_PROXY_CONNECTED:8,MSG_TYPE_PROXY_CONNECTION_CLOSED:9,MSG_TYPE_PROXY_SEND_DATA:10,MSG_TYPE_PROXY_RECV_DATA:11,MSG_TYPE_HB_REQUEST:12,MSG_TYPE_HB_RESPONSE:13,MSG_TYPE_GET_CONFIG_REQUEST:14,MSG_TYPE_GET_CONFIG_RESPONSE:15,MSG_TYPE_HTTP_REQUEST_ACK:16,MSG_TYPE_PC_UPWARD_MESSAGE:17,MSG_TYPE_PC_UPWARD_MESSAGE_ACK:18,MSG_TYPE_PC_ESTABLISHED:19,MSG_TYPE_PC_BROKEN:20,MSG_TYPE_PC_DOWNWARD_MESSAGE:21,MSG_TYPE_REDIRECT:22,MSG_TYPE_GET_APPCONFIG_REQUEST:23,MSG_TYPE_GET_APPCONFIG_RESPONSE:24,MSG_TYPE_PUSH_APPCONFIG:25,MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST:26,MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE:27,MSG_TYPE_GET_IM_CONFIG_REQUEST:28,MSG_TYPE_GET_IM_CONFIG_RESPONSE:29,MSG_TYPE_PUSH_EXCEPTION:30,MSG_TYPE_RESOLVE_DOMAIN_REQUEST:31,MSG_TYPE_RESOLVE_DOMAIN_RESPONSE:32,MSG_TYPE_HTTP_REQUEST2:33,MSG_TYPE_REDIRECT2:34,MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST2:35,MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE2:36,MSG_TYPE_GET_ROOTCERTS_REQUEST:37,MSG_TYPE_GET_ROOTCERTS_RESPONSE:38,MSG_TYPE_GET_SVRADDR_REQUEST:39,MSG_TYPE_GET_SVRADDR_RESPONSE:40,MSG_TYPE_UA_DISPATCH_REQUEST:50,MSG_TYPE_UA_DISPATCH_RESPONSE:51,MSG_TYPE_UA_ECHO_REQUEST:52,MSG_TYPE_UA_ECHO_RESPONSE:53,MSG_TYPE_NODE_REGISTER_REQUEST:100,MSG_TYPE_NODE_REGISTER_RESPONSE:101,MSG_TYPE_NODE_HB_REQUEST:102,MSG_TYPE_NODE_HB_RESPONSE:103}},Method:{$e:{METHOD_UNSET:0,METHOD_GET:1,METHOD_POST:2,METHOD_PUT:3,METHOD_PATCH:4,METHOD_DELETE:5,METHOD_HEAD:6,METHOD_OPTIONS:7}},Mode:{$e:{Mode_UNSET:0,MODE_ONLINE:1,MODE_TEST:2,MODE_ALPHA:3}},PCBroken:{$m:{}},PCDownwardMessage:{$m:{1:["payload","bytes",[]],2:["wss_message_type","uint32",0],3:["ts","uint64",{low:0,high:0,unsigned:!0}]}},PCEstablished:{$m:{1:["elapse","uint32",0],2:["from","uint32",0]}},PCUpwardMessage:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["appid","uint32",0],3:["biz_type","uint32",0],4:["mode_no","PB.proto_accesshub.Mode",0],5:["id_name","string",""],6:["service_no","PB.proto_accesshub.Service",0],7:["ack","bool",!1],8:["payload","bytes",[]],9:["sdk_type","PB.proto_accesshub.SdkType",0],10:["wss_message_type","uint32",0],11:["wss_path","string",""],12:["wss_raw_query","string",""],13:["zegoconn_version","uint32",0],14:["zegoconn_run_env","PB.proto_accesshub.ZegoconnRunEnv",0],15:["backend_conn_type","PB.proto_accesshub.BackendConnType",0],16:["device_id","string",""],17:["geofencing_type","uint32",0],18:["geofencings","[uint32",null]}},PCUpwardMessageAck:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}]}},ProxyConnectionClosed:{$m:{1:["code","int32",0],2:["msg","string",""],3:["connected","int32",0]}},PushAppConfig:{$m:{1:["config_key","string",""],2:["data","bytes",[]]}},PushException:{$m:{1:["reason","int32",0],2:["msg","string",""],3:["txid","uint64",{low:0,high:0,unsigned:!0}]}},Redirect2:{$m:{1:["rand","string",""],2:["secret","string",""],3:["groups","<PB.proto_accesshub.AccesshubDispatchGroup2",null],4:["wss_groups","<PB.proto_accesshub.WssAccesshubDispatchGroup",null]}},SdkType:{$e:{SDK_TYPE_UNSET:0,SDK_TYPE_QUIC_MTCP_NATIVE:1,SDK_TYPE_WSS_NATIVE:2,SDK_TYPE_WSS_WEB:3}},Service:{$e:{SERVICE_UNSET:0,SERVICE_MEDIAGW:1,SERVICE_LIVEROOM:2,SERVICE_MIX:3,SERVICE_ZEUS:4,SERVICE_ZPUSH:5,SERVICE_L3:6,SERVICE_TALKLINE:7,SERVICE_EDUSUITE:8,SERVICE_ZIM:9,SERVICE_ClOUD_SETTING:10,SERVICE_ZEUSHB:11,SERVICE_USER_LOGIC:12,SERVICE_UNIFYDISPATCH:13,SERVICE_QUALITY:14,SERVICE_SECURITY:15,SERVICE_KTVCPR:16,SERVICE_SWITCH4LIVEROOM:17,SERVICE_WEBRTC_SIGNAL:18,SERVICE_L3_WEBRTC_SIGNAL:19,SERVICE_VIDEOCPR:20,SERVICE_CDN:21,SERVICE_CLOUDRECORD:22,SERVICE_INNER_ECHO:23,SERVICE_OUTER_ECHO:24,SERVICE_LOCALHOST_ECHO:25,SERVICE_ECHO:26,SERVICE_DOCSERVICE:27,SERVICE_AUTHSVR:28,SERVICE_WEBLIVEROOM:29,SERVICE_WHITEBOARD:30,SERVICE_METAWORLD:31,SERVICE_ZEGOLAND:32}},StreamClosed:{$m:{1:["code","int32",0],2:["msg","string",""]}},WssAccesshubDispatchGroup:{$m:{1:["group","string",""],2:["host","string",""],3:["main_domain","string",""]}},ZegoconnRunEnv:{$e:{ZEGOCONN_RUN_ENV_UNSET:0,ZEGOCONN_RUN_ENV_BROWSER:1,ZEGOCONN_RUN_ENV_APPLET:2}}},proto_initconfig:{AppConfig:{$m:{1:["test_id","int32",0],2:["domain","string",""],3:["flexible_domain","string",""],4:["replace_flexible_domain","string",""]}},InitConfig:{$m:{1:["app_config","PB.proto_initconfig.AppConfig",null],4:["speedlog_config","PB.proto_initconfig.SpeedlogConfig",null],5:["media_config","PB.proto_initconfig.MediaConfig",null]}},MediaConfig:{$m:{1:["play_config","PB.proto_initconfig.MediaPlayConfig",null],2:["publish_config","PB.proto_initconfig.MediaPublishConfig",null]}},MediaPlayConfig:{$m:{5:["resource_info","<PB.proto_initconfig.MediaResourceInfo",null]}},MediaPublishConfig:{$m:{2:["resource_info","<PB.proto_initconfig.MediaResourceInfo",null],5:["enable_subject_segmentation","int32",0],6:["object_segmentation_platform","int32",0]}},MediaResourceInfo:{$m:{1:["resource_type","PB.proto_initconfig.ResourceType",0],2:["service_info","<PB.proto_initconfig.MediaServiceProtocolInfo",null]}},MediaServiceProtocolInfo:{$m:{1:["config_id","string",""],2:["protocol","PB.proto_initconfig.ProtocolType",0],3:["url_template","string",""],4:["resolve_type","PB.proto_initconfig.ResolveType",0],5:["push_cdn_authentication","int32",0],6:["cdn_quic_version","<int32",null]}},ProtocolType:{$e:{UDP:0,RTMP:1,FLV:2,HLS:3,WEBRTC:4}},ResolveType:{$e:{LOCAL_DNS:0,DISPATCH:1}},ResourceType:{$e:{CDN:0,RTC:1,L3:2,CDN_PLUS:3,CDN_PLUS_BACKUP:4}},SpeedlogConfig:{$m:{1:["report_count","int32",0],2:["report_retry_interval","int32",0],3:["push_quality_sample_count","int32",0],4:["pull_quality_sample_count","int32",0],5:["hardware_report_cycle","int32",0],6:["room_user_max_count","int32",0],7:["room_stream_max_count","int32",0],8:["charge_info_report_cycle","int32",0],9:["charge_info_report_mode","int32",0],10:["disable_report_pull","<PB.proto_initconfig.ResourceType",null],11:["report_max_bytes","int32",0],12:["push_quality_report_freq","int32",0],13:["pull_quality_report_freq","int32",0],14:["charge_info_report_no_playing","int32",0]}}}}},"",E,!1),S.util.global.PB=E.PB;var L=E.PB,k=function(){return(k=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};t.util.Long=v.a,t.configure(),H.prototype.encodeRequest=function(e,t,r){var o=(n=this.protoMap[e])[0],n=n[1];return n=(o=this.encode(this.protoInstance[o][n],t)).length,(t=new Uint8Array(13+n))[0]=175,t[1]=0,t[2]=e>>8,t[3]=e-(t[2]<<8),t.set(new Uint8Array(Int32Array.from([n]).buffer).reverse(),4),t.set(new Uint8Array(Int32Array.from([r]).buffer).reverse(),8),t[12]=0,t.set(o,13),t},H.prototype.decodeResponse=function(e){var t=(e[2]<<8)+e[3],r=new DataView(e.buffer).getUint32(8),o=e.slice(13);try{var n=this.protoMap[t];return[r,t,this.decode(this.protoInstance[n[0]][n[1]],o)]}catch(e){return[r,t,{code:1}]}},H.prototype.decodeConfigMessage=function(e){return this.decode(this.protoInstance.proto_initconfig.InitConfig,e)},H.prototype.encode=function(e,t){return e.encode(new e(t)).finish()},H.prototype.decode=function(e,t){return k({},e.decode(t))};var N,O=H,A=(Object.defineProperty(x.prototype,"id",{get:function(){return this._id||null},set:function(e){this._id=e},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"data",{get:function(){return this._data},set:function(e){this._data=e},enumerable:!1,configurable:!0}),x.prototype.hasNext=function(){return this.next&&this.next.id},x.prototype.hasPrev=function(){return this.prev&&this.prev.id},x),w=(U.prototype.insertBefore=function(e,t){return(t=new A(this._idCounter,t)).next=e,t.prev=e.prev,e.prev&&(e.prev.next=t),e.prev=t,++this._idCounter,++this._numNodes,t},U.prototype.addLast=function(e){return this.insertBefore(this.end,e)},U.prototype.add=function(e){return this.addLast(e)},U.prototype.getFirst=function(){return 0===this._numNodes?null:this.start.next},U.prototype.getLast=function(){return 0===this._numNodes?null:this.end.prev},U.prototype.size=function(){return this._numNodes},U.prototype.getFromFirst=function(e){var t=0,r=this.start.next;if(0<=e)for(;t<e&&null!==r;)r=r.next,++t;else r=null;if(null===r)throw"Index out of bounds.";return r},U.prototype.get=function(e){return 0===e?this.getFirst():e===this._numNodes-1?this.getLast():this.getFromFirst(e)},U.prototype.remove=function(e){return e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),--this._numNodes,e},U.prototype.removeFirst=function(){var e=null;return 0<this._numNodes&&this.start.next?this.remove(this.start.next):e},U.prototype.removeLast=function(){var e=null;return 0<this._numNodes&&this.end.prev?this.remove(this.end.prev):e},U.prototype.removeAll=function(){this.start.next=this.end,this.end.prev=this.start,this._numNodes=0,this._idCounter=0},U.prototype.each=function(e){for(var t=this.start;t.hasNext();)e(t=t.next)},U.prototype.find=function(e){for(var t=this.start,r=!1,o=null;t.hasNext()&&!r;)e(t=t.next)&&(o=t,r=!0);return o},U.prototype.map=function(e){for(var t=this.start,r=[];t.hasNext();)e(t=t.next)&&r.push(t);return r},U.prototype.push=function(e){return this.addLast(e)},U.prototype.unshift=function(e){this.insertBefore(0<this._numNodes?this.start.next:this.end,e)},U.prototype.pop=function(){return this.removeLast()},U.prototype.shift=function(){return this.removeFirst()},U);function D(){this.txid=0,this.linkRetryTime=60,this.updatedMsgTime=0,this.connectServer=""}function U(){this.start=new A,this.end=new A,this._idCounter=0,this._numNodes=0,this.start.next=this.end,this.start.prev=null,this.end.prev=this.start,this.end.next=null}function x(e,t){void 0===e&&(e=null),void 0===t&&(t=null),this.next=null,this.prev=null,this._id=e,this._data=t}function H(){var e;this.protoInstance=L,this.protoMap=((e={})[n.MSG_TYPE_STREAM_CLOSED]=["proto_accesshub","ConnectionClosed"],e[n.MSG_TYPE_CLOSE_CONNECTION]=["proto_accesshub","CloseConnection"],e[n.MSG_TYPE_HTTP_REQUEST]=["proto_accesshub","HTTPRequest"],e[n.MSG_TYPE_HTTP_RESPONSE]=["proto_accesshub","HTTPResponse"],e[n.MSG_TYPE_HTTP_REQUEST2]=["proto_accesshub","HTTPRequest2"],e[n.MSG_TYPE_HB_REQUEST]=["proto_accesshub","HBRequest"],e[n.MSG_TYPE_HB_RESPONSE]=["proto_accesshub","HBResponse"],e[n.MSG_TYPE_GET_CONFIG_REQUEST]=["proto_accesshub","GetConfigRequest"],e[n.MSG_TYPE_GET_CONFIG_RESPONSE]=["proto_accesshub","GetConfigResponse"],e[n.MSG_TYPE_GET_SVRADDR_REQUEST]=["proto_accesshub","GetSvraddrRequest"],e[n.MSG_TYPE_GET_SVRADDR_RESPONSE]=["proto_accesshub","GetSvraddrResponse"],e[n.MSG_TYPE_HTTP_REQUEST_ACK]=["proto_accesshub","HTTPRequestAck"],e[n.MSG_TYPE_PC_UPWARD_MESSAGE]=["proto_accesshub","PCUpwardMessage"],e[n.MSG_TYPE_PC_UPWARD_MESSAGE_ACK]=["proto_accesshub","PCUpwardMessageAck"],e[n.MSG_TYPE_PC_ESTABLISHED]=["proto_accesshub","PCEstablished"],e[n.MSG_TYPE_PC_BROKEN]=["proto_accesshub","PCBroken"],e[n.MSG_TYPE_PC_DOWNWARD_MESSAGE]=["proto_accesshub","PCDownwardMessage"],e[n.MSG_TYPE_REDIRECT]=["proto_accesshub","Redirect"],e[n.MSG_TYPE_REDIRECT2]=["proto_accesshub","Redirect2"],e[n.MSG_TYPE_GET_APPCONFIG_REQUEST]=["proto_accesshub","GetAppConfigRequest"],e[n.MSG_TYPE_GET_APPCONFIG_RESPONSE]=["proto_accesshub","GetAppConfigResponse"],e[n.MSG_TYPE_PUSH_APPCONFIG]=["proto_accesshub","PushAppConfig"],e[n.MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST]=["proto_accesshub","AccesshubDispatchRequest"],e[n.MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE]=["proto_accesshub","AccesshubDispatchResponse"],e[n.MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST2]=["proto_accesshub","AccesshubDispatchRequest2"],e[n.MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE2]=["proto_accesshub","AccesshubDispatchResponse2"],e[n.MSG_TYPE_PUSH_EXCEPTION]=["proto_accesshub","PushException"],e)}D.prototype.createSocket=function(e){},D.prototype.setState=function(e){},D.prototype.initEvent=function(e,t,r,o){},D.prototype.sendMessage=function(e,t,r,o,n,i,s,a){void 0===o&&(o=!0),void 0===n&&(n=null),void 0===i&&(i=null),void 0===s&&(s=null)},y=D,(r=N=N||{})[r.BROWSER=0]="BROWSER",r[r.WEIXINMINI=1]="WEIXINMINI",B.prototype.init=function(){var e=this;this._websocket&&(this.readyState=0,this._websocket.onOpen((function(t){e.readyState=1,"function"==typeof e.onopen&&(e.onopen(t),e._websocket.onClose((function(t){e.readyState=3,"function"==typeof e.onclose&&e.onclose(t)})),e._websocket.onMessage((function(t){if(t.data.isBuffer)try{t.data.data=my.base64ToArrayBuffer(t.data.data)}catch(e){t.data.data=my.base64ToArrayBuffer(t.data.data.replace(/\n/g,""))}"function"==typeof e.onmessage&&e.onmessage(t.data)})))})),this._websocket.onError((function(t){e.readyState=3,"function"==typeof e.onerror&&e.onerror(t)})))},B.prototype.onopen=function(e){},B.prototype.onerror=function(e){},B.prototype.onclose=function(e){},B.prototype.onmessage=function(e){},B.prototype.send=function(e){(e=e instanceof Uint8Array?new Uint8Array(e).buffer:e)instanceof ArrayBuffer&&(e=my.arrayBufferToBase64(e)),this._websocket&&this._websocket.send({data:e,isBuffer:!0})},B.prototype.close=function(){this._websocket&&this._websocket.close()};var q=B;function B(e,t){this.url=e,this.readyState=3,this._websocket=my.connectSocket({url:e,multiple:!0}),this.init()}function G(e,t,r){if(r||2===arguments.length)for(var o,n=0,i=t.length;n<i;n++)!o&&n in t||((o=o||Array.prototype.slice.call(t,0,n))[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))}function z(e){var t=escape||window.unescape;return Uint8Array.from(Array.from(t(encodeURIComponent(e))).map((function(e){return e.charCodeAt(0)})))}function V(e){var t=escape||window.escape;return decodeURIComponent(t(String.fromCharCode.apply(String,Array.from(e))))}ye.prototype.createSocket=function(e){this.socket=new(this.ENV%2%2===N.BROWSER?WebSocket:q)(e)},ye.prototype.openHandler=function(e){var t=this;this.socket&&(this.socket.onopen=function(r){t.socket.binaryType="arraybuffer",t.responseHandler(),e(r)})},ye.prototype.responseHandler=function(){var e=this;this.socket&&(this.socket.onmessage=function(t){t="string"==typeof t.data?JSON.parse(t.data):t.data,e.onMessage(t)})},ye.prototype.onMessage=function(e){},ye.prototype.closeHandler=function(e){this.socket&&(this.socket.onclose=function(t){e(t)})},ye.prototype.errorHandler=function(e){this.socket&&(this.socket.onerror=e)},ye.prototype.closeSocket=function(){this.socket&&(this.socket.onclose=null,this.socket.onerror=null,this.socket.close(),this.socket=null)},ye.prototype.isDisConnect=function(){return!this.socket||1!==this.socket.readyState},ye.prototype.sendMessage=function(e){this.isDisConnect()||this.socket&&this.socket.send(e)};var W,j=ye,F={TIMEOUT:{code:1100002,msg:"network timeout."},SOCKET_CLOSE:{code:1100003,msg:"socket close"},NET_SOCKET_TIMEOUT:{code:1100004,msg:"net agent timeout"},NET_HB_TIMEOUT:{code:1100005,msg:"net hb timeout"},NET_CONNECT_TIMEOUT:{code:1100006,msg:"net connect timeout"}},Y="zn.zca.gc",K="zn.zca.gac",$="zn.zca.rd",Q="zn.zca.cc",X="zn.shq.0",Z="zn.nab.du",J="zn.nab.gac",ee="zn.nhb.s",te="zn.rlh.at",re="zn.rlh.sm",oe="zn.wl.cs.0",ne="zn.wl.bse",ie="zn.napr.sr",se="zn.napr.ope",ae="zn.nahr.sr",ue="zn.nahr.sr2",le={domains:["accesshub-wss.zego.im"],mode:"online",modeNo:a.MODE_ONLINE,sdkType:3,connectVer:30,pcEstablishTimeout:15,scheme:"wss",location:"accesshub",wssMessageType:1},he=(W=function(e,t){return(W=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(){return(he=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)}),ce=function(e){function t(t,r,o,i,s){var a=e.call(this)||this;return a.appID=t,a.env=r,a.protobuf=o,a.logger=i,a.stateCenter=s,a.socketService=new j(a.env),a.urlIndex=0,a.updatedMsgTime=0,a.unUpdateMsgTimeTypes=[n.MSG_TYPE_HB_REQUEST,n.MSG_TYPE_HB_RESPONSE,n.MSG_TYPE_GET_CONFIG_REQUEST,n.MSG_TYPE_GET_CONFIG_RESPONSE,n.MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST2,n.MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE2],a.netLinkState=0,a.sendCommandList=new w,a.unSendCommandList=new w,a.sendCommandMap={},a.unSendCommandMap={},a.sendDataCheckOnceCount=100,a.sendDataDropTimeout=1e4,a.sendDataCheckInterval=2e3,a.timeout=5e3,a.connectInterval=1e4,a.connectTimer=null,a.connectRsp={},a.unlogTypes=[12,13],a.tryServers=[],a.tryConnectEvents=[],a.connectStartTime=0,a.updatedMsgTime=Date.now(),a}var r=t,o=e;if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function i(){this.constructor=r}return W(r,o),r.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i),t.prototype.initEvent=function(e,t,r,o){this.onConnectedEvent=e,this.onDisConnectedEvent=t,this.onConnectingEvent=r,this.onPushEvent=o},t.prototype.createSocket=function(e){this.servers=e,this.urlIndex=0},t.prototype.destroySocket=function(e){this.logger.info("zn.wl.ds.0 call "+e),this.socketService.closeSocket(),this.netLinkState=0,e!==l.NONE&&this.onDisConnectedEvent&&this.onDisConnectedEvent(e===l.BROKEN),this.resetConnect()},t.prototype.refreshServers=function(e){this.servers=G(G([],e,!0),this.servers,!0)},t.prototype.connectSocket=function(e,t,r){var o=this,n=(void 0===e&&(e=!0),this.logger.info(oe+" call"),this.connectRsp.suc=t,!1),i=(this.connectRsp.fail=function(){r&&(n?o.logger.info(oe+" fail cb has exec"):(r(),n=!0))},e&&(this.urlIndex=(this.urlIndex+1)%this.servers.length),this.servers[this.urlIndex]);return this.connectServer=i,this.logger.info(oe+" server "+i),this.tryServers.push(i),this.connectStartTime=Date.now(),this.closeSocket(),this.netLinkState=1,this.socketService.createSocket(i),this.onConnectingEvent&&this.onConnectingEvent(!0),this.bindSocketEvent(),this.connectTimer=setTimeout((function(){o.logger.info(oe+" timeout"),o.connectEvent(i,F.NET_CONNECT_TIMEOUT.code),o.connectRsp.fail&&o.connectRsp.fail()}),this.connectInterval),!0},t.prototype.bindSocketEvent=function(){var e=this;this.openHandler((function(){e.logger.info(ne+" open"),e.resetConnect(),e.connectRsp.suc&&e.connectRsp.suc(),e.netLinkState=2,e.connectEvent(e.connectServer,0),e.onConnectedEvent&&e.onConnectedEvent(e.tryServers,e.tryConnectEvents),e.tryConnectEvents=[],e.checkUnSendMsgs(e.unSendCommandList),e.startCheck()})),this.closeHandler((function(t){e.logger.warn(ne+" close "+JSON.stringify(t.code||t)),e.resetConnect(),e.connectRsp.fail&&e.connectRsp.fail(),e.connectEvent(e.connectServer,(null==t?void 0:t.code)||F.NET_CONNECT_TIMEOUT.code),e.onDisConnectedEvent&&e.onDisConnectedEvent(!0),e.netLinkState=0})),this.errorHandler((function(t){e.logger.warn(ne+" error "+JSON.stringify(t.code||t)),e.resetConnect(),e.connectRsp.fail&&e.connectRsp.fail(),e.connectEvent(e.connectServer,(null==t?void 0:t.code)||F.NET_CONNECT_TIMEOUT.code),e.onDisConnectedEvent&&e.onDisConnectedEvent(!0),e.netLinkState=0})),this.onMessage()},t.prototype.closeSocket=function(){this.logger.info("zn.wl.cs.1 call"),this.socketService.closeSocket(),this.netLinkState=0},t.prototype.connectEvent=function(e,t){var r;this.connectStartTime&&(r=Date.now()-this.connectStartTime,this.tryConnectEvents.push({url:e,time_consumed:r,connect_type:3,error:t}))},t.prototype.resetConnect=function(){this.connectTimer&&(clearTimeout(this.connectTimer),this.connectTimer=null),this.stopCheck()},t.prototype.isConnect=function(){return 2===this.netLinkState},t.prototype.isDisConnect=function(){return!this.socketService||this.socketService.isDisConnect()},t.prototype.isConnecting=function(){return 1===this.netLinkState},t.prototype.setState=function(e){this.netLinkState=e},t.prototype.closeHandler=function(e){this.socketService.closeHandler(e)},t.prototype.openHandler=function(e){this.socketService.openHandler(e)},t.prototype.errorHandler=function(e){this.socketService.errorHandler(e)},t.prototype.sendMessage=function(e,t,r,o,i,a,u,l){void 0===o&&(o=!0),void 0===i&&(i=null),void 0===a&&(a=null),void 0===u&&(u=null),void 0===(l=void 0===l?{}:l).timeout&&(l.timeout=5e3),void 0===l.isInSendMap&&(l.isInSendMap=!0),void 0===l.isMsgCache&&(l.isMsgCache=!0),this.txid++;var h={appid:this.appID,biz_type:0,mode_no:(null==(h=this.stateCenter.appInfo)?void 0:h.mode)||le.modeNo,id_name:this.stateCenter.userId,sdk_type:le.sdkType,zegoconn_run_env:0===this.env?s.ZEGOCONN_RUN_ENV_BROWSER:s.ZEGOCONN_RUN_ENV_APPLET,zegoconn_version:(null==(h=this.stateCenter.appInfo)?void 0:h.connVer)||le.connectVer};null!=(c=this.stateCenter.appInfo)&&c.deviceID&&(h.device_id=null==(c=this.stateCenter.appInfo)?void 0:c.deviceID);var c=he(he({txid:this.txid},o?h:{}),r);o={data:c,txid:this.txid,sendTime:Date.now(),streamID:t,type:e,timeOut:l.timeout||this.timeout,ack:r.ack,success:i,error:a,ackFunc:u,isSend:!0,isCheck:e!==n.MSG_TYPE_PC_UPWARD_MESSAGE,extras:l.extras},l.isInSendMap&&(h=this.sendCommandList.push(o),this.sendCommandMap[this.txid]=h),10!==c.service&&14!==c.interface_id&&this.unUpdateMsgTimeTypes.includes(e)||(this.updatedMsgTime=Date.now()),-1===this.unlogTypes.indexOf(e)&&this.logger.info("zn.wl.sm type: "+e+"-"+_[e]+" streamID: "+t+" txid: "+this.txid),this.isConnect()?this.sendUint8Data(e,c,t,l.extras):l.isMsgCache&&(o.isSend=!1,r=this.unSendCommandList.push(o),this.unSendCommandMap[this.txid]=r)},t.prototype.checkUnSendMsgs=function(e){for(var t,r=e.getFirst();null!=r;)e.remove(r),r._data&&!1===(null==(t=r._data)?void 0:t.isSend)&&r._data.type&&r._data.streamID&&r._data.data&&(this.sendUint8Data(r._data.type,r._data.data,r._data.streamID),r._data.isSend=!0),r=e.getFirst()},t.prototype.Uint8ToArrayBuffer=function(e){return e.buffer.slice(e.byteOffset,e.byteLength+e.byteOffset)},t.prototype.sendUint8Data=function(e,t,r,o){e=this.protobuf.encodeRequest(e,t,r),this.socketService.sendMessage(this.Uint8ToArrayBuffer(e))},t.prototype.onMessage=function(){var e=this;this.socketService.onMessage=function(t){t=new Uint8Array(t);var r,o,n=(o=e.protobuf.decodeResponse(t))[0],i=o[1],s=((o=o[2]).txid&&v.a.isLong(o.txid)&&o.txid.toNumber&&(o.txid=o.txid.toNumber()),e.unUpdateMsgTimeTypes.includes(i)||(e.updatedMsgTime=Date.now()),(null==o?void 0:o.txid)||(null==(s=null==o?void 0:o.data)?void 0:s.txid));-1===e.unlogTypes.indexOf(i)&&(r=s?", txid: ".concat(s):"",e.logger.info("zn.wl.om"+" streamID: ".concat(n,", msgType: ").concat(i,"-").concat(_[i])+r)),s&&e.isRspMsg(s)?e.handleSendCommandMsgRsp(n,i,s,o,{size:t.length}):e.onPushEvent(n,i,o,{size:t.length})}},t.prototype.isRspMsg=function(e){return void 0!==this.sendCommandMap[e]},t.prototype.startCheck=function(){var e=this;this.checkMessageListTimeout(this.sendCommandList,this.sendCommandMap),this.sendDataCheckTimer=setTimeout((function(){e.startCheck()}),this.sendDataCheckInterval)},t.prototype.stopCheck=function(){this.checkSendMessageList(this.sendCommandList),clearTimeout(this.sendDataCheckTimer)},t.prototype.checkMessageListTimeout=function(e,t){for(var r,o=e.getFirst(),n=Date.now(),i=0,s=this;null!=o&&"break"!==function(){var a,u,l;return o._data&&o._data.sendTime+o._data.timeOut>n||(o._data&&delete t[o._data.data.txid],e.remove(o),o._data&&null==o._data.error||o._data&&o._data.sendTime+s.sendDataDropTimeout<n||(a=o&&o._data&&o._data.error,u=o&&o._data&&o._data.txid,l=o&&o._data&&(null==(r=o._data)?void 0:r.isCheck),setTimeout((function(){l&&a&&a({},u,F.TIMEOUT)}),0)),++i>=s.sendDataCheckOnceCount)?"break":void(o=e.getFirst())}(););},t.prototype.checkSendMessageList=function(e){for(var t,r=e.getFirst();null!=r&&r._data;)!function(){var o,n,i;e.remove(r),r._data.isSend&&r._data.error&&(o=r&&r._data&&r._data.error,n=r&&r._data&&r._data.txid,i=r&&r._data&&(null==(t=r._data)?void 0:t.isCheck),setTimeout((function(){i&&o&&o({},n,F.TIMEOUT)}),0)),r=e.getFirst()}()},t.prototype.handleSendCommandMsgRsp=function(e,t,r,o,i){var s,a=this.sendCommandMap[r];null!=a&&(null!=(s=a._data)&&s.ack||(delete this.sendCommandMap[r],this.sendCommandList.remove(a)),o.code&&0!==o.code?s&&null!=s.error&&s.error(o,r):t===n.MSG_TYPE_PUSH_EXCEPTION?(o.code=o.reason,o.message=o.msg,delete o.reason,delete o.msg,s&&null!=s.error&&s.error(o,r)):t===n.MSG_TYPE_HTTP_REQUEST_ACK?s&&null!=s.ackFunc&&s.ackFunc(o,r):s&&null!=s.success&&s.success(o,r,i))},t}(y),de=(_e.prototype.getConfig=function(e,t){var r;this.logger.info("zn.nab.gc call"),this.streamManager.createStream(u.OTHER).sendMessage(n.MSG_TYPE_GET_CONFIG_REQUEST,{geofencing_type:null==(r=this.stateCenter.appInfo.geoFencing)?void 0:r.type,geofencings:null==(r=this.stateCenter.appInfo.geoFencing)?void 0:r.list},e,t)},_e.prototype.dispatchURL=function(e,t){var r,o=this;this.logger.info(Z+" call"),this.streamManager.createStream(u.OTHER).sendMessage(n.MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST2,{geofencing_type:null==(r=this.stateCenter.appInfo.geoFencing)?void 0:r.type,geofencings:null==(r=this.stateCenter.appInfo.geoFencing)?void 0:r.list},(function(t){o.logger.info(Z+" suc "),e&&e(t)}),(function(e,r,n){o.logger.info(Z+" fail"),t&&t(n||e)}))},_e.prototype.getAppConfig=function(e,t,r,o,i){var s=this;return new Promise((function(a,l){function h(e,t,r){r?(s.logger.error(J+" fail "+JSON.stringify(r)),l(r)):0===e.code?(s.logger.info(J+" suc"),r=s.decodeConfigMessage(e.data.data),a({code:0,data:r,etag:e.data.etag})):(s.logger.error(J+" fail "+e.code),l({code:e.code}))}s.logger.info(J+" call");var c={id_name:t,config_key:e,token:r,mode_no:(null==(c=s.stateCenter.appInfo)?void 0:c.mode)||le.modeNo,etag:i};s.streamManager.createStream(u.OTHER).sendMessage(n.MSG_TYPE_GET_APPCONFIG_REQUEST,c,h,h,null,{timeout:o})}))},_e.prototype.decodeConfigMessage=function(e){return this.protobuf.decodeConfigMessage(e)},_e),pe=(fe.prototype.init=function(e){var t=this;this.logger.info("zn.nhb.ii call"),this.hbStream||(this.hbStream=this.streamManager.createStream(u.OTHER)),1<=e.data.logic_hb_interval&&e.data.logic_hb_interval<=10&&(this.hbInterval=e.data.logic_hb_interval),3<=e.data.logic_hb_timeout&&e.data.logic_hb_timeout<=30&&(this.hbTimeout=e.data.logic_hb_timeout),this.tryHbCount=0,this.hbTimeoutMaxCount=this.hbTimeout/this.hbInterval,this.hbTimer&&clearTimeout(this.hbTimer),this.hbTimer=setTimeout((function(){t.start()}),1e3*this.hbInterval)},fe.prototype.start=function(){var e,t,r,o=this;this.logger.debug(ee+" call "),this.tryHbCount++>this.hbTimeoutMaxCount?(this.logger.error(ee+" come to try limit"),this.reset(),this.netHbLogout(F.NET_HB_TIMEOUT)):(e=(new Date).getTime(),t=function(t,r,n){var i=(new Date).getTime()-e;o.logger.debug(ee+" hb callback "+i),n&&0!==(null==n?void 0:n.code)?o.logger.info(ee+" fail "+JSON.stringify(n)):(null!=t&&t.ntp_time&&(n="number"==typeof(i=t.ntp_time)?i:i.toNumber(),t=(new Date).getTime(),o.stateCenter.timeOffset=Math.round((n-e+(n-t))/2),o.stateCenter.networkRTT=n-e+(t-n)),o.tryHbCount=0)},r={ts:Date.now()},this.hbStream.sendMessage(n.MSG_TYPE_HB_REQUEST,r,t,t,null),this.hbStream.isFirst=!1,this.hbTimer&&clearTimeout(this.hbTimer),this.hbTimer=setTimeout((function(){o.start()}),1e3*this.hbInterval))},fe.prototype.netHbLogout=function(e){},fe.prototype.reset=function(){this.hbTimer&&(clearTimeout(this.hbTimer),this.hbTimer=null),this.tryHbCount=0},fe),ge=(me.prototype.addEventHandler=function(e,t){if(this.handlerListMap[e]||(this.handlerListMap[e]=[]),"function"!=typeof t)throw new Error("Params callBack is not a Function");return this.handlerListMap[e]&&-1==this.handlerListMap[e].indexOf(t)&&this.handlerListMap[e].push(t),!0},me.prototype.removeEventHandler=function(e,t){return!!this.handlerListMap[e]&&(this.handlerListMap[e]=t?this.handlerListMap[e].filter((function(e){return e!==t})):[],!0)},me.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];this.handlerListMap[e]&&this.handlerListMap[e].forEach((function(r){try{setTimeout((function(){r.apply(void 0,t)}),0)}catch(r){console.error('Fail to execute callback of event "'.concat(e,'" : ').concat(r))}}))},me);function me(){this.handlerListMap={}}function fe(e,t,r){this.streamManager=e,this.logger=t,this.stateCenter=r,this.hbTimer=null,this.hbInterval=5,this.hbTimeout=10,this.hbTimeoutMaxCount=0,this.tryHbCount=0}function _e(e,t,r,o){this.streamManager=e,this.protobuf=t,this.logger=r,this.stateCenter=o}function ye(e){this.socket=null,this.ENV=e}function ve(){this.networkState=o.online,this.useNetAgent=!0,this.specified=!1,this.clientIP="",this.timeOffset=0,this.networkRTT=0}function Se(e,t,r){if(r||2===arguments.length)for(var o,n=0,i=t.length;n<i;n++)!o&&n in t||((o=o||Array.prototype.slice.call(t,0,n))[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))}var Ee=function(){return(Ee=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},be=(qe.prototype.sendRequest=function(e,t,r,o){var i=this,s=e.payload,a=(null!=(a=this.option)&&a.encode&&(s=z(e.payload)),{service_no:this.service,ack:e.ack,payload:s,wss_message_type:null!=(s=null==(a=this.option)?void 0:a.messageType)?s:le.wssMessageType,wss_path:null==(a=this.option)?void 0:a.path,wss_raw_query:null==(s=this.option)?void 0:s.query,zegoconn_version:le.connectVer});this.netPcStream.isConnect()||(this.logger.info(ie+" pc is not connect"),this.eventManager.emit("connectStart")),this.netPcStream.sendMessage(n.MSG_TYPE_PC_UPWARD_MESSAGE,a,(function(){i.logger.info(ie+" suc"),r&&r()}),(function(e){i.logger.error(ie+" fail"),t&&t(e)}),null,{isInSendMap:"boolean"==typeof e.isInSendMap&&e.isInSendMap,extras:o,isMsgCache:null==(s=this.option)?void 0:s.isMsgCache})},qe.prototype.onPushEvent=function(e,t,r){var o;switch(this.logger.info(se+" msgType: ".concat(e)),e){case n.MSG_TYPE_PC_ESTABLISHED:this.netPcStream.isFirst=!1,this.pcEstablished(t,this.netPcStream.StreamID);break;case n.MSG_TYPE_PC_BROKEN:this.pcBroken();break;case n.MSG_TYPE_PC_DOWNWARD_MESSAGE:this.logger.info(se+" ".concat(this.service," down ").concat((null==t?void 0:t.ts)&&t.ts.toNumber&&t.ts.toNumber()||t.ts));var i=t.payload;null!=(o=this.option)&&o.encode&&(i=V(t.payload)),this.eventManager.emit("downLoadMessage",i,r);break;case n.MSG_TYPE_PUSH_EXCEPTION:this.logger.info(se+" ".concat(this.service," exception ").concat(JSON.stringify(t))),this.eventManager.emit("exception",t,r)}},qe.prototype.on=function(e,t){return this.eventManager.addEventHandler(e,t)},qe.prototype.off=function(e,t){this.eventManager.removeEventHandler(e,t)},qe.prototype.pcEstablished=function(e,t){this.logger.info("zn.napr.pe call "+JSON.stringify(e)),this.setConnectState(h.CONNECTED);var r=g.MANUAL;this.lastConnectState===h.BROKEN&&this.connectState===h.CONNECTED&&(r=g.AUTO),this.eventManager.emit("connected",r),this.reportEvent("pcConnectedEvent",{proxy_link_sources:null==e?void 0:e.from,connect_stream:t}),this.brokenTimer&&clearTimeout(this.brokenTimer)},qe.prototype.pcBroken=function(){var e=this;this.logger.info("zn.napr.pb call"),this.setConnectState(h.BROKEN),this.eventManager.emit("broken"),this.reportEvent("pcBrokenEvent"),this.brokenTimer=setTimeout((function(){e.eventManager.emit("disconnected",p.TEMP),e.reportEvent("pcDisconnectedEvent")}),1e3*this.pcEstablishTimeout)},qe.prototype.resetBrokenTimer=function(){this.brokenTimer&&clearTimeout(this.brokenTimer)},qe.prototype._close=function(e,t){var r;this.logger.info("zn.napr.cr call "+this.service+" "+this.connectState),this.connectState!==h.DISCONNECT&&(this.netPcStream.closeStream(0,""),this.resetBrokenTimer(),r=this.streamManager.getStreamID(),this.netPcStream.refresh(r),this.eventManager.emit(e,t),r="","broken"===e?r="pcBrokenEvent":"disconnected"===e&&(r="pcDisconnectedEvent"),r)&&this.reportEvent(r),this.setConnectState(h.DISCONNECT)},qe.prototype.closePc=function(){this._close("broken")},qe.prototype.closeRequest=function(){this._close("disconnected",p.CLOSE)},qe.prototype.setConnectState=function(e){this.connectState!==e&&(this.lastConnectState=this.connectState,this.connectState=e)},qe.prototype.reportEvent=function(e,t){this.eventManager.emit(e,Ee({service_no:this.service},t))},qe),Ce=(He.prototype.getRequest=function(e,t){return e=new be(this.logger,e,this.streamManager,this.pcEstablishTimeout,t),this.pcStreamRequests.push(e),e},He.prototype.updateConnectState=function(e,t,r){this.logger.info("zn.naprm.ucs call "+e+" "+t),this.pcStreamRequests.forEach((function(o){e===h.BROKEN?(o.eventManager.emit("broken"),o.reportEvent("pcBrokenEvent")):e===h.DISCONNECT&&(o.eventManager.emit("disconnected",t,r),o.reportEvent("pcDisconnectedEvent"))}))},He.prototype.closePCs=function(){this.pcStreamRequests.forEach((function(e){e.closePc()}))},He.prototype.setEstablishTimeout=function(e){this.pcEstablishTimeout=e},He),Re=(xe.prototype.initLink=function(e){this.link=e},xe.prototype.startMaxTime=function(){var e=this;this.logger.info(re+" call"),this.maxTimer||(this.logger.info(re+" start max timer"),this.maxTimer=setTimeout((function(){e.logger.warn(re+" over max time ".concat(e.RETRY_MAX_TIME,"s, stop retry")),e.isOverTime=!0,e.link.destroySocket(l.NONE),e.stopMaxTime(),e.invalid(),e.onactive(!1,F.NET_SOCKET_TIMEOUT)}),1e3*this.RETRY_MAX_TIME))},xe.prototype.stopMaxTime=function(){this.maxTimer&&clearTimeout(this.maxTimer),this.maxTimer=null},xe.prototype.active=function(e,t,r){var n=this;if(void 0===r&&(r=!1),this.logger.info(te+" call "+e+" "+(t=void 0!==t&&t)),this.retryTimer)return this.logger.info(te+" has actived, ignore"),!1;var i=this.stateCenter.networkState==o.offline;if(i){if(this.logger.info(te+"  check if really offline. "+this.retryNetCount),this.retryNetCount>=this.retryNetMaxTimes)return this.logger.warn(te+" network is broken, stop retry"),!1}else this.retryNetCount=0;return this.link.isConnecting()&&!r?(this.logger.info(te+" link is connecting, ignore"),!1):this.isOverTime?(this.logger.info(te+" retry over time, stop retry"),!1):(1==this.retryActiveCount?this.retryActiveInterval=Math.floor(Math.random()*(1-this.RETRY_START_TIME_INTERVAL)+this.RETRY_START_TIME_INTERVAL):(r=Math.pow(2,Math.round(this.retryActiveCount/this.RETRY_CONTINUE_COUNT+1)),this.retryActiveInterval=r>this.RETRY_MAX_TIME_INTERVAL?this.RETRY_MAX_TIME_INTERVAL:r),this.logger.info(te+" interval "+this.retryActiveInterval),this.retryTimer=setTimeout((function(){n.link.destroySocket(l.BROKEN),n.link.connectSocket(e,(function(){n.logger.info(te+" suc"),n.stateCenter.networkState=o.online,n.stopMaxTime(),n.invalid(),n.onactive(!0)}),(function(){n.logger.info(te+" fail"),n.maxTimer||n.startMaxTime(),n.active(!0,!1,!0)})),n.retryTimer&&clearTimeout(n.retryTimer),n.retryTimer=null,i?n.retryNetCount++:n.retryActiveCount++}),t?0:1e3*this.retryActiveInterval),!0)},xe.prototype.onactive=function(){for(var e=0;e<arguments.length;e++);},xe.prototype.init=function(e,t,r,o){this.invalid(),this.stopMaxTime(),this.isOverTime=!1,"number"==typeof e&&e<3600&&(this.RETRY_MAX_TIME=e),"number"==typeof t&&(this.RETRY_START_TIME_INTERVAL=t),"number"==typeof r&&(this.RETRY_CONTINUE_COUNT=r),"number"==typeof o&&(this.RETRY_MAX_TIME_INTERVAL=o)},xe.prototype.invalid=function(){this.logger.info("zn.rlh.ivd end retry"),this.retryTimer&&clearTimeout(this.retryTimer),this.retryTimer=null,this.retryActiveCount=1,this.retryNetCount=0},xe),Te=(Ue.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e.join(" ");console.log(r)},Ue.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e.join(" ");console.debug(r)},Ue.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e.join(" ");console.info(r)},Ue.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e.join(" ");console.warn(r)},Ue.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e.join(" ");console.error(r)},Ue),Ie=function(){return(Ie=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},Pe=(De.prototype.sendRequest=function(e,t,r,o,i){var s=this,a=e.disableLog;e={service_no:this.service,ack:e.ack,headers:e.headers,body:z(JSON.stringify(e.body)),id_name:e.idName,method_no:e.method_no,stick:e.stick,location:e.location},this.netHttpStream.sendMessage(n.MSG_TYPE_HTTP_REQUEST,e,(function(e){s.closeStream();var r=("gzip"===(null==(r=(null==e?void 0:e.headers).find((function(e){return"Content-Encoding"===(null==e?void 0:e.name)})))?void 0:r.val)?a||s.logger.info(ae+" gzip"):e.body&&(r=V(e.body),e.body=r),Ie(Ie({},e),{body:void 0}));a||s.logger.info(ae+" suc "+JSON.stringify(r)),t&&t(e)}),(function(e,t,o){s.closeStream(),a||s.logger.error(ae+" fail"),r&&r(o||e)}),(function(e){a||s.logger.error(ae+" ack"),o&&o(e)}),i),this.netHttpStream.isFirst=!1},De.prototype.sendRequest2=function(e,t,r,o,i){var s=this,a=1===e.format?z(JSON.stringify(e.body)):e.body;a={ack:e.ack,body:a,id_name:e.idName,method:e.method,interface_id:e.interfaceID,token:e.token},e.headers&&(a.headers=e.headers),e.resID&&(a.res_id=e.resID),e.urlParams&&(a.params=e.urlParams),e.mode&&(a.mode=e.mode),this.netHttpStream.sendMessage(n.MSG_TYPE_HTTP_REQUEST2,a,(function(o,n){s.closeStream();var i=(null==o?void 0:o.headers).find((function(e){return"Content-Encoding"===(null==e?void 0:e.name)}));if(200===o.status_code){if("gzip"===(null==i?void 0:i.val))s.logger.info(ue+" gzip");else if(o.body&&1===e.format)try{a=V(o.body),o.body=a}catch(n){s.logger.info(ue+" decode "+JSON.stringify(n))}i=Ie(Ie({},o),{body:void 0}),s.logger.info(ue+" suc "+JSON.stringify(i)),t&&t(o,n)}else{try{var a=V(o.body);o.body=a}catch(n){s.logger.info(ue+" status "+o.status_code+" "+JSON.stringify(n))}r&&r(o)}}),(function(e,t,o){s.closeStream(),s.logger.error(ue+" fail"),r&&r(o||e)}),(function(e){s.logger.error(ue+" ack"),o&&o(e)}),i),this.netHttpStream.isFirst=!1},De.prototype.closeStream=function(){this.logger.info("zn.nahr.cs call"),this.netHttpStream.closeStream(0,"")},De),Me=(Object.defineProperty(we.prototype,"StreamID",{get:function(){return this.streamID},enumerable:!1,configurable:!0}),we.prototype.refresh=function(e){this.streamID=e,this.isFirst=!0},we.prototype.sendMessage=function(e,t,r,o,n,i){var s=this;void 0===r&&(r=null),void 0===o&&(o=null),this.zegoLink.sendMessage(e,this.streamID,t,this.isFirst,(function(e,t,o){s.type!==u.PC&&(s.isFree=!0),r&&r(e,o)}),(function(e,t,r){s.type!==u.PC&&(s.isFree=!0),o&&o(e,t,r)}),n=void 0===n?null:n,i=void 0===i?{timeout:5e3,isInSendMap:!0}:i)},we.prototype.onPushEvent=function(e,t,r){},we.prototype.closeStream=function(e,t){this.zegoLink.sendMessage(n.MSG_TYPE_STREAM_CLOSED,this.streamID,{code:e,msg:t})},we.prototype.isConnect=function(){return this.zegoLink.isConnect()},we),Le=(Ae.prototype.createStream=function(e){var t=new Me(e,this.streamID++,this.zegoLink);return e===u.PC&&this.pcStreams.push(t),t},Ae.prototype.onPushEvent=function(e,t,r,o){var n=this.pcStreams.find((function(t){return t.StreamID===e}));n&&n.onPushEvent(t,r,o)},Ae.prototype.getStreamID=function(){return this.streamID++},Ae),ke=function(){return(ke=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},Ne=(Object.defineProperty(Oe.prototype,"clientIP",{get:function(){return this.stateCenter.clientIP},enumerable:!1,configurable:!0}),Object.defineProperty(Oe.prototype,"timeOffset",{get:function(){return this.stateCenter.timeOffset},enumerable:!1,configurable:!0}),Object.defineProperty(Oe.prototype,"linkConnectState",{get:function(){return this._linkConnectState},set:function(e){this.lastLinkConnectState=this._linkConnectState,this._linkConnectState=e},enumerable:!1,configurable:!0}),Oe.prototype.init=function(){this.logger=new Te,this.protobuf=new O,this.stateCenter=new ve,this.eventManager=new ge,this.checkLinkMsg(),this.inited=!0},Oe.prototype.unInit=function(){this.inited=!1},Oe.prototype.setAppInfo=function(e){this.logger.info("zn.sai.0 "+JSON.stringify(e)),this.stateCenter.appInfo=e,this.stateCenter.networkState=!navigator||navigator.onLine?o.online:o.offline,0===e.env?this.bindWindowListener():1===e.env&&this.bindWxListener(),this.zegoLink=new ce(e.appID,e.env,this.protobuf,this.logger,this.stateCenter),this.zegoLink.initEvent(this.onConnectedEvent,this.onDisConnectedEvent,this.onConnectingEvent,this.onPushEvent),this.streamManager=new Le(this.zegoLink),this.businessRequestMgr=new de(this.streamManager,this.protobuf,this.logger,this.stateCenter),this.netHeartBeatHandler=new pe(this.streamManager,this.logger,this.stateCenter),this.netAgentPCRequestMgr=new Ce(this.streamManager,this.logger),this.heartBeatHandler()},Oe.prototype.setUserInfo=function(e){this.stateCenter.userId=e},Oe.prototype.setNetAgentDefaultServers=function(e){this.connectServers=Se([],e,!0)},Oe.prototype.setNetAgentSpecifiedServers=function(e){this.logger.info("zn.sss.0 "+JSON.stringify(e)),this.stateCenter.specified=!0,this.specifiedServers=Se([],e,!0)},Oe.prototype.setBackupDomains=function(e){this.primaryDomains=e},Oe.prototype.setDispatchConnectServers=function(e){this.connect(e)},Oe.prototype.startHttpRequest=function(e,t,r,o,n){var i=this,s=this.reportSeq++;this.eventManager.emit("requestEvent",s,"start"),this.isConnect()||(this.logger.info(X+" link is not connect"),this.connectUa()),new Pe(this.logger,this.streamManager,e.service).sendRequest(e,(function(r){i.eventManager.emit("requestEvent",s,"end",{na_req_location:e.location,status_code:r.status_code,err_code:0}),t&&t(r)}),(function(t){i.eventManager.emit("requestEvent",s,"end",{na_req_location:e.location,err_code:t.code||0}),r&&r(t)}),o,n)},Oe.prototype.startHttpRequest2=function(e,t,r,o,n){var i=this,s=this.reportSeq++;this.eventManager.emit("requestEvent",s,"start"),this.isConnect()||(this.logger.info(X+" link is not connect"),this.connectUa()),new Pe(this.logger,this.streamManager).sendRequest2(e,(function(r,o){i.eventManager.emit("requestEvent",s,"end",{na_req_interface:e.interfaceID,status_code:r.status_code,err_code:0}),t&&t(r,o)}),(function(t){i.eventManager.emit("requestEvent",s,"end",{na_req_interface:e.interfaceID,err_code:t.code||0}),r&&r(t)}),o,n)},Oe.prototype.getAppConfigByAgent=function(e,t,r,o){return this.isConnect()||(this.logger.info("zn.gab.0 link is not connect"),this.connectUa()),this.getAppConfig(e,this.stateCenter.userId,t,r,o)},Oe.prototype.getPCRequest=function(e,t){var r=this;return(t=this.netAgentPCRequestMgr.getRequest(e,t)).on("disconnected",(function(t){r.logger.warn("zn.zca.gpr "+e+" disconnect "+t),t===p.TEMP&&(r.disConnect(),r.connectStart())})),t.on("connectStart",(function(){r.connectUa()})),t},Oe.prototype.connectUa=function(){this.isDestroy||(this.logger.info("zn.zca.cua call"),this.retryLinkHandler&&(this.retryLinkHandler.init(),this.connectStart(!1,!0)))},Oe.prototype.destroyConnect=function(){this.logger.info("zn.zca.dc.0 call"),this.resetNetAgent()},Oe.prototype.destroy=function(){this.logger.info("zn.zca.dy.0 call"),this.destroyConnect(),this.linkCheckTimer&&clearTimeout(this.linkCheckTimer),this.retryLinkHandler.invalid(),this.retryLinkHandler.stopMaxTime(),this.isDestroy=!0},Oe.prototype.isConnect=function(){return this.zegoLink&&this.zegoLink.isConnect()},Oe.prototype.on=function(e,t){return this.logger.info("zn.zca.o.0 "+e),this.eventManager.addEventHandler(e,t)},Oe.prototype.off=function(e,t){this.logger.info("zn.zca.o.1 "+e),this.eventManager.removeEventHandler(e,t)},Oe.prototype.setLogger=function(e){this.logger=e},Oe.prototype.setAccess=function(e){this.stateCenter.useNetAgent=e},Oe.prototype.getVersion=function(){return"1.1.0"},Oe.prototype.heartBeatHandler=function(){var e=this;this.netHeartBeatHandler.netHbLogout=function(t){e.retryLinkHandler&&([F.NET_HB_TIMEOUT.code].includes(t.code)?(e.retryLinkHandler.startMaxTime(),e.disConnect(),e.connectStart()):(e.retryLinkHandler.stopMaxTime(),e.retryLinkHandler.invalid(),e.eventManager.emit("disconnected")))}},Oe.prototype.bindWindowListener=function(){var e=this;window.addEventListener("offline",(function(){e.netOffLineHandle()})),window.addEventListener("online",(function(){e.netOnLineHandle()}))},Oe.prototype.bindWxListener=function(){var e=this;my.onNetworkStatusChange((function(t){t.isConnected?e.netOnLineHandle():e.netOffLineHandle()}))},Oe.prototype.netOnLineHandle=function(){this.logger.info("zn.zca.noh.0 network is online"),this.stateCenter.networkState=o.online,this.stateCenter.useNetAgent&&this.netOnLineHandler()},Oe.prototype.netOffLineHandle=function(){this.logger.info("zn.zca.noh.1 network is broken"),this.stateCenter.networkState=o.offline,this.stateCenter.useNetAgent&&this.netOffLineHandler()},Oe.prototype.checkLinkMsg=function(){var e=this;if(this.stateCenter.useNetAgent){if(this.isConnect()){var t=Date.now()-this.zegoLink.updatedMsgTime;if(t>1e3*this.linkMsgMaxInterval)return this.logger.info("zn.zca.clm interval: "+t),void this.resetNetAgent()}this.linkCheckTimer&&clearTimeout(this.linkCheckTimer),this.linkCheckTimer=setTimeout((function(){e.checkLinkMsg()}),1e3*this.linkMsgCheckInterval)}},Oe.prototype.connect=function(e){var t=this;0<e.length&&(this.connectServers=Se([],e,!0)),this.stateCenter.specified&&0<this.specifiedServers.length&&(this.connectServers=this.specifiedServers),this.zegoLink.createSocket(this.connectServers),this.retryLinkHandler||(this.retryLinkHandler=new Re(this.logger,this.stateCenter)),this.retryLinkHandler.init(),this.retryLinkHandler.initLink(this.zegoLink),this.retryLinkHandler.onactive=function(e,r){r===F.NET_SOCKET_TIMEOUT&&(t.eventManager.emit("disconnected",r),t.netAgentPCRequestMgr.updateConnectState(h.DISCONNECT,p.TIMEOUT,r))},this.connectStart(!1,!0)},Oe.prototype.resetNetAgent=function(){this.netHeartBeatHandler.reset(),this.zegoLink.destroySocket(l.DISCONNECT)},Oe.prototype.getConfig=function(){function e(e,o,n){n?t.logger.info(Y+" fail "+JSON.stringify(n)):0===e.code?(t.logger.info(Y+" suc "+JSON.stringify(e)),t.getConfigSuccess(e,r)):t.logger.info(Y+" fail "+JSON.stringify(e))}var t=this,r=(new Date).getTime();this.businessRequestMgr.getConfig(e,e)},Oe.prototype.getConfigSuccess=function(e,t){var r,o;this.netHeartBeatHandler.init(e),this.netAgentPCRequestMgr.setEstablishTimeout(e.data.pc_establish_timeout),null!=(r=null==e?void 0:e.data)&&r.client_outer_ip&&(this.stateCenter.clientIP=e.data.client_outer_ip),null!=(r=null==e?void 0:e.data)&&r.ntp_time&&(r="number"==typeof(r=e.data.ntp_time)?r:r.toNumber(),o=(new Date).getTime(),this.stateCenter.timeOffset=Math.round((r-t+(r-o))/2),this.stateCenter.networkRTT=r-t+(o-r)),this.eventManager.emit("clientInfo",{clientIP:this.clientIP,timeOffset:this.timeOffset,geofencingID:t=e.data.geofencing_id})},Oe.prototype.dispatch=function(){var e=this;return new Promise((function(t,r){e.businessRequestMgr.dispatchURL((function(r){r=r.data.wss_groups;var o=(e.logger.info(Z+" wss_groups: "+JSON.stringify(r)),r.some((function(e){return e.host.includes("geo")}))),n=null!=(n=e.stateCenter.appInfo)&&n.geoFencing||o?r:e.getConnectionDomains(r,e.primaryDomains);o=e.handleWssGroups(n),t({servers:o,domains:n})}),(function(e){r(e)}))}))},Oe.prototype.handleWssGroups=function(e){return Array.isArray(e)&&0<e.length?e.map((function(e){return le.scheme+"://"+e.host+"/"+le.location})):[]},Oe.prototype.getConnectionDomains=function(e,t){var r=Se([],e,!0);return t.forEach((function(t){e.forEach((function(e){var o,n="";e.main_domain?n=e.main_domain:e.host&&(n=(o=e.host.split("."))[o.length-2]+"."+o[o.length-1]),n&&n!==t&&(o=e.host.replace(n,t),r.push({group:e.group,host:o}))}))})),r=r.filter((function(e){return!!e.host}))},Oe.prototype.getAppConfig=function(e,t,r,o,n){var i=this;return new Promise((function(s,a){"string"==typeof t&&"string"==typeof r?i.businessRequestMgr.getAppConfig(e,t,r,o,n).then((function(e){s(ke(ke({},e),{retryCount:i.getAppConfigFailCount}))})).catch((function(o){var u;i.logger.error(K+" "+JSON.stringify(o)),!(-1<f.indexOf(o.code))&&(i.getAppConfigFailCount++,20008===o.code||1100002===o.code)&&i.getAppConfigFailCount<3?i.getAppConfig(e,t,r,n).then((function(e){return s(e)})).catch((function(e){return a(e)})):(u=i.getAppConfigFailCount,i.getAppConfigFailCount=0,a(ke(ke({},o),{retryCount:u})))})):i.logger.error(K+" userID or token must be string")}))},Oe.prototype.reportDisConnectEvent=function(){var e=(new Date).getTime()-this.connectedTime;this.connectid&&this.eventManager.emit("disConnectedEvent",{duration:e,server:this.zegoLink.connectServer,connectid:this.connectid})},Oe.prototype.redirect=function(e){this.logger.info($+" ".concat(JSON.stringify(e.wss_groups))),(e=this.handleWssGroups(e.wss_groups))&&Array.isArray(e)&&0<e.length?(this.disConnect(),this.stateCenter.specified&&(this.logger.info($+" specified"),e=this.specifiedServers),this.zegoLink.createSocket(e),this.connectStart(!1,!0)):this.logger.warn($+" wss_groups null")},Oe.prototype.connectClosed=function(e){var t=this;switch(this.logger.info(Q+" ".concat(e.reason," ").concat(e.msg," ").concat(e.action)),e.action){case c.ACTION_DISPATCH:var r=this.reportSeq++;this.eventManager.emit("dispatchEvent",r,"start"),this.dispatch().then((function(e){var o=e.servers;t.eventManager.emit("dispatchEvent",r,"end",{domains:e=e.domains,reason:"ConnectClosed"}),Array.isArray(o)&&0<o.length&&(t.eventManager.emit("dispatchResultUpdate",{servers:o,domains:e}),e=t.stateCenter.specified?t.specifiedServers:o,t.disConnect(),t.zegoLink.createSocket(e),t.connectStart(!1,!0))})).catch((function(e){t.logger.info(Q+" dispatch fail")}));break;case c.ACTION_RETRY:this.disConnect(),this.connectStart(!1);break;case c.ACTION_NEXT_GROUP:this.netAgentPCRequestMgr.closePCs(),this.eventManager.emit("broken",m.CLOSE),this.connectStart()}},Oe.prototype.netOnLineHandler=function(){this.retryLinkHandler&&(this.zegoLink.isConnect()?this.retryLinkHandler.stopMaxTime():this.connectStart())},Oe.prototype.netOffLineHandler=function(){this.disConnect(),this.retryLinkHandler&&(this.retryLinkHandler.invalid(),this.retryLinkHandler.startMaxTime(),this.zegoLink.setState(0))},Oe.prototype.connectStart=function(e,t){this.retryLinkHandler.active(e,t)&&this.reportConnectEvent()},Oe.prototype.reportConnectEvent=function(){var e=this.reportSeq++;this.connectSeq=e,this.eventManager.emit("connectedEvent",e,"start")},Oe.prototype.disConnect=function(){this.logger.info("zn.zca.dc.1 call"),this.netAgentPCRequestMgr.closePCs(),this.eventManager.emit("broken"),2===this.lastLinkConnectState&&0===this.linkConnectState&&this.reportDisConnectEvent()},Oe.prototype.getNetworkTimeInfo=function(){return{timestamp:Date.now()+this.stateCenter.timeOffset,maxDeviation:Math.round(this.stateCenter.networkRTT/2)}},Oe);function Oe(){var e=this;this.linkCheckTimer=null,this.connectServers=[],this.specifiedServers=[],this.getAppConfigFailCount=0,this.getAppConfigTime=0,this.inited=!1,this.linkMsgMaxInterval=90,this.linkMsgCheckInterval=5,this.isDestroy=!1,this.connectedTime=0,this.connectid="",this.reportSeq=0,this.connectSeq=0,this.primaryDomains=[],this._linkConnectState=0,this.lastLinkConnectState=0,this.onConnectedEvent=function(t,r){var o;e.linkConnectState=2,e.getConfig(),e.stateCenter.specified||(o=e.reportSeq++,e.eventManager.emit("dispatchEvent",o,"start"),e.dispatch().then((function(t){var r=t.servers;t=t.domains.map((function(e){return e.host})),e.eventManager.emit("dispatchEvent",o,"end",{domains:t}),0<r.length&&e.eventManager.emit("dispatchResultUpdate",{servers:r,domains:t})})).catch((function(e){}))),e.eventManager.emit("connected"),e.connectedTime=(new Date).getTime(),e.connectid=function(e){var t,r="0123456789".split(""),o=[];for(e=r.length,t=0;t<16;t++)o[t]=r[0|Math.random()*e];return o.join("")}(),e.eventManager.emit("connectedEvent",e.connectSeq,"end",{servers:t,count:t.length,connectid:e.connectid,connectEvents:r})},this.onConnectingEvent=function(){e.logger.info("zn.zca.oce call"),e.linkConnectState=1},this.onDisConnectedEvent=function(t){e.logger.info("zn.zca.ode"+" ".concat(t)),e.linkConnectState=0,t?(e.disConnect(),e.netAgentPCRequestMgr.updateConnectState(h.BROKEN)):(e.eventManager.emit("disconnected"),e.netAgentPCRequestMgr.updateConnectState(h.DISCONNECT))},this.onPushEvent=function(t,r,o,i){switch(r){case n.MSG_TYPE_REDIRECT:case n.MSG_TYPE_REDIRECT2:e.redirect(o);break;case n.MSG_TYPE_CLOSE_CONNECTION:e.connectClosed(o);break;case n.MSG_TYPE_PC_BROKEN:case n.MSG_TYPE_PC_ESTABLISHED:case n.MSG_TYPE_PC_DOWNWARD_MESSAGE:case n.MSG_TYPE_PUSH_EXCEPTION:e.streamManager.onPushEvent(t,r,o,i);break;case n.MSG_TYPE_PUSH_APPCONFIG:e.businessRequestMgr.decodeConfigMessage(o.data)}}}function Ae(e){this.zegoLink=e,this.streamID=1,this.httpStreams=[],this.pcStreams=[]}function we(e,t,r){this.type=e,this.streamID=t,this.zegoLink=r,this.isFree=!1,this.isFirst=!0}function De(e,t,r){this.logger=e,this.streamManager=t,this.service=r,this.netHttpStream=this.streamManager.createStream(u.HTTP)}function Ue(){}function xe(e,t){this.logger=e,this.stateCenter=t,this.RETRY_START_TIME_INTERVAL=4,this.RETRY_CONTINUE_COUNT=2,this.RETRY_MAX_TIME_INTERVAL=32,this.retryTimer=null,this.maxTimer=null,this.retryActiveCount=1,this.retryNetCount=0,this.retryNetMaxTimes=3,this.isOverTime=!1,this.RETRY_MAX_TIME=90}function He(e,t){this.streamManager=e,this.logger=t,this.pcStreamRequests=[],this.pcEstablishTimeout=le.pcEstablishTimeout}function qe(e,t,r,o,n){this.logger=e,this.service=t,this.streamManager=r,this.pcEstablishTimeout=o,this.option=n,this.connectState=h.DISCONNECT,this.lastConnectState=h.DISCONNECT,this.brokenTimer=null,this.listenerList={connected:[],broken:[]},this.netPcStream=this.streamManager.createStream(u.PC),this.eventManager=new ge,this.netPcStream.onPushEvent=this.onPushEvent.bind(this)}}],a={},o.m=s,o.c=a,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(r,n,function(t){return e[t]}.bind(null,n));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=2))},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var o=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1];function n(e){for(var t,r,n,i,s=e.length,a=0,u="";a<s;){for(;t=o[255&e.charCodeAt(a++)],a<s&&-1==t;);if(-1==t)break;for(;r=o[255&e.charCodeAt(a++)],a<s&&-1==r;);if(-1==r)break;u+=String.fromCharCode(t<<2|(48&r)>>4);do{if(61==(n=255&e.charCodeAt(a++)))return u}while(n=o[n],a<s&&-1==n);if(-1==n)break;u+=String.fromCharCode((15&r)<<4|(60&n)>>2);do{if(61==(i=255&e.charCodeAt(a++)))return u}while(i=o[i],a<s&&-1==i);if(-1==i)break;u+=String.fromCharCode((3&n)<<6|i)}return u}},function(e,t,r){var o;e.exports=(o=r(8),function(){var e,t;"function"==typeof ArrayBuffer&&(t=(e=o.lib.WordArray).init,(e.init=function(e){if((e=(e=e instanceof ArrayBuffer?new Uint8Array(e):e)instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e)instanceof Uint8Array){for(var r=e.byteLength,o=[],n=0;n<r;n++)o[n>>>2]|=e[n]<<24-n%4*8;t.call(this,o,r)}else t.apply(this,arguments)}).prototype=e)}(),o.lib.WordArray)},function(e,t,r){e.exports=function(e){for(var t=Math,r=e,o=r.lib,n=o.WordArray,i=o.Hasher,s=r.algo,a=[],u=0;u<64;u++)a[u]=4294967296*t.abs(t.sin(u+1))|0;var l=s.MD5=i.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var r=0;r<16;r++){var o=t+r,n=e[o];e[o]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8)}var i=this._hash.words,s=e[t+0],u=e[t+1],l=e[t+2],g=e[t+3],m=e[t+4],f=e[t+5],_=e[t+6],y=e[t+7],v=e[t+8],S=e[t+9],E=e[t+10],b=e[t+11],C=e[t+12],R=e[t+13],T=e[t+14],I=e[t+15],P=i[0],M=i[1],L=i[2],k=i[3];P=h(P,M,L,k,s,7,a[0]),k=h(k,P,M,L,u,12,a[1]),L=h(L,k,P,M,l,17,a[2]),M=h(M,L,k,P,g,22,a[3]),P=h(P,M,L,k,m,7,a[4]),k=h(k,P,M,L,f,12,a[5]),L=h(L,k,P,M,_,17,a[6]),M=h(M,L,k,P,y,22,a[7]),P=h(P,M,L,k,v,7,a[8]),k=h(k,P,M,L,S,12,a[9]),L=h(L,k,P,M,E,17,a[10]),M=h(M,L,k,P,b,22,a[11]),P=h(P,M,L,k,C,7,a[12]),k=h(k,P,M,L,R,12,a[13]),L=h(L,k,P,M,T,17,a[14]),P=c(P,M=h(M,L,k,P,I,22,a[15]),L,k,u,5,a[16]),k=c(k,P,M,L,_,9,a[17]),L=c(L,k,P,M,b,14,a[18]),M=c(M,L,k,P,s,20,a[19]),P=c(P,M,L,k,f,5,a[20]),k=c(k,P,M,L,E,9,a[21]),L=c(L,k,P,M,I,14,a[22]),M=c(M,L,k,P,m,20,a[23]),P=c(P,M,L,k,S,5,a[24]),k=c(k,P,M,L,T,9,a[25]),L=c(L,k,P,M,g,14,a[26]),M=c(M,L,k,P,v,20,a[27]),P=c(P,M,L,k,R,5,a[28]),k=c(k,P,M,L,l,9,a[29]),L=c(L,k,P,M,y,14,a[30]),P=d(P,M=c(M,L,k,P,C,20,a[31]),L,k,f,4,a[32]),k=d(k,P,M,L,v,11,a[33]),L=d(L,k,P,M,b,16,a[34]),M=d(M,L,k,P,T,23,a[35]),P=d(P,M,L,k,u,4,a[36]),k=d(k,P,M,L,m,11,a[37]),L=d(L,k,P,M,y,16,a[38]),M=d(M,L,k,P,E,23,a[39]),P=d(P,M,L,k,R,4,a[40]),k=d(k,P,M,L,s,11,a[41]),L=d(L,k,P,M,g,16,a[42]),M=d(M,L,k,P,_,23,a[43]),P=d(P,M,L,k,S,4,a[44]),k=d(k,P,M,L,C,11,a[45]),L=d(L,k,P,M,I,16,a[46]),P=p(P,M=d(M,L,k,P,l,23,a[47]),L,k,s,6,a[48]),k=p(k,P,M,L,y,10,a[49]),L=p(L,k,P,M,T,15,a[50]),M=p(M,L,k,P,f,21,a[51]),P=p(P,M,L,k,C,6,a[52]),k=p(k,P,M,L,g,10,a[53]),L=p(L,k,P,M,E,15,a[54]),M=p(M,L,k,P,u,21,a[55]),P=p(P,M,L,k,v,6,a[56]),k=p(k,P,M,L,I,10,a[57]),L=p(L,k,P,M,_,15,a[58]),M=p(M,L,k,P,R,21,a[59]),P=p(P,M,L,k,m,6,a[60]),k=p(k,P,M,L,b,10,a[61]),L=p(L,k,P,M,l,15,a[62]),M=p(M,L,k,P,S,21,a[63]),i[0]=i[0]+P|0,i[1]=i[1]+M|0,i[2]=i[2]+L|0,i[3]=i[3]+k|0},_doFinalize:function(){var e=this._data,r=e.words,o=8*this._nDataBytes,n=8*e.sigBytes;r[n>>>5]|=128<<24-n%32;var i=t.floor(o/4294967296),s=o;r[15+(n+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),r[14+(n+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),e.sigBytes=4*(r.length+1),this._process();for(var a=this._hash,u=a.words,l=0;l<4;l++){var h=u[l];u[l]=16711935&(h<<8|h>>>24)|4278255360&(h<<24|h>>>8)}return a},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});function h(e,t,r,o,n,i,s){var a=e+(t&r|~t&o)+n+s;return(a<<i|a>>>32-i)+t}function c(e,t,r,o,n,i,s){var a=e+(t&o|r&~o)+n+s;return(a<<i|a>>>32-i)+t}function d(e,t,r,o,n,i,s){var a=e+(t^r^o)+n+s;return(a<<i|a>>>32-i)+t}function p(e,t,r,o,n,i,s){var a=e+(r^(t|~o))+n+s;return(a<<i|a>>>32-i)+t}return r.MD5=i._createHelper(l),r.HmacMD5=i._createHmacHelper(l),e.MD5}(r(8))},function(e,t){var r,o;function n(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}e=e.exports={};try{r="function"==typeof setTimeout?setTimeout:n}catch(e){r=n}try{o="function"==typeof clearTimeout?clearTimeout:i}catch(e){o=i}function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===n||!r)&&setTimeout)return(r=setTimeout)(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}var a,u=[],l=!1,h=-1;function c(){l&&a&&(l=!1,a.length?u=a.concat(u):h=-1,u.length)&&d()}function d(){if(!l){for(var e=s(c),t=(l=!0,u.length);t;){for(a=u,u=[];++h<t;)a&&a[h].run();h=-1,t=u.length}a=null,l=!1,function(e){if(o===clearTimeout)return clearTimeout(e);if((o===i||!o)&&clearTimeout)return(o=clearTimeout)(e);try{o(e)}catch(t){try{return o.call(null,e)}catch(t){return o.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function g(){}e.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new p(e,t)),1!==u.length||l||s(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},e.title="browser",e.browser=!0,e.env={},e.argv=[],e.version="",e.versions={},e.on=g,e.addListener=g,e.once=g,e.off=g,e.removeListener=g,e.removeAllListeners=g,e.emit=g,e.prependListener=g,e.prependOnceListener=g,e.listeners=function(e){return[]},e.binding=function(e){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(e){throw new Error("process.chdir is not supported")},e.umask=function(){return 0}},function(e,t){var r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t){},function(e,t,r){"use strict";r.r(t),r.d(t,"ZegoExpressWebRTMEngine",(function(){return Vt})),r.d(t,"getReportSeq",(function(){return n.m})),r.d(t,"getSeq",(function(){return n.n})),r.d(t,"ZegoLogger",(function(){return Fe.ZegoLogger})),r.d(t,"ZegoDataReport",(function(){return Fe.ZegoDataReport})),r.d(t,"ZegoExpressWebRTM",(function(){return xt})),r.d(t,"BusinessService",(function(){return i.b})),r.d(t,"NetConnection",(function(){return i.f})),r.d(t,"ZReporter",(function(){return Gt}));var o,n=r(0),i=r(4),s=((t=o=o||{}).Logining="LOGINING",t.Logined="LOGINED",t.LoginFailed="LOGIN_FAILED",t.Reconnecting="RECONNECTING",t.Reconnected="RECONNECTED",t.ReconnectFailed="RECONNECT_FAILED",t.Kickout="KICKOUT",t.Logout="LOGOUT",t.LogoutFailed="LOGOUT_FAILED",r(1)),a=r(2),u=["accesshub-wss.zego.im","accesshub-wss.coolzcloud.com","accesshub-wss.zegocloud.com"],l=["zego.im","coolzcloud.com","zegocloud.com"];function h(e,t){this.logger=e,this.stateCenter=t,this.RETRY_MAX_TIME=300,this.RETRY_START_TIME_INTERVAL=4,this.RETRY_CONTINUE_COUNT=2,this.RETRY_MAX_TIME_INTERVAL=32,this.retryTimer=null,this.maxTimer=null,this.retryStartTime=0,this.retryActiveCount=1,this.isOverTime=!1}function c(e){return e}function d(e){return e}function p(e){return e}function g(e){return e}h.prototype.init=function(e,t,r,o){this.invalid(),this.stopMaxTime(),this.isOverTime=!1,"number"==typeof e&&e<3600&&(this.RETRY_MAX_TIME=e),"number"==typeof t&&(this.RETRY_START_TIME_INTERVAL=t),"number"==typeof r&&(this.RETRY_CONTINUE_COUNT=r),"number"==typeof o&&(this.RETRY_MAX_TIME_INTERVAL=o)},h.prototype.invalid=function(){this.logger.info("zm.rh.ivd end retry"),this.retryTimer&&clearTimeout(this.retryTimer),this.retryTimer=null,this.retryStartTime=0,this.retryActiveCount=1},t=h;var m="zm.0",f="zm.slf",_="zm.lg",y="zm.lo",v="zm.fac",S="zm.hlu",E="zm.cna",b="zm.on",C="zm.rntk",R="zm.rm.lg",T="zm.rm.tl",I="zm.rm.lgr",P="zm.rm.clh",M="zm.rm.lo",L="zm.rm.rr",k="zm.rm.dcn",N="zm.rm.kco",O="zm.hhl",A="zm.hb.st",w="zm.hb.rsp",D="zm.us.ftu",U="zm.us.urp",x="zm.us.uph",H="zm.us.mg",q="ON_LISTENER",B="zm.st.ofls",G="zm.lrh.sm",z="zm.lrh.hp",V="zm.lrh.hsp",W="zm.lrh.gs",j="zm.lrh.lgi",F="zm.lrh.ful",Y="zm.lrh.lgo",K="zm.lrh.sru",$="zm.lrh.hd",Q="zm.lrh.hb",X=r(5),Z={event:"/sdk/init",error:{kInvalidParamError:s.a.INPUT_PARAM},system_info:d,servers:function(e){return e},is_from_cache:g,project:d,liveroom_version:d,biz_type:p,lua_md5:d,sev_env:d,use_na:p},J="listener",ee="/sdk/set_debug",te=d,re={event:"/sdk/set_log_config",error:{kInvalidParamError:s.a.INPUT_PARAM},log_level:function(e){return e},remote_log_level:d,log_url:d},oe={event:"/sdk/on_listener",listener:d,error:{INPUT_PARAM:s.a.INPUT_PARAM}},ne=d,ie={event:"/sdk/login",room_id:d,room_sid_string:d,user_state_update:p,max_member_cnt:p,message:d,token:d,svr_env:d,server:d,try_cnt:p,room_mode:p,role:p,audience_create_room:p,liveroom_sid_string:d,error:{ROOM_ID_NULL:s.a.ROOM_ID_NULL,INPUT_PARAM:s.a.INPUT_PARAM,ROOM_ID_TOO_LONG:s.a.ROOM_ID_TOO_LONG,ROOM_ID_INVALID_CHARACTER:s.a.ROOM_ID_INVALID_CHARACTER,USER_ID_NULL:s.a.USER_ID_NULL,USER_ID_TOO_LONG:s.a.USER_ID_TOO_LONG,USER_ID_INVALID_CHARACTER:s.a.USER_ID_INVALID_CHARACTER,USER_NAME_NULL:s.a.USER_NAME_NULL,USER_NAME_TOO_LONG:s.a.USER_NAME_TOO_LONG,REPEATEDLY_LOGIN:s.a.REPEATEDLY_LOGIN,LOGIN_TIMEOUT:s.a.LOGIN_TIMEOUT,INNER_ERROR:s.a.ROOM_INNER_ERROR,NETWORK_BROKEN:s.a.NETWORK_BROKEN}},se="/sdk/sublogin",ae=d,ue={event:"/zpush/login",sdk_zpush_sessionid_string:d},le={event:"/liveroom/enter"},he={event:"/sdk/renew_token",error:{INPUT_PARAM:s.a.INPUT_PARAM,NOT_LOGIN:s.a.NOT_LOGIN},token:d},ce={event:"/sdk/logout",error:{INPUT_PARAM:s.a.INPUT_PARAM,ROOM_NOT_EXIST:s.a.ROOM_NOT_EXIST},room_id:d,room_sid_string:d,is_multi:g,is_send_cmd_net:g,liveroom_sid_string:d},de="/liveroom/quit",pe=d,ge=d,me="/sdk/relogin",fe={event:"/liveroom/tempbroken"},_e={event:"/sdk/reconnect",room_broken_time:p},ye={event:"/sdk/disconnect"},ve=p,Se=p,Ee={event:"/liveroom/hb",room_id:d,room_sid_string:d,interval:p,stream_seq:p,server_user_seq:p,error:{NOT_LOGIN:s.a.NOT_LOGIN,HB_TIMEOUT:s.a.TIMEOUT}},be="/sdk/listener",Ce={event:"/sdk/enable_multi_room",is_multi:g,error:{kInvalidParamError:s.a.INPUT_PARAM,kAlreadyLoginError:s.a.ALREADY_LOGIN}},Re={event:"/liveroom/get_current_user_list",user_index:p,is_time_ascend:g,use_na:p},Te="/zegoconn/connect",Ie=d,Pe=p,Me=c,Le=d,ke=d,Ne=p,Oe="/zegoconn/request",Ae=c,we=c,De=p,Ue={event:"/zegoconn/proxy_connect",service_no:p,proxy_link_sources:p,recv_time:p,connect_stream:p},xe={event:"/zegoconn/proxy_broken",service_no:p},He={event:"/zegoconn/proxy_disconnect",service_no:p};qe=function(e,t){return(qe=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}qe(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(Ve,Be=t),Ve.prototype.renewLocalToken=function(e,t){this.token=e,this.room.token=this.token;var r=(new Date).getTime(),o=void 0;t&&"number"==typeof t?o=1e3*t:"string"==typeof e&&["03","04"].includes(e.substring(0,2))&&(t=1e3*a.a.decodeTokenExpire(e.substring(2)),this.logger.info("zm.rm.rlt time "+t+" "+r+" "+this.stateCenter.local_time_deviation),o=t-(r-this.stateCenter.local_time_deviation)),o&&this.roomHandler.resetTokenTimer(o),this.logger.setTokenInfo(e),this.stateCenter.actionListener("_tokenRenewed",e,this.room.roomID)},Ve.prototype.initRoom=function(e,t,r,o,n,i,s){this.roomHandler=e,this.roomID=t,this.renewLocalToken(r),this.user=o,this.server=n,this.serverBak=i||n,this.config=s},Ve.prototype.active=function(e){var t=this,r=(this.logger.info(R+" retry call "+(null==(r=this.room)?void 0:r.roomID)+" "+(e=void 0!==e&&e)),null!=(r=this.loginRoomCallback)&&r.success?se:me);if(this.subLoginSpan||(this.subLoginSpan=this.stateCenter.reporter.createSpan(n.k.H,{key:ie.event,par:this.roomID},{key:r,par:this.roomID},r,!0),this.spanKey=r),this.roomHandler.setRunState(n.b.trylogin),this.room.isMulti&&(null==(r=this.stateCenter.roomModulesList.find((function(e){return!e.isMulti})))?void 0:r.runState)!==n.b.login)this.logger.info(R+" service is disconnected, multi room stop retry");else if(this.retryTimer)this.logger.info(R+" has actived, ignore");else{var o=this.stateCenter.networkState==n.a.offline;if(o){if(this.logger.info(R+" check if really offline. "+this.retryNetCount),this.retryNetCount>=this.retryNetMaxTimes)return void this.logger.warn(R+" network is broken, stop retry")}else this.retryNetCount=0;this.isOverTime?this.logger.info(R+" retry over time, stop retry"):(1==this.retryActiveCount?this.retryActiveInterval=Math.floor(Math.random()*(1-this.RETRY_START_TIME_INTERVAL)+this.RETRY_START_TIME_INTERVAL):(r=Math.pow(2,Math.round(this.retryActiveCount/this.RETRY_CONTINUE_COUNT+1)),this.retryActiveInterval=r>this.RETRY_MAX_TIME_INTERVAL?this.RETRY_MAX_TIME_INTERVAL:r),this.logger.info(R+" interval "+this.retryActiveInterval),Object(X.b)(),this.retryTimer=setTimeout((function(){t.roomHandler.login(t.retryActiveCount%2==1?t.server:t.serverBak,t.roomID,t.token,t.user,t.config,(function(e){t.stateCenter.networkState=n.a.online,t.handleLoginFinish(e)}),(function(e,r){t.handleLoginFinish(!1,e,r)})),t.retryTimer&&clearTimeout(t.retryTimer),t.retryTimer=null,o?t.retryNetCount++:t.retryActiveCount++}),e?0:1e3*this.retryActiveInterval))}},Ve.prototype.startMaxTime=function(){var e=this;this.maxTimer||(this.logger.info(R+" start max timer"),this.maxTimer=setTimeout((function(){e.logger.info(R+" over max time ".concat(e.RETRY_MAX_TIME,"s, stop retry")),e.isOverTime=!0,e.roomHandler.resetRoom(),e.stopMaxTime(),e.invalid(),e.onactive(!1,s.a.LOGIN_TIMEOUT),e.subLoginSpan&&(e.stateCenter.reporter.spanEnd({key:e.spanKey,par:e.roomID},{error:s.a.LOGIN_TIMEOUT.code,message:s.a.LOGIN_TIMEOUT.msg}),e.subLoginSpan=null),e.loginRoomCallback.fail&&(e.loginRoomCallback.fail(s.a.LOGIN_TIMEOUT),e.roomHandler.disconnectedHandle(s.a.LOGIN_TIMEOUT),e.resetCallBack())}),1e3*this.RETRY_MAX_TIME))},Ve.prototype.stopMaxTime=function(){this.logger.info(R+" stop max timer"),this.maxTimer&&clearTimeout(this.maxTimer),this.maxTimer=null},Ve.prototype.onactive=function(e,t){},Ve.prototype.handleError=function(e,t){if(this.RETRY_MAX_TIME<3)return!1;if(t){t=void 0;var r=void 0,o=void 0,i=(this.stateCenter.useNetAgent&&(t=["202002","205030","205035","50116","50117","50118","50119","50120","50121","50122","50123","50124","50125","50126","50127","50128"],r=["40001","40100"],o=["201002","30019"]),e.code+"");if(this.stateCenter.useNetAgent){if(10015===e.code)return this.room.retryConnect(),!0;if(40001<=e.code&&e.code<=40100||50200<=e.code&&e.code<=50299||null!=o&&o.includes(i))return this.room.resetSessionInfo(),!0}return!(null!=t&&t.includes(i)||(null==r||!r.includes(i))&&(this.room.lastRunState!=n.b.login||(this.logger.warn("zm.rrh.he reset"),this.room.resetUserSession(),this.invalid(),0)))}return!0},Ve.prototype.setLoginRoomCallback=function(e,t){this.loginRoomCallback.success=e,this.loginRoomCallback.fail=t},Ve.prototype.loginFail=function(e){this.roomHandler.resetRoom(),this.stopMaxTime(),this.invalid(),this.onactive(!1,e),this.loginRoomCallback.fail&&(this.loginRoomCallback.fail(e),this.roomHandler.disconnectedHandle(e),this.resetCallBack())},Ve.prototype.handleLoginFinish=function(e,t,r){this.logger.info("zm.rrh.hlf "+e+" "+JSON.stringify(t)),t?(this.subLoginSpan&&(this.stateCenter.reporter.spanEnd({key:this.spanKey,par:this.roomID},{error:t.code,message:t.msg}),this.subLoginSpan=null),this.handleError(t,r)?(this.maxTimer||this.startMaxTime(),this.active()):(this.roomHandler.resetRoom(),this.stopMaxTime(),this.invalid(),this.onactive(e,t),this.loginRoomCallback.fail&&(this.loginRoomCallback.fail(t),this.roomHandler.disconnectedHandle(t),this.resetCallBack()))):(this.stopMaxTime(),this.invalid(),this.onactive(e,{code:0,msg:""}),this.subLoginSpan&&(this.stateCenter.reporter.spanEnd({key:this.spanKey,par:this.roomID},{room_id:this.roomID,room_sid_string:null==(r=this.room)?void 0:r.roomSidString}),this.subLoginSpan=null),this.loginRoomCallback.success&&(this.loginRoomCallback.success(e),this.resetCallBack()))},Ve.prototype.invalid=function(){this.logger.info("zm.rh.ivd end retry"),this.retryTimer&&clearTimeout(this.retryTimer),this.retryTimer=null,this.retryActiveCount=1,this.retryNetCount=0},Ve.prototype.resetCallBack=function(){this.loginRoomCallback.success=void 0,this.loginRoomCallback.fail=void 0};var qe,Be,Ge,ze=Ve;function Ve(e,t,r){var o=Be.call(this,e,t)||this;return o.logger=e,o.stateCenter=t,o.room=r,o.retryNetCount=0,o.retryNetMaxTimes=3,o.spanKey="",o.loginRoomCallback={},o}(t=Ge=Ge||{}).NOT_EMPTY="NOT_EMPTY",t.ILLEGAL_CHARACTERS="ILLEGAL_CHARACTERS",t.TYPE_STRING="TYPE_STRING",t.TYPE_INTEGER="TYPE_INTEGER",t.TYPE_OBJECT="TYPE_OBJECT",t.MAX_LENGTH_10="MAX_LENGTH_10",t.MAX_LENGTH_64="MAX_LENGTH_64",t.MAX_LENGTH_100="MAX_LENGTH_100",t.MAX_LENGTH_128="MAX_LENGTH_128",t.MAX_LENGTH_256="MAX_LENGTH_256",t.MAX_LENGTH_1024="MAX_LENGTH_1024";var We={error:{code:0,msg:"suc"}},je={NOT_EMPTY:function(e,t,r,o,n){return void 0===t||""===t||null===t?(o.error("".concat(r," ").concat(e," is empty")),n):We},ILLEGAL_CHARACTERS:function(e,t,r,o,n){return a.a.checkIllegalCharacters(t)?We:(o.error("".concat(r," ").concat(e," contains illegal characters")),n)},TYPE_STRING:function(e,t,r,o,n){return"string"!=typeof t?(o.error("".concat(r," ").concat(e," must be string")),n):We},TYPE_INTEGER:function(e,t,r,o,n){return a.a.checkInteger(t,!1)?We:(o.error("".concat(r," ").concat(e,"  must be integer number")),n)},TYPE_OBJECT:function(e,t,r,o,n){return t&&"object"==typeof t?We:(o.error("".concat(r," ").concat(e,"  must be object")),n)},MAX_LENGTH_10:function(e,t,r,o,n){return 10<t.length?(o.error("".concat(r," ").concat(e," is too long")),n):We},MAX_LENGTH_64:function(e,t,r,o,n){return 64<t.length?(o.error("".concat(r," ").concat(e," is too long")),n):We},MAX_LENGTH_100:function(e,t,r,o,n){return 100<t.length?(o.error("".concat(r," ").concat(e," is too long")),n):We},MAX_LENGTH_128:function(e,t,r,o,n){return 128<t.length?(o.error("".concat(r," ").concat(e," is too long")),n):We},MAX_LENGTH_256:function(e,t,r,o,n){return 256<t.length?(o.error("".concat(r," ").concat(e," is too long")),n):We},MAX_LENGTH_1024:function(e,t,r,o,n){return 1024<t.length?(o.error("".concat(r," ").concat(e," is too long")),n):We}},Fe=r(6),Ye=(Object.defineProperty(Ke.prototype,"debug",{get:function(){return this._debug},set:function(e){this._debug=e,Fe.LoggerStateCenter.getInstance().debug=e},enumerable:!1,configurable:!0}),Object.defineProperty(Ke.prototype,"testEnvironment",{get:function(){return this._testEnvironment},set:function(e){this._testEnvironment=e,Fe.LoggerStateCenter.getInstance().testEnvironment=e},enumerable:!1,configurable:!0}),Object.defineProperty(Ke.prototype,"ENV",{get:function(){return this._env},set:function(e){this._env=e,Fe.LoggerStateCenter.getInstance().ENV=e},enumerable:!1,configurable:!0}),Object.defineProperty(Ke.prototype,"roomid",{get:function(){return this.roomModulesList[0]?this.roomModulesList[0].roomID:""},enumerable:!1,configurable:!0}),Object.defineProperty(Ke.prototype,"serverTimeOffset",{get:function(){return this.roomModulesList[0]?this.roomModulesList[0].messageHandler.serverTimeOffset:0},enumerable:!1,configurable:!0}),Ke.prototype.getRequestId=function(){return this.idName+"-"+Object(n.n)()},Ke.prototype.actionListener=function(e){for(var t,r=this,o=[],i=1;i<arguments.length;i++)o[i-1]=arguments[i];["getAnchorInfo","HBResponse","roomOnlineUserCountUpdate","roomLoginResponse"].includes(e)||e.startsWith("_")||!this.listenerList[e]||((t=this.reporter.createSpan(n.k.H,{key:J},{key:""},be)).setAttributes({listener:e,listener_params:JSON.stringify(o)}),t.end()),["roomStateChanged","tokenWillExpire"].includes(e)&&this.logger.info("zm.al ".concat(e," ").concat(JSON.stringify(o))),this.listenerList[e]&&this.listenerList[e].forEach((function(t){try{t.apply(void 0,o)}catch(t){r.logger.error("zm.st.at ",e," ",JSON.stringify(t))}}))},Ke.prototype.onListener=function(e,t){return this.listenerList[e]?"function"!=typeof t?(this.logger.error(q+" listener callBack must be funciton"),!1):(-1==this.listenerList[e].indexOf(t)&&this.listenerList[e].push(t),!0):(this.logger.error(q+" event "+e+" no found"),!1)},Ke.prototype.offListener=function(e,t){return this.listenerList[e]?"function"!=typeof t?(this.logger.error(B+" listener callBack must be funciton"),!1):(-1!==this.listenerList[e].indexOf(t)&&(this.listenerList[e]=this.listenerList[e].filter((function(e){return e!==t}))),!0):(this.logger.error(B+" event "+e+" no found"),!1)},Object.defineProperty(Ke.prototype,"sdKVersion",{get:function(){return this._sdkVersion},set:function(e){this._sdkVersion=e},enumerable:!1,configurable:!0}),Ke.prototype.proxyRes=function(e,t,r){return{interResolve:function(r){t(r),e.end()},interReject:function(t,o){var n;void 0===o&&(o=""),(n=t.code<2e9&&1e9<t.code?a.a.decodeServerError(t.code,t.msg):{code:t.code,message:t.msg})&&e.setAttributes({error:n.code,message:n.message+o}),e.end(),r({errorCode:t.code})}}},Ke);function Ke(e,t){this.logger=e,this.dataReport=t,this._debug=!1,this.appConfigEtag=-1,this.appConfigFetched=!1,this.requestList={},this.mode=i.e.MODE_ONLINE,this.connectState="connected",this.testNetPackageSize=!1,this.netGeoFencing={},this._testEnvironment=!1,this._env=0,this.type="PUBLIC",this.debugCustom=!1,this.configOK=!1,this.role=2,this.relateService=[],this.maxMemberCount=0,this.roomCreateFlag=1,this.local_time_deviation=0,this.callbackList={},this.listenerList={roomUserUpdate:[],roomOnlineUserCountUpdate:[],getAnchorInfo:[],_getAnchorInfo:[],IMRecvCustomCommand:[],IMRecvBroadcastMessage:[],recvReliableMessage:[],roomExtraInfoUpdate:[],IMRecvBarrageMessage:[],recvJoinLiveRequest:[],recvInviteJoinLiveRequest:[],recvEndJoinLiveCommand:[],roomLoginResponse:[],_roomLogin:[],_appConfigRsp:[],_netAppConfigRsp:[],_connectChanged:[],HBResponse:[],roomStateUpdate:[],_roomStateUpdate:[],_getTotalUserList:[],_userStateUpdate:[],_recvBigRoomMessage:[],_recvRoomMsg:[],_kickout:[],tokenWillExpire:[],_tokenExpired:[],roomStateChanged:[],hallStateUpdate:[],_hallStateUpdate:[],roomTokenWillExpire:[],_tokenRenewed:[],_protobufResponse:[],_cloudSettingNotify:[],_settingCanFetch:[]},this.reportList={},this.reportSeqList={login:0,relogin:0},this.networkState=n.a.online,this.roomRetryTime=300,this.roomModulesList=[],this.isMultiRoom=!1,this.setMultiRoom=!1,this.protoFormat="json",this.settingFetched=!1,this.useNetAgent=!0,this.netHasSet=!1,this.configRoomAuth=!1,this.configCheckToken=!1,this._sdkVersion="unknown"}Qe.prototype.init=function(e){var t=this,r=e.body.hearbeat_interval<n.g?n.g:e.body.hearbeat_interval;this.tryHeartbeatCount=0,this.heartbeatTimer&&clearTimeout(this.heartbeatTimer),this.loginHeartbeatTimer=setTimeout((function(){t.start(r)}),r),this.initCount++},Qe.prototype.start=function(e){var t,r=this,o=(this.logger.info(A+" call"),this.stateCenter.reporter.createSpan(n.k.H,{key:ie.event,par:this.room.roomID},{key:""},Ee.event));this.room.isLogin()?3<++this.tryHeartbeatCount?(this.logger.error(A+" come to try limit"),this.stateCenter.reporter.setError(o,Ee.error.HB_TIMEOUT),this.hbLogout(s.a.HEARTBEAT_TIMEOUT),this.stateCenter.reporter.createSpan(n.k.H,{key:ie.event,par:this.room.roomID},{key:""},"/zpush/hb_timeout").end()):(this.liveRoomHandler.heartBeat(t=function(e,t){var n=e.body&&e.body.err_code;e.header&&e.body?0!==n&&(n=a.a.decodeServerError(e.body.err_code||e.body.code,e.body.err_message||e.body.message),o.setAttributes({error:n.code,message:n.message+e.body.err_code})):o.setAttributes({error:(0<e.code?e:s.a.ROOM_INNER_ERROR).code,message:e.msg||s.a.ROOM_INNER_ERROR}),r.handleHeartbeatRsp(e,t),0===(null==(n=null==e?void 0:e.body)?void 0:n.err_code)&&o.setAttributes({interval:Ee.interval(null==(t=null==e?void 0:e.body)?void 0:t.hearbeat_interval),stream_seq:Ee.stream_seq(null==(n=null==e?void 0:e.body)?void 0:n.stream_seq),server_user_seq:Ee.server_user_seq(null==(t=null==e?void 0:e.body)?void 0:t.server_user_seq)}),o.end()},t,this.room),this.heartbeatInterval=e,t=this.heartbeatInterval,2<=this.initCount?(t=Math.round(Math.random()*(this.heartbeatInterval+1)),this.initCount=1):t=this.heartbeatInterval,this.heartbeatTimer=setTimeout((function(){r.start(r.heartbeatInterval)}),t),this.logger.info(A+" call success")):(this.logger.error(A+" state error"),this.stateCenter.reporter.setError(o,Ee.error.NOT_LOGIN))},Qe.prototype.handleHeartbeatRsp=function(e,t){if(e.body&&e.body.err_code&&0!==e.body.err_code)return this.logger.error(w+" disconnect, server error=",e.body.err_code),e.body.err_code==n.c.ROOM_SESSION_ID_ERR?void this.hbLogout(s.a.HEARTBEAT_TIMEOUT):void this.hbLogout(a.a.getServerError(e.body.err_code));e.header&&e.body?((this.tryHeartbeatCount=0)!==e.body.hearbeat_interval&&(this.heartbeatInterval=e.body.hearbeat_interval,this.heartbeatInterval<n.g)&&(this.heartbeatInterval=n.g),this.heartbeatRspNotiFy(e,this.room.roomID),this.logger.info(w+" call success")):(this.logger.error(w+" disconnect, error=",JSON.stringify(e)+", seq = "+t),this.hbLogout(e))},Qe.prototype.heartbeatRspNotiFy=function(e,t){},Qe.prototype.hbLogout=function(e){},Qe.prototype.resetHeartbeat=function(){clearTimeout(this.heartbeatTimer),this.heartbeatTimer=null,clearTimeout(this.loginHeartbeatTimer),this.loginHeartbeatTimer=null,this.tryHeartbeatCount=0,this.initCount=0,this.logger.info("zm.hb.rst call success")};var $e=Qe;function Qe(e,t,r,o,n,i){this.logger=e,this.stateCenter=t,this.dataReport=r,this.liveRoomHandler=o,this.room=n,this.service=i,this.tryHeartbeatCount=0,this.heartbeatTimer=null,this.loginHeartbeatTimer=null,this.initCount=0}Object.defineProperty(Ze.prototype,"isUseNetAgent",{get:function(){return this.stateCenter.useNetAgent},enumerable:!1,configurable:!0}),Ze.prototype.resetTokenTimer=function(e){var t=this;this.logger.info("zm.rm.rst  call: "+(e=2147483647<(e=(e-=3e4)<0?0:e)?2147483647:e)),this.tokenTimer&&clearTimeout(this.tokenTimer),this.tokenTimer=setTimeout((function(){t.stateCenter.actionListener("tokenWillExpire",t.room.roomID),t.stateCenter.actionListener("roomTokenWillExpire",t.room.roomID)}),e)},Ze.prototype.stopTokenTimer=function(){this.tokenTimer&&clearTimeout(this.tokenTimer),this.tokenTimer=null},Ze.prototype.setRunState=function(e){this.room.runState!==e&&(this.room.lastRunState=this.room.runState,this.room.runState=e)},Ze.prototype.resetTryLogin=function(){this.tryLoginTimer&&clearTimeout(this.tryLoginTimer),this.tryLoginTimer=null},Ze.prototype.reportLogoutSpan=function(e){var t,r=this.stateCenter.isMultiRoom?de:"/switch/logout_user";r=this.stateCenter.reporter.createSpan(n.k.H,{key:ce.event,par:this.room.roomID},{key:""},r),e&&this.isUseNetAgent&&"0"===this.liveRoomHandler.roomServicer.zPushSid&&(this.liveRoomHandler.roomServicer.zPushSid=null==(t=null==(t=null==(t=this.liveRoomHandler)?void 0:t.roomServicer)?void 0:t.switchSessionID)?void 0:t.toString()),e=this.isUseNetAgent?e?null==(e=null==(t=this.liveRoomHandler)?void 0:t.roomServicer)?void 0:e.zPushSid:null==(t=null==(e=null==(t=this.liveRoomHandler)?void 0:t.roomServicer)?void 0:e.switchSessionID)?void 0:t.toString():void 0,r.setAttributes({room_id:ce.room_id(null==(t=this.room)?void 0:t.roomID),room_sid_string:ce.room_sid_string(null==(t=this.room)?void 0:t.roomSidString),liveroom_sid_string:pe(null==(t=this.room)?void 0:t.userSidString),sdk_zpush_sessionid_string:ge(e)}),r.end()},Ze.prototype.resetRoom=function(e){var t,r=this;this.logger.info(L+" call"),1<this.stateCenter.roomModulesList.length&&!e&&(this.room.isMulti=!0),this.resetTryLogin(),this.room.sessionExist&&this.room.runState!==n.b.logout&&!this.room.isDisConnect()&&this.liveRoomHandler.logout(this.room,t=function(e){r.handleLogoutRsp(e,!r.room.isMulti)},t),this.reportLogoutSpan(e),this.setRunState(n.b.logout),this.room.resetRoomSession(),this.room.resetUserSession(),this.room.isMulti||(this.stateCenter.userid="",this.logger.setSessionInfo(this.stateCenter.appid,this.room.roomID,this.room.userSidString,this.stateCenter.idName,this.stateCenter.nickName,this.stateCenter.sdKVersion),null!=(t=this.liveRoomHandler)&&t.reset()),this.resetRoomCallBack(),this.stateCenter.roomModulesList=this.stateCenter.roomModulesList.filter((function(e){return e!==r.room})),(e=this.stateCenter.roomModulesList[0])&&(e.isMulti=!1,e.runState!==n.b.login)&&e.roomTryHandler&&(e.roomTryHandler.startMaxTime(),e.roomTryHandler.active()),this.stateCenter.isMultiRoom&&0===this.stateCenter.roomModulesList.length&&(this.stateCenter.reporter.createSpan(n.k.H,{key:ce.event,par:this.room.roomID},{key:""},"/zpush/multi_logout_user").end(),this.liveRoomHandler.roomServicer.zPushSid="0"),this.logger.info(L+" call success")},Ze.prototype.resetRoomCallBack=function(){},Ze.prototype.loginSuccessCallBack=function(e,t){},Ze.prototype.handlePushKickout=function(e,t,r){var o=this,i=(this.logger.info(N+"  call "+JSON.stringify(e)),a.a.getKickoutError(e.body.reason||(null==(i=e.body)?void 0:i.kickout_reason),this.isUseNetAgent)),u=this.stateCenter.reporter.createSpan(n.k.H,{key:ie.event,par:this.room.roomID},{key:""},"/sdk/kickout"),l=(u.setAttributes({error:null==(l=s.a[i.name||"ROOM_INNER_ERROR"])?void 0:l.code,message:i.message,kickout_reason:ve((null==(l=e.body)?void 0:l.reason)||(null==(l=e.body)?void 0:l.kickout_reason)),need_relogin:Se(null==(l=null==e?void 0:e.body)?void 0:l.need_relogin)}),u.end(),this.room.roomTryHandler);l?(l.onactive=function(e,t){o.logger.info(N+" onactive"),o.disconnectedHandle(t),o.stateCenter.actionListener("_kickout",t)},e.body.need_relogin&&1==e.body.need_relogin?(this.room.resetUserSession(),l.startMaxTime(),l.active()):(this.setRunState(n.b.logout),this.resetRoom(t),u={},e&&e.body.custom_reason?u.custom_kickout_message=e.body.custom_reason:i.name&&s.a[i.name]&&(u.custom_kickout_message=s.a[i.name].msg+"; kickout reason: "+(l=e.body.reason||e.body.kickout_reason)),this.disconnectedHandle(i.name&&s.a[i.name]?s.a[i.name]:s.a.ROOM_INNER_ERROR,{extendedData:JSON.stringify(u),isKickout:!0}),this.stateCenter.actionListener("_kickout",{code:s.a.MANUAL_KICKOUT.code,msg:s.a.MANUAL_KICKOUT.msg+e.body.reason||e.body.kickout_reason}))):this.logger.info(N+" try handler no found")},Ze.prototype.handleHbLogout=function(e){var t=this,r=this.room.roomTryHandler;r&&(r.onactive=function(e,r){t.logger.warn(O+" onactive"),t.transError(r),t.disconnectedHandle(r)},[s.a.HEARTBEAT_TIMEOUT,s.a.SOCKET_CLOSE].includes(e)||[105,152,2001].includes(null==e?void 0:e.code)||e.msg.endsWith("1000002001")||e.msg.endsWith("1000000152")||e.msg.endsWith("1000000105")?(r.startMaxTime(),r.active()):[s.a.TIMEOUT].includes(e)?this.logger.warn(O+" timeout"):(this.logger.warn(O+" unexpected error: ".concat(JSON.stringify(e))),r.stopMaxTime(),r.invalid(),this.resetRoom(),this.disconnectedHandle(e)))},Ze.prototype.onDisconnect=function(e){var t=this;this.logger.error(k+" "+e.msg),"string"==typeof e.code&&"Error.Network"===e.code||"number"==typeof e.code&&(e.code<2e9&&1e9<e.code||e.code<1e6)&&a.a.decodeServerError(e.code,e.msg),a.a.unregisterCallback(me,this.stateCenter.reportList),(e=this.room.roomTryHandler)?(e.onactive=function(e,r){t.logger.error(k+" onactive"),r&&0!==r.code?(t.transError(r),t.roomStateHandle("DISCONNECTED",o.ReconnectFailed,r)):t.roomStateHandle("CONNECTED",o.Reconnected,r)},e.startMaxTime(),e.active()):this.logger.error(k+" try handler no found")},Ze.prototype.onConnecting=function(e){this.roomStateHandle("CONNECTING",o.Logining,e)},Ze.prototype.disconnectedHandle=function(e,t){var r;e&&0!==e.code?(this.stopTokenTimer(),r=null!=t&&t.isKickout?o.Kickout:o.ReconnectFailed,this.transError(e),this.roomStateHandle("DISCONNECTED",r,e,(null==t?void 0:t.extendedData)||e.msg)):this.roomStateHandle("CONNECTED",o.Reconnected,e,null==t?void 0:t.extendedData)},Ze.prototype.roomStateHandle=function(e,t,r,i,s){if(!t||t!=o.Reconnecting||(this.reconectTimes++,1!=this.reconectTimes)){this.logger.info("zm.rm.scb "+e+" "+JSON.stringify(r)),["CONNECTED","DISCONNECTED"].includes(e)&&(this.reconectTimes=0);var a,u,l=0;switch(t=(t=(t=t&&[o.LoginFailed,o.ReconnectFailed].includes(t)?null!=(u=this.room.roomTryHandler)&&u.loginRoomCallback.fail?o.LoginFailed:o.ReconnectFailed:t)&&[o.Logined,o.Reconnected].includes(t)?null!=(u=this.room.roomTryHandler)&&u.loginRoomCallback.success?o.Logined:o.Reconnected:t)&&[o.Logining,o.Reconnecting].includes(t)?null!=(u=this.room.roomTryHandler)&&u.loginRoomCallback.success?o.Logining:o.Reconnecting:t){case o.Reconnecting:a=fe,this.tempBrokenTime=(new Date).getTime();break;case o.ReconnectFailed:a=ye;break;case o.Reconnected:a=_e,l=(new Date).getTime()-this.tempBrokenTime}this.room.lastRoomState=this.room.roomState,this.room.roomState=e,this.room.roomState!==this.room.lastRoomState&&(this.stateCenter.actionListener("_roomStateUpdate",this.room.roomID,e,r?r.code:0,i,s),s||(this.stateCenter.actionListener("roomStateUpdate",this.room.roomID,e,r?r.code:0,i),this.stateCenter.actionListener("roomStateChanged",this.room.roomID,t,r?r.code:0,i)),a)&&((u=this.stateCenter.reporter.createSpan(n.k.H,{key:ie.event,par:this.room.roomID},{key:""},a.event)).setAttributes(t===o.Reconnected?{room_broken_time:_e.room_broken_time(l)}:{error:(null==r?void 0:r.code)||0,message:i||""}),u.end())}},Ze.prototype.transError=function(e){var t;this.logger.info("zm.rm.te "+JSON.stringify(e)),0!==e.code&&(e.code<2e9&&1e9<e.code||e.code<1e6)&&(t=a.a.getLiveRoomError(e.code,this.stateCenter.useNetAgent))&&s.a[t]&&(e.code=s.a[t].code,e.msg=s.a[t].msg)},Ze.prototype.login=function(e,t,r,o,i,a,u){this.logger.info(R+" call:"+t+" "+r),this.room.isMulti||this.logger.setSessionInfo(this.stateCenter.appid,t,"",o.userID,"",this.stateCenter.sdKVersion),i&&(i.userUpdate&&"boolean"==typeof i.userUpdate&&(this.room.userStateUpdate=i.userUpdate),i.maxMemberCount)&&"number"==typeof i.maxMemberCount&&(this.room.maxMemberCount=i.maxMemberCount),this.stateCenter.configOK?(this.room.runState!==n.b.trylogin&&this.setRunState(n.b.trylogin),this.room.roomID=t,this.room.token=r,this.room.thirdToken=r,this.stateCenter.idName=o.userID,this.stateCenter.nickName=o.userName||o.userID,this.loginCallback.success=a,this.loginCallback.fail=u,this.server=e,this.stateCenter.reporter.spanSetAttributes({key:se,bak_key:me,par:t},{server:this.isUseNetAgent?void 0:ae(this.server)}),this.liveRoomLoginKey=this.room.isMulti?le:ue,this.stateCenter.reporter.createSpan(n.k.H,{key:se,bak_key:me,par:this.room.roomID},{key:this.liveRoomLoginKey.event,par:this.room.roomID},this.liveRoomLoginKey.event,!0),this.resetTryLogin(),this.onConnecting({code:0,msg:""}),this.tryLogin(e),this.logger.info(R+" call success")):(this.logger.error(R+" init sdk wrong"),u(s.a.INIT))},Ze.prototype.tryLogin=function(e){var t,r=this;if(this.room.runState!==n.b.trylogin)this.logger.error("zb.rh.tl state error");else{var o;if(this.isUseNetAgent)return this.room.isMulti&&this.room.isDisConnect()?void this.logger.warn(T+" liveroom is not connected"):(o=function(e,t){r.handleLoginRsp(e,t)},void(null!=(t=this.liveRoomHandler)&&t.isUaConnect()?(this.stateCenter.reporter.spanSetAttributes({key:this.liveRoomLoginKey.event,par:null==(t=this.room)?void 0:t.roomID},{sdk_zpush_sessionid_string:null==(t=null==(t=null==(t=this.liveRoomHandler)?void 0:t.roomServicer)?void 0:t.switchSessionID)?void 0:t.toString()}),this.liveRoomHandler.login(this.room,o,o)):(this.tryLoginTimer=setTimeout((function(){r.logger.info(T+" over time no response, login timeout"),r.loginCallback.fail&&r.loginCallback.fail(ie.error.LOGIN_TIMEOUT)}),this.tryLoginInterval),this.logger.warn(T+" ua is not connected"))));this.tryLoginTimer=setTimeout((function(){r.logger.info(T+" over time no response, login timeout"),r.loginCallback.fail&&r.loginCallback.fail(ie.error.LOGIN_TIMEOUT)}),this.tryLoginInterval),this.logger.info(T+" call success")}},Ze.prototype.handleLoginRsp=function(e,t){this.logger.info(I+" seq: "+t+" "+JSON.stringify(e)),this.room.runState!==n.b.trylogin?this.logger.error(I+" state error"):e.header&&e.body?e.header.seq!==t&&0==this.room.isMulti?this.logger.error(I+" in wrong seq, local=",t+"",",recv=",e.header.seq):0!==e.body.err_code?(this.logger.error(I+" server error=",e.body.err_code),this.handleLoginFail(e)):(this.logger.info(I+" call success."),this.handleLoginSuccess(e)):(this.logger.error(I+" "+JSON.stringify(e)),this.handleLoginFail(e))},Ze.prototype.handleLoginFail=function(e){this.resetTryLogin();var t=ie.error.INNER_ERROR;e.header&&e.body?t=a.a.getServerError(e.body.err_code):e.code&&e.msg&&(t=e),this.stateCenter.reporter.spanEnd({key:this.liveRoomLoginKey.event,par:this.room.roomID},{error:t.code,message:t.msg}),this.loginCallback.fail&&this.loginCallback.fail(t,!0)},Ze.prototype.handleLoginSuccess=function(e){var t,r,i=this,s=(this.room.checkRoomSession(e.body.room_session_id)&&(this.room.loginTime=Date.now()),this.room.lastRunState),u=(this.setRunState(n.b.login),this.stateCenter.userid=e.body.user_id,this.room.longRoomSid=e.body.room_session_id,this.room.longSid=e.body.session_id,(u={})[this.room.roomID]={room_sid_string:this.room.roomSidString},this.stateCenter.reporter.setPublicPros(u),null==(u=null==e?void 0:e.body)?void 0:u.token_remain_time);this.stateCenter.configRoomAuth=0<u,e.body.ret_timestamp&&["03","04"].includes(this.room.token.substring(0,2))&&(r=(t=(new Date).getTime())-e.body.ret_timestamp,this.stateCenter.local_time_deviation=r<5e3?0:r,r=0<u?1e3*u:1e3*a.a.decodeTokenExpire(this.room.token.substring(2))-(t-this.stateCenter.local_time_deviation),this.resetTokenTimer(r)),this.room.isMulti||this.logger.setSessionInfo(this.stateCenter.appid,this.room.roomID,this.room.userSidString,this.stateCenter.idName,this.stateCenter.nickName,this.stateCenter.sdKVersion),this.stateCenter.reporter.spanEnd({key:this.liveRoomLoginKey.event,par:this.room.roomID},{server:this.isUseNetAgent?void 0:ae(this.server),room_id:null==(u=this.room)?void 0:u.roomID,room_sid_string:null==(t=this.room)?void 0:t.roomSidString,zpush_sessionid_string:this.isUseNetAgent&&null!=(u=null==(r=null==e?void 0:e.header)?void 0:r.session_id)?u.toString():void 0,liveroom_sid_string:null==(t=this.room)?void 0:t.userSidString}),this.resetTryLogin(),this.loginSuccessCallBack(s,e),this.roomStateHandle("CONNECTED",o.Logined,{code:0,msg:""}),this.logger.makeZipLogSpaceUpload().catch((function(e){i.logger.error("zm.rm.lgsuc zip log upload error: "+e.message)})),this.loginCallback.success&&this.loginCallback.success(!0)},Ze.prototype.closeHandler=function(e){this.logger.error(P+" room websocket close "+JSON.stringify(e.code||e)),this.room.runState!==n.b.logout?this.room.runState===n.b.trylogin?(this.resetTryLogin(),this.loginCallback.fail&&this.loginCallback.fail(1006==e.code?ie.error.LOGIN_TIMEOUT:e)):this.room.runState===n.b.login&&(this.logger.info(P+" is called because of network broken"),this.resetTryLogin(),this.onDisconnect(ie.error.NETWORK_BROKEN)):this.logger.info(P+" onclose logout flow call websocket.close")},Ze.prototype.logout=function(e,t){this.logger.info(M+" call"),this.room.runState===n.b.logout?this.logger.warn("zb.rh.lo at logout"):(this.resetRoom(e),this.roomStateHandle("DISCONNECTED",o.Logout,{code:0,msg:""},void 0,t),this.stopTokenTimer(),this.logger.info(M+" call success"))},Ze.prototype.handleLogoutRsp=function(e,t){this.logger.info(M+" result=",e.body&&e.body.err_code?e.body.err_code:"-1"),this.isUseNetAgent&&t&&null!=(e=this.liveRoomHandler)&&e.closeRequest()};var Xe=Ze;function Ze(e,t,r,o,n,i){this.logger=e,this.stateCenter=t,this.dataReport=r,this.room=o,this.liveRoomHandler=n,this.service=i,this.tryLoginTimer=null,this.tryLoginCount=0,this.tryLoginInterval=1e4,this.tokenTimer=null,this.beforeExpire=30,this.server="",this.tempBrokenTime=0,this.reconectTimes=0,this.loginCallback={}}var Je=function(e,t,r){if(r||2===arguments.length)for(var o,n=0,i=t.length;n<i;n++)!o&&n in t||((o=o||Array.prototype.slice.call(t,0,n))[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))},et=(tt.prototype.loginRsp=function(e,t){this.anchor_info=e.body.anchor_info||this.anchor_info,this.userListInterval=e.body.userlist_interval||this.userListInterval,this.userListMergeInterval=e.body.userlist_merge_timeout||this.userListMergeInterval,e.body.anchor_info&&(this.stateCenter.actionListener("getAnchorInfo",e.body.anchor_info.anchor_id_name,e.body.anchor_info.anchor_nick_name),this.stateCenter.actionListener("_getAnchorInfo",e.body.anchor_info.anchor_id_name,e.body.anchor_info.anchor_nick_name)),e.body.online_count&&this.stateCenter.actionListener("roomOnlineUserCountUpdate",this.room.roomID,e.body.online_count),this.logger.info("zm.us.lgr  userStateUpdate "+this.room.userStateUpdate),this.room.userStateUpdate&&this.fetchUserList(t)},tt.prototype.patchUserList=function(e){var t=this;e.body.server_user_seq!==this.userSeq&&this.room.userStateUpdate&&!this.userSeqMergeMap&&(this.logger.info("zm.us.pt call update user "+this.userSeq+" server "+e.body.server_user_seq),this.userSeqMergeMap||(this.userSeqMergeMap={}),this.userSeqMergeTimer&&clearTimeout(this.userSeqMergeTimer),this.userSeqMergeTimer=setTimeout((function(){t.handleMergeTimeout()}),this.userListMergeInterval)),this.minUserSeq=e.body.server_user_seq,null!=e.body.online_count&&0!=e.body.online_count&&this.stateCenter.actionListener("roomOnlineUserCountUpdate",this.room.roomID,e.body.online_count)},tt.prototype.resetUserHandler=function(){this.userQuerying=!1,this.lastUserQueryTime=0,this.userTempList=[],this.userSeq=0,this.minUserSeq=0,this.userList=void 0,this.userSeqMergeMap={},this.userSeqMergeTimer=void 0,this.userQueryTimer=void 0,this.userListInterval=3e4,this.userListMergeInterval=5e3,this.anchor_info={anchor_id:"",anchor_id_name:"",anchor_nick_name:""}},tt.prototype.fetchUserList=function(e){this.userQuerying?this.logger.warn(D+" is already querying"):(this.userQuerying=!0,this.userTempList=[],this.fetchUserListWithPage(0,e||0),this.logger.info(D+" the first time call"))},tt.prototype.fetchUserListWithPage=function(e,t){function r(e){o.handleFetchUserListRsp(e,t)}var o=this,i={user_index:e,sort_type:0},s=Re;this.stateCenter.reporter.createSpan(n.k.H,{key:ie.event,par:this.room.roomID},{key:s.event,par:this.room.roomID},s.event,!0).setAttribute("user_index",s.user_index(e)),null!=(s=this.liveRoomHandler)&&s.fetchUserList(i,r,r,this.room)},tt.prototype.handleFetchUserListRsp=function(e,t){var r=this;if(this.stateCenter.reporter.spanEnd({key:Re.event,par:this.room.roomID},{error:(null==(o=null==e?void 0:e.body)?void 0:o.err_code)||(null==e?void 0:e.code),message:(null==(o=null==e?void 0:e.body)?void 0:o.err_message)||(null==e?void 0:e.msg)}),e.body&&0!=e.body.err_code)this.userQuerying=!1,this.lastUserQueryTime=Date.now()+this.userListInterval,this.logger.info(U+" fetch error "+e.body.err_code);else if(e.header&&e.body)if(this.room.userStateUpdate){this.userTempList=Je(Je([],this.userTempList,!0),e.body.user_baseinfos,!0);var o=e.body.ret_user_index;if(o!=e.body.server_user_index)this.logger.info(U+" fetch another page"),this.fetchUserListWithPage(o+1,t);else{this.userSeq=e.body.server_user_seq;for(var i=[],s=[],u=0;u<this.userTempList.length;u++){var l={userID:this.userTempList[u].id_name,userName:this.userTempList[u].nick_name,role:this.userTempList[u].role};4!==l.role&&(i.push(l),s.push({idName:this.userTempList[u].id_name,nickName:this.userTempList[u].nick_name,role:this.userTempList[u].role}))}this.stateCenter.actionListener("_getTotalUserList",this.room.roomID,s),t==n.b.login?(this.userList&&a.a.mergeUserList(this.logger,this.userList,i,(function(e,t){0!==e.length&&r.onUserStateUpdate(r.room.roomID,"ADD",e),0!==t.length&&r.onUserStateUpdate(r.room.roomID,"DELETE",t)})),this.userList=i):0!==(this.userList=i).length&&this.onUserStateUpdate(this.room.roomID,"ADD",i),this.userQuerying=!1,this.lastUserQueryTime=Date.now()+this.userListInterval,this.userTempList=[],this.logger.info(U+" call success user_list "+i+", count: "+i.length+", seq: "+this.userSeq)}}else this.logger.info(U+" not update");else this.userQuerying=!1,this.lastUserQueryTime=Date.now()+this.userListInterval,this.logger.info(U+" fetch error "+e)},tt.prototype.handlePushUserStateUpdateMsg=function(e){if(this.logger.info(x+" call"),this.room.userStateUpdate)if(this.userSeq===e.body.user_list_seq)this.logger.warn(x+" user_list_seq is the same with local seq");else if(this.userSeq+e.body.user_actions.length!==e.body.user_list_seq)this.mergeUserByUserSeq(e.body.user_list_seq,e.body.user_actions);else{this.userSeq=e.body.user_list_seq;for(var t=[],r=0;r<e.body.user_actions.length;r++){var o={action:e.body.user_actions[r].Action,idName:e.body.user_actions[r].IdName,nickName:e.body.user_actions[r].NickName,role:e.body.user_actions[r].Role,loginTime:e.body.user_actions[r].LoginTime};4!==o.role&&t.push(o)}this.stateCenter.actionListener("_userStateUpdate",e.body.room_id,t);var n=[],i=[];t.forEach((function(e){1==e.action?n.push({userID:e.idName,userName:e.nickName,role:e.role}):2==e.action&&i.push({userID:e.idName,userName:e.nickName,role:e.role})})),this.userList&&(this.userList=this.userList.concat(n).filter((function(e){return!i.some((function(t){return t.userID==e.userID}))}))),0!==n.length&&this.onUserStateUpdate(e.body.room_id,"ADD",n),0!==i.length&&this.onUserStateUpdate(e.body.room_id,"DELETE",i),this.logger.info(x+" call success")}else this.logger.info(x+" userStateUpdate is false")},tt.prototype.onUserStateUpdate=function(e,t,r){var o=this;r=r.filter((function(e){return e.userID!==o.stateCenter.idName})),0!=r.length&&(r=r.map((function(e){return{userID:e.userID,userName:e.userName}})),this.stateCenter.actionListener("roomUserUpdate",e,t,r))},tt.prototype.mergeUserByUserSeq=function(e,t){var r=this;this.userSeqMergeMap||(this.logger.warn(H+" new merge userlist "+this.userSeq+" server "+e),this.userSeqMergeMap={},this.userSeqMergeTimer&&clearTimeout(this.userSeqMergeTimer),this.userSeqMergeTimer=setTimeout((function(){r.handleMergeTimeout()}),this.userListMergeInterval)),this.userSeqMergeMap[e]=t,this.logger.warn(H+"  merge userlist "+this.userSeq+" server "+e+" userlist "+t.length)},tt.prototype.mergeUser=function(e){var t=this,r=(this.logger.info("zm.us.mg merge userlist "+this.userSeq+" userSeqList "+e.join(",")),this.userSeq=e[e.length-1],this.lastUserQueryTime=Date.now()+this.userListInterval,{}),o=((e.forEach((function(e){t.userSeqMergeMap&&t.userSeqMergeMap[e].forEach((function(e){r[e.IdName]=e}))})),this.userSeqMergeMap=null,e=Object.values(r).map((function(e){return{action:e.Action,idName:e.IdName,nickName:e.NickName,role:e.Role,loginTime:e.LoginTime?String(e.LoginTime):""}})).filter((function(e){return 4!==e.role}))).sort((function(e,t){return e.loginTime.localeCompare(t.loginTime)})),[]),n=[];e.forEach((function(e){1==e.action?o.push({userID:e.idName,userName:e.nickName,role:e.role}):2==e.action&&n.push({userID:e.idName,userName:e.nickName,role:e.role})})),this.userList=this.userList&&this.userList.concat(o).filter((function(e){return!n.some((function(t){return t.userID==e.userID}))})),0!==o.length&&this.onUserStateUpdate(this.room.roomID,"ADD",o),0!==n.length&&this.onUserStateUpdate(this.room.roomID,"DELETE",n),this.stateCenter.actionListener("_userStateUpdate",this.room.roomID,e)},tt.prototype.handleMergeTimeout=function(){var e,t=this,r=Object.keys(this.userSeqMergeMap).map((function(e){return+e})).sort((function(e,t){return e-t}));r[r.length-1]-r[0]+1===r.length||r[r.length-1]>=this.minUserSeq?this.mergeUser(r):(this.userSeqMergeMap=null,e=this.lastUserQueryTime-Date.now(),this.logger.info("zm.us.mto  fetch merge userlist "+this.userSeq+" userSeqList "+r.join(",")+" wait "+e),0<e?(this.userQueryTimer&&clearTimeout(this.userQueryTimer),this.userQueryTimer=setTimeout((function(){t.fetchUserList()}),e)):this.fetchUserList())},tt);function tt(e,t,r,o,n,i){this.logger=e,this.stateCenter=t,this.dataReport=r,this.liveRoomHandler=o,this.room=n,this.service=i,this.userQuerying=!1,this.userTempList=[],this.userSeq=0,this.minUserSeq=0,this.userList=[],this.userSeqMergeMap=null,this.userListInterval=3e4,this.userListMergeInterval=5e3,this.anchor_info={anchor_id:"",anchor_id_name:"",anchor_nick_name:""}}Object.defineProperty(ot.prototype,"isUseNetAgent",{get:function(){return this.stateCenter.useNetAgent},enumerable:!1,configurable:!0}),Object.defineProperty(ot.prototype,"sessionExist",{get:function(){return null!==this.longSid||"0"!==this.sessionID},enumerable:!1,configurable:!0}),Object.defineProperty(ot.prototype,"roomSidString",{get:function(){return this.longRoomSid?this.longRoomSid.toString():"0"},enumerable:!1,configurable:!0}),Object.defineProperty(ot.prototype,"userSidString",{get:function(){return this.longSid?this.longSid.toString():"0"},enumerable:!1,configurable:!0}),ot.prototype.initMessageHandler=function(){},ot.prototype.initLiveHandler=function(){},ot.prototype.init=function(){this.bindHeatBeatHandler(),this.bindRoomHandler(),this.bindMessageHandler(),this.bindLiveHandler()},ot.prototype.bindHeatBeatHandler=function(){var e=this;this.heartBeatHandler.hbLogout=function(t){e.roomHandler.handleHbLogout(t)},this.heartBeatHandler.heartbeatRspNotiFy=function(t,r){e.messageHandler&&e.messageHandler.loginRsp(t),e.userHandler.patchUserList(t),e.HBResponse(t,r)}},ot.prototype.bindRoomHandler=function(){var e=this;this.roomHandler.loginSuccessCallBack=function(t,r){e.logger.info("zm.lrm.brh login suc "+t),e.heartBeatHandler.init(r),e.liveRoomHandler.startCheck(),e.userHandler.loginRsp(r,t),e.messageHandler&&e.messageHandler.loginRsp(r),e.isMulti||e.handleMultiRoom(),e.roomLoginResponse(r)},this.roomHandler.resetRoomCallBack=function(){e.heartBeatHandler.resetHeartbeat(),e.liveHandler&&e.liveHandler.resetLiveHandler(),e.messageHandler&&e.messageHandler.resetMessageInfo(),e.isUseNetAgent&&e.liveRoomHandler&&e.liveRoomHandler.stopCheck(),e.userHandler.resetUserHandler(),e.roomTryHandler&&(e.roomTryHandler.invalid(),e.roomTryHandler.stopMaxTime())}},ot.prototype.bindUserHandler=function(){},ot.prototype.bindMessageHandler=function(){},ot.prototype.bindLiveHandler=function(){},ot.prototype.HBResponse=function(e,t){this.stateCenter.actionListener("HBResponse",e,t)},ot.prototype.roomLoginResponse=function(e){this.stateCenter.actionListener("roomLoginResponse",e)},ot.prototype.checkRoomSession=function(e){return null!==this.longRoomSid&&this.longRoomSid.eq(e)},ot.prototype.handleMultiRoom=function(){var e=this;this.stateCenter.roomModulesList.forEach((function(t){t.runState!==n.b.login&&t.roomTryHandler&&1==t.isMulti&&(t.roomTryHandler.onactive=function(r,n){var i;n&&0!==n.code?(0!==n.code&&(i=a.a.getLiveRoomError(n.code,e.isUseNetAgent))&&s.a[i]&&(n=s.a[i]),t.roomHandler.roomStateHandle("DISCONNECTED",o.ReconnectFailed,n,n.msg)):t.roomHandler.roomStateHandle("CONNECTED",o.Reconnected,n)},t.roomTryHandler.startMaxTime(),t.roomTryHandler.active())}))},ot.prototype.isLogin=function(){return this.runState===n.b.login},ot.prototype.isLogout=function(){return this.runState===n.b.logout},ot.prototype.isTryLogin=function(){return this.runState===n.b.trylogin},ot.prototype.isDisConnect=function(){return this.liveRoomHandler.isDisConnect()},ot.prototype.retryConnect=function(){this.logger.info("zm.lrm.rc call"),this.isUseNetAgent&&(this.resetSessionInfo(),this.liveRoomHandler.closeRequest())},ot.prototype.retryRoom=function(){this.logger.info("zm.lrm.rr.0 call"),this.roomTryHandler&&this.rtm.netAgent.isConnect()&&(this.resetRoomSession(),this.resetUserSession(),this.roomTryHandler.active(!0))},ot.prototype.resetSessionInfo=function(){var e;this.logger.info("zm.lrm.rsi call"),this.resetRoomSession(),this.resetUserSession(),null!=(e=this.liveRoomHandler)&&e.reset()},ot.prototype.resetRoomSession=function(){this.roomSessionID="0",this.longRoomSid=null},ot.prototype.resetUserSession=function(){this.sessionID="0",this.longSid=null};var rt=ot;function ot(e,t,r,o,i,s,a){this.roomID=e,this.stateCenter=t,this.logger=r,this.dataReport=o,this.rtm=i,this.liveRoomHandler=s,this.service=a,this.runState=n.b.logout,this.lastRunState=n.b.logout,this.lastRoomState="DISCONNECTED",this.roomState="DISCONNECTED",this.roomSessionID="0",this.sessionID="0",this.longSid=null,this.longRoomSid=null,this.isMulti=!1,this.token="",this.thirdToken="",this.loginTime=0,this.userStateUpdate=!1,this.maxMemberCount=0,this.roomName="",this.roomHandler=new Xe(this.logger,this.stateCenter,this.dataReport,this,s,this.service),this.heartBeatHandler=new $e(this.logger,this.stateCenter,this.dataReport,this.liveRoomHandler,this,this.service),this.userHandler=new et(this.logger,this.stateCenter,this.dataReport,this.liveRoomHandler,this,this.service),this.initMessageHandler(),this.initLiveHandler(),this.init()}for(var nt=function(){},it=r(7),st=it.roots,at=it.types?it.types.basic:{double:1,float:5,int32:0,uint32:0,sint32:0,fixed32:5,sfixed32:5,int64:0,uint64:0,sint64:0,fixed64:1,sfixed64:1,bool:0,string:2,bytes:2},ut=it.types?it.types.packed:{double:1,float:5,int32:0,uint32:0,sint32:0,fixed32:5,sfixed32:5,int64:0,uint64:0,sint64:0,fixed64:1,sfixed64:1,bool:0},lt=Object.keys(at),ht=it.util.Long?it.util.Long.fromBits:function(){return 0},ct={$:function(e){return ct[e]?ct[e].call(this):st[e].decode?st[e].decode(this,this.uint32()):ct.$.call(this,"int32")}},dt={$:function(e,t,r){var o=at[e];return void 0===o?st[e].encode?(this.uint32((r<<3|2)>>0).fork(),st[e].encode(t,this).ldelim()):dt.$.call(this,"int32",t,r):dt[e].call(this.uint32(r<<3|o),t)}},pt=0;pt<lt.length;pt++)ct[lt[pt]]=it.Reader.prototype[lt[pt]],dt[lt[pt]]=it.Writer.prototype[lt[pt]];!function e(t,r,o,n){for(var i=0,s=Object.keys(t);i<s.length;i++){var a=s[i];if(t[a].$m&&Object.keys(t[a].$m).every((function(e){return Number(e)}))){if(o[a])throw Error(`nested type ${o}.${a} has already exist`);o[a]=function(t,o){function n(e){for(var r in t)"{"===(r=t[r])[1].charAt(0)?this[r[0]]={}:"["!==r[1].charAt(0)&&"<"!==r[1].charAt(0)||(this[r[0]]=[]);if(e)for(var o=Object.keys(e),n=0;n<o.length;++n)null!=e[o[n]]&&(this[o[n]]=e[o[n]])}var i,s={};for(i in t){var a=t[i],u=a[1];"{"===u.charAt(0)?(n.prototype[a[0]]=it.util.emptyObject,s[u]={$m:u.substring(1).split(",").map((function(e,t){return["$"+(t+1),e,null]})).reduce((function(e,t,r){return e[r+1]=t,e}),{})}):n.prototype[a[0]]="["===u.charAt(0)||"<"===u.charAt(0)?it.util.emptyArray:"bytes"===u?it.util.newBuffer([]):a[2]&&a[2].hasOwnProperty("low")&&a[2].hasOwnProperty("high")?ht(a[2].low,a[2].high,a[2].unsigned):a[2]}return n.create=function(e){return new n(e)},n.decode=function(e,r){e instanceof it.Reader||(e=it.Reader.create(e));for(var o=void 0===r?e.len:e.pos+r,i=new n;e.pos<o;){var s=e.uint32(),a=s>>>3;if(0<a&&t[a]){var u=t[a][0],l=t[a][1];if("{"===l.charAt(0))i[u]===it.util.emptyObject&&(i[u]={}),a=n.$namespace[l].decode(e,e.uint32()),i[u][a.$1]=a.$2;else if("["===l.charAt(0)||"<"===l.charAt(0))if(l=l.substring(1),i[u]&&i[u].length||(i[u]=[]),void 0!==ut[l]&&2==(7&s))for(var h=e.uint32()+e.pos;e.pos<h;)i[u].push(ct.$.call(e,l));else i[u].push(ct.$.call(e,l));else i[u]=ct.$.call(e,l)}else e.skipType(7&s)}return i},n.encode=function(e,r){for(var o in r=r||it.Writer.create(),t){var i=t[o][0];if("{"===(l=t[o][1]).charAt(0)){if(null!=e[i]&&e.hasOwnProperty(i))for(var s=0,a=Object.keys(e[i]);s<a.length;++s)r.uint32((o<<3|2)>>0).fork(),n.$namespace[l].encode({$1:a[s],$2:e[i][a[s]]},r).ldelim()}else if("["===l.charAt(0)||"<"===l.charAt(0)){var u="<"===l.charAt(0),l=l.substring(1),h=e[i];if(null!=h&&h.length)if(u&&void 0!==ut[l]){for(r.uint32((o<<3|2)>>0).fork(),s=0;s<h.length;s++)dt[l].call(r,h[s]);r.ldelim()}else for(s=0;s<h.length;s++)dt.$.call(r,l,h[s],o)}else null!=e[i]&&e.hasOwnProperty(i)&&dt.$.call(r,l,e[i],o)}return r},Object.keys(s).length&&(n.$namespace=e(s,r+"."+o,n.$namespace||{},!0)),n}(t[a].$m,a)}else t[a].$s?o[a]=function(e,t){function o(e,t,r){it.rpc.Service.call(this,e,t,r)}return((o.prototype=Object.create(it.rpc.Service.prototype)).constructor=o).create=function(e,t,r){return new o(e,t,r)},Object.keys(e).forEach((function(n){var i=e[n];function s(e,t){return this.rpcCall(s,st[i[0]],st[i[1]],e,t)}Object.defineProperty(s,"name",{value:n}),Object.defineProperty(s,"path",{value:r+"."+t}),o.prototype[n]=s})),o}(t[a].$s,a):t[a].$e&&Object.values(t[a].$e).every((function(e){return Number(e)===e}))&&(o[a]=function(e){for(var t=Object.keys(e),r={},o=0;o<t.length;o++)r[r[t[o]]=e[t[o]]]=t[o];return r}(t[a].$e));o[a]&&!n&&(st[r+"."+a]=o[a]),delete t[a].$m,delete t[a].$s,delete t[a].$e,o[a]=e(t[a],r?r+"."+a:a,o[a]||{})}return o}({PB:{liveroom_cs_v3:{AddStreamReq:{$m:{1:["stream_id","bytes",[]],2:["stream_title","bytes",[]],3:["stream_type","uint32",0],4:["stream_attr","bytes",[]],5:["extra_info","bytes",[]],6:["client_req_seq","uint32",0],7:["third_token","bytes",[]],8:["censor_mode","uint32",0],9:["need_gather","uint32",0]}},AddStreamRsp:{$m:{1:["rsp_head","PB.liveroom_cs_v3.RspHead",null],2:["stream_seq","uint32",0],3:["stream_sid","string",""],4:["stream_ver","uint32",0],5:["stream_nid","uint32",0],6:["token_remain_time","uint32",0]}},AnchorInfo:{$m:{1:["id_name","bytes",[]],2:["user_id","uint64",{low:0,high:0,unsigned:!0}],3:["nick_name","bytes",[]]}},BigImData:{$m:{1:["id_name","bytes",[]],2:["nick_name","bytes",[]],3:["role","uint32",0],4:["msg_id","bytes",[]],5:["msg_category","uint32",0],6:["msg_type","uint32",0],7:["msg_content","bytes",[]],8:["msg_timestamp","int64",{low:0,high:0,unsigned:!1}]}},CommonRsp:{$m:{1:["rsp_head","PB.liveroom_cs_v3.RspHead",null]}},DeleteStreamReq:{$m:{1:["stream_sid","string",""],2:["stream_id","bytes",[]],3:["client_req_seq","uint32",0]}},DeleteStreamRsp:{$m:{1:["rsp_head","PB.liveroom_cs_v3.RspHead",null],2:["stream_seq","uint32",0],3:["stream_ver","uint32",0]}},EnterRoomReq:{$m:{1:["net_type","uint32",0],2:["conn_type","uint32",0],3:["room_id","bytes",[]],4:["room_name","bytes",[]],5:["role","uint32",0],6:["third_token","bytes",[]],7:["room_create_flag","uint32",0],8:["user_state_flag","uint32",0],9:["user_count_limit","uint32",0],10:["relate_service","string",""],11:["need_gather_stream","uint32",0],12:["callback_data","bytes",[]],13:["service_flags","uint32",0],14:["license_token","bytes",[]]}},EnterRoomRsp:{$m:{1:["rsp_head","PB.liveroom_cs_v3.RspHead",null],2:["user_session_id","uint64",{low:0,high:0,unsigned:!0}],3:["room_session_id","uint64",{low:0,high:0,unsigned:!0}],4:["user_id","uint64",{low:0,high:0,unsigned:!0}],5:["ret_timestamp","int64",{low:0,high:0,unsigned:!1}],6:["big_im_time_window","uint32",0],7:["liveroom_hb_interval","uint32",0],8:["liveroom_hb_timeout","uint32",0],9:["online_count","uint32",0],10:["anchor_info","PB.liveroom_cs_v3.AnchorInfo",null],11:["userlist_merge_timeout","uint32",0],12:["userlist_interval","uint32",0],13:["token_remain_time","uint32",0],14:["trans_list_seq","uint32",0],15:["trans_channel_list","<PB.liveroom_cs_v3.TransChannel",null],16:["stream_count","uint32",0],17:["stream_list_seq","uint32",0],18:["stream_info_list","<PB.liveroom_cs_v3.StreamInfo",null],19:["stream_fetch_flag","uint32",0],20:["stream_list_push_merge_timeout","uint32",0],21:["stream_list_hb_merge_timeout","uint32",0],22:["relate_result_list","<PB.liveroom_cs_v3.RelateResult",null],23:["gather_list_seq","uint32",0],24:["gather_info_list","<PB.liveroom_cs_v3.GatherInfo",null]}},EnumSignalTransmitResult:{$e:{ok:0,version_err:1}},GatherInfo:{$m:{1:["gather_id","string",""]}},GetGatherListReq:{$m:{}},GetGatherListRsp:{$m:{1:["rsp_head","PB.liveroom_cs_v3.RspHead",null],2:["gather_list_seq","uint32",0],3:["gather_info_list","<PB.liveroom_cs_v3.GatherInfo",null]}},GetImReq:{$m:{1:["msg_id","uint64",{low:0,high:0,unsigned:!0}],2:["sort_type","uint32",0],3:["msg_count","uint32",0]}},GetImRsp:{$m:{1:["rsp_head","PB.liveroom_cs_v3.RspHead",null],2:["server_msg_id","uint64",{low:0,high:0,unsigned:!0}],3:["ret_msg_id","uint64",{low:0,high:0,unsigned:!0}],4:["msg_list","<PB.liveroom_cs_v3.GetImRspImData",null]}},GetImRspImData:{$m:{1:["id_name","bytes",[]],2:["nick_name","bytes",[]],3:["role","uint32",0],4:["msg_id","uint64",{low:0,high:0,unsigned:!0}],5:["msg_category","uint32",0],6:["msg_type","uint32",0],7:["msg_content","bytes",[]],8:["send_time","int64",{low:0,high:0,unsigned:!1}]}},GetStreamListReq:{$m:{}},GetStreamListRsp:{$m:{1:["rsp_head","PB.liveroom_cs_v3.RspHead",null],2:["stream_list_seq","uint32",0],3:["stream_info_list","<PB.liveroom_cs_v3.StreamInfo",null],4:["stream_refresh","uint32",0]}},GetTransReq:{$m:{1:["trans_channel","bytes",[]],2:["trans_list","<PB.liveroom_cs_v3.GetTransReqTransData",null]}},GetTransReqTransData:{$m:{1:["trans_type","bytes",[]],2:["trans_local_seq","uint32",0]}},GetTransRsp:{$m:{1:["rsp_head","PB.liveroom_cs_v3.RspHead",null],2:["trans_channel","bytes",[]],3:["trans_list_seq","uint32",0],4:["trans_list","<PB.liveroom_cs_v3.GetTransRspTransData",null]}},GetTransRspTransData:{$m:{1:["err_code","uint32",0],2:["trans_type","bytes",[]],3:["trans_data","bytes",[]],4:["trans_send_time","int64",{low:0,high:0,unsigned:!1}],5:["trans_seq","uint32",0],6:["id_name","bytes",[]],7:["nick_name","bytes",[]],8:["role","uint32",0]}},GetUserlistReq:{$m:{1:["sort_type","uint32",0],2:["user_index","uint32",0]}},GetUserlistRsp:{$m:{1:["rsp_head","PB.liveroom_cs_v3.RspHead",null],2:["server_user_seq","uint64",{low:0,high:0,unsigned:!0}],3:["server_user_index","int64",{low:0,high:0,unsigned:!1}],4:["ret_user_index","int64",{low:0,high:0,unsigned:!1}],5:["user_base_info_list","<PB.liveroom_cs_v3.UserBaseInfo",null]}},GetUserTransReq:{$m:{1:["trans_channel","bytes",[]],2:["user_trans_list","<PB.liveroom_cs_v3.GetUserTransReqTransData",null]}},GetUserTransReqTransData:{$m:{1:["trans_type","bytes",[]],2:["trans_local_seq","uint32",0]}},GetUserTransRsp:{$m:{1:["rsp_head","PB.liveroom_cs_v3.RspHead",null],2:["trans_channel","bytes",[]],3:["user_trans_list","<PB.liveroom_cs_v3.GetUserTransRspTransData",null]}},GetUserTransRspTransData:{$m:{1:["err_code","uint32",0],2:["trans_type","bytes",[]],3:["trans_data","bytes",[]],4:["trans_send_time","int64",{low:0,high:0,unsigned:!1}],5:["trans_seq","uint32",0],6:["id_name","bytes",[]],7:["nick_name","bytes",[]],8:["role","uint32",0]}},HbReq:{$m:{}},HbRsp:{$m:{1:["rsp_head","PB.liveroom_cs_v3.RspHead",null],2:["ret_timestamp","int64",{low:0,high:0,unsigned:!1}],3:["hb_interval","uint32",0],4:["hb_timeout","uint32",0],5:["stream_seq","uint32",0],6:["user_seq","int64",{low:0,high:0,unsigned:!1}],7:["online_count","uint32",0],8:["big_im_time_window","uint32",0],9:["trans_channel_list","<PB.liveroom_cs_v3.TransChannel",null],10:["user_trans_channel_list","<PB.liveroom_cs_v3.TransChannel",null],11:["stream_refresh","uint32",0],12:["trans_list_seq","uint32",0],13:["gather_list_seq","uint32",0]}},ImData:{$m:{1:["id_name","bytes",[]],2:["nick_name","bytes",[]],3:["role","uint32",0],4:["msg_id","uint64",{low:0,high:0,unsigned:!0}],5:["msg_category","uint32",0],6:["msg_type","uint32",0],7:["msg_content","bytes",[]],8:["send_time","int64",{low:0,high:0,unsigned:!1}]}},LiveroomSessionInfo:{$m:{1:["RoomId","bytes",[]],2:["UserSessionId","uint64",{low:0,high:0,unsigned:!0}],3:["RoomSessionId","uint64",{low:0,high:0,unsigned:!0}],4:["Role","uint32",0]}},PushBigIm:{$m:{1:["msg_list","<PB.liveroom_cs_v3.BigImData",null]}},PushIm:{$m:{1:["server_msg_id","uint64",{low:0,high:0,unsigned:!0}],2:["ret_msg_id","uint64",{low:0,high:0,unsigned:!0}],4:["msg_list","<PB.liveroom_cs_v3.ImData",null]}},PushStartGather:{$m:{1:["gather_id","string",""],2:["gather_seq","uint32",0]}},PushStopGather:{$m:{1:["gather_id","string",""],2:["gather_seq","uint32",0]}},PushStream:{$m:{1:["stream_seq","uint32",0],2:["stream_info_list","<PB.liveroom_cs_v3.PushStreamInfo",null]}},PushStreamInfo:{$m:{1:["stream_id","bytes",[]],2:["stream_sid","string",""],3:["id_name","bytes",[]],4:["nick_name","bytes",[]],5:["stream_title","bytes",[]],6:["stream_ver","uint32",0],7:["stream_attr","bytes",[]],8:["stream_src","uint32",0],9:["stream_state","uint32",0],10:["stream_type","uint32",0],11:["stream_nid","uint32",0],12:["extra_info","bytes",[]],13:["create_time","int64",{low:0,high:0,unsigned:!1}],14:["close_type","uint32",0],15:["need_gather","uint32",0]}},PushTrans:{$m:{1:["id_name","bytes",[]],2:["nick_name","bytes",[]],3:["role","uint32",0],4:["trans_type","bytes",[]],5:["trans_data","bytes",[]],6:["trans_seq","uint32",0],7:["trans_send_time","int64",{low:0,high:0,unsigned:!1}],8:["trans_channel","bytes",[]],9:["trans_list_seq","uint32",0]}},PushUserInfoUpdated:{$m:{1:["server_user_seq","int64",{low:0,high:0,unsigned:!1}],2:["user_action_list","<PB.liveroom_cs_v3.UserAction",null]}},PushUserKickout:{$m:{1:["id_name","bytes",[]],2:["user_session_id","uint64",{low:0,high:0,unsigned:!0}],3:["kickout_reason","int32",0],4:["custom_reason","bytes",[]]}},PushUserLogReport:{$m:{}},PushUserTokenExpire:{$m:{1:["token","string",""],2:["stop_stream_info","PB.liveroom_cs_v3.StopStream",null]}},PushUserTrans:{$m:{1:["id_name","bytes",[]],2:["nick_name","bytes",[]],3:["role","uint32",0],4:["trans_send_time","int64",{low:0,high:0,unsigned:!1}],5:["trans_channel","bytes",[]],6:["trans_seq_list","<PB.liveroom_cs_v3.PushUserTransInfo",null]}},PushUserTransInfo:{$m:{1:["trans_type","bytes",[]],2:["trans_data","bytes",[]],3:["trans_seq","uint32",0]}},QuitRoomReq:{$m:{}},QuitRoomRsp:{$m:{1:["rsp_head","PB.liveroom_cs_v3.RspHead",null]}},RelateResult:{$m:{1:["service","string",""],2:["relate_result","uint32",0]}},RenewTokenReq:{$m:{1:["token","string",""]}},RenewTokenRsp:{$m:{1:["rsp_head","PB.liveroom_cs_v3.RspHead",null],2:["token_remain_time","uint32",0],3:["stop_stream_id_list","<bytes",null]}},RspHead:{$m:{1:["code","uint32",0],2:["message","string",""]}},SendBigImReq:{$m:{1:["msg_list","<PB.liveroom_cs_v3.SendBigImReqMsgData",null]}},SendBigImReqMsgData:{$m:{1:["msg_category","uint32",0],2:["msg_type","uint32",0],3:["msg_content","bytes",[]],4:["msg_timestamp","int64",{low:0,high:0,unsigned:!1}],5:["msg_client_id","bytes",[]]}},SendBigImRsp:{$m:{1:["rsp_head","PB.liveroom_cs_v3.RspHead",null],2:["big_im_time_window","uint32",0],3:["msg_list","<PB.liveroom_cs_v3.SendBigImRspMsgData",null]}},SendBigImRspMsgData:{$m:{1:["msg_id","bytes",[]],2:["msg_client_id","bytes",[]]}},SendImReq:{$m:{1:["msg_category","uint32",0],2:["msg_type","uint32",0],3:["msg_content","bytes",[]],4:["to_user_list","<PB.liveroom_cs_v3.ToUser",null]}},SendImRsp:{$m:{1:["rsp_head","PB.liveroom_cs_v3.RspHead",null],2:["msg_id","uint64",{low:0,high:0,unsigned:!0}]}},SetTransReq:{$m:{1:["trans_type","bytes",[]],2:["trans_data","bytes",[]],3:["trans_local_seq","uint32",0],4:["trans_channel","bytes",[]]}},SetTransRsp:{$m:{1:["rsp_head","PB.liveroom_cs_v3.RspHead",null],2:["trans_type","bytes",[]],3:["trans_seq","uint32",0],4:["trans_list_seq","uint32",0],5:["trans_channel","bytes",[]]}},SetUserAttrReq:{$m:{1:["use_data_channel","uint32",0],2:["is_modify_use_data_channel","bool",!1],3:["user_type","uint32",0],4:["is_modify_user_type","bool",!1]}},SetUserAttrRsp:{$m:{1:["rsp_head","PB.liveroom_cs_v3.RspHead",null]}},SignalLiveCustomReq:{$m:{1:["push_message","bytes",[]],2:["to_user_list","<PB.liveroom_cs_v3.ToUser",null]}},SignalLiveCustomRsp:{$m:{1:["rsp_head","PB.liveroom_cs_v3.RspHead",null]}},SignalLiveInviteReq:{$m:{1:["push_message","bytes",[]],2:["to_user_list","<PB.liveroom_cs_v3.ToUser",null]}},SignalLiveInviteRsp:{$m:{1:["rsp_head","PB.liveroom_cs_v3.RspHead",null]}},SignalLiveRequestReq:{$m:{1:["push_message","bytes",[]],2:["to_user_list","<PB.liveroom_cs_v3.ToUser",null]}},SignalLiveRequestRsp:{$m:{1:["rsp_head","PB.liveroom_cs_v3.RspHead",null]}},SignalLiveResultReq:{$m:{1:["push_message","bytes",[]],2:["to_user_list","<PB.liveroom_cs_v3.ToUser",null]}},SignalLiveResultRsp:{$m:{1:["rsp_head","PB.liveroom_cs_v3.RspHead",null]}},SignalLiveStopReq:{$m:{1:["push_message","bytes",[]],2:["to_user_list","<PB.liveroom_cs_v3.ToUser",null]}},SignalLiveStopRsp:{$m:{1:["rsp_head","PB.liveroom_cs_v3.RspHead",null]}},SignalTransmitReq:{$m:{1:["to_user_list","<bytes",null],2:["transmit_data","bytes",[]]}},SignalTransmitResult:{$m:{1:["to_user","bytes",[]],2:["result","PB.liveroom_cs_v3.EnumSignalTransmitResult",0]}},SignalTransmitRsp:{$m:{1:["rsp_head","PB.liveroom_cs_v3.RspHead",null],2:["result","<PB.liveroom_cs_v3.SignalTransmitResult",null]}},StopStream:{$m:{1:["stream_id_list","<bytes",null]}},StreamInfo:{$m:{1:["stream_id","bytes",[]],2:["stream_sid","string",""],3:["id_name","bytes",[]],4:["nick_name","bytes",[]],5:["stream_title","bytes",[]],6:["stream_ver","uint32",0],7:["stream_attr","bytes",[]],8:["create_time","int64",{low:0,high:0,unsigned:!1}],9:["stream_src","uint32",0],10:["stream_state","uint32",0],11:["stream_type","uint32",0],12:["stream_nid","uint32",0],13:["extra_info","bytes",[]],14:["need_gather","uint32",0]}},ToUser:{$m:{1:["id_name","bytes",[]],2:["user_id","uint64",{low:0,high:0,unsigned:!0}]}},TransChannel:{$m:{1:["trans_channel","bytes",[]],2:["trans_seq_list","<PB.liveroom_cs_v3.TransSeq",null]}},TransSeq:{$m:{1:["trans_type","bytes",[]],2:["trans_seq","uint32",0]}},UpdateStreamReq:{$m:{1:["stream_sid","string",""],2:["stream_id","bytes",[]],3:["stream_title","bytes",[]],4:["stream_attr","bytes",[]],5:["extra_info","bytes",[]],6:["client_req_seq","uint32",0],7:["nick_name","bytes",[]]}},UpdateStreamRsp:{$m:{1:["rsp_head","PB.liveroom_cs_v3.RspHead",null],2:["stream_seq","uint32",0],3:["stream_ver","uint32",0]}},UserAction:{$m:{1:["action","uint32",0],2:["id_name","bytes",[]],3:["nick_name","bytes",[]],4:["role","uint32",0],5:["login_time","int64",{low:0,high:0,unsigned:!1}]}},UserBaseInfo:{$m:{1:["id_name","bytes",[]],2:["nick_name","bytes",[]],3:["role","uint32",0]}}},proto_switch_v3:{AnchorInfo:{$m:{1:["id_name","bytes",[]],2:["user_id","uint64",{low:0,high:0,unsigned:!0}],3:["nick_name","bytes",[]]}},CommonRsp:{$m:{1:["rsp_head","PB.proto_switch_v3.RspHead",null]}},GatherInfo:{$m:{1:["gather_id","string",""]}},Header:{$m:{1:["cmd","uint32",0],2:["seq","uint32",0],3:["timestamp","int64",{low:0,high:0,unsigned:!1}],4:["controls","bytes",[]],5:["flags","bytes",[]],6:["context_key","uint32",0],101:["dev_traffic_label","bytes",[]]}},LiveroomProtoVersion:{$e:{PROTO_VERSION_NONE:0,RPOTO_V020000:131072}},LoginRoomReq:{$m:{1:["app_id","uint32",0],2:["biz_type","uint32",0],3:["room_id","bytes",[]],4:["room_name","bytes",[]],5:["role","uint32",0],6:["id_name","bytes",[]],7:["nick_name","bytes",[]],8:["device_id","string",""],9:["term_type","PB.proto_switch_v3.TermType",0],10:["net_type","PB.proto_switch_v3.NetType",0],11:["sdk_conn_type","PB.proto_switch_v3.SdkConnType",0],12:["sdk_version","uint32",0],13:["biz_version","string",""],14:["client_stamp","bytes",[]],15:["login_logic","uint32",0],16:["third_token","bytes",[]],17:["login_token","bytes",[]],18:["relogin_token","bytes",[]],19:["switch_session_id","uint64",{low:0,high:0,unsigned:!0}],20:["user_session_id","uint64",{low:0,high:0,unsigned:!0}],21:["room_create_flag","uint32",0],22:["user_state_flag","uint32",0],23:["user_count_limit","uint32",0],24:["relate_service","string",""],25:["need_gather_stream","uint32",0],26:["callback_data","bytes",[]],27:["service_flags","uint32",0],28:["license_token","bytes",[]]}},LoginRoomRsp:{$m:{1:["rsp_head","PB.proto_switch_v3.RspHead",null],2:["switch_session_id","uint64",{low:0,high:0,unsigned:!0}],3:["user_session_id","uint64",{low:0,high:0,unsigned:!0}],4:["room_session_id","uint64",{low:0,high:0,unsigned:!0}],5:["user_id","uint64",{low:0,high:0,unsigned:!0}],6:["ret_timestamp","int64",{low:0,high:0,unsigned:!1}],7:["big_im_time_window","uint32",0],8:["liveroom_hb_interval","uint32",0],9:["liveroom_hb_timeout","uint32",0],10:["online_count","uint32",0],11:["anchor_info","PB.proto_switch_v3.AnchorInfo",null],12:["relogin_token","bytes",[]],13:["userlist_merge_timeout","uint32",0],14:["userlist_interval","uint32",0],15:["token_remain_time","uint32",0],16:["trans_list_seq","uint32",0],17:["trans_channel_list","<PB.proto_switch_v3.TransChannel",null],18:["stream_count","uint32",0],19:["stream_list_seq","uint32",0],20:["stream_info_list","<PB.proto_switch_v3.StreamInfo",null],21:["stream_fetch_flag","uint32",0],22:["stream_list_push_merge_timeout","uint32",0],23:["stream_list_hb_merge_timeout","uint32",0],24:["relate_result_list","<PB.proto_switch_v3.RelateResult",null],25:["gather_list_seq","uint32",0],26:["gather_info_list","<PB.proto_switch_v3.GatherInfo",null]}},LogoutRoomReq:{$m:{1:["logout_code","uint32",0],2:["logout_check","bytes",[]],3:["user_session_id","uint64",{low:0,high:0,unsigned:!0}],4:["logout_logic","uint32",0]}},LogoutRoomRsp:{$m:{1:["rsp_head","PB.proto_switch_v3.RspHead",null]}},MergePushHead:{$m:{1:["qos_flag","uint32",0],2:["send_time","int64",{low:0,high:0,unsigned:!1}]}},MergePushInfo:{$m:{1:["sub_cmd","uint32",0],2:["sub_seq","uint32",0],3:["msg_body","bytes",[]]}},MergePushReq:{$m:{1:["head","PB.proto_switch_v3.MergePushHead",null],2:["message_list","<PB.proto_switch_v3.MergePushInfo",null]}},MergePushRsp:{$m:{1:["message_list","<PB.proto_switch_v3.MergePushRspInfo",null],2:["server_send_time","int64",{low:0,high:0,unsigned:!1}]}},MergePushRspInfo:{$m:{1:["sub_cmd","uint32",0],2:["sub_seq","uint32",0]}},NetType:{$e:{NT_NONE:0,NT_LINE:1,NT_WIFI:2,NT_2G:3,NT_3G:4,NT_4G:5,NT_UNKNOWN:32}},PushKickout:{$m:{1:["reason","uint32",0],2:["message","string",""],3:["is_need_relogin","uint32",0]}},PushReq:{$m:{1:["head","PB.proto_switch_v3.PushReqHead",null],2:["msg_body","bytes",[]]}},PushReqHead:{$m:{1:["sub_cmd","uint32",0],2:["qos_flag","uint32",0],3:["send_time","int64",{low:0,high:0,unsigned:!1}]}},PushRsp:{$m:{1:["code","uint32",0],2:["message","string",""],3:["sub_cmd","uint32",0],4:["server_send_time","int64",{low:0,high:0,unsigned:!1}]}},RelateResult:{$m:{1:["service","string",""],2:["relate_result","uint32",0]}},RspHead:{$m:{1:["code","uint32",0],2:["message","string",""]}},SdkConnType:{$e:{SdkConnType_None:0,SdkConnType_Tcp:1,SdkConnType_Websocket:2}},StreamInfo:{$m:{1:["stream_id","bytes",[]],2:["stream_sid","string",""],3:["id_name","bytes",[]],4:["nick_name","bytes",[]],5:["create_time","int64",{low:0,high:0,unsigned:!1}],6:["extra_info","bytes",[]],7:["title","bytes",[]],8:["stream_ver","uint32",0],9:["stream_attr","bytes",[]],10:["stream_src","uint32",0],11:["stream_state","uint32",0],12:["stream_type","uint32",0],13:["stream_nid","uint32",0],14:["need_gather","uint32",0]}},TermType:{$e:{TT_NONE:0,TT_PC:1,TT_IOS:2,TT_ANDROID:3,TT_MAC:4,TT_LINUX:5,TT_WEB:6,TT_MINI_PROGRAM:7,TT_UNKNOWN:32}},TransChannel:{$m:{1:["trans_channel","bytes",[]],2:["trans_seq_list","<PB.proto_switch_v3.TransSeq",null]}},TransSeq:{$m:{1:["trans_type","bytes",[]],2:["trans_seq","uint32",0]}}}}},"",st,!1),it.util.global.PB=st.PB,t=st.PB;var gt,mt={1002:"LoginRoomRsp",1004:"LogoutRoomRsp",1101:"PushReq",1103:"MergePushReq",1105:"PushKickout",10001:"PushUserInfoUpdated",10002:"PushUserKickout",10003:"PushUserLogReport",10004:"PushUserTokenExpire",12001:"PushStream",12002:"PushStream",12003:"PushStream",13001:"PushIm",14001:"PushBigIm",15001:"PushTrans",15002:"PushUserTrans",301002:"EnterRoomRsp",301004:"QuitRoomRsp",301006:"HbRsp",301008:"RenewTokenRsp",301012:"SetTransRsp",301014:"GetTransRsp",302002:"AddStreamRsp",302004:"DeleteStreamRsp",302006:"UpdateStreamRsp",302008:"GetStreamListRsp",303002:"SendImRsp",303006:"SendBigImRsp",303010:"SignalLiveRequestRsp",303012:"SignalLiveResultRsp",303014:"SignalLiveInviteRsp",303016:"SignalLiveStopRsp",303018:"SignalLiveCustomRsp",304002:"GetUserlistRsp"},ft=((ft=gt=gt||{})[ft.LoginRoomReq=1001]="LoginRoomReq",ft[ft.LoginRoomRsp=1002]="LoginRoomRsp",ft[ft.LogoutRoomReq=1003]="LogoutRoomReq",ft[ft.LogoutRoomRsp=1004]="LogoutRoomRsp",ft[ft.PushReq=1101]="PushReq",ft[ft.PushRsp=1102]="PushRsp",ft[ft.MergePushReq=1103]="MergePushReq",ft[ft.MergePushRsp=1104]="MergePushRsp",ft[ft.PushKickout=1105]="PushKickout",ft[ft.PushUserInfoUpdated=10001]="PushUserInfoUpdated",ft[ft.PushUserKickout=10002]="PushUserKickout",ft[ft.PushUserLogReport=10003]="PushUserLogReport",ft[ft.PushUserTokenExpire=10004]="PushUserTokenExpire",ft[ft.PushIm=13001]="PushIm",ft[ft.PushBigIm=14001]="PushBigIm",ft[ft.PushTrans=15001]="PushTrans",ft[ft.PushUserTrans=15002]="PushUserTrans",ft[ft.EnterRoomReq=301001]="EnterRoomReq",ft[ft.EnterRoomRsp=301002]="EnterRoomRsp",ft[ft.QuitRoomReq=301003]="QuitRoomReq",ft[ft.QuitRoomRsp=301004]="QuitRoomRsp",ft[ft.HbReq=301005]="HbReq",ft[ft.HbRsp=301006]="HbRsp",ft[ft.RenewTokenReq=301007]="RenewTokenReq",ft[ft.RenewTokenRsp=301008]="RenewTokenRsp",ft[ft.SetUserAttrReq=301009]="SetUserAttrReq",ft[ft.SetUserAttrRsp=301010]="SetUserAttrRsp",ft[ft.SetTransReq=301011]="SetTransReq",ft[ft.SetTransRsp=301012]="SetTransRsp",ft[ft.GetTransReq=301013]="GetTransReq",ft[ft.GetTransRsp=301014]="GetTransRsp",ft[ft.GetUserTransReq=301015]="GetUserTransReq",ft[ft.GetUserTransRsp=301016]="GetUserTransRsp",ft[ft.AddStreamReq=302001]="AddStreamReq",ft[ft.AddStreamRsp=302002]="AddStreamRsp",ft[ft.DeleteStreamReq=302003]="DeleteStreamReq",ft[ft.DeleteStreamRsp=302004]="DeleteStreamRsp",ft[ft.UpdateStreamReq=302005]="UpdateStreamReq",ft[ft.UpdateStreamRsp=302006]="UpdateStreamRsp",ft[ft.GetStreamListReq=302007]="GetStreamListReq",ft[ft.GetStreamListRsp=302008]="GetStreamListRsp",ft[ft.SendImReq=303001]="SendImReq",ft[ft.SendImRsp=303002]="SendImRsp",ft[ft.GetImReq=303003]="GetImReq",ft[ft.GetImRsp=303004]="GetImRsp",ft[ft.SendBigImReq=303005]="SendBigImReq",ft[ft.SendBigImRsp=303006]="SendBigImRsp",ft[ft.SignalLiveRequestReq=303009]="SignalLiveRequestReq",ft[ft.SignalLiveRequestRsp=303010]="SignalLiveRequestRsp",ft[ft.SignalLiveResultReq=303011]="SignalLiveResultReq",ft[ft.SignalLiveResultRsp=303012]="SignalLiveResultRsp",ft[ft.SignalLiveInviteReq=303013]="SignalLiveInviteReq",ft[ft.SignalLiveInviteRsp=303014]="SignalLiveInviteRsp",ft[ft.SignalLiveStopReq=303015]="SignalLiveStopReq",ft[ft.SignalLiveStopRsp=303016]="SignalLiveStopRsp",ft[ft.SignalLiveCustomReq=303017]="SignalLiveCustomReq",ft[ft.SignalLiveCustomRsp=303018]="SignalLiveCustomRsp",ft[ft.SignalTransmitReq=303019]="SignalTransmitReq",ft[ft.SignalTransmitRsp=303020]="SignalTransmitRsp",ft[ft.GetUserlistReq=304001]="GetUserlistReq",ft[ft.GetUserlistRsp=304002]="GetUserlistRsp",r(7)),_t=r(11),yt=r.n(_t),vt=(_t=r(12),r.n(_t)),St=(Et.prototype.md5Bytes=function(e){return this.wordArray2Uint8Array(vt()(this.uint8Array2WordArray(e)))},Et.prototype.wordArray2Uint8Array=function(e){for(var t=e.words,r=e.sigBytes,o=new Uint8Array(r),n=0;n<r;n++)o[n]=t[n>>>2]>>>24-n%4*8&255;return o},Et.prototype.uint8Array2WordArray=function(e){for(var t=e.length,r=[],o=0;o<t;o++)r[o>>>2]|=(255&e[o])<<24-o%4*8;return yt.a.create(r,t)},Et);function Et(){}function bt(e){var t=unescape||window.unescape;return Uint8Array.from(Array.from(t(encodeURIComponent(e))).map((function(e){return e.charCodeAt(0)})))}function Ct(e){var t=escape||window.escape;return decodeURIComponent(t(String.fromCharCode.apply(String,Array.from(e))))}_t=r(3);var Rt,Tt=r.n(_t),It=function(){return(It=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},Pt=(ft.util.Long=Tt.a,ft.configure(),t),Mt=t.liveroom_cs_v3,Lt=t.proto_switch_v3,kt=((r=Rt=Rt||{})[r.disconnected=0]="disconnected",r[r.broken=1]="broken",r[r.connected=2]="connected",Object.defineProperty(Nt.prototype,"nickName",{get:function(){return bt(this.stateCenter.nickName)},enumerable:!1,configurable:!0}),Object.defineProperty(Nt.prototype,"TermType",{get:function(){return this.stateCenter.ENV%2==0?n.l.TT_WEB:n.l.TT_MINIPROGRAM},enumerable:!1,configurable:!0}),Nt.prototype.isDisConnect=function(){return this.state!==Rt.connected},Nt.prototype.getHeader=function(e,t){return e={cmd:e,seq:++this.seq,timestamp:(new Date).getTime()},this.controls&&(e.controls=this.controls),null!=t&&t.contextKey&&(e.context_key=null==t?void 0:t.contextKey),t=Lt.Header.create(e),t=Lt.Header.encode(t).finish(),[e.seq,t]},Nt.prototype.isUaConnect=function(){return this.ua.isConnect()},Nt.prototype.sendMessage=function(e,t,r,o,n,i,s){var a=this;if(void 0===i&&(i={timeout:6e3}),void 0===s&&(s=!0),this.logger.info(G+" call"),"LoginRoomReq"!==e&&this.state!==Rt.connected)return this.logger.warn(G+" state "+this.state),-1;if("number"==typeof e)h=e;else if(void 0===(h=gt[e]))return this.logger.warn(G+" cmd not found "+e),-1;var u=0,l=void 0!==(null==n?void 0:n.roomID)?null==n?void 0:n.roomID:null==(l=this.stateCenter.roomModulesList[0])?void 0:l.roomID,h=("LoginRoomReq"!==e&&l&&(u=this.roomIDKeys[l]),l=this.getHeader(h,{contextKey:u}))[1];return t=this.getHead(h.length,(u=t).length),t=new Uint8Array(Array.from(t).concat(Array.from(h)).concat(Array.from(u))),s&&(h={seq:this.seq,deleted:!1,sendTime:Date.parse(new Date+""),timeout:i.timeout,success:r,error:function(e,t,r){var n;if(a.logger.info(G+" seq: "+t+" "+JSON.stringify(e)+" "+JSON.stringify(r)),(null==(n=null==e?void 0:e.header)?void 0:n.cmd)!==gt.LoginRoomRsp&&-1<[1002,105].indexOf(null==(n=null==e?void 0:e.body)?void 0:n.err_code))return(null==(n=null==e?void 0:e.header)?void 0:n.cmd)===gt.EnterRoomRsp&&null!=r&&r.roomID?(n=a.stateCenter.roomModulesList.find((function(e){return e.roomID==r.roomID})))?void n.retryRoom():void a.logger.error(G+" room no found ignore "):void a.rtm.retryRoom();[207,208].indexOf(null==(n=null==e?void 0:e.body)?void 0:n.err_code),o&&o(e,t)},params:n},u=this.sendCommandList.push(h),this.sendCommandMap[h.seq]=u),this.logger.info(G+" seq: "+l[0]+" cmd: "+e),null!=(s=this.liveroomRequest)&&s.sendRequest({payload:t,ack:"LoginRoomReq"===e},(function(e){a.logger.info(G+" fail")}),(function(){a.logger.info(G+" ack")}),{}),l[0]},Nt.prototype.getHead=function(e,t){var r=new Uint8Array(7);return r[0]=49,r[1]=e>>8,r[2]=e-(r[1]<<8),r.set(new Uint8Array(Int32Array.from([t]).buffer).reverse(),3),r},Nt.prototype.handlePush=function(e,t){var r,o,n;49===e[0]&&(r=Lt.Header.decode(e.slice(7,7+(n=(e[1]<<8)+e[2]))),e=e.slice(7+n),mt[r.cmd]?(n=this.decodeResponseBody(r,e),this.swPushCmdList.includes(r.cmd)?this.handleSwitchPush(r,n):(this.logger.info(z+" down "+(o=mt[r.cmd]||r.cmd)+" "+JSON.stringify(this.transBuf(n))),o={header:this.transHeader(r),body:this.transRsp(n)},void 0!==(n=this.roomKeyIDs[r.context_key])&&(o.header.room_id=n),this.handleSendCommandMsgRsp(o))):(this.logger.info(z+" cmd is not rtc"),this.onSwitchMessage(r,e)))},Nt.prototype.handleSwitchPush=function(e,t){var r,o,n=this.roomKeyIDs[e.context_key];if(n||this.noContextKeyCmdList.includes(e.cmd))if(e.cmd===gt.PushReq)if((o=this.transRsp(t.head)).room_id=n,this.stateCenter.roomModulesList.find((function(e){return e.roomID==n}))){var i,s,a={header:o,body:this.unStructCmdList.includes(t.head.sub_cmd)?{signal_msg:Ct(t.msg_body),sub_cmd:t.head.sub_cmd}:11005===t.head.sub_cmd?{custommsg:Ct(t.msg_body)}:mt[t.head.sub_cmd]?this.transRsp(this.decode(Mt[mt[t.head.sub_cmd]],t.msg_body)):{}};if(this.logger.info(V+" push "+JSON.stringify(this.transBuf(a))),this.rtcPushCmdList.includes(t.head.sub_cmd))switch(t.head.sub_cmd){case gt.PushUserInfoUpdated:this.handlePushUserStateUpdateMsg(a);break;case gt.PushUserKickout:this.transKeysName(a.body,this.loginKeyTransMap),this.handlePushKickout(a,!1);break;case gt.PushTrans:this.handlePushTransMsg(a);break;case gt.PushIm:this.handlePushRoomMsg(a);break;case 11005:this.handlePushCustomMsg(a);break;case 12001:case 12002:case 12003:this.handlePushStreamMsg(a);break;case 11001:case 11002:case 11003:case 11004:this.handlePushSignalMsg(a);break;case gt.PushUserTokenExpire:this.handlePushTokenExpire(a)}else this.logger.info(V+" white "),this.onSwitchMessage(e,t);1==t.head.qos_flag&&(i=Lt.PushRsp.create({code:0,message:"",sub_cmd:t.head.sub_cmd,server_send_time:t.head.send_time}),s=Lt.PushRsp.encode(i).finish(),this.sendMessage("PushRsp",s,void 0,void 0))}else this.logger.warn(V+" room no found ignore ");else e.cmd===gt.MergePushReq?((o=this.transRsp(t.head)).room_id=n,this.stateCenter.roomModulesList.find((function(e){return e.roomID==n}))?(r=[],t.message_list.forEach((function(e){var t;r.push({sub_cmd:e.sub_cmd,sub_seq:e.sub_seq}),e.sub_cmd===gt.PushBigIm&&(t=Mt.PushBigIm.decode(e.msg_body),e.msg_body=t)})),delete(o={header:o,body:this.transRsp(t)}).body.head,this.handlePushMergeMsg(o),1==t.head.qos_flag&&(i=Lt.MergePushRsp.create({messages:r,server_send_time:t.head.send_time}),s=Lt.MergePushRsp.encode(i).finish(),this.sendMessage("MergePushRsp",s,void 0,void 0))):this.logger.warn(V+" room no found ignore ")):e.cmd===gt.PushKickout&&this.handlePushKickout({header:e,body:{reason:900<t.reason?t.reason-900:t.reason,msg:t.message,need_relogin:void 0!==t.is_need_relogin?t.is_need_relogin:0}},!0);else this.logger.warn(V+" ctx key not found")},Nt.prototype.handlePushTokenExpire=function(e){},Nt.prototype.handlePushKickout=function(e,t){},Nt.prototype.handlePushStreamMsg=function(e){},Nt.prototype.handlePushSignalMsg=function(e){},Nt.prototype.handlePushMergeMsg=function(e){},Nt.prototype.handlePushCustomMsg=function(e){},Nt.prototype.handlePushRoomMsg=function(e){},Nt.prototype.handlePushTransMsg=function(e){},Nt.prototype.onSwitchMessage=function(e,t){},Nt.prototype.decodeResponseBody=function(e,t){var r=this.onSwitchCmdList.includes(e.cmd)?"proto_switch_v3":"liveroom_cs_v3";return this.decode(this.protoInstance[r][mt[e.cmd]],t)},Nt.prototype.handlePushUserStateUpdateMsg=function(e){},Nt.prototype.login=function(e,t,r){var o,n,i,s=this,u=(this.state==Rt.disconnected&&(this.logger.info(j+" state disconnect"),this.closeRequest()),(new Date).getTime()+""),l={net_type:a.a.getNetTypeNum(),room_id:bt(e.roomID),room_name:bt(e.roomName),nick_name:this.nickName,role:this.stateCenter.role,third_token:bt(e.token),room_create_flag:this.stateCenter.roomCreateFlag,user_state_flag:e.userStateUpdate?1:0,user_count_limit:e.maxMemberCount,relate_service:this.stateCenter.relateService.join()||""};e.isMulti?(n=It(It({},l),{conn_type:2}),o=It(It({},n),{room_id:e.roomID,room_name:e.roomName,third_token:e.token}),this.logger.info(j+" enter "+JSON.stringify(o)),n=Mt.EnterRoomReq.create(n),i=Mt.EnterRoomReq.encode(n).finish(),this.sendMessage("EnterRoomReq",i,(function(r,o){s.transLoginRspKeys(r,e),t&&t(r,o)}),(function(e,t){r&&r(e,t)}),{roomID:e.roomID})):(l=It(It({},l),{app_id:this.stateCenter.appid,id_name:bt(this.stateCenter.idName),device_id:this.stateCenter.deviceID,term_type:this.TermType,sdk_version:this.getNumSDKVersion(),client_stamp:bt(u),relogin_token:this.switchSessionID.notEquals(Tt.a.fromInt(0))?bt(this.reloginToken):"",switch_session_id:this.switchSessionID,user_session_id:null!=(l=e.longSid)?l:Tt.a.fromInt(0),biz_type:0,biz_version:this.stateCenter.bizVersion||"",login_logic:this.stateCenter.isMultiRoom?3:1,sdk_conn_type:2}),o=It(It({},l),{id_name:this.stateCenter.idName,nick_name:this.stateCenter.nickName,client_stamp:u,k1_sign:void 0,relogin_token:this.reloginToken,room_id:e.roomID,room_name:e.roomName,third_token:e.token,user_session_id:e.longSid}),this.logoutCheckToken=e.token,this.logger.info(j+" login "+JSON.stringify(o)),n=Lt.LoginRoomReq.create(l),i=Lt.LoginRoomReq.encode(n).finish(),this.sendMessage("LoginRoomReq",i,(function(r,o){var n;s.logger.info(j+" login rsp"),s.switchSessionID=r.body.switch_session_id,s.reloginToken=r.body.relogin_token,null!=(n=null==r?void 0:r.header)&&n.controls&&(s.controls=null==(n=null==r?void 0:r.header)?void 0:n.controls),s.transLoginRspKeys(r,e),t&&t(r,o)}),(function(e,t){r&&r(e,t)})))},Nt.prototype.transLoginRspKeys=function(e,t){null!=(r=e.header)&&r.context_key&&(this.roomIDKeys[t.roomID]=null==(r=e.header)?void 0:r.context_key,this.roomKeyIDs[null==(r=e.header)?void 0:r.context_key]=t.roomID,e.header.room_id=t.roomID),this.longToStringNumber(e.body,["ret_timestamp"],"toString"),this.transKeysName(e.body,this.loginKeyTransMap),this.keysExist(e.body,["token_remain_time","stream_seq"]);var r={anchor_id_name:e.body.anchor_info.id_name,anchor_id:e.body.anchor_info.user_id,anchor_nick_name:e.body.anchor_info.nick_name};e.body.anchor_info=r},Nt.prototype.transKeysName=function(e,t){t.forEach((function(t){void 0!==e[t[0]]&&(e[t[1]]=e[t[0]],delete e[t[0]])}))},Nt.prototype.keysExist=function(e,t){t.forEach((function(t){void 0===e[t]&&(e[t]=0)}))},Nt.prototype.longToStringNumber=function(e,t,r){t.forEach((function(t){Tt.a.isLong(e[t])&&(e[t]=e[t][r]())}))},Nt.prototype.logout=function(e,t,r){var o,n,i,s;return e.isMulti?(o={},this.logger.info(Y+" quit "+e.roomID),i=Mt.QuitRoomReq.create(o),s=Mt.QuitRoomReq.encode(i).finish(),this.sendMessage("QuitRoomReq",s,t,r,{roomID:null==e?void 0:e.roomID})):(o={logout_code:0,logout_check:this.crypto.md5Bytes(bt(this.logoutCheckToken)),user_session_id:e.longSid,logout_logic:this.stateCenter.isMultiRoom?3:1},n=this.transBuf(o),this.logger.info(Y+" logout "+JSON.stringify(n)),i=Lt.LogoutRoomReq.create(o),s=Lt.LogoutRoomReq.encode(i).finish(),this.sendMessage("LogoutRoomReq",s,t,r,{roomID:null==e?void 0:e.roomID}))},Nt.prototype.checkSendMessageList=function(e){for(var t=e.getFirst();null!=t;)e.remove(t),t._data&&t._data.error&&setTimeout((function(){t&&t._data&&t._data.error&&t._data.error(s.a.TIMEOUT,t._data.seq)}),0),t=e.getFirst()},Nt.prototype.checkMessageListTimeout=function(e,t){for(var r=e.getFirst(),o=Date.parse(new Date+""),n=0,i=this;null!=r&&"break"!==function(){var a,u;return r._data&&r._data.sendTime+r._data.timeout>o||(r._data&&delete t[r._data.seq],e.remove(r),r._data&&null==r._data.error||r._data&&r._data.sendTime+i.sendDataDropTimeout<o||(a=r&&r._data&&r._data.error,u=r&&r._data&&r._data.seq,setTimeout((function(){a&&a(s.a.TIMEOUT,u)}),0)),++n>=i.sendDataCheckOnceCount)?"break":void(r=e.getFirst())}(););},Nt.prototype.startCheck=function(){var e=this;this.checkMessageListTimeout(this.sendCommandList,this.sendCommandMap),this.sendDataCheckTimer=setTimeout((function(){e.startCheck()}),this.sendDataCheckInterval)},Nt.prototype.stopCheck=function(){this.checkSendMessageList(this.sendCommandList),clearTimeout(this.sendDataCheckTimer)},Nt.prototype.handleSendCommandMsgRsp=function(e){var t,r,o=this.sendCommandMap[e.header.seq];null!=o&&(r=null==(t=o._data)?void 0:t.params,delete this.sendCommandMap[e.header.seq],this.sendCommandList.remove(o),0===e.body.err_code?setTimeout((function(){t&&null!=t.success&&t.success(e,e.header.seq)}),0):setTimeout((function(){t&&null!=t.error&&t.error(e,e.header.seq,r)}),0))},Nt.prototype.getReqHead=function(e){return{}},Nt.prototype.heartBeat=function(e,t,r){var o=this,n=Mt.HbReq.create({});n=Mt.HbReq.encode(n).finish(),this.sendMessage("HbReq",n,(function(t,r){o.transKeysName(t.body,[["hb_interval","hearbeat_interval"],["hb_timeout","hearbeat_timeout"],["big_im_time_window","bigim_time_window"],["trans_channel_list","trans_seqs"]]),t.body.server_user_seq=t.body.user_seq.toNumber(),o.longToStringNumber(t.body,["ret_timestamp"],"toNumber"),e&&e(t,r)}),t,{roomID:null==r?void 0:r.roomID})},Nt.prototype.fetchUserList=function(e,t,r,o){var n=this,i=(e=It({},e),this.transBuf(e));return this.logger.info(F+" "+JSON.stringify(i)),i=Mt.GetUserlistReq.create(e),e=Mt.GetUserlistReq.encode(i).finish(),this.sendMessage("GetUserlistReq",e,(function(e,r){n.logger.info(F+" suc "+r),n.transKeysName(e.body,[["user_base_info_list","user_baseinfos"]]),n.longToStringNumber(e.body,["server_user_seq","server_user_index","ret_user_index"],"toNumber"),t&&t(e,r)}),r,{roomID:null==o?void 0:o.roomID})},Nt.prototype.sendRoomMsg=function(e,t,r,o){var n=this,i=(e={msg_category:e.msg_category,msg_type:e.msg_type,msg_content:bt(e.msg_content)},this.transBuf(e));return this.logger.info("zm.lrh.srm.1 "+JSON.stringify(i)),i=Mt.SendImReq.create(e),e=Mt.SendImReq.encode(i).finish(),this.sendMessage("SendImReq",e,(function(e,r){n.longToStringNumber(e.body,["msg_id"],"toNumber"),t&&t(e,r)}),r,{roomID:null==o?void 0:o.roomID})},Nt.prototype.sendReliableMessage=function(e,t,r,o){e={trans_type:bt(e.trans_type),trans_data:bt(e.trans_data),trans_local_seq:e.trans_local_seq,trans_channel:bt(e.trans_channel)};var n=this.transBuf(e);return this.logger.info("zm.lrh.srm.0 "+JSON.stringify(n)),n=Mt.SetTransReq.create(e),e=Mt.SetTransReq.encode(n).finish(),this.sendMessage("SetTransReq",e,t,r,{roomID:null==o?void 0:o.roomID})},Nt.prototype.fetchReliableMessage=function(e,t,r,o){var n=e.fetch_array.map((function(e){return{trans_type:bt(e.trans_type),trans_local_seq:e.trans_seq}}));return e={trans_channel:bt(e.trans_channel),trans_list:n},n=this.transBuf(e),this.logger.info("zm.lrh.frm "+JSON.stringify(n)),n=Mt.GetTransReq.create(e),e=Mt.GetTransReq.encode(n).finish(),this.sendMessage("GetTransReq",e,t,r,{roomID:null==o?void 0:o.roomID})},Nt.prototype.sendCustomCommand=function(e,t,r,o){var n=this,i=e.dest_id_name.map((function(e){return{id_name:bt(e)}}));return i=It({to_user_list:i,push_message:bt(e.custom_msg)},e),e=this.transBuf(i),this.logger.info("zm.lrh.scc "+JSON.stringify(e)),e=Mt.SignalLiveCustomReq.create(i),i=Mt.SignalLiveCustomReq.encode(e).finish(),this.sendMessage("SignalLiveCustomReq",i,(function(e,r){t&&t(n.transRsp(e),r)}),(function(e,t){r&&r(e,t)}),{roomID:null==o?void 0:o.roomID})},Nt.prototype.sendBigRoomMessage=function(e,t,r,o){e={msg_list:e.msgs.map((function(e){return{msg_category:e.msg_category,msg_type:e.msg_type,msg_timestamp:Tt.a.fromNumber(Date.now()),msg_content:bt(e.msg_content),msg_client_id:bt(e.bigmsg_client_id)}}))};var n=this.transBuf(e);return this.logger.info("zm.lrh.sbrm "+JSON.stringify(n)),n=Mt.SendBigImReq.create(e),e=Mt.SendBigImReq.encode(n).finish(),this.sendMessage("SendBigImReq",e,t,r,{roomID:null==o?void 0:o.roomID})},Nt.prototype.sendSignalCmd=function(e,t,r,o){var n="";switch(e.sub_cmd){case 1003:n="SignalLiveInviteReq";break;case 1001:n="SignalLiveRequestReq";break;case 1002:n="SignalLiveResultReq";break;case 1004:n="SignalLiveStopReq"}var i=e.dest_id_name.map((function(e){return{id_name:bt(e)}}));return e={push_message:bt(e.signal_msg),to_user_list:i},i=this.transBuf(e),this.logger.info("zm.lrh.ssc "+JSON.stringify(i)),i=Mt[n].create(e),e=Mt[n].encode(i).finish(),this.sendMessage(n,e,t,r,{roomID:null==o?void 0:o.roomID})},Nt.prototype.sendStreamUpdate=function(e,t,r,o){var n,i=this;try{n=JSON.parse(e.stream_msg)}catch(e){}var s,a="",u=(this.logger.info(K+" "+JSON.stringify(e)),this.stateCenter.roomModulesList.find((function(e){return e.roomID==o.roomID})));if(!u)return this.logger.error(K+" room no found ignore "),-1;switch(e.sub_cmd){case 2001:a="AddStreamReq",s={stream_id:bt(n.stream_id),extra_info:bt(n.extra_info),client_req_seq:this.seq+1,third_token:bt(e.third_token||"")};break;case 2002:a="DeleteStreamReq",s={stream_id:bt(n.stream_id),stream_sid:n.stream_sid,client_req_seq:this.seq+1};break;case 2003:a="UpdateStreamReq",s={stream_id:bt(n.stream_id),stream_sid:n.stream_sid,client_req_seq:this.seq+1,extra_info:bt(n.extra_info)}}var l=this.transBuf(s);return this.logger.info(K+" "+JSON.stringify(l)),l=Mt[a].create(s),l=Mt[a].encode(l).finish(),this.sendMessage(a,l,(function(e,r){i.logger.info(K+" suc "+a+" "+JSON.stringify(e)),e.header.room_id=u.roomID,t&&t(e,r)}),(function(e,t){i.logger.info(K+" fail "+a+" "+JSON.stringify(e)),r&&r(e,t)}),{roomID:null==o?void 0:o.roomID})},Nt.prototype.getStreamList=function(e,t,r,o){var n,i,s=this;this.stateCenter.roomModulesList.find((function(e){return e.roomID==o.roomID}))?(n=this.transBuf(i={}),this.logger.info(W+" "+JSON.stringify(n)),n=Mt.GetStreamListReq.create(i),i=Mt.GetStreamListReq.encode(n).finish(),this.sendMessage("GetStreamListReq",i,(function(e,r){var o;null!=(o=e.body)&&o.stream_info_list.forEach((function(e){e.create_time=e.create_time.toNumber()})),s.transKeysName(e.body,[["stream_list_seq","stream_seq"],["stream_info_list","stream_info"]]),t&&t(e,r)}),(function(e,t){r&&r(e,t)}),{roomID:null==o?void 0:o.roomID})):this.logger.error(W+" room no found ignore "+o.roomID)},Nt.prototype.transBuf=function(e){var t=this,r={};return Object.keys(e).forEach((function(o){["logout_check","k2_sign","k1_sign"].includes(o)?r[o]=e[o]:t.transReqBytes(r,e,o)})),r},Nt.prototype.transReqBytes=function(e,t,r){var o=this;if(Tt.a.isLong(t[r]))e[r]=t[r].toString();else if("[object Object]"===Object.prototype.toString.call(t[r]))e[r]={},Object.keys(t[r]).forEach((function(n){return o.transReqBytes(e[r],t[r],n)}));else if("[object Array]"===Object.prototype.toString.call(t[r])&&"[object Object]"===Object.prototype.toString.call(t[r][0])){e[r]=[];for(var n=0;n<t[r].length;n++)!function(n){var i={};Object.keys(t[r][n]).forEach((function(e){o.transReqBytes(i,t[r][n],e)})),e[r].push(i)}(n)}else e[r]="[object Uint8Array]"===Object.prototype.toString.call(t[r])?Ct(t[r]):t[r]},Nt.prototype.transHeader=function(e){return e.timestamp=Tt.a.isLong(e.timestamp)?e.timestamp.toString():e.timestamp,e},Nt.prototype.transRsp=function(e){var t=this,r=e&&e.rsp_head?this.transRspHead(e.rsp_head):{},o=It(It({},e),r),n=(delete o.rsp_head,{});return Object.keys(o).forEach((function(e){"k2_sign"===e?n[e]=o[e]:t.transBytes(n,o,e)})),n},Nt.prototype.transBytes=function(e,t,r){var o=this;if(Tt.a.isLong(t[r]))e[r]=t[r];else if("[object Object]"===Object.prototype.toString.call(t[r]))e[r]={},Object.keys(t[r]).forEach((function(n){return o.transBytes(e[r],t[r],n)}));else if("[object Array]"===Object.prototype.toString.call(t[r])&&"[object Object]"===Object.prototype.toString.call(t[r][0])){e[r]=[];for(var n=0;n<t[r].length;n++)!function(n){var i={};Object.keys(t[r][n]).forEach((function(e){o.transBytes(i,t[r][n],e)})),e[r].push(i)}(n)}else e[r]="[object Uint8Array]"===Object.prototype.toString.call(t[r])?Ct(t[r]):t[r]},Nt.prototype.transRspHead=function(e){return e?{err_code:e.code||0,err_message:e.message}:{}},Nt.prototype.decode=function(e,t){return It({},e.decode(t))},Nt.prototype.handleDisconnected=function(e,t){var r=this;this.logger.info($+" call"),this.state=Rt.disconnected,this.stateCenter.useNetAgent&&e===i.d.TIMEOUT&&this.stateCenter.roomModulesList.forEach((function(e){e.roomTryHandler&&(r.ua.isConnect()?(r.logger.info($+" ua is connect"),e.roomTryHandler.active()):(r.logger.info($+" ua is disconnect"),r.ua.connectUa()))}))},Nt.prototype.handleBroken=function(){var e=this;this.logger.info(Q+" call"),this.state=Rt.broken,this.stateCenter.useNetAgent&&this.stateCenter.roomModulesList.forEach((function(t){t.roomTryHandler&&(t.roomTryHandler.invalid(),t.roomTryHandler.onactive=function(r,o){e.logger.info(Q+" onactive"),t.roomHandler.transError(o),t.roomHandler.disconnectedHandle(o)},t.roomTryHandler.startMaxTime(),t.roomHandler.roomStateHandle("CONNECTING",o.Reconnecting,s.a.NETWORK_BROKEN))}))},Nt.prototype.handleConnected=function(e){var t=this;this.logger.info("zm.lrh.hc call "+e),this.state=Rt.connected,this.stateCenter.useNetAgent&&e===i.c.AUTO&&this.stateCenter.roomModulesList.forEach((function(e){e.roomTryHandler&&t.ua.isConnect()&&e.roomTryHandler.active()}))},Nt.prototype.renewToken=function(e,t,r,o){var n=this,i=Mt.RenewTokenReq.create(e={token:e.token});i=Mt.RenewTokenReq.encode(i).finish(),e=this.transBuf(e),this.logger.info("zm.lrh.rt "+JSON.stringify(e)),this.sendMessage("RenewTokenReq",i,(function(e,r){n.keysExist(e.body,["token_remain_time"]),t&&t(e,r)}),r,{roomID:null==o?void 0:o.roomID})},Nt.prototype.reset=function(){this.logger.info("zm.lrh.r.0 call "),this.state=Rt.disconnected,this.switchSessionID=Tt.a.fromInt(0),this.sendDataCheckTimer&&clearTimeout(this.sendDataCheckTimer)},Nt.prototype.closeRequest=function(){var e;null!=(e=this.liveroomRequest)&&e.closeRequest()},Nt.prototype.resetSessionInfo=function(){this.switchSessionID=Tt.a.fromInt(0)},Nt.prototype.getNumSDKVersion=function(){var e=0===this.stateCenter.ENV?6:7,t=this.rtm.version.split(".").map((function(e){return parseInt(e)}));return e<<28|t[0]<<20|t[1]<<8|t[2]},Nt);function Nt(e,t,r,o,s){var a=this;this.logger=e,this.stateCenter=t,this.ua=r,this.dataReport=o,this.rtm=s,this.seq=0,this.sendCommandList=new n.f,this.sendCommandMap={},this.logoutCheckToken="",this.zPushSid="0",this.loginKeyTransMap=[["user_session_id","session_id"],["liveroom_hb_interval","hearbeat_interval"],["liveroom_hb_timeout","hearbeat_timeout"],["big_im_time_window","bigim_time_window"],["trans_channel_list","trans_seqs"],["stream_list_seq","stream_seq"],["stream_info_list","stream_info"]],this.sendDataCheckOnceCount=100,this.sendDataDropTimeout=1e4,this.sendDataCheckInterval=2e3,this.protoInstance=Pt,this.roomKeyIDs={},this.roomIDKeys={},this.swPushCmdList=[gt.PushReq,gt.MergePushReq,gt.PushKickout],this.onSwitchCmdList=[gt.LoginRoomRsp,gt.LogoutRoomRsp,gt.PushKickout,gt.PushReq,gt.MergePushReq],this.noContextKeyCmdList=[1105],this.rtcPushCmdList=[10001,10002,10004,11001,11002,11003,11004,11005,12001,12002,12003,13001,15001],this.state=Rt.disconnected,this.unStructCmdList=[11001,11002,11003,11004],this.reloginToken="",this.crypto=new St,this.liveroomRequest=this.ua.getPCRequest(i.b.SERVICE_SWITCH4LIVEROOM),this.switchSessionID=Tt.a.fromInt(0),null!=(e=this.liveroomRequest)&&e.on("connected",(function(e){a.handleConnected(e)})),null!=(t=this.liveroomRequest)&&t.on("broken",(function(e){a.handleBroken()})),null!=(r=this.liveroomRequest)&&r.on("disconnected",(function(e,t){a.handleDisconnected(e,t)})),null!=(o=this.liveroomRequest)&&o.on("downLoadMessage",(function(e,t){a.handlePush(e,t)})),null!=(s=this.liveroomRequest)&&s.on("exception",(function(e,t){a.logger.info("zm.lrh.o.0 except "+JSON.stringify(e))})),null!=(e=this.liveroomRequest)&&e.on("pcBrokenEvent",(function(e){var t=xe,r=a.stateCenter.reporter.createSpan(n.k.H,{key:Te},{key:""},t.event);r.setAttributes({service_no:t.service_no(null==e?void 0:e.service_no)}),r.end()})),null!=(t=this.liveroomRequest)&&t.on("pcDisconnectedEvent",(function(e){var t=He,r=a.stateCenter.reporter.createSpan(n.k.H,{key:Te},{key:""},t.event);r.setAttributes({service_no:t.service_no(null==e?void 0:e.service_no)}),r.end()})),null!=(r=this.liveroomRequest)&&r.on("pcConnectedEvent",(function(e){var t=Ue,r=a.stateCenter.reporter.createSpan(n.k.H,{key:Te},{key:""},t.event);r.setAttributes({service_no:t.service_no(e.service_no),recv_time:t.recv_time((new Date).getTime()),proxy_link_sources:t.proxy_link_sources(e.proxy_link_sources),connect_stream:t.connect_stream(e.connect_stream)}),r.end()}))}var Ot=(At.prototype.listenCallBack=function(){var e=this;this.roomServicer.handlePushCustomMsg=function(t){e.handlePushCustomMsg(t)},this.roomServicer.handlePushTokenExpire=function(t){var r,o=null==(o=null==(o=null==t?void 0:t.body)?void 0:o.stop_stream)?void 0:o.stream_id_list.map(Ct);null!=(r=null==(r=null==t?void 0:t.body)?void 0:r.stop_stream)&&(r.stream_id_list=o),e.stateCenter.actionListener("_tokenExpired",t)},this.roomServicer.handlePushKickout=function(t,r){var o;r?function(e,t,r){if(r||2===arguments.length)for(var o,n=0,i=t.length;n<i;n++)!o&&n in t||((o=o||Array.prototype.slice.call(t,0,n))[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))}([],e.stateCenter.roomModulesList,!0).forEach((function(e){e.roomHandler.handlePushKickout(t,!0,!0)})):(o=null==(r=null==t?void 0:t.header)?void 0:r.room_id,r=e.stateCenter.roomModulesList.find((function(e){return e.roomID==o})),e.roomServicer.longToStringNumber(t.body,["session_id"],"toString"),r?r.roomHandler.handlePushKickout(t):e.logger.error("zm.lrh.pk room no found ignore "+JSON.stringify(null==(r=t.header)?void 0:r.room_id)))},this.roomServicer.handlePushStreamMsg=function(t){e.handlePushStreamMsg(t)},this.roomServicer.handlePushSignalMsg=function(t){e.handlePushSignalMsg(t)},this.roomServicer.handlePushMergeMsg=function(t){e.handlePushMergeMsg(t)},this.roomServicer.handlePushRoomMsg=function(t){e.handlePushRoomMsg(t)},this.roomServicer.handlePushTransMsg=function(t){e.handlePushTransMsg(t)},this.roomServicer.onSwitchMessage=function(t,r){e.onSwitchMessage(t,r)},this.roomServicer.handlePushUserStateUpdateMsg=function(t){var r,o,i,s=null==(a=null==t?void 0:t.header)?void 0:a.room_id,a=e.stateCenter.roomModulesList.find((function(e){return e.roomID==s}));a?(i=t.body.user_action_list.map((function(e){return{Action:e.action,IdName:e.id_name,NickName:e.nick_name,Role:e.role,LoginTime:e.login_time.toString()}})),o=e.stateCenter.reporter.createSpan(n.k.H,{key:ie.event,par:s},{key:""},"/liveroom/recv_user_update_info"),i={body:{user_actions:i,user_list_seq:t.body.server_user_seq.toNumber(),room_id:s}},o.setAttributes({user_list_seq:null==(r=null===i?void 0:i.body)?void 0:r.user_list_seq,update_user:null==(r=null===i?void 0:i.body)?void 0:r.user_actions}),o.end(),a.userHandler.handlePushUserStateUpdateMsg(i)):e.logger.error("zm.lrh.puu room no found ignore "+JSON.stringify(t))}},At.prototype.isDisConnect=function(){return!!this.roomServicer&&this.roomServicer.isDisConnect()},At.prototype.isUaConnect=function(){var e;return null==(e=this.roomServicer)?void 0:e.isUaConnect()},At.prototype.sendMessage=function(e,t,r,o,n,i,s){var a;return null==(a=this.roomServicer)?void 0:a.sendMessage(e,t,r,o,n,i)},At.prototype.handlePushTokenExpire=function(e){},At.prototype.handlePushKickout=function(e,t){},At.prototype.handlePushStreamMsg=function(e){},At.prototype.handlePushSignalMsg=function(e){},At.prototype.handlePushMergeMsg=function(e){},At.prototype.handlePushCustomMsg=function(e){},At.prototype.handlePushRoomMsg=function(e){},At.prototype.handlePushTransMsg=function(e){},At.prototype.onSwitchMessage=function(e,t){},At.prototype.handlePushUserStateUpdateMsg=function(e){},At.prototype.login=function(e,t,r){var o;null!=(o=this.roomServicer)&&o.login(e,t,r)},At.prototype.logout=function(e,t,r){var o;return null==(o=this.roomServicer)?void 0:o.logout(e,t,r)},At.prototype.startCheck=function(){var e;null!=(e=this.roomServicer)&&e.startCheck()},At.prototype.stopCheck=function(){var e;null!=(e=this.roomServicer)&&e.stopCheck()},At.prototype.getReqHead=function(e){var t;return null==(t=this.roomServicer)?void 0:t.getReqHead(e)},At.prototype.heartBeat=function(e,t,r){var o;null!=(o=this.roomServicer)&&o.heartBeat(e,t,r)},At.prototype.fetchUserList=function(e,t,r,o){var n;return null==(n=this.roomServicer)?void 0:n.fetchUserList(e,t,r,o)},At.prototype.sendRoomMsg=function(e,t,r,o){var n;return null==(n=this.roomServicer)?void 0:n.sendRoomMsg(e,t,r,o)},At.prototype.sendReliableMessage=function(e,t,r,o){var n;return null==(n=this.roomServicer)?void 0:n.sendReliableMessage(e,t,r,o)},At.prototype.fetchReliableMessage=function(e,t,r,o){var n;return null==(n=this.roomServicer)?void 0:n.fetchReliableMessage(e,t,r,o)},At.prototype.sendCustomCommand=function(e,t,r,o){var n;return null==(n=this.roomServicer)?void 0:n.sendCustomCommand(e,t,r,o)},At.prototype.sendBigRoomMessage=function(e,t,r,o){var n;return null==(n=this.roomServicer)?void 0:n.sendBigRoomMessage(e,t,r,o)},At.prototype.sendSignalCmd=function(e,t,r,o){var n;return null==(n=this.roomServicer)?void 0:n.sendSignalCmd(e,t,r,o)},At.prototype.sendStreamUpdate=function(e,t,r,o){var n;return null==(n=this.roomServicer)?void 0:n.sendStreamUpdate(e,t,r,o)},At.prototype.getStreamList=function(e,t,r,o){var n;return null==(n=this.roomServicer)?void 0:n.getStreamList(e,t,r,o)},At.prototype.renewToken=function(e,t,r,o){var n;null!=(n=this.roomServicer)&&n.renewToken(e,t,r,o)},At.prototype.reset=function(){var e;null!=(e=this.roomServicer)&&e.reset()},At.prototype.closeRequest=function(){var e;null!=(e=this.roomServicer)&&e.closeRequest()},At);function At(e,t,r,o,n){this.logger=e,this.stateCenter=t,this.ua=r,this.dataReport=o,this.rtm=n,this.roomServicer=new kt(e,t,r,o,n),this.listenCallBack()}var wt=function(e,t,r,o){return new(r=r||Promise)((function(n,i){function s(e){try{u(o.next(e))}catch(e){i(e)}}function a(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?n(e.value):((t=e.value)instanceof r?t:new r((function(e){e(t)}))).then(s,a)}u((o=o.apply(e,t||[])).next())}))},Dt=function(e,t){var r,o,n,i={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},s={next:a(0),throw:a(1),return:a(2)};return"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(u){var l=[a,u];if(r)throw new TypeError("Generator is already executing.");for(;i=s&&l[s=0]?0:i;)try{if(r=1,o&&(n=2&l[0]?o.return:l[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,l[1])).done)return n;switch(o=0,(l=n?[2&l[0],n.value]:l)[0]){case 0:case 1:n=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,o=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(!(n=0<(n=i.trys).length&&n[n.length-1])&&(6===l[0]||2===l[0])){i=0;continue}if(3===l[0]&&(!n||l[1]>n[0]&&l[1]<n[3]))i.label=l[1];else if(6===l[0]&&i.label<n[1])i.label=n[1],n=l;else{if(!(n&&i.label<n[2])){n[2]&&i.ops.pop(),i.trys.pop();continue}i.label=n[2],i.ops.push(l)}}l=t.call(e,i)}catch(u){l=[6,u],o=0}finally{r=n=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}},Ut=function(e,t,r){if(r||2===arguments.length)for(var o,n=0,i=t.length;n<i;n++)!o&&n in t||((o=o||Array.prototype.slice.call(t,0,n))[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))},xt=(Object.defineProperty(Ht.prototype,"modules",{get:function(){return{service:this.service}},enumerable:!1,configurable:!0}),Object.defineProperty(Ht.prototype,"isUseNetAgent",{get:function(){return this.stateCenter.useNetAgent},enumerable:!1,configurable:!0}),Ht.prototype.destroyRTM=function(){this.stateCenter.roomModulesList.some((function(e){return!(null!=e&&e.isLogout()||"DISCONNECTED"===e.roomState)}))&&this.logoutRoom(),this.stateCenter.reporter.setUnloadState(n.k.I),this.reporter.destroy()},Ht.prototype.initCallback=function(){this.proxyRes=a.a.proxyRes,this.actionSuccessCallback=a.a.actionSuccessCallback,this.actionErrorCallback=a.a.actionErrorCallback,this.getServerError=a.a.getServerError,this.generateRandumNumber=a.a.generateRandumNumber,this.unregisterCallback=a.a.unregisterCallback,this.logReportCallback=a.a.logReportCallback,this.registerCallback=a.a.registerCallback},Ht.prototype.createNetAgent=function(){var e=this,t=(this.logger.info(E+" call"),this.netAgent.on("disconnected",(function(t){e.logger.info("".concat(E," netAgent disconnect"))})),this.netAgent.on("connected",(function(){e.logger.info("".concat(E," netAgent connect")),e.stateCenter.reporter.setNetStateCheck(),e.isUseNetAgent&&(e.fetchAppConfig(),e.stateCenter.roomModulesList.forEach((function(t){t.roomTryHandler&&e.netAgent.isConnect()&&t.roomTryHandler.active(!0)})))})),this.netAgent.on("broken",(function(t){e.logger.info("".concat(E," netAgent broken")),t===i.a.CLOSE&&e.stateCenter.roomModulesList.forEach((function(e){e.resetSessionInfo()}))})),this.netAgent.on("dispatchEvent",(function(t,r,o){var i;e.logger.info("".concat(E," dispatch")),"start"===r?(i=e.stateCenter.reporter.createSpan(n.k.H,{key:Te},{key:""},"/zegoconn/auto_dispatch"),e.stateCenter.requestList[t]=i):"end"===r&&(i=e.stateCenter.requestList[t])&&(i.setAttributes({domain_list:o.domains}),i.end())})),this.netAgent.on("dispatchResultUpdate",(function(t){var r=t.servers;t=t.domains,e.logger.info("".concat(E," dispatchResult ").concat(JSON.stringify(r),", ").concat(JSON.stringify(t)))})),this.netAgent.on("connectedEvent",(function(t,r,o){var i;e.logger.info("".concat(E," connect")),"start"===r?(i=e.stateCenter.reporter.createSpan(n.k.H,{key:Z.event},{key:Te},Te,!0),e.stateCenter.requestList[t]=i):"end"===r&&(i=e.stateCenter.requestList[t])&&(i.setAttributes({request_count:Pe(o.count),connect_id:Ie(o.connectid),events:Me(o.connectEvents)}),i.end())})),this.netAgent.on("requestEvent",(function(t,r,o){var i;e.logger.info("".concat(E," request")),"start"===r?(i=e.stateCenter.reporter.createSpan(n.k.H,{key:Z.event},{key:Oe},Oe,!0),e.stateCenter.requestList[t]=i):"end"===r&&(i=e.stateCenter.requestList[t])&&(i.setAttributes({req_location:Ae(o.na_req_location),http_code:o.status_code,error:o.err_code}),i.end())})),this.netAgent.on("disConnectedEvent",(function(t){var r=t.duration,o=t.server,i=(t=t.connectid,e.logger.info("".concat(E," disconnect")),e.stateCenter.reporter.createSpan(n.k.H,{key:Z.event},{key:""},"/zegoconn/disconnect"));i.setAttributes({url:ke(o),connect_duration:Ne(r),connect_id:Le(t)}),i.end()})),null!=(t=this.netAgent)&&t.on("clientInfo",(function(t){var r=t.timeOffset;"number"==typeof r&&e.stateCenter.reporter.setTimeOffset(r),e.updateTimeOffsetInterval()})),u);this.logger.info("".concat(E," domains ").concat(JSON.stringify(t))),t=t.map((function(e){return"wss://".concat(e,"/accesshub")})),this.netAgent.setBackupDomains(l),this.netAgent.setNetAgentDefaultServers(t),!this.stateCenter.geoFencing&&null!=(t=this.options)&&t.accessURL&&this.netAgent.setNetAgentSpecifiedServers([null==(t=this.options)?void 0:t.accessURL]),null!=(t=this.options)&&t.customDomain&&this.netAgent.setNetAgentSpecifiedServers([t="wss://accesshub-wss."+this.options.customDomain+"/accesshub"]),this.dispatchServers=[],this.netAgent.setDispatchConnectServers(this.dispatchServers)},Ht.prototype.getMainDomain=function(e){return(e=e.split("."))[e.length-2]+"."+e[e.length-1]},Ht.prototype.bindWxListener=function(){var e=this;(0,my.onNetworkStatusChange)((function(t){t.isConnected?e.netOnLineHandle():e.netOffLineHandle()}))},Ht.prototype.retryRoom=function(){var e=this;this.stateCenter.roomModulesList.forEach((function(t){t.roomTryHandler&&e.netAgent.isConnect()&&(t.resetSessionInfo(),t.roomTryHandler.active(!0))}))},Ht.prototype.netOnLineHandle=function(){this.logger.info("zm.wl network is online"),this.stateCenter.networkState=n.a.online},Ht.prototype.netOffLineHandle=function(){this.logger.info("zm.wl network is broken"),this.stateCenter.networkState=n.a.offline},Ht.prototype.setLogConfig=function(e){this.logger.info(f+" call");var t,r=this.stateCenter.reporter.createSpan(n.k.H,{key:Z.event},{key:re.event},re.event);if(e.logLevel&&["debug","info","warn","error","report","disable"].includes(e.logLevel)&&(this.logger.setLogLevel(e.logLevel),r.setAttributes({log_level:re.log_level(e.logLevel)})),e.remoteLogLevel&&["debug","info","warn","error","report","disable"].includes(e.remoteLogLevel)&&r.setAttributes({remote_log_level:re.remote_log_level(e.remoteLogLevel)}),"string"==typeof e.logURL&&(e.logURL.startsWith("wss://")||e.logURL.startsWith("https://")))null!=(t=this.stateCenter.geoFencing)&&t.logreport?this.logger.info(f+" geo exist"):(this.logger.setLogServer(e.logURL),0===this.stateCenter.ENV&&(this.stateCenter.logDomain=null==(t=this.logger.url)?void 0:t.split("/")[2],this.stateCenter.reporter.setConfig({serverUrl:"wss://"+this.stateCenter.logDomain+"/zglog/tlog"}))),r.setAttributes({log_url:re.log_url(e.logURL)}),r.end();else if(e.logURL)return this.logger.error(f+"log url must be a wss or https url"),this.stateCenter.reporter.setError(r,re.error.kInvalidParamError),!1;return this.logger.info(f+" call success"),r.end(),!0},Ht.prototype.setDebugVerbose=function(e){var t=this.stateCenter.reporter.createSpan(n.k.H,{key:Z.event},{key:ee},ee);"boolean"==typeof e&&(this.stateCenter.debug=e,this.stateCenter.debugCustom=!0,t.setAttributes({debug:te(e?"true":"false")})),t.end(),this.logger.info("zm.sdv call success")},Ht.prototype.setDebug=function(e){"string"==typeof e&&-1<e.indexOf("wss")?this.stateCenter.debug=a.a.isTestEnv(e):Array.isArray(e)&&0<e.length&&e.every((function(e){return"string"==typeof e&&-1<e.indexOf("wss")}))?this.stateCenter.debug=a.a.isTestEnv(e[0]):this.logger.info(m+" server wrong"),this.stateCenter.testEnvironment=this.stateCenter.debug},Ht.prototype.renewToken=function(e,t){var r,o=this,i=this.stateCenter.reporter.createSpan(n.k.H,{key:ie.event,par:t},{key:""},he.event);return void 0===t||"string"==typeof t&&""!=t?(r=this.getRoomModules(t)||this.stateCenter.roomModulesList[0])?"string"==typeof e&&r.roomTryHandler?(e===r.roomTryHandler.token?(this.logger.info(C+" token has not changed"),i.setAttributes({error:he.error.INPUT_PARAM.code,message:"token has not changed"}),i.end()):(i.setAttributes({token:he.token(e)}),this.stateCenter.configRoomAuth?null!=(t=this.liveRoomHandler)&&t.renewToken({token:e},(function(t){var n;null!=(n=r.roomTryHandler)&&n.renewLocalToken(e,null==(n=null==t?void 0:t.body)?void 0:n.token_remain_time),o.reporter.setReporterInfo(o.stateCenter.idName||"",e),o.stateCenter.configCheckToken=!0,i.end(),o.logger.info(C+" "+JSON.stringify(t))}),(function(t){var n=null==(n=null==t?void 0:t.body)?void 0:n.err_code;o.stateCenter.reporter.setError(i,t),!n||1000002014!==n&&2014!==n?o.logger.error(C+" "+JSON.stringify(t)):(o.stateCenter.configCheckToken=!1,null!=(n=r.roomTryHandler)&&n.renewLocalToken(e),o.logger.warn(C+" "+JSON.stringify(t)))}),r):(null!=(t=r.roomTryHandler)&&t.renewLocalToken(e),this.reporter.setReporterInfo(this.stateCenter.idName||"",e),i.end())),!0):("string"!=typeof e||r.roomTryHandler?(this.logger.error(C+" token must be string and not empty"),this.stateCenter.reporter.setError(i,he.error.INPUT_PARAM)):(this.logger.error(C+" calling must after loginRoom"),this.stateCenter.reporter.setError(i,he.error.NOT_LOGIN)),!1):(this.logger.error(C+" calling must after loginRoom"),this.stateCenter.reporter.setError(i,he.error.NOT_LOGIN),!1):(this.logger.error(C+" roomID must be string and no empty"),!1)},Ht.prototype.loginRoom=function(e,t,r,i){var s=this;return this.logger.info(_+" call by user "+(null==r?void 0:r.userID)+" "+e+" "+this.version),new Promise((function(a,u){return wt(s,void 0,void 0,(function(){var s,l,h,c,d,p=this;return Dt(this,(function(g){switch(g.label){case 0:return 1!==this.stateCenter.ENV?[3,2]:[4,new Promise((function(e){my.getNetworkType({success:function(t){p.stateCenter.networkState="NOTREACHABLE"===t.networkType?n.a.offline:n.a.online,e()},fail:function(t){p.logger.error(m+" network "+JSON.stringify(t)),p.stateCenter.networkState=n.a.online,e()}})}))];case 1:g.sent(),g.label=2;case 2:return l=this.loginReport(a,u,e,t,i),d=l.interResolve,s=l.interReject,l=l.loginSpan,(i=i||{}).maxMemberCount||(i.maxMemberCount=0),h=this.getRoomModules(e),c=ie.error,h?(this.logger.setSessionInfo(this.stateCenter.appid,e,"",r.userID,"",this.stateCenter.sdKVersion),s(c.REPEATEDLY_LOGIN)):((h=new rt(e,this.stateCenter,this.logger,this.dataReport,this,this.liveRoomHandler,this.service)).roomTryHandler||(h.roomTryHandler=new ze(this.logger,this.stateCenter,h)),h.roomTryHandler.init(this.stateCenter.roomRetryTime),h.roomTryHandler.initRoom(h.roomHandler,e,t,r,this.stateCenter.server,this.stateCenter.serverBak,i),h.roomTryHandler.setLoginRoomCallback(d,s),h.roomHandler.roomStateHandle("CONNECTING",o.Logining,{code:0,msg:""}),(d=function(e,t){var r,o,n=[],i={};for(r in e)i[e[r].order]=e[r],e[r].key=r;for(o in i)n.push(i[o]);for(var s=0;s<n.length;s++)for(var a=n[s].rules,u=0;u<a.length;u++){var l={key:n[s].key,value:n[s].value,action:t.action,logger:t.logger},h=l.value,c=a[u].name?""+a[u].name:"";if((void 0===h&&c===Ge.NOT_EMPTY||void 0!==h)&&je[c]&&(c=je[c](l.key,h,l.action,l.logger,a[u]))!=We)return c}return We}({roomID:{order:0,value:e,rules:[{name:Ge.NOT_EMPTY,error:c.ROOM_ID_NULL},{name:Ge.TYPE_STRING,error:c.INPUT_PARAM,extMsg:"roomID must be string"},{name:Ge.MAX_LENGTH_128,error:c.ROOM_ID_TOO_LONG},{name:Ge.ILLEGAL_CHARACTERS,error:c.ROOM_ID_INVALID_CHARACTER}]},token:{order:1,value:t,rules:[{name:Ge.NOT_EMPTY,error:c.INPUT_PARAM},{name:Ge.TYPE_STRING,error:c.INPUT_PARAM}]},user:{order:2,value:r,rules:[{name:Ge.NOT_EMPTY,error:c.INPUT_PARAM,extMsg:" param user error."},{name:Ge.TYPE_OBJECT,error:c.INPUT_PARAM,extMsg:" param user error."}]},"user.userID":{order:3,value:r.userID,rules:[{name:Ge.NOT_EMPTY,error:c.USER_ID_NULL,extMsg:" param user error."},{name:Ge.TYPE_STRING,error:c.INPUT_PARAM,extMsg:" param userID error."},{name:Ge.MAX_LENGTH_64,error:c.USER_ID_TOO_LONG},{name:Ge.ILLEGAL_CHARACTERS,error:c.USER_ID_INVALID_CHARACTER}]},"user.userName":{order:4,value:r.userName,rules:[{name:Ge.TYPE_STRING,error:c.INPUT_PARAM,extMsg:" userName must be string."},{name:Ge.MAX_LENGTH_256,error:c.USER_NAME_TOO_LONG}]},config:{order:5,value:i,rules:[]},"config.maxMemberCount":{order:6,value:i.maxMemberCount,rules:[{name:Ge.TYPE_INTEGER,error:c.INPUT_PARAM,extMsg:" maxMemberCount must be integer number."}]}},{action:_,logger:this.logger}))!==We?(h.roomHandler.roomStateHandle("DISCONNECTED",o.LoginFailed,d.error,d.extMsg),s(d.error,d.extMsg)):(this.logger.setSessionInfo(this.stateCenter.appid,"","",r.userID,"",this.version),0<this.stateCenter.roomModulesList.length&&1==this.stateCenter.isMultiRoom?h.isMulti=!0:Ut([],this.stateCenter.roomModulesList,!0).forEach((function(e){return e.roomHandler.logout()})),i&&(h.config=i),this.stateCenter.roomModulesList.push(h),this.netAgent&&(this.stateCenter.idName=r.userID,this.netAgent.setUserInfo(r.userID),this.stateCenter.actionListener("_roomLogin",e,t),this.netAgent.isConnect())&&this.fetchAppConfig(t),this.stateCenter.reporter.setCommonAttributes({id_name:r.userID}),this.stateCenter.reporter.setReporterInfo(r.userID,t),this.logger.setTokenInfo(t,r.userID),this.stateCenter.reporter.setSpanInMap(l,{key:ie.event,par:e}),this.stateCenter.setMultiRoom=!0,h.roomTryHandler.startMaxTime(),this.isUseNetAgent&&!this.netAgent.isConnect()?(this.logger.info(_," us is not connected"),h.roomHandler.setRunState(n.b.trylogin),this.netAgent.connectUa()):(this.isUseNetAgent&&(this.stateCenter.networkState=n.a.online),h.roomTryHandler.active(!0)))),[2]}}))}))}))},Ht.prototype.handleLogUpload=function(e){var t="";e&&e.app_config?t=e.app_config.domain:this.stateCenter.appConfig&&this.stateCenter.appConfig.app_config&&(t=this.stateCenter.appConfig.app_config.domain),this.logger.info(S+" call"),this.logger.url?this.logger.info(S+" log is connected"):(null!=(e=this.stateCenter.geoFencing)&&e.logreport?(this.stateCenter.logDomain=null==(e=this.stateCenter.geoFencing)?void 0:e.logreport,t=this.getMainDomain(null==(e=this.stateCenter.geoFencing)?void 0:e.logreport)):this.stateCenter.testEnvironment?(this.stateCenter.logDomain="weblogger-hk-test.zegocloud.com",t="zegocloud.com"):this.stateCenter.logDomain="weblogger".concat(this.stateCenter.appid,"-api.").concat(t),t?(e="",0===this.stateCenter.ENV?(e="wss://".concat(this.stateCenter.logDomain,"/log"),this.reporter.setConfig({serverUrl:"wss://".concat(this.stateCenter.logDomain,"/zglog/tlog")})):e="https://".concat(this.stateCenter.logDomain,"/httplog"),this.logger.setLogServer(e)):this.logger.warn(S+" appconfig no domain"))},Ht.prototype.fetchAppConfigByTargetToken=function(e,t){return wt(this,void 0,void 0,(function(){return Dt(this,(function(e){return[2,null]}))}))},Ht.prototype.fetchAppConfig=function(e){return wt(this,void 0,void 0,(function(){var t,r,o,i,a,u,l;return Dt(this,(function(h){switch(h.label){case 0:if(this.stateCenter.appConfigFetched)return this.logger.warn(v+" config fetched"),[2];if(!this.getUserID())return this.logger.warn(v+" user not exist"),[2];if(t="",e)t=e;else{if(!(0<this.stateCenter.roomModulesList.length))return this.logger.warn(v+" token not exist"),[2];t=this.getToken()}r=this.stateCenter.reporter.createSpan(n.k.H,{key:Z.event},{key:""},"/sdk_config/init"),this.logger.info(_+" initConfig etag: "+this.stateCenter.appConfigEtag),o=!!this.stateCenter.appConfig,h.label=1;case 1:return h.trys.push([1,3,,4]),[4,this.netAgent.getAppConfigByAgent("init",t,5e3,this.stateCenter.appConfigEtag)];case 2:if(l=h.sent(),a=l.code,u=l.data,i=l.etag,l=l.retryCount,r.setAttributes({trigger_reason:we(this.stateCenter.appConfig?"refresh":"normal"),try_count:De(l||0)}),r.end(),this.stateCenter.appConfigFetched=!0,this.logger.info(_+" initConfig code:"+a+" data: "+JSON.stringify(u)+" etag: "+i),this.stateCenter.appConfigEtag!==i){if(0==Object.keys(u).length)return this.logger.info(_+" initConfig data null"),[2];this.stateCenter.appConfig={app_config:l=u.app_config,media_config:{publish_config:(a=u.media_config).publish_config,play_config:a=a.play_config},speedlog_config:{charge_info_report_no_playing:(u=u.speedlog_config.charge_info_report_no_playing)||0}},this.stateCenter.appConfigEtag=i}return this.handleLogUpload(),!o&&this.stateCenter.appConfig&&this.stateCenter.actionListener("_appConfigRsp"),!this.stateCenter.netAppConfig&&this.stateCenter.appConfig&&(this.stateCenter.netAppConfig=Object.assign(this.stateCenter.appConfig),this.stateCenter.actionListener("_netAppConfigRsp",this.stateCenter.netAppConfig),this._onAppConfigUpdate)&&this._onAppConfigUpdate(this.stateCenter.netAppConfig),[3,4];case 3:return l=h.sent(),this.logger.error(_+" fail "+JSON.stringify(l)),r.setAttributes({error:null==l?void 0:l.code}),r.end(),[20012,20008].includes(null==l?void 0:l.code)&&this.stateCenter.roomModulesList.forEach((function(e){e.roomTryHandler&&e.roomTryHandler.loginFail(s.a.APPID_INVALID)})),[3,4];case 4:return[2]}}))}))},Ht.prototype.cloudReportNotify=function(e,t,r){},Ht.prototype.loginReport=function(e,t,r,o,i){var u=this,l=ie,h=this.stateCenter.reporter.createSpan(n.k.I,{key:Z.event},{key:""},l.event);return h.setAttributes({svr_env:l.svr_env(this.stateCenter.testEnvironment?"test":"online"),token:l.token(o)}),i&&("boolean"==typeof i.userUpdate&&h.setAttribute("user_state_update",l.user_state_update(i.userUpdate?1:0)),"number"==typeof i.maxMemberCount)&&h.setAttributes({max_member_cnt:l.max_member_cnt(i.maxMemberCount)}),{interResolve:function(t){var o=u.getRoomSessionID(r),n=u.getRoomModules(r),i=u.getSessionId(r);h.setAttributes({room_id:l.room_id(r),room_sid_string:l.room_sid_string(o),liveroom_sid_string:l.liveroom_sid_string(i),try_cnt:l.try_cnt(null==(o=null==n?void 0:n.roomTryHandler)?void 0:o.retryActiveCount),server:l.server(null==(i=null==n?void 0:n.roomHandler)?void 0:i.server),room_mode:l.room_mode(u.stateCenter.isMultiRoom?1:0),role:l.role(u.stateCenter.role),audience_create_room:l.audience_create_room(u.stateCenter.roomCreateFlag?1:0),max_member_cnt:l.max_member_cnt((null==n?void 0:n.maxMemberCount)||0)}),h.end(),e(t)},interReject:function(e,o){var n,i;void 0===o&&(o=""),h.setAttributes({room_id:l.room_id(r)}),e.code<2e9&&1e9<e.code||e.code<1e6?(n=a.a.decodeServerError(e.code,e.msg),i=a.a.getLiveRoomError(e.code,u.isUseNetAgent)):n={code:e.code,message:e.msg},n&&u.stateCenter.reporter.setError(h,{code:n.code,msg:n.message+o}),i&&s.a[i]&&(e.code=s.a[i].code,e.msg.includes("unknown"))&&(e.msg=s.a[i].msg),t(e.code&&e.msg&&""!==o?{code:e.code,msg:e.msg+o}:e)},loginSpan:h}},Ht.prototype.logoutRoom=function(e){var t,r=this;this.logger.info(y+" call by user "+e),this.stateCenter.roomModulesList.length?void 0===e?Ut([],this.stateCenter.roomModulesList,!0).forEach((function(e){r.logoutSpan(e),e.roomHandler.logout(!0)})):"string"!=typeof e||""==e?(this.logger.error(y+" roomID must be string and not empty"),this.logoutSpan(void 0,ce.error.INPUT_PARAM)):(t=this.getRoomModules(e))?(this.logoutSpan(t),t.roomHandler.logout()):(this.logger.error(y+" room not exist"),this.logoutSpan(void 0,ce.error.ROOM_NOT_EXIST,e)):this.logger.warn(y+" no room")},Ht.prototype.uploadLog=function(){var e=this;return new Promise((function(t,r){e.logger.info("zm.zip.udlg call"),e.logger.uploadStorageLog().then((function(){e.logger.info("zm.zip.udlg call success"),t({errorCode:0,extendedData:"upload logs success!"})})).catch((function(t){e.logger.error("zm.zip.udlg upload zip log failed, result: "+((null==t?void 0:t.message)||"unknown")),r({errorCode:s.a.UPLOAD_LOG_ERROR.code,extendedData:s.a.UPLOAD_LOG_ERROR.msg+", result: "+((null==t?void 0:t.message)||"unknown")})}))}))},Ht.prototype.sendCustomCommand=function(e,t,r){return new Promise((function(e,t){console.error(n.h.MESSAGE),t()}))},Ht.prototype._sendCustomCommand=function(e,t,r){return new Promise((function(e,t){console.error(n.h.MESSAGE),t()}))},Ht.prototype.sendBroadcastMessage=function(e,t){return new Promise((function(e,t){console.error(n.h.MESSAGE),t()}))},Ht.prototype._sendBroadcastMessage=function(e,t,r,o){return void 0===r&&(r=1),void 0===o&&(o=1),new Promise((function(e,t){console.error(n.h.MESSAGE),t()}))},Ht.prototype.setRoomExtraInfo=function(e,t,r){return new Promise((function(e,t){console.error(n.h.MESSAGE),t()}))},Ht.prototype._setRoomExtraInfo=function(e,t,r){return new Promise((function(e,t){console.error(n.h.MESSAGE),t()}))},Ht.prototype.sendBarrageMessage=function(e,t){return new Promise((function(e,t){console.error(n.h.MESSAGE),t()}))},Ht.prototype._sendBarrageMessage=function(e,t,r,o){return void 0===r&&(r=1),void 0===o&&(o=1),new Promise((function(e,t){console.error(n.h.MESSAGE),t()}))},Ht.prototype.sendRelayMessage=function(e,t,r,o,i){console.error(n.h.MESSAGE)},Ht.prototype.requestJoinLive=function(e,t,r,o,i){return console.error(n.h.MESSAGE),!1},Ht.prototype.inviteJoinLive=function(e,t,r,o,i){return console.error(n.h.MESSAGE),!1},Ht.prototype.endJoinLive=function(e,t,r,o){return console.error(n.h.MESSAGE),!1},Ht.prototype.respondJoinLive=function(e,t,r,o,i){return console.error(n.h.MESSAGE),!1},Ht.prototype.getVersion=function(){return this.version},Ht.prototype.setSdkBizVersion=function(e){"string"==typeof e&&""!==e&&(this.stateCenter.bizVersion=e)},Ht.prototype.on=function(e,t){var r=this.stateCenter.reporter.createSpan(n.k.H,{key:J},{key:""},oe.event);return r.setAttributes({listener:oe.listener(e)}),this.stateCenter.listenerList[e]?"function"!=typeof t?(this.logger.error(b+" listener callBack must be funciton"),this.stateCenter.reporter.setError(r,oe.error.INPUT_PARAM," listener callBack must be function"),!1):(-1==this.stateCenter.listenerList[e].indexOf(t)&&this.stateCenter.listenerList[e].push(t),r.end(),!0):(this.logger.error(b+" event "+e+" no found"),this.stateCenter.reporter.setError(r,oe.error.INPUT_PARAM," event "+e+" no found"),!1)},Ht.prototype.off=function(e,t){var r,o=this.stateCenter.reporter.createSpan(n.k.H,{key:J},{key:""},"/sdk/off_listener");return o.setAttributes({listener:ne(e)}),this.stateCenter.listenerList[e]?(r=this.stateCenter.listenerList[e],t?r.splice(r.indexOf(t),1):this.stateCenter.listenerList[e]=[],o.end(),!0):(this.logger.error("zm.off listener no found"),this.stateCenter.reporter.setError(o,oe.error.INPUT_PARAM," event "+e+" no found"),!1)},Ht.prototype._on=function(e,t){return this.stateCenter.listenerList[e]?"function"!=typeof t?(this.logger.error(b+" listener callBack must be funciton"),!1):(-1==this.stateCenter.listenerList[e].indexOf(t)&&this.stateCenter.listenerList[e].push(t),!0):(this.logger.error(b+" event "+e+" no found"),!1)},Ht.prototype._off=function(e,t){var r;return this.stateCenter.listenerList[e]?(r=this.stateCenter.listenerList[e],t?r.splice(r.indexOf(t),1):this.stateCenter.listenerList[e]=[],!0):(this.logger.error("zm.off listener no found"),!1)},Ht.prototype.isTestEnvironment=function(){return this.stateCenter.testEnvironment},Ht.prototype.isLogin=function(e){return!!(e=this.getRoomModules(e)||this.stateCenter.roomModulesList[0])&&e.isLogin()},Ht.prototype.getMultiRoom=function(){return this.stateCenter.isMultiRoom},Ht.prototype.getAppID=function(){return this.stateCenter.appid},Ht.prototype.getUserID=function(){return this.stateCenter.idName},Ht.prototype.getUserName=function(){return this.stateCenter.nickName},Ht.prototype.getToken=function(e){return(this.getRoomModules(e)||this.stateCenter.roomModulesList[0]).token},Ht.prototype.setRoomCreateFlag=function(e){this.stateCenter.roomCreateFlag=e},Ht.prototype.setRole=function(e){this.stateCenter.role=e},Ht.prototype.getSessionId=function(e){return(e=this.getRoomModules(e)||this.stateCenter.roomModulesList[0])?e.userSidString:"0"},Ht.prototype.getRoomSessionID=function(e){return(e=this.getRoomModules(e)||this.stateCenter.roomModulesList[0])?e.roomSidString:"0"},Ht.prototype.getAppConfig=function(){return this.stateCenter.appConfig},Ht.prototype.setTestPackageSize=function(e){this.stateCenter.testNetPackageSize=e},Ht.prototype.setAccess=function(e){},Ht.prototype.enableMultiRoom=function(e){var t=this.stateCenter.reporter.createSpan(n.k.H,{key:Z.event},{key:""},Ce.event);return"boolean"!=typeof e?(this.logger.error("zm.emr param must be boolean"),this.stateCenter.reporter.setError(t,Ce.error.kAlreadyLoginError),!1):(t.setAttribute("is_multi",Ce.is_multi(e)),0<this.stateCenter.roomModulesList.length||this.stateCenter.setMultiRoom?(this.logger.error("zm.emr multi room can only be set once before first login"),this.stateCenter.reporter.setError(t,Ce.error.kInvalidParamError),!1):(t.end(),this.stateCenter.isMultiRoom=e,this.stateCenter.setMultiRoom=!0))},Ht.prototype.getRoomModules=function(e){return this.stateCenter.roomModulesList.find((function(t){return t.roomID==e}))},Ht.prototype._onAppConfigUpdate=function(e){},Ht.prototype._onBeforePageUnload=function(){},Ht.use=function(e){switch(e.type){case"message":case"live":e.install(Ht,rt,nt,Ot)}},Ht.setEngineOptions=function(e){Ht.engineOptions=e},Ht.prototype.resetRoomTokenTimer=function(e,t){(e=this.getRoomModules(e)||this.stateCenter.roomModulesList[0])&&t&&0<t&&e.roomHandler.resetTokenTimer(1e3*t)},Ht.prototype.isDisConnect=function(){return this.liveRoomHandler.isDisConnect()},Ht.prototype.sendMessage=function(e,t,r,o){this.liveRoomHandler.sendMessage(e,t,r,o)},Ht.prototype.setProtoFormat=function(e){if(!["json","pb"].includes(e=void 0===e?"json":e))throw new Error("Failed to execute 'setProtoFormat': Arguments 'format' must be 'json' or 'pb'.");this.stateCenter.protoFormat=e},Ht.prototype.setSdkLoginRelateService=function(e){Array.isArray(e)&&e.every((function(e){return"string"==typeof e}))&&(this.stateCenter.relateService=e)},Ht.prototype.getRoomID=function(){return this.stateCenter.roomid},Ht.prototype.getServerTimeOffset=function(){return this.stateCenter.serverTimeOffset},Ht.prototype.getReqHead=function(e){return e="string"==typeof e&&""!==e&&this.getRoomModules(e)||this.stateCenter.roomModulesList[0],this.liveRoomHandler.getReqHead(e)},Ht.prototype.sendSwitchMessage=function(e,t){throw this.logger.error("".concat("zm.ssm"," ").concat(s.a.WHITE_BOARD_VERSION_ERROR.msg)),s.a.WHITE_BOARD_VERSION_ERROR},Ht.prototype.onSwitchMessage=function(e){e&&this.liveRoomHandler&&(this.liveRoomHandler.onSwitchMessage=e)},Ht.prototype.onAppConfigUpdate=function(e){e&&(this._onAppConfigUpdate=e)},Ht.prototype.onBeforePageUnload=function(e){e&&(this._onBeforePageUnload=e)},Ht.prototype.getProtoVer=function(){return n.d.SWITCH_TWO},Ht.prototype.sendBusinessMessage=function(e,t,r){return"number"==typeof e&&t?this.liveRoomHandler.sendMessage(e,t,void 0,void 0,r,void 0,!1):-1},Ht.prototype.logoutSpan=function(e,t,r){var o=this,i=this.stateCenter.reporter.createSpan(n.k.I,{key:Z.event},{key:ce.event,par:null==e?void 0:e.roomID},ce.event,!0);i.setAttributes({is_multi:ce.is_multi(this.stateCenter.isMultiRoom),is_send_cmd_net:ce.is_send_cmd_net(!0)}),e?i.setAttributes({room_id:ce.room_id(null==e?void 0:e.roomID),room_sid_string:ce.room_sid_string(null==e?void 0:e.roomSidString),liveroom_sid_string:ce.liveroom_sid_string(null==e?void 0:e.userSidString)}):"string"==typeof r&&i.setAttributes({room_id:ce.room_id(r)}),t?this.stateCenter.reporter.setError(i,t):i.end(),setTimeout((function(){o.reporter.flush()}),200)},Ht.prototype.getMsgSpan=function(e,t,r){return this.stateCenter.reporter.createSpan(n.k.H,{key:ie.event,par:t},{key:e,par:t},e,r=void 0!==r&&r)},Ht.prototype.updateTimeOffsetInterval=function(){var e=this;"number"==typeof this.netAgent.timeOffset&&this.stateCenter.reporter.setTimeOffset(this.netAgent.timeOffset),this.timeOffsetUpdateTimer=setTimeout((function(){e.updateTimeOffsetInterval()}),9e5)},Ht);function Ht(e,t,r,o,s,u,l,h){var c;if(this.logger=r,this.dataReport=o,this.reporter=s,this.version=u,this.options=h,this.roomLoginResponseListener=function(){},this.stateCenter=new Ye(this.logger,this.dataReport),this.stateCenter.ENV=l,this.stateCenter.product="rtc_web",this.getReportSeq=n.m,this.getSeq=n.n,this.initCallback(),this.stateCenter.deviceID=a.a.generateUUID(l),this.logger.info("".concat(m," device ID is ").concat(this.stateCenter.deviceID)),this.reporter.init(e,l,this.stateCenter.deviceID),this.reporter.setLogger(this.logger),this.stateCenter.reporter=this.reporter,o=this.stateCenter.reporter.createSpan(n.k.H,{key:""},{key:(r=Z).event},r.event,!0),0!=l&&1!=l||this.setDebug(t),s="Express",null!=(u=this.options)&&u.reportData&&(c=null==(u=null==(h=this.options)?void 0:h.reportData)?void 0:u.version,s=(null==(u=null==(h=this.options)?void 0:h.reportData)?void 0:u.project)||s),o.setAttributes({biz_type:r.biz_type(0),project:r.project(s),servers:r.servers("string"==typeof t?[t]:t),liveroom_version:r.liveroom_version(c),is_from_cache:r.is_from_cache(!1),sev_env:r.sev_env(this.stateCenter.testEnvironment?"test":"online")}),a.a.checkConfigParam(e,t,this.logger)){this.stateCenter.appid=e,this.stateCenter.configOK=!0,this.stateCenter.sdKVersion=this.version,this.netAgent=new i.f,this.logger.setSessionInfo(this.stateCenter.appid,"","","","",this.version),this.netAgent.init(),this.netAgent.setLogger(this.logger),this.netAgent.setAppInfo(h={appID:this.stateCenter.appid,env:this.stateCenter.ENV,mode:this.stateCenter.mode}),this.liveRoomHandler=new Ot(this.logger,this.stateCenter,this.netAgent,this.dataReport,this),this.createNetAgent(),o.setAttributes({use_na:r.use_na(1)}),o.end(),"string"==typeof t?(this.stateCenter.server=t,this.stateCenter.serverBak=t):Array.isArray(t)&&0<t.length&&(this.stateCenter.server=t[0],this.stateCenter.serverBak=t[1]||t[0]),this.bindWxListener();try{var d,p={brand:(d=my.getSystemInfoSync()).brand,model:d.model,system:d.system,platform:d.platform,version:d.version,SDKVersion:d.SDKVersion};this.logger.warn(m+" "+JSON.stringify(p)),o.setAttribute("mini_sys_infos",p),o.end()}catch(e){this.logger.warn(m+" get system info error")}this.logger.setSessionInfo(this.stateCenter.appid,"","","","",this.version)}else this.logger.error("".concat(m," init sdk error")),this.stateCenter.reporter.setError(o,r.error.kInvalidParamError);this.stateCenter.onListener("roomLoginResponse",this.roomLoginResponseListener)}Bt.prototype.setAttributes=function(e){this.dataReport.addMsgInfo(this.seq,e)},Bt.prototype.setAttribute=function(e,t){this.dataReport.addMsgInfo(this.seq,{key:t})},Bt.prototype.end=function(e){this.dataReport.uploadReport(this.seq)};var qt=Bt;function Bt(e,t){this.dataReport=e,this.seq=t}zt.prototype.init=function(e,t,r){},zt.prototype.setConfig=function(e){},zt.prototype.loadScript=function(e,t,r,o){return Promise.resolve()},zt.prototype.setReporterInfo=function(e,t){},zt.prototype.flush=function(e){},zt.prototype.destroy=function(){},zt.prototype.setCommonStates=function(e){},zt.prototype.setResource=function(e){},zt.prototype.setCommonAttributes=function(e){},zt.prototype.setPublicPros=function(e){},zt.prototype.createSpan=function(e,t,r,o,i){t&&t.key&&t.par?(a=t.par1?"_"+t.par1:"",!(s=null==(s=this.reportList[t.key])?void 0:s[t.par+a])&&t.bak_key&&(s=null==(u=this.reportList[t.bak_key])?void 0:u[t.par+a])):t&&!(s=this.reportList[t.key])&&t.bak_key&&(s=this.reportList[t.bak_key]),s=s||this.reportList[Z.event];var s,a,u=Object(n.m)();return this.dataReport.newReport(u,o),t=new qt(this.dataReport,u),i&&(r.par?(this.reportList[r.key]||(this.reportList[r.key]={}),this.reportList[r.key][r.par+(a=r.par1?"_"+r.par1:"")]=t):this.reportList[r.key]=t),t},zt.prototype.setSpanInMap=function(e,t){t.par?(this.reportList[t.key]||(this.reportList[t.key]={}),this.reportList[t.key][t.par+(t.par2?"_"+t.par2:"")]=e):this.reportList[t.key]=e},zt.prototype.spanEnd=function(e,t,r){var o;e.par?(o=e.par1?"_"+e.par1:"",o=this.reportList[e.key]&&this.reportList[e.key][e.par+o],this.reportList[e.key]&&!r&&delete this.reportList[e.key][e.par]):(o=this.reportList[e.key],r||delete this.reportList[e.key]),o&&(this.dataReport.addMsgInfo(o.seq,t),this.dataReport.uploadReport(o.seq))},zt.prototype.spanSetAttributes=function(e,t){var r,o;e.par?(r=e.par1?"_"+e.par1:"",!(o=this.reportList[e.key]&&this.reportList[e.key][e.par+r])&&e.bak_key&&(o=this.reportList[e.bak_key]&&this.reportList[e.bak_key][e.par+r])):!(o=this.reportList[e.key])&&e.bak_key&&(o=this.reportList[e.key]),o&&(this.dataReport.addMsgInfo(o.seq,t),this.dataReport.uploadReport(o.seq))},zt.prototype.spanAppendAttribute=function(e,t,r){this.logger.warn("zm.zr.saa not support this func "+(null==e?void 0:e.key))},zt.prototype.setError=function(e,t,r){this.dataReport.uploadReport(e.seq,void 0,t,r)},zt.prototype.setLogger=function(e){},zt.prototype.setTimeOffset=function(e){},zt.prototype.setUnloadState=function(e){},zt.prototype.setNetStateCheck=function(){};var Gt=zt;function zt(e){this.logger=e,this.reportList={},this.publicPros={},this.dataReport=new Fe.ZegoDataReport(e)}Wt.prototype.enableMultiRoom=function(e){return this.zegoWebRTM.enableMultiRoom(e)},Wt.prototype.loginRoom=function(e,t,r,o){return this.zegoWebRTM.loginRoom(e,t,r,o)},Wt.prototype.logoutRoom=function(e){return this.zegoWebRTM.logoutRoom(e)},Wt.prototype.renewToken=function(e,t){return this.zegoWebRTM.renewToken(e,t)},Wt.prototype.sendBarrageMessage=function(e,t){return this.zegoWebRTM.sendBarrageMessage(e,t)},Wt.prototype.sendBroadcastMessage=function(e,t){return this.zegoWebRTM.sendBroadcastMessage(e,t)},Wt.prototype.sendCustomCommand=function(e,t,r){return this.zegoWebRTM.sendCustomCommand(e,t,r)},Wt.prototype.setRoomExtraInfo=function(e,t,r){return this.zegoWebRTM.setRoomExtraInfo(e,t,r)},Wt.prototype.setLogConfig=function(e){return this.zegoWebRTM.setLogConfig(e)},Wt.prototype.setDebugVerbose=function(e){return this.zegoWebRTM.setDebugVerbose(e)},Wt.prototype.on=function(e,t){return this.zegoWebRTM.on(e,t)},Wt.prototype.getVersion=function(){return this.zegoWebRTM.getVersion()},Wt.prototype.off=function(e,t){return this.zegoWebRTM.off(e,t)},Wt.use=function(e){xt.use(e)},Wt.setGeoFence=function(e,t){},Wt.setEngineOptions=function(e){xt.setEngineOptions(e)},Wt.version=n.j;var Vt=Wt;function Wt(e,t,r,o){this.logger=new Fe.ZegoLogger(r=void 0===r?0:r),this.dataReport=new Fe.ZegoDataReport(this.logger),this.reporter=new Gt(this.logger),this.zegoWebRTM=new xt(e,t,this.logger,this.dataReport,this.reporter,Wt.version,r,o)}}],o={},t.m=r,t.c=o,t.d=function(e,r,o){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:o})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var n in e)t.d(o,n,function(t){return e[t]}.bind(null,n));return o},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=16);function t(e){var n;return(o[e]||(n=o[e]={i:e,l:!1,exports:{}},r[e].call(n.exports,n,n.exports,t),n.l=!0,n)).exports}var r,o}(r(100))},533:function(e){"undefined"!=typeof self&&self,e.exports=function(){return t={17:function(e,t,r){"use strict";function o(e){return e}function n(e){return e}function i(e){return e}r.r(t);var s,a="zm.scc",u="zm.sbcm",l="zm.srlm",h="zm.sbrm",c="zm.msg.sdr",d="zm.msg.rlr",p="zm.msg.rps",g="zm.msg.srm",m="zm.msg.scm",f="zm.msg.sbm",_="zm.msg.bps",y="zm.msg.slm",v="zm.sv.ps",S={code:1100001,msg:"input parm error."},E={code:1100002,msg:"network timeout."},b={code:1000002,msg:"not login"},C={code:1009001,msg:"message content is empty"},R={code:1009010,msg:"failed to send message"},T={code:1002014,msg:"room not exist"},I={code:1002099,msg:"room inner error"},P={code:1109001,msg:"frequency limited."},M={INPUT_PARAM:S,IM_CONTENT_NULL:C,IM_CONTENT_TOO_LONG:j={code:1009002,msg:"message content is too long"},ROOM_NOT_EXIST:T},L="/liveroom/send_custom_command",k=n,N={INPUT_PARAM:S,IM_CONTENT_NULL:C,IM_CONTENT_TOO_LONG:j,ROOM_NOT_EXIST:T},O="/liveroom/send_room_message",A=i,w=i,D={INPUT_PARAM:S,IM_CONTENT_NULL:C,IM_CONTENT_TOO_LONG:j,ROOM_NOT_EXIST:T},U=n,x=n,H=S,q={code:1102022,msg:"trans send frequently"},B=T,G=o,z=o,V=n,W=i,j=((C=s=s||{})[C.I=0]="I",C[C.H=10]="H",C[C.M=100]="M",C[C.L=1e3]="L",r(3)),F=r.n(j),Y=(Object.defineProperty(K.prototype,"isUseNetAgent",{get:function(){return this.stateCenter.useNetAgent},enumerable:!1,configurable:!0}),Object.defineProperty(K.prototype,"serviceHandler",{get:function(){return this.liveRoomHandler},enumerable:!1,configurable:!0}),K.prototype.loginRsp=function(e){var t,r=this;if(null!=e.body.ret_timestamp&&"string"==typeof e.body.ret_timestamp&&(t=parseFloat(e.body.ret_timestamp),this.serverTimeOffset=0==t?0:e.body.ret_timestamp-(new Date).getTime()),e.body.bigim_time_window&&"number"==typeof e.body.bigim_time_window&&(this.bigimTimeWindow=e.body.bigim_time_window),e.body.dati_time_window&&"number"==typeof e.body.dati_time_window&&(this.datiTimeWindow=e.body.dati_time_window),e.body.trans_seqs)for(var o=0;o<e.body.trans_seqs.length;o++){var n=e.body.trans_seqs[o].trans_channel,i=e.body.trans_seqs[o].trans_seq_list||e.body.trans_seqs[o].trans_seq_array;0<(i=(i=i.filter((function(e){var t=e.trans_type;return e=e.trans_seq,!r.transSeqMap[t]||r.transSeqMap[t].seq<e}))).map((function(e){return{trans_type:e.trans_type,trans_local_seq:e.trans_seq}}))).length&&this.fetchReliableMessage(n,i)}},K.prototype.sendReliableMessage=function(e,t,r,o){var n=this;this.logger.info(c+" call"),this.room.isLogin()?this.isReliable?(this.logger.error(c+" send too often"),o(q)):(this.transSeqMap[e]||(this.transSeqMap[e]={seq:0}),t={trans_type:e,trans_data:t,trans_local_seq:this.transSeqMap[e].seq,trans_channel:"clt"},this.isReliable=!0,this.serviceHandler.sendReliableMessage(t,(function(t){n.transSeqMap[e].seq=t.body.trans_seq,n.logger.info(c+" trans "+e+" seq "+t.body.trans_seq),n.isReliable=!1,r({seq:t.header.seq,errorCode:0})}),(function(e){var t=I;e.body&&e.body.err_code?(t=n.rtm.getServerError(e.body.err_code),n.logger.error(g+"  "+t.msg)):t=e,n.isReliable=!1,o(t)}),this.room)):(this.logger.error(c+" state error"),o&&o(b))},K.prototype.fetchReliableMessage=function(e,t){function r(e){o.handleFetchTransRsp(e,n)}var o=this,n=(e={trans_channel:e,fetch_array:t},this.stateCenter.reporter.createSpan(s.H,{key:"/sdk/login",par:this.room.roomID},{key:""},"/liveroom/get_room_extrainfo"));n.setAttributes({fetch_array:G(t)}),this.serviceHandler.fetchReliableMessage(e,r,r,this.room),this.logger.info("zm.msg.frm call success")},K.prototype.handleFetchTransRsp=function(e,t){if(e.body&&0!=e.body.err_code)this.logger.error(d+" trans send error "+e.body.err_code),this.stateCenter.tracer.setError(t,{code:e.body.err_code});else if(e.header&&e.body){var r=e.body.trans_list||e.body.trans_fetch_results,o=[],n=[];if(Array.isArray(r)&&0<r.length){for(var i=0;i<r.length;i++){var s,a,u=r[i];1000001109===u.err_code?this.logger.warn(d+" fetch trans unknown type "+u.err_code):(n.push({trans_type:s=u.trans_type,trans_seq:a=u.trans_seq}),1000001110===u.err_code?(this.logger.warn(d+" fetch trans seq is wrong "+u.err_code),this.transSeqMap[s]={seq:a}):!this.transSeqMap[s]||this.transSeqMap[s].seq<a?(this.transSeqMap[s]={seq:a},o.push(u)):this.logger.warn(d+" fetch trans seq wrong"))}0<o.length&&this.onRecvReliableMessage(o)}t.setAttributes({result_array:z(n)}),t.end()}else this.logger.error(d+" trans send error "+e),this.stateCenter.tracer.setError(t,E)},K.prototype.handlePushTransMsg=function(e){var t,r=e.body.trans_type,o=e.body.trans_seq;!this.transSeqMap[r]||this.transSeqMap[r].seq<o?(this.transSeqMap[r]={seq:o},(null==(t=null==e?void 0:e.body)?void 0:t.trans_idname)!==this.stateCenter.idName&&(null==(t=null==e?void 0:e.body)?void 0:t.id_name)!==this.stateCenter.idName?this.onRecvReliableMessage([e.body]):this.logger.warn(p+" id name same")):this.logger.warn(p+" trans seq wrong"),this.logger.info(p+" trans "+r+" seq "+o)},K.prototype.sendRoomMsg=function(e,t,r,o,n,i){var s=this;if(!this.room.isLogin())return this.logger.error(g+" state error"),i(b),!1;var a=Date.parse(new Date+"");return 0<this.sendRoomMsgTime&&this.sendRoomMsgTime+this.sendRoomMsgInterval>a?(this.logger.info(g+" freq error"),i&&i(P,0,e,o),!1):(this.sendRoomMsgTime=a,a=this.serviceHandler.sendRoomMsg({msg_category:e,msg_type:1,msg_priority:1,msg_content:o},(function(e){n({seq:e.header.seq,errorCode:0,messageID:e.body.msg_id})}),(function(e){var t,r,o=I;e.header&&e.body?(r=(t=[s.rtm.getServerError(e.body.err_code),e.body.msg_id])[1],s.logger.error(g+"  "+(o=t[0]).msg),i({seq:e.header.seq,errorCode:(o=o==E?R:o).code,messageID:r})):(e.code&&e.msg&&(o=e),i({seq:0,errorCode:o.code,messageID:0}))}),this.room),this.stateCenter.reporter.spanSetAttributes({key:O,par:null==(e=this.room)?void 0:e.roomID},{send_seq:A(a)}),this.logger.info(g+"  call success"),!0)},K.prototype.handlePushRoomMsg=function(e){var t,r=[];this.isUseNetAgent&&(t=e.body.msg_list,e.body.msg_list.forEach((function(e){e={fromUser:{userID:e.id_name,userName:e.nick_name},message:e.msg_content,sendTime:e.send_time.toNumber(),messageID:e.msg_id.toNumber()},r.push(e)})),e.body.server_msg_id=e.body.server_msg_id.toNumber(),e.body.ret_msg_id=e.body.ret_msg_id.toNumber()),this.stateCenter.actionListener("IMRecvBroadcastMessage",this.room.roomID,r),this.stateCenter.actionListener("_recvRoomMsg",t,e.body.server_msg_id,e.body.ret_msg_id)},K.prototype.sendCustomCommand=function(e,t,r,o){var n,i=this;return this.room.isLogin()?(t={from_userid:this.stateCenter.idName,from_username:this.stateCenter.nickName,request_id:this.stateCenter.getRequestId(),custom_content:t||"",room_id:this.room.roomID},this.stateCenter.reporter.spanSetAttributes({key:L,par:null==(n=this.room)?void 0:n.roomID},{request_id:k(t.request_id)}),n={dest_id_name:e,custom_msg:JSON.stringify(t)},this.serviceHandler.sendCustomCommand(n,(function(e){r({seq:e.header.seq,errorCode:0})}),(function(e){var t,r=i.rtm.getServerError(e.body.err_code);i.logger.error(m+" "+r.msg),t=2===(null==(t=e.body)?void 0:t.err_code)||1000000002===(null==(t=e.body)?void 0:t.err_code)?S:r==E?R:r,o({seq:e.header.seq,errorCode:t.code,code:t.code})}),this.room),this.logger.info(m+" call success"),!0):(this.logger.error(m+" state error"),o(b),!1)},K.prototype.handlePushCustomMsg=function(e){e=[(e=JSON.parse(e.body.custommsg)).from_userid,e.from_username,e.room_id,e.custom_content],this.stateCenter.actionListener("IMRecvCustomCommand",e[2],{userID:e[0],userName:e[1]},e[3])},K.prototype.sendBigRoomMessage=function(e,t,r,o,n,i){var s,a,u,l,h=this;this.room.isLogin()?(s=this.bigimTimeWindow,a=this.serverTimeOffset,u=(new Date).getTime()+a,l=this.rtm.getSeq().toString(),this.bigImCallbackMap[l]={success:n,error:i},0==s?this.sendBigRoomMessageInternal([{msg_category:e,msg_type:1,msg_content:o,bigmsg_client_id:l}],(function(e){h.handleBigImMsgRsp(e)}),(function(e){i&&i(e)})):(n=Math.floor(u/s),this.bigImLastTimeIndex<n&&0==this.bigIMmessageList.length?(this.bigImLastTimeIndex=n,this.sendBigRoomMessageInternal([{msg_category:e,msg_type:1,msg_content:o,bigmsg_client_id:l}],(function(e){h.handleBigImMsgRsp(e)}),(function(e){i&&i(e)}))):(this.bigIMmessageList.push({msg_category:e,msg_type:1,msg_content:o,bigmsg_client_id:l}),1==this.bigIMmessageList.length&&this.setBigImTimer(a,s)))):(this.logger.error(f+" state error"),i&&i(b))},K.prototype.sendBigRoomMessageInternal=function(e,t,r){this.serviceHandler.sendBigRoomMessage({msgs:e},(function(e){t(e)}),(function(e){var t=I;e.header&&e.body||(e.code&&e.msg&&(t=e),r(t)),r(t)}),this.room),this.logger.info(f+" sendBigRoomMessage called")},K.prototype.handleBigImMsgRsp=function(e){this.bigimTimeWindow=e.body.bigim_time_window;for(var t=e.body.msg_list||e.body.msgs,r=0;r<t.length;r++){var o,n=t[r].msg_client_id||t[r].bigmsg_client_id;this.bigImCallbackMap[n]&&(null!=(o=this.bigImCallbackMap[n].success)&&o({seq:e.header.seq,errorCode:0,messageID:t[r].msg_id||t[r].bigmsg_id}),delete this.bigImCallbackMap[n])}},K.prototype.setBigImTimer=function(e,t){var r=this;e=t-((new Date).getTime()+e)%t,t=this.rtm.generateRandumNumber(t)+e,this.bigImTimer=setTimeout((function(){r.onBigImTimer()}),t)},K.prototype.onBigImTimer=function(){for(var e=this,t=(new Date).getTime()+this.serverTimeOffset,r=(this.bigImLastTimeIndex=Math.floor(t/this.bigimTimeWindow),[]),o=[],n=0;n<this.bigIMmessageList.length&&!(20<=n);n++){var i=this.bigIMmessageList[n];r.push({msg_category:i.msg_category,msg_type:i.msg_type,msg_content:i.msg_content,bigmsg_client_id:i.bigmsg_client_id}),o.push(i.bigmsg_client_id)}20<this.bigIMmessageList.length?this.bigIMmessageList.splice(0,20):this.bigIMmessageList=[],this.sendBigRoomMessageInternal(r,(function(t){e.handleBigImMsgRsp(t)}),(function(t,r){for(var n=0;n<o.length;n++){var i=o[n],s=e.bigImCallbackMap[i];s&&(null!=s.error&&s.error(t,r),delete e.bigImCallbackMap[i])}})),this.bigImTimer&&clearTimeout(this.bigImTimer),this.bigImTimer=null,0<this.bigIMmessageList.length&&this.setBigImTimer(this.serverTimeOffset,this.bigimTimeWindow)},K.prototype.handlePushMergeMsg=function(e){for(var t=e.body.message_list||e.body.messages,r=0;r<t.length;r++)14001===t[r].sub_cmd&&this.handlePushBigRooMsg(t[r].msg_body)},K.prototype.handlePushBigRooMsg=function(e){var t;if("string"==typeof e)try{t=JSON.parse(e)}catch(e){return void this.logger.warn(_+"parse json error")}else t=e;if(t){e=t.room_id||this.room.roomID;for(var r=[],o=t.msg_list||t.msg_data,n=0;n<o.length;n++){var i=o[n];i.id_name==this.stateCenter.idName?this.logger.info(_+" self message"):r.push({idName:i.id_name,nickName:i.nick_name,messageId:i.msg_id||i.bigmsg_id,category:i.msg_category,type:i.msg_type,content:i.msg_content,time:i.send_time||F.a.isLong(i.msg_timestamp)&&i.msg_timestamp.toNumber()})}0==r.length?this.logger.info(_+" no other pushData except self"):this.onRecvBigRoomMessage(r,e),this.logger.info(_+"call success")}else this.logger.warn(_+" cann't find message body")},K.prototype.onRecvBigRoomMessage=function(e,t){var r=[];e.forEach((function(e){r.push(e={fromUser:{userID:e.idName,userName:e.nickName},message:e.content,sendTime:e.time,messageID:e.messageId})})),this.stateCenter.actionListener("IMRecvBarrageMessage",t,r),this.stateCenter.actionListener("_recvBigRoomMessage",e,t)},K.prototype.resetMessageInfo=function(){this.transSeqMap={},this.realyMessageList=[],this.relayTimer&&(clearTimeout(this.relayTimer),this.relayTimer=null),this.bigImLastTimeIndex=0,this.bigIMmessageList=[],this.bigImCallbackMap={},this.bigImTimer&&(clearTimeout(this.bigImTimer),this.bigImTimer=null),this.serverTimeOffset=0,this.datiTimeWindow=0,this.bigimTimeWindow=0},K.prototype.sendRelayMessage=function(e,t,r,o){var n=this.datiTimeWindow,i=this.serverTimeOffset;0<n?(this.realyMessageList.push({type:e,data:t,success:r,error:o}),1==this.realyMessageList.length&&this.setRelayTimer(i,n)):this.sendRelayMessageInternal(e,t,r,o)},K.prototype.sendRelayMessageInternal=function(e,t,r,o){var n=this;this.logger.info(y+" call"),this.serviceHandler.sendRelayMessage(e={relay_type:e,relay_data:t},(function(e){r&&r(e.header.seq,e.body.relay_result)}),(function(e){var t=I;e.header&&e.body?o&&o(n.rtm.getServerError(e.body.err_code),e.header.seq):(e.code&&e.msg&&(t=e),o&&o(t,0))}),t=this.room)},K.prototype.setRelayTimer=function(e,t){var r=this;e=(new Date).getTime()+e,e=this.rtm.generateRandumNumber(2*t-e%t),this.logger.info(y+" setTimer "+e),this.relayTimer=setTimeout((function(){r.onRelayTimer()}),e)},K.prototype.onRelayTimer=function(){var e;0==this.realyMessageList.length?this.logger.info(y+"  no relay data"):(this.sendRelayMessageInternal((e=this.realyMessageList[0]).type,e.data,e.success,e.error),this.relayTimer&&clearTimeout(this.relayTimer),this.relayTimer=null,this.realyMessageList.splice(0,1),0<this.realyMessageList.length&&this.setRelayTimer(this.serverTimeOffset,this.datiTimeWindow))},K);function K(e,t,r,o,n,i,s){var a=this;this.logger=e,this.stateCenter=t,this.dataReport=r,this.service=o,this.liveRoomHandler=n,this.rtm=i,this.room=s,this.sendRoomMsgTime=0,this.sendRoomMsgInterval=500,this.bigImCallbackMap={},this.bigImLastTimeIndex=0,this.bigIMmessageList=[],this.bigImTimer=null,this.relayTimer=null,this.serverTimeOffset=0,this.datiTimeWindow=0,this.bigimTimeWindow=0,this.isReliable=!1,this.transSeqMap={},this.onRecvReliableMessage=function(e){var t=e.map((function(e){return{key:e.trans_type,value:e.trans_data,updateUser:{userID:e.id_name||e.trans_idname,userName:e.nick_name||e.trans_nickname},updateTime:F.a.isLong(e.trans_send_time)?e.trans_send_time.toNumber():e.trans_send_time}}));0<t.length&&a.stateCenter.actionListener("roomExtraInfoUpdate",a.room.roomID,t),e.forEach((function(e){a.stateCenter.actionListener("recvReliableMessage",e.trans_type,e.trans_seq,e.trans_data)}))},this.realyMessageList=[]}function $(e,t,r,o){var n=this;return void 0===r&&(r=1),void 0===o&&(o=1),new Promise((function(i,s){var a,l=n.getMsgSpan(O,e,!0),h=(s=n.stateCenter.proxyRes(l,(function(e){l.setAttributes({msg_id:w(e.messageID)}),i(e)}),s)).interResolve;s=s.interReject,"string"!=typeof e||""==e?(n.logger.error(u+" roomid must be string and not empty"),s(D.INPUT_PARAM," param roomID error")):void 0===t||""==t?(n.logger.error(u+" message is empty"),s(D.IM_CONTENT_NULL)):"string"!=typeof t?(n.logger.error(u+" message must be string"),s(D.INPUT_PARAM," param message error")):1024<t.length?(n.logger.error(u+" message too long"),s(D.IM_CONTENT_TOO_LONG)):(a=n.getRoomModules(e),l.setAttributes({send_seq:A(),msg_content:t}),a?a.messageHandler.sendRoomMsg(r,o,e,t,(function(e){e.messageID&&l.setAttributes({msg_id:e.messageID}),h(e)}),s):s(D.ROOM_NOT_EXIST))}))}function Q(e,t,r){var o=this;return new Promise((function(n,i){var s,u,l=o.getMsgSpan(L,e,!0);i=(n=o.stateCenter.proxyRes(l,n,i)).interResolve,n=n.interReject,"string"!=typeof e||""==e?(o.logger.error(a+" roomid must be string and not empty"),n(S," param roomID error")):r instanceof Array&&!r.find((function(e){return"string"!=typeof e}))?"string"!=typeof t&&"object"!=typeof t?(o.logger.error(a+" custom content must be a non empty string or object"),n(N.INPUT_PARAM," param command error")):"string"==typeof t&&1024<t.length?(o.logger.error(a+" command too long"),n(N.IM_CONTENT_TOO_LONG)):(s=o.getRoomModules(e),u="string"==typeof t?t:JSON.stringify(t),l.setAttributes({msg_content:u}),s?s.messageHandler.sendCustomCommand(r,t,i,n):n(N.ROOM_NOT_EXIST)):(o.logger.error(a+" dstMembers must be string array"),n(N.INPUT_PARAM," param toUserList error"))}))}function X(e,t,r,o){var n=this;return void 0===r&&(r=1),void 0===o&&(o=1),new Promise((function(i,s){var a=n.getMsgSpan("/liveroom/send_big_room_message",e);s=(i=n.stateCenter.proxyRes(a,i,s)).interResolve,i=i.interReject,"string"!=typeof e||""==e?(n.logger.error(h+" roomid must be string and not empty"),i(M.INPUT_PARAM," param roomID error")):void 0===t||""==t?(n.logger.error(h+" message is empty"),i(M.IM_CONTENT_NULL)):"string"!=typeof t?(n.logger.error(h+" message must be string"),i(M.INPUT_PARAM," param message error")):1024<t.length?(n.logger.error(h+" message too long"),i(M.IM_CONTENT_TOO_LONG)):(a.setAttributes({msg_content:t}),(a=n.getRoomModules(e))?a.messageHandler.sendBigRoomMessage(r,o,e,t,s,i):i(M.ROOM_NOT_EXIST))}))}function Z(e,t,r){var o=this;return new Promise((function(n,i){var s=o.getMsgSpan("/liveroom/set_room_extrainfo",e),a=(n=o.stateCenter.proxyRes(s,n,(function(e){o.stateCenter.useNetAgent&&1015===e.errorCode&&(e.errorCode=1002017),i(e)}))).interResolve;n=n.interReject,"string"!=typeof e||""==e?(o.logger.error(u+" roomid must be string and not empty"),n(D.INPUT_PARAM," param roomID error")):t&&"string"==typeof t?128<t.length?(o.logger.error(l+" type is too long"),n({errorCode:H.code})):r&&"string"==typeof r?4096<r.length?(o.logger.error(l+" type is too long"),n({errorCode:H.code})):(s.setAttributes({key:U(t),value:x(r)}),(s=o.getRoomModules(e))?s.messageHandler.sendReliableMessage(t,r,a,n):n(B)):(o.logger.error(l+" data must be string"),n({errorCode:H.code})):(o.logger.error(l+" type must be string"),n({errorCode:H.code}))}))}var J={_sendBroadcastMessage:$,sendBroadcastMessage:function(e,t){var r=this;return new Promise((function(o,n){$.call(r,e,t).then((function(e){o({errorCode:e.errorCode,messageID:e.messageID,extendedData:e.extendedData})})).catch((function(e){n(e)}))}))},_sendCustomCommand:Q,sendCustomCommand:function(e,t,r){var o=this;return new Promise((function(n,i){Q.call(o,e,t,r).then((function(e){n({errorCode:e.errorCode,extendedData:e.extendedData})})).catch((function(e){i(e)}))}))},_sendBarrageMessage:X,sendBarrageMessage:function(e,t){var r=this;return new Promise((function(o,n){X.call(r,e,t).then((function(e){o({errorCode:e.errorCode,messageID:e.messageID,extendedData:e.extendedData})})).catch((function(e){n(e)}))}))},_setRoomExtraInfo:Z,setRoomExtraInfo:function(e,t,r){return Z.call(this,e,t,r)},sendRelayMessage:function(e,t,r,o,n){(n=this.getRoomModules(n)||this.stateCenter.roomModulesList[0])?n.messageHandler.sendRelayMessage(e,t,r,o):o&&o(T,0)}},ee={handlePushRoomMsg:function(e){(e=this.handlePushMsg(e))[0].messageHandler.handlePushRoomMsg(e=e[1])},handlePushCustomMsg:function(e){(e=this.handlePushMsg(e))[0].messageHandler.handlePushCustomMsg(e=e[1])},handlePushMergeMsg:function(e){var t=null==(t=null==e?void 0:e.header)?void 0:t.room_id;(t=this.rtm.getRoomModules(t))?t.messageHandler.handlePushMergeMsg(e):this.logger.error(v+" room no found ignore "+JSON.stringify(e))},handlePushTransMsg:function(e){var t,r=(o=this.handlePushMsg(e))[0],o=o[1],n=null==(n=null==e?void 0:e.header)?void 0:n.room_id;(n=this.rtm.getMsgSpan("/liveroom/recv_room_extrainfo",n)).setAttributes({trans_type:V(null==(t=null==e?void 0:e.body)?void 0:t.trans_type),trans_seq:W(null==(t=null==e?void 0:e.body)?void 0:t.trans_seq)}),n.end(),r.messageHandler.handlePushTransMsg(o)},handleBigImMsgRsp:function(e){var t=null==(t=null==e?void 0:e.header)?void 0:t.room_id;(t=this.rtm.getRoomModules(t))?t.messageHandler.handleBigImMsgRsp(e):this.logger.error(v+" room no found ignore "+JSON.stringify(e))},handlePushMsg:function(e){var t=null==(t=null==e?void 0:e.header)?void 0:t.room_id;if(t=this.rtm.getRoomModules(t))return[t,e];this.logger.error(v+" room no found ignore "+JSON.stringify(e))}},te={initMessageHandler:function(){this.messageHandler=new Y(this.logger,this.stateCenter,this.dataReport,this.service,this.liveRoomHandler,this.rtm,this)}};t.default={type:"message",install:function(e,t,r,o){for(var n in J)Object.defineProperty(e.prototype,n,{value:J[n],writable:!1});for(var n in ee)Object.defineProperty(r.prototype,n,{value:ee[n],writable:!1}),Object.defineProperty(o.prototype,n,{value:ee[n],writable:!1});for(var n in te)Object.defineProperty(t.prototype,n,{value:te[n],writable:!1})}}},3:function(e,t,r){var o=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=null;try{t=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(e){}function r(e,t,r){this.low=0|e,this.high=0|t,this.unsigned=!!r}function o(e){return!0===(e&&e.__isLong__)}function n(e){var t=Math.clz32(e&-e);return e?31-t:t}Object.defineProperty(r.prototype,"__isLong__",{value:!0}),r.isLong=o;var i={},s={};function a(e,t){var r,o,n;return t?(n=0<=(e>>>=0)&&e<256)&&(o=s[e])?o:(r=l(e,0,!0),n&&(s[e]=r),r):(n=-128<=(e|=0)&&e<128)&&(o=i[e])?o:(r=l(e,e<0?-1:0,!1),n&&(i[e]=r),r)}function u(e,t){if(isNaN(e))return t?y:_;if(t){if(e<0)return y;if(g<=e)return C}else{if(e<=-m)return R;if(m<=e+1)return b}return e<0?u(-e,t).neg():l(e%p|0,e/p|0,t)}function l(e,t,o){return new r(e,t,o)}r.fromInt=a,r.fromNumber=u,r.fromBits=l;var h=Math.pow;function c(e,t,r){if(0===e.length)throw Error("empty string");if(t="number"==typeof t?(r=t,!1):!!t,"NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return t?y:_;if((r=r||10)<2||36<r)throw RangeError("radix");var o;if(0<(o=e.indexOf("-")))throw Error("interior hyphen");if(0===o)return c(e.substring(1),t,r).neg();for(var n=u(h(r,8)),i=_,s=0;s<e.length;s+=8){var a=Math.min(8,e.length-s),l=parseInt(e.substring(s,s+a),r);i=(a<8?(a=u(h(r,a)),i.mul(a)):i=i.mul(n)).add(u(l))}return i.unsigned=t,i}function d(e,t){return"number"==typeof e?u(e,t):"string"==typeof e?c(e,t):l(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}r.fromString=c,r.fromValue=d;var p=4294967296,g=p*p,m=g/2,f=a(1<<24),_=a(0),y=(r.ZERO=_,a(0,!0)),v=(r.UZERO=y,a(1)),S=(r.ONE=v,a(1,!0)),E=(r.UONE=S,a(-1)),b=(r.NEG_ONE=E,l(-1,2147483647,!1)),C=(r.MAX_VALUE=b,l(-1,-1,!0)),R=(r.MAX_UNSIGNED_VALUE=C,l(0,-2147483648,!1)),T=(r.MIN_VALUE=R,r.prototype);return T.toInt=function(){return this.unsigned?this.low>>>0:this.low},T.toNumber=function(){return this.unsigned?(this.high>>>0)*p+(this.low>>>0):this.high*p+(this.low>>>0)},T.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";var t,r;if(this.isNegative())return this.eq(R)?(r=u(e),r=(t=this.div(r)).mul(r).sub(this),t.toString(e)+r.toInt().toString(e)):"-"+this.neg().toString(e);for(var o=u(h(e,6),this.unsigned),n=this,i="";;){var s=n.div(o),a=(n.sub(s.mul(o)).toInt()>>>0).toString(e);if((n=s).isZero())return a+i;for(;a.length<6;)a="0"+a;i=""+a+i}},T.getHighBits=function(){return this.high},T.getHighBitsUnsigned=function(){return this.high>>>0},T.getLowBits=function(){return this.low},T.getLowBitsUnsigned=function(){return this.low>>>0},T.getNumBitsAbs=function(){if(this.isNegative())return this.eq(R)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;0<t&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},T.isZero=function(){return 0===this.high&&0===this.low},T.eqz=T.isZero,T.isNegative=function(){return!this.unsigned&&this.high<0},T.isPositive=function(){return this.unsigned||0<=this.high},T.isOdd=function(){return 1==(1&this.low)},T.isEven=function(){return 0==(1&this.low)},T.equals=function(e){return o(e)||(e=d(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},T.eq=T.equals,T.notEquals=function(e){return!this.eq(e)},T.neq=T.notEquals,T.ne=T.notEquals,T.lessThan=function(e){return this.comp(e)<0},T.lt=T.lessThan,T.lessThanOrEqual=function(e){return this.comp(e)<=0},T.lte=T.lessThanOrEqual,T.le=T.lessThanOrEqual,T.greaterThan=function(e){return 0<this.comp(e)},T.gt=T.greaterThan,T.greaterThanOrEqual=function(e){return 0<=this.comp(e)},T.gte=T.greaterThanOrEqual,T.ge=T.greaterThanOrEqual,T.compare=function(e){var t,r;return o(e)||(e=d(e)),this.eq(e)?0:(t=this.isNegative(),r=e.isNegative(),t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1)},T.comp=T.compare,T.negate=function(){return!this.unsigned&&this.eq(R)?R:this.not().add(v)},T.neg=T.negate,T.add=function(e){o(e)||(e=d(e));var t=0,r=0,n=0,i=0;return r+=(n=n+((i+=(65535&this.low)+(65535&e.low))>>>16)+((this.low>>>16)+(e.low>>>16)))>>>16,l((n&=65535)<<16|(i&=65535),((t+=(r+=(65535&this.high)+(65535&e.high))>>>16)+((this.high>>>16)+(e.high>>>16))&65535)<<16|(r&=65535),this.unsigned)},T.subtract=function(e){return o(e)||(e=d(e)),this.add(e.neg())},T.sub=T.subtract,T.multiply=function(e){var r,n,i,s,a,h,c,p,g,m;return this.isZero()?this:(o(e)||(e=d(e)),t?l(t.mul(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):e.isZero()?this.unsigned?y:_:this.eq(R)?e.isOdd()?R:_:e.eq(R)?this.isOdd()?R:_:this.isNegative()?e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg():e.isNegative()?this.mul(e.neg()).neg():this.lt(f)&&e.lt(f)?u(this.toNumber()*e.toNumber(),this.unsigned):(s=e.high>>>16,a=65535&e.high,h=e.low>>>16,m=(m=g=p=c=0)+((p=p+((g+=(i=65535&this.low)*(e=65535&e.low))>>>16)+(n=this.low>>>16)*e)>>>16)+((p=(65535&p)+i*h)>>>16),l((p&=65535)<<16|(g&=65535),(c=(c=(c+=(m+=(r=65535&this.high)*e)>>>16)+((m=(65535&m)+n*h)>>>16)+((m=(65535&m)+i*a)>>>16))+((this.high>>>16)*e+r*h+n*a+i*s)&65535)<<16|(m&=65535),this.unsigned)))},T.mul=T.multiply,T.divide=function(e){if((e=o(e)?e:d(e)).isZero())throw Error("division by zero");var r,n,i;if(t)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?l((this.unsigned?t.div_u:t.div_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?y:_;if(this.unsigned){if((e=e.unsigned?e:e.toUnsigned()).gt(this))return y;if(e.gt(this.shru(1)))return S;n=y}else{if(this.eq(R))return e.eq(v)||e.eq(E)?R:e.eq(R)?v:(i=this.shr(1).div(e).shl(1)).eq(_)?e.isNegative()?v:E:(r=this.sub(e.mul(i)),i.add(r.div(e)));if(e.eq(R))return this.unsigned?y:_;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();n=_}for(r=this;r.gte(e);){i=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(i)/Math.LN2),a=s<=48?1:h(2,s-48),c=u(i),p=c.mul(e);p.isNegative()||p.gt(r);)p=(c=u(i-=a,this.unsigned)).mul(e);c.isZero()&&(c=v),n=n.add(c),r=r.sub(p)}return n},T.div=T.divide,T.modulo=function(e){return o(e)||(e=d(e)),t?l((this.unsigned?t.rem_u:t.rem_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},T.mod=T.modulo,T.rem=T.modulo,T.not=function(){return l(~this.low,~this.high,this.unsigned)},T.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},T.clz=T.countLeadingZeros,T.countTrailingZeros=function(){return this.low?n(this.low):n(this.high)+32},T.ctz=T.countTrailingZeros,T.and=function(e){return o(e)||(e=d(e)),l(this.low&e.low,this.high&e.high,this.unsigned)},T.or=function(e){return o(e)||(e=d(e)),l(this.low|e.low,this.high|e.high,this.unsigned)},T.xor=function(e){return o(e)||(e=d(e)),l(this.low^e.low,this.high^e.high,this.unsigned)},T.shiftLeft=function(e){return o(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?l(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):l(0,this.low<<e-32,this.unsigned)},T.shl=T.shiftLeft,T.shiftRight=function(e){return o(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?l(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):l(this.high>>e-32,0<=this.high?0:-1,this.unsigned)},T.shr=T.shiftRight,T.shiftRightUnsigned=function(e){return o(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?l(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):l(32===e?this.high:this.high>>>e-32,0,this.unsigned)},T.shru=T.shiftRightUnsigned,T.shr_u=T.shiftRightUnsigned,T.rotateLeft=function(e){var t;return o(e)&&(e=e.toInt()),0==(e&=63)?this:32===e?l(this.high,this.low,this.unsigned):e<32?l(this.low<<e|this.high>>>(t=32-e),this.high<<e|this.low>>>t,this.unsigned):l(this.high<<(e-=32)|this.low>>>(t=32-e),this.low<<e|this.high>>>t,this.unsigned)},T.rotl=T.rotateLeft,T.rotateRight=function(e){var t;return o(e)&&(e=e.toInt()),0==(e&=63)?this:32===e?l(this.high,this.low,this.unsigned):e<32?l(this.high<<(t=32-e)|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned):l(this.low<<(t=32-(e-=32))|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned)},T.rotr=T.rotateRight,T.toSigned=function(){return this.unsigned?l(this.low,this.high,!1):this},T.toUnsigned=function(){return this.unsigned?this:l(this.low,this.high,!0)},T.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},T.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},T.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},r.fromBytes=function(e,t,o){return o?r.fromBytesLE(e,t):r.fromBytesBE(e,t)},r.fromBytesLE=function(e,t){return new r(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},r.fromBytesBE=function(e,t){return new r(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)},e.default=r,"default"in e?e.default:e}({});void 0!==(t=function(){return o}.apply(t,[]))&&(e.exports=t)}},r={},e.m=t,e.c=r,e.d=function(t,r,o){e.o(t,r)||Object.defineProperty(t,r,{enumerable:!0,get:o})},e.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},e.t=function(t,r){if(1&r&&(t=e(t)),8&r)return t;if(4&r&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(e.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&r&&"string"!=typeof t)for(var n in t)e.d(o,n,function(e){return t[e]}.bind(null,n));return o},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},e.p="",e(e.s=17);function e(o){var n;return(r[o]||(n=r[o]={i:o,l:!1,exports:{}},t[o].call(n.exports,n,n.exports,e),n.l=!0,n)).exports}var t,r}()}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var r=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e].call(r.exports,r,r.exports,__webpack_require__),r.exports}__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=(e,t)=>{for(var r in t)__webpack_require__.o(t,r)&&!__webpack_require__.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__={};return(()=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{ZegoExpressEngine:()=>oo});var e,t,r=__webpack_require__(901);!function(e){e[e.debug=0]="debug",e[e.info=1]="info",e[e.warn=2]="warn",e[e.error=3]="error",e[e.report=99]="report",e[e.disable=100]="disable"}(e||(e={})),function(e){e[e.CN=2]="CN",e[e.NA=3]="NA",e[e.EU=4]="EU",e[e.AS=5]="AS",e[e.IN=6]="IN",e[e.NCN=7]="NCN"}(t||(t={}));var o,n;!function(e){e[e.disable=0]="disable",e[e.websocket=1]="websocket",e[e.https=2]="https"}(o||(o={})),function(e){e[e.SDKProject_Other=0]="SDKProject_Other",e[e.SDKProject_ZegoExpressVideo=1]="SDKProject_ZegoExpressVideo",e[e.SDKProject_ZegoExpressAudio=2]="SDKProject_ZegoExpressAudio",e[e.SDKProject_ZegoLiveRoom=3]="SDKProject_ZegoLiveRoom",e[e.SDKProject_ZegoAudioRoom=4]="SDKProject_ZegoAudioRoom",e[e.SDKProject_ZegoAVKit=5]="SDKProject_ZegoAVKit",e[e.SDKProject_ZegoWebRTC=6]="SDKProject_ZegoWebRTC",e[e.SDKProject_ZegoMiniProgram=7]="SDKProject_ZegoMiniProgram"}(n||(n={}));var i;!function(e){e[e.disconnected=0]="disconnected",e[e.connecting=1]="connecting",e[e.connected=2]="connected"}(i||(i={}));var s,a,u,l=6,h=7,c=0,d=1,p=2;!function(e){e[e.tryProbe=0]="tryProbe",e[e.probed=2]="probed"}(s||(s={})),function(e){e[e.CDN=0]="CDN",e[e.RTC=1]="RTC",e[e.L3=2]="L3",e[e.DG=3]="DG"}(a||(a={})),function(e){e[e.UDP=0]="UDP",e[e.RTMP=1]="RTMP",e[e.FLV=2]="FLV",e[e.HLS=3]="HLS",e[e.WEBRTC=4]="WEBRTC"}(u||(u={}));var g,m,f,_=1,y=2,v=3,S=4,E=2001,b=2002,C=2003,R=1,T=0;!function(e){e[e.logout=0]="logout",e[e.trylogin=1]="trylogin",e[e.login=2]="login"}(g||(g={})),function(e){e[e.logout=0]="logout",e[e.trylogin=1]="trylogin",e[e.login=2]="login",e[e.reconnect=3]="reconnect"}(m||(m={})),function(e){e[e.offline=0]="offline",e[e.online=1]="online"}(f||(f={}));var I;!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.CDN=1]="CDN",e[e.RTC=2]="RTC",e[e.L3=3]="L3"}(I||(I={}));var P,M=12001,L=12002,k=12003,N=1,O=2,A=3;!function(e){e[e.low=1]="low",e[e.stantard=2]="stantard",e[e.hight=3]="hight",e[e.custome=4]="custome"}(P||(P={}));var w,D,U,x,H,q;!function(e){e[e.captureFpsToLow=1001]="captureFpsToLow",e[e.captureVolumeToLow=1002]="captureVolumeToLow",e[e.sendVideoBitrateToLow=1003]="sendVideoBitrateToLow",e[e.sendFpsToLow=1004]="sendFpsToLow",e[e.sendAudioBitrateToLow=1005]="sendAudioBitrateToLow",e[e.receiveVolumeToLow=1006]="receiveVolumeToLow",e[e.receiveAudioDecodedFail=1007]="receiveAudioDecodedFail",e[e.receiveVideoDecodedFail=1008]="receiveVideoDecodedFail",e[e.receiveVideoFpsDecodedToLow=1009]="receiveVideoFpsDecodedToLow",e[e.renderVideoFpsToLow=1010]="renderVideoFpsToLow",e[e.captureFpsNormal=2001]="captureFpsNormal",e[e.captureVolumeNormal=2002]="captureVolumeNormal",e[e.sendVideoBitrateNormal=2003]="sendVideoBitrateNormal",e[e.sendFpsNormal=2004]="sendFpsNormal",e[e.sendAudioBitrateNormal=2005]="sendAudioBitrateNormal",e[e.receiveVolumeNormal=2006]="receiveVolumeNormal",e[e.receiveAudioDecodedNormal=2007]="receiveAudioDecodedNormal",e[e.receiveVideoDecodedNormal=2008]="receiveVideoDecodedNormal",e[e.receiveVideoFpsDecodedNormal=2009]="receiveVideoFpsDecodedNormal",e[e.renderVideoFpsNormal=2010]="renderVideoFpsNormal"}(w||(w={})),function(e){e[e.cdn=0]="cdn",e[e.ultra=1]="ultra"}(D||(D={})),function(e){e[e.stop=0]="stop",e[e.start=1]="start"}(U||(U={})),function(e){e[e.cdn=0]="cdn",e[e.ultra=1]="ultra",e[e.customUrl=2]="customUrl"}(x||(x={})),function(e){e[e.CDN=0]="CDN",e[e.BGP=1]="BGP"}(H||(H={})),function(e){e[e.ClientType_None=0]="ClientType_None",e[e.ClientType_H5=1]="ClientType_H5",e[e.ClientType_SmallPragram=2]="ClientType_SmallPragram",e[e.ClientType_Webrtc=3]="ClientType_Webrtc"}(q||(q={}));var B,G,z,V,W,j,F,Y,K,$,Q,X=function(){function e(e,t){void 0===e&&(e=null),void 0===t&&(t=null),this._id=null,this.next=null,this.prev=null,this._id=e,this._data=t}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id?this._id:null},set:function(e){this._id=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(e){this._data=e},enumerable:!1,configurable:!0}),e.prototype.hasNext=function(){return this.next&&this.next.id},e.prototype.hasPrev=function(){return this.prev&&this.prev.id},e}(),Z=(function(){function e(){this.start=new X,this.end=new X,this._idCounter=0,this._numNodes=0,this.start.next=this.end,this.start.prev=null,this.end.prev=this.start,this.end.next=null}e.prototype.insertBefore=function(e,t){var r=new X(this._idCounter,t);return r.next=e,r.prev=e.prev,e.prev&&(e.prev.next=r),e.prev=r,++this._idCounter,++this._numNodes,r},e.prototype.addLast=function(e){return this.insertBefore(this.end,e)},e.prototype.add=function(e){return this.addLast(e)},e.prototype.getFirst=function(){return 0===this._numNodes?null:this.start.next},e.prototype.getLast=function(){return 0===this._numNodes?null:this.end.prev},e.prototype.size=function(){return this._numNodes},e.prototype.getFromFirst=function(e){var t=0,r=this.start.next;if(e>=0)for(;t<e&&null!==r;)r=r.next,++t;else r=null;if(null===r)throw"Index out of bounds.";return r},e.prototype.get=function(e){return 0===e?this.getFirst():e===this._numNodes-1?this.getLast():this.getFromFirst(e)},e.prototype.remove=function(e){return e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),--this._numNodes,e},e.prototype.removeFirst=function(){var e=null;return this._numNodes>0&&this.start.next&&(e=this.remove(this.start.next)),e},e.prototype.removeLast=function(){var e=null;return this._numNodes>0&&this.end.prev&&(e=this.remove(this.end.prev)),e},e.prototype.removeAll=function(){this.start.next=this.end,this.end.prev=this.start,this._numNodes=0,this._idCounter=0},e.prototype.each=function(e){for(var t=this.start;t.hasNext();)e(t=t.next)},e.prototype.find=function(e){for(var t=this.start,r=!1,o=null;t.hasNext()&&!r;)e(t=t.next)&&(o=t,r=!0);return o},e.prototype.map=function(e){for(var t=this.start,r=[];t.hasNext();)e(t=t.next)&&r.push(t);return r},e.prototype.push=function(e){return this.addLast(e)},e.prototype.unshift=function(e){this.insertBefore(this._numNodes>0?this.start.next:this.end,e)},e.prototype.pop=function(){return this.removeLast()},e.prototype.shift=function(){return this.removeFirst()}}(),0),J=1,ee=2,te=1,re=2,oe="eventStart",ne="addEventMsg",ie="eventEnd",se="addMsgInfo";!function(e){e[e.Unknown=-1]="Unknown",e[e.Excellent=0]="Excellent",e[e.Good=1]="Good",e[e.Middle=2]="Middle",e[e.Poor=3]="Poor",e[e.Die=4]="Die"}(B||(B={})),function(e){e[e.MinQuality=0]="MinQuality",e[e.DieQuality=0]="DieQuality",e[e.PoorMinQuality=1]="PoorMinQuality",e[e.MiddleMinQuality=30]="MiddleMinQuality",e[e.GoodMinQuality=60]="GoodMinQuality",e[e.ExcellentMinQuality=85]="ExcellentMinQuality",e[e.MaxQuality=100]="MaxQuality"}(G||(G={})),function(e){e[e.ZegoDefined=0]="ZegoDefined",e[e.UserUnregister=1]="UserUnregister"}(z||(z={})),function(e){e[e.CDN=0]="CDN",e[e.L3=1]="L3"}(V||(V={})),function(e){e[e.RTC=0]="RTC",e[e.CDN=1]="CDN",e[e.L3=2]="L3",e[e.DG=3]="DG"}(W||(W={})),function(e){e[e.PortraitSegmentation=0]="PortraitSegmentation"}(j||(j={})),function(e){e[e.Default=3]="Default",e[e.StandardVideoCall=4]="StandardVideoCall",e[e.HighVideoCall=5]="HighVideoCall",e[e.StandardChatroom=6]="StandardChatroom",e[e.HighQualityChatroom=7]="HighQualityChatroom",e[e.Broadcast=8]="Broadcast"}(F||(F={})),function(e){e[e.I=0]="I",e[e.H=10]="H",e[e.M=100]="M",e[e.L=1e3]="L"}(Y||(Y={})),function(e){e[e.BASE_LINE=1]="BASE_LINE",e[e.MAIN=2]="MAIN",e[e.HIGH=3]="HIGH"}(K||(K={})),function(e){e.ONLY_BASELINE="only_baseline",e.HARD_SOFT_ENCODEC_FIRST="hard_or_soft_encodec_first",e.HIGH_PROFILE_FIRST="high_profile_first"}($||($={})),function(e){e[e.useAnalyzer=0]="useAnalyzer",e[e.useWorklet=1]="useWorklet"}(Q||(Q={}));var ae,ue="zw.w.opsuh",le="zw.w.sppst.1",he="zw.w.bl",ce="zw.w.dl",de="zw.w.scsu",pe="zw.pu.sppst.0",ge="zw.pu.sps.0",me="zw.pu.sps.0.0",fe="zw.pu.fpsu.0",_e="zw.pu.hfspur.0",ye="zw.pu.dps.0",ve="zw.pl.sps.1",Se="zw.pl.sps.1.0",Ee="zw.pl.spsfc",be="zw.pl.fpsu",Ce="zw.pl.hfsur",Re="zw.scw.r.0",Te="zw.scw.sps.0",Ie="zw.scw.sps.1",Pe="zw.scw.sp.0",Me="zw.scw.ups.0",Le="zw.scw.upns",ke="zw.scw.ups.0.0",Ne="zw.scw.ups.1.0",Oe="zw.scw.gnu",Ae="zw.scw.sp.1",we="zw.scw.ops.1",De="zw.pw.tsp.0",Ue="zw.pw.ue",xe="zw.pw.gpu",He={code:1000002,message:"not login room"},qe={code:1000014,message:"stream ID is too long"},Be={code:1000015,message:"streamID is empty"},Ge={code:1000016,message:"stream ID contains illegal characters"},ze={code:1000017,message:"network is broken"},Ve={code:1100001,message:"input param error."},We={code:1100002,message:"network timeout."},je={code:1102017,message:"dispatch error"},Fe={code:1102018,message:"token expired"},Ye={code:1102022,message:"dispatch request timeout"},Ke={code:1103001,message:"input param error"},$e={code:1103002,message:"browser do not support"},Qe={code:1103011,message:"enumerate devices fail"},Xe={code:1103049,message:"repeated pull same stream"},Ze={code:1103051,message:"publisher retry timeout"},Je={code:1103055,message:"publish stream no found"},et={code:1103056,message:"publish is publishing"},tt={code:1104001,message:"input parm error"},rt={code:1104031,message:"player retry timeout"},ot={code:1104032,message:"player is playing"},nt={code:1104039,message:"play stream not found"},it=function(e){return e},st=function(e){return e},at=function(e){return e},ut="/sdk/login",lt="listener",ht="/sdk/init",ct="/sdk/start_publish",dt={kBrowserNotSupportError:$e,kEnumDevicesError:Qe},pt="/liveroom/send_stream_update_info",gt=st,mt=st,ft=st,_t={event:"/liveroom/get_current_stream_list",room_id:st,room_sid_string:st,stream_seq:at,stream_size:at,stream_list:it,use_ua:at,error:{kParamError:Ke,NOT_LOGIN:He}},yt="/sdk/listener",vt={kParamError:Ve,kPublishStreamNoFoundError:Je,kNoLoginError:He,kNoResponseError:{code:1103063,message:"publish target no response"},kBizChannelError:{code:1102021,message:"biz channel error."},kInvalidChannelError:{code:1102024,message:"invalid channel"},kUnknownServerError:{code:1100999,message:"unknown server error"}},St="/mss/pushadd",Et="/mss/pushdel",bt=st,Ct={event:"/liveroom/send_stream_extra_info",error:{kParamError:Ve,kExtraInfoNullError:{code:1003050,message:"extra info of publishing stream is null"},kNoLoginError:He,kPublishStreamNoFoundError:Je,kUpdateStreamInfoFailError:{code:1103062,message:"update stream info fail"}},stream_id:st,stream_extra_info:st,room_sid_string:st,room_id:st,send_seq:at};!function(e){e.WIN32="WIN32",e.MAC="Mac",e.ANDROID="Android",e.LINUX="Linux",e.IOS="iOS",e.UNKNOWN="WTF"}(ae||(ae={}));function Rt(e){return/^([0-9a-zA-Z#!$%&()`'+-;<=.>@^_~,\\*])+$/.test(e)&&/^[^:/]*$/g.test(e)}function Tt(e){return!!(e.startsWith("rtmp://")||e.startsWith("avertp://")||e.startsWith("https://")&&e.endsWith(".flv")||e.startsWith("https://")&&e.endsWith(".m3u8"))}function It(e,t){return t[e+"SuccessCallback"]}function Pt(e,t,r,o,n){switch(r){case"eventStart":e.eventStart(t,o);break;case"eventEndWithMsgInfo":e.eventEndWithMsgInfo(t,o,n[0]);break;case"addEventMsg":e.addEventMsg(t,o,n[0],n[1]);break;case"addEvent":e.addEvent(t,o);break;case"eventEnd":e.eventEnd(t,o);break;case"addMsgInfo":e.addMsgInfo(t,n[0])}}function Mt(e,t,r,o){!function(e,t,r){t.success&&(r[e+"SuccessCallback"]=t.success),t.error&&(r[e+"ErrorCallback"]=t.error)}(e,{success:function(e,o){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];Pt(t,r,e,o,n)}},o)}function Lt(e,t,r,o,n){It(e,t)&&It(e,t)(r,o)}function kt(e,t,r){if(t)return{code:e,message:r||"liveroom error"};var o={1:"parse json error.",1001:"login is processing.",1002:"liveroom request error.",1003:"zpush connect fail.",1004:"zpush handshake fail.",1005:"zpush login fail.",1006:"user login state is wrong.",1007:"got no zpush addr",1008:"token error",1009:"dispatch error",1010:"token expired",1011:"token format error",1013:"token03 format error",2002:"biz channel error",1e9:"liveroom cmd error, code:",1000002001:"need relogin",1000002002:"third token auth error",1000002003:"token nonce type should be int64",1000002004:"token appid type  should be uint32",1000002005:"token timeout type should be int64",1000002006:"token user_id type should be string",1000002007:"token room_id type should be string",1000002008:"token format error",1000002009:"token privilege type should be map",1000002010:"token expire_time type should be int64",1000002011:"token user_id type should be string",1000002012:"token not exist",1000002013:"token update error",1000002014:"token not need to check"};if(0===e)return{code:0,message:""};var n={code:0,message:"liveroom cmd error"};if(n.code=e,e>1e9){var i=o[e];n.message=i?"liveroom cmd error, code: "+e+", message: "+i:o[1e9]+e}else n.message=o[e]?o[e]+" code:"+e:"unknown error code:"+e;return n}function Nt(e,t){delete t[e+"SuccessCallback"],delete t[e+"ErrorCallback"]}function Ot(e,t){var r={code:-1,message:"server error"};return e>1e9&&(r.code=e-1e9+52e6),t&&(r.message=t),r}function At(e,t){var r={1016:"MULTI_ROOM_UNABLE",1105:"ROOM_MAX_USER_COUNT",1012:"PUBLISHER_ERROR_REPETITIVE_PUBLISH_STREAM",2002:"TOKEN_ERROR",2003:"ROOM_ERROR_LOGIN_TIMEOUT",2010:"TOKEN_ERROR",5022:"ROOM_COUNT_EXCEED"};if(t)return e>2e5&&e<3e5?r[e-2e5]:e<2e5?{50116:"TOKEN_ERROR",50117:"TOKEN_EXPIRED",50118:"TOKEN_ERROR",50119:"TOKEN_ERROR",50120:"TOKEN_ERROR",50121:"TOKEN_ERROR",50122:"TOKEN_ERROR",50123:"TOKEN_EXPIRED",50124:"TOKEN_ERROR",50125:"TOKEN_ERROR",50126:"TOKEN_ERROR",50127:"TOKEN_ERROR",50128:"TOKEN_ERROR"}[e]||r[e]||"ROOM_INNER_ERROR":r[e]||"ROOM_INNER_ERROR";return e>1e9?r[e-1e9]||"":{1:"PARSE_JSON_ERROR",1001:"LOGIN_PROCESSING",1002:"LIVEROMM_REQUEST_ERROR",1003:"ZPUSH_REQUEST_FAIL",1004:"ZPUSH_REQUEST_FAIL",1005:"ZPUSH_REQUEST_FAIL",1006:"LOGIN_STATE_WRONG",1007:"ZPUSH_REQUEST_FAIL",1008:"TOKEN_ERROR",1009:"DIAPATCH_ERROR",1010:"TOKEN_EXPIRED",1011:"TOKEN_ERROR",1012:"SUBCMD_ERROR",1101:"ZEGO_AUTH_ERROR",2001:"BIZ_CHANNEL_ERROR",2002:"BIZ_CHANNEL_ERROR"}[e]||"ROOM_INNER_ERROR"}function wt(e,t,r,o){var n,i=[],s=[],a=[];r||(r=[]);for(var u=0;u<r.length;u++)if(r[u].anchor_id_name!=e&&r[u].id_name!=e&&r[u].user_id!=e){n=!1;for(var l=0;l<t.length;l++)if(r[u].stream_id===t[l].stream_id){r[u].extra_info!==t[l].extra_info&&a.push(r[u]),n=!0;break}n||i.push(r[u])}for(var h=0;h<t.length;h++)if(t[h].anchor_id_name!=e&&t[h].id_name!=e&&t[h].user_id!=e){n=!1;for(var c=0;c<r.length;c++)if(t[h].stream_id===r[c].stream_id){n=!0;break}n||s.push(t[h])}t.splice(0);for(u=0;u<r.length;u++)t.push(r[u]);o(i,s,a)}function Dt(e,t){return 0==t?"number"==typeof e&&e%1==0&&e>=0:"number"==typeof e&&e%1==0&&e>0}function Ut(e,t,r){return t=null!=t?t:1,r=null!=r?r:1e4,"number"==typeof e&&e%1==0&&e>=t&&e<=r}function xt(e,t){void 0!==navigator.mediaDevices&&void 0!==navigator.mediaDevices.enumerateDevices?navigator.mediaDevices.enumerateDevices().then((function(t){for(var r=[],o=[],n=[],i=0;i<t.length;i++){var s=t[i];"audioinput"===s.kind&&r.push({deviceName:s.label,deviceID:s.deviceId}),"audiooutput"===s.kind&&o.push({deviceName:s.label,deviceID:s.deviceId}),"videoinput"===s.kind&&n.push({deviceName:s.label,deviceID:s.deviceId})}e&&e({microphones:r,speakers:o,cameras:n})})).catch((function(e){console.error("enumerate devices wrong "+e),t&&t(dt.kEnumDevicesError)})):t&&t(dt.kBrowserNotSupportError)}function Ht(e){return 0==e||1==e?0==e?"PUBLISHING":"NO_PUBLISH":"PUBLISH_REQUESTING"}function qt(e){return 0==e||1==e?0==e?"PLAYING":"NO_PLAY":"PLAY_REQUESTING"}function Bt(e){return null!=e&&""!==e}function Gt(e){return"string"==typeof e}function zt(e,t){return!(e.length>=t)}function Vt(e){for(var t,r=0,o=e.length,n="";r<o;)t=e.subarray(r,Math.min(r+32768,o)),n+=String.fromCharCode.apply(null,Array.from(t)),r+=32768;return btoa(n)}var Wt="zc.sc.al",jt="zc.sh.msbss",Ft="zc.sh.ms",Yt="zc.sh.psl",Kt="zc.sh.sbr",$t="zc.sh.sbr3",Qt=function(){function e(e,t){this.logger=e,this.dataReport=t,this.debug=!1,this.testEnvironment=!1,this.pullLimited=!0,this.useNetAgent=!0,this.configOK=!1,this.relateService=[],this.role=2,this.maxMemberCount=0,this.roomCreateFlag=1,this.callbackList={},this.publishStreamList={},this.waitPublishStreamList={},this.streamUrlMap={},this.cmdCallback={},this.customUrl=[],this.customPlayUrl=[],this.turnToTcp=!1,this.turnOverTcpOnly=void 0,this.audioEffectBuffer={},this.audioBitRate=48e3,this.cdnSeq=0,this.engineDestroy=!1,this.listenerList={roomStreamUpdate:[],streamExtraInfoUpdate:[],playerStateUpdate:[],publisherStateUpdate:[],screenSharingEnded:[],publishQualityUpdate:[],playQualityUpdate:[],remoteCameraStatusUpdate:[],remoteMicStatusUpdate:[],soundLevelUpdate:[],capturedSoundLevelUpdate:[],videoDeviceStateChanged:[],audioDeviceStateChanged:[],deviceError:[],_deviceError:[],_remoteCameraStatusUpdate:[],_remoteMicStatusUpdate:[],_streamUpdated:[],receiveRealTimeSequentialData:[],beautyEffectOverload:[],playerRecvSEI:[],beautyEffectError:[],_engineConfigUpdate:[],backgroundEffectError:[],exceptionUpdate:[],networkQuality:[],_engineDestroy:[]},this.reportList={},this.reportSeqList={startPublish:{},rePublish:{},startPlay:{},rePlay:{},stopPublish:{},stopPlay:{}},this.streamTrigger={},this.audioStreamList={},this.deviceInfos=null,this.deviceChangeTimer=null,this.deviceStateOut=!1,this.customUa=!1,this.testNetPackageSize=!1,this.testSignalConnectCount=0,this.streamRetryTime=300,this.checkList=[],this.anchor_info={anchor_id:"",anchor_id_name:"",anchor_nick_name:""},this.streamConnectTime=0,this.defaultConnTime=5,this.clientIP="",this.accessClientIp="",this.isMultiOuter=!1,this.type="PUBLIC",this.roomList=[],this.tempRoomList=[],this.isMultiRoom=!1,this.browser="",this.unregisterSeiFilter="",this.isTestMode=!1,this.debugLog=!1,this.netAppConfigDelay=0,this.seiConfig={emulationPreventionByte:!1},this.playAccelerate=!0,this.connectChanged=!1,this.autoSwitchDeviceSetting={camera:!1,microphone:!1},this.unSendMessageList=[],this.scenario=F.Default,this.testStreamRetryMode=0,this.testStreamRetryCount=10,this.supportDispatchByPass=!1,this.testStreamStatusSeq=0,this.engineConfig={keepAudioTrack:!0,playClearLastFrame:!0,previewClearLastFrame:!0,mixingAudioDelay:0,baseMixingAudioDelay:0,adaptCustomUA:!1,allowReplaceEmptyTrack:!1},this._isMiniSdp=!0,this._forceMiniSdp=!1,this.player265Validated=!1,this.player265ReceiverList=[],this.logReportCallback=Mt,this.unregisterCallback=Nt,this.checkIllegalCharacters=Rt,this.decodeServerError=Ot,this.getLiveRoomError=At,this.getServerError=kt,this.mergeStreamList=wt,this.checkInteger=Dt,this.isUrl=Tt,this.actionSuccessCallback=It,this.checkValidNumber=Ut,this.getDevices=xt,this.uint8arrayToBase64=Vt,this.getSeq=r.getSeq,this.getReportSeq=r.getReportSeq}return Object.defineProperty(e.prototype,"networkState",{get:function(){var e;return null===(e=this.rtm)||void 0===e?void 0:e.stateCenter.networkState},set:function(e){var t;(null===(t=this.rtm)||void 0===t?void 0:t.stateCenter)&&void 0!==e&&(this.rtm.stateCenter.networkState=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isMiniSdp",{get:function(){if(!this._isMiniSdp&&!this._forceMiniSdp)return!1;if(!window.WebAssembly||!window.Worker)return!1;var e=this.settingConfig.getSetting("open_mini_sdp");return"boolean"==typeof e&&(this.logger.info("zc.c.ims setting: "+e),e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"streamCenter",{get:function(){return this._streamCenter},set:function(e){this._streamCenter=e},enumerable:!1,configurable:!0}),e.prototype.getRequestId=function(){return this.idName+"-"+(0,r.getSeq)()},e.prototype.getSignalCmdContent=function(e,t,r,o){var n={request_id:t,room_id:e,from_userid:this.idName,from_username:this.nickName,to_userid:r};return null!=o&&(n.result=o),JSON.stringify(n)},e.prototype.actionListener=function(e){for(var t=this,r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];if(!["playQualityUpdate","publishQualityUpdate","soundLevelUpdate","capturedSoundLevelUpdate","playerRecvSEI","remoteCameraStatusUpdate","_remoteCameraStatusUpdate","remoteMicStatusUpdate","_remoteMicStatusUpdate","_streamUpdated","_deviceError","networkQuality"].includes(e)&&this.listenerList[e]){var n=this.reporter.createSpan(Y.H,{key:lt},{key:""},yt);n.setAttributes({listener:e,listener_params:JSON.stringify(r)}),["deviceError","streamExtraInfoUpdate","publisherStateUpdate","playerStateUpdate","roomStreamUpdate"].includes(e)&&this.logger.info("zc.al ".concat(e," ").concat(JSON.stringify(r))),n.end()}this.listenerList[e]&&this.listenerList[e].forEach((function(o){try{setTimeout((function(){o.apply(void 0,r)}),0)}catch(r){t.logger.error(Wt+" "+e+" "+r)}}))},e.prototype.getRoomByRoomID=function(e){return this.roomList.find((function(t){return t.roomID==e}))},e.prototype.getPlayRoom=function(e){return this.roomList.find((function(t){return!!t.streamList.find((function(t){return t.stream_id==e}))}))},e.prototype.destroy=function(){this._streamCenter=null},e}(),Xt=_t,Zt=function(){function e(e,t,r,o,n){this.logger=e,this.stateCenter=t,this.rtm=r,this.streamCenter=o,this.roomID=n,this.minStreamSeq=0,this.streamSeq=0,this.maxFullStreamSeq=0,this.streamQuerying=!1,this.streamSeqMergeMap=null,this.streamListHBMergeInterval=2e3,this.streamListMergeInterval=5e3}return e.prototype.setCDNInfo=function(e,t){e.urlFlv=t.urls_flv instanceof Array?t.urls_flv[0]||"":"string"==typeof t.urls_flv?t.urls_flv:"",e.urlHls=t.urls_m3u8 instanceof Array?t.urls_m3u8[0]||"":"string"==typeof t.urls_m3u8?t.urls_m3u8:"",e.urlFlvPlus=t.urls_flv_plus instanceof Array?t.urls_flv_plus[0]||"":"string"==typeof t.urls_flv_plus?t.urls_flv_plus:"",e.urlHlsPlus=t.urls_m3u8_plus instanceof Array?t.urls_m3u8_plus[0]||"":"string"==typeof t.urls_m3u8_plus?t.urls_m3u8_plus:"",e.urlHttpsFlv=t.urls_https_flv instanceof Array?t.urls_https_flv[0]||"":"string"==typeof t.urls_https_flv?t.urls_https_flv:"",e.urlHttpsHls=t.urls_https_m3u8 instanceof Array?t.urls_https_m3u8[0]||"":"string"==typeof t.urls_https_m3u8?t.urls_https_m3u8:"",e.urlRtmp=t.urls_rtmp instanceof Array?t.urls_rtmp[0]||"":"string"==typeof t.urls_rtmp?t.urls_rtmp:""},e.prototype.onStreamUpdated=function(e,t,r){},e.prototype.onStreamExtraInfoUpdated=function(e,t){},e.prototype.handleStreamStart=function(e,t){this.logger.info("zb.sh.hss call stream update"),this.room=t,e.body?(this.streamListHBMergeInterval=e.body.stream_list_hb_wait_merge_time||2e3,this.streamListMergeInterval=e.body.stream_list_push_merge_timeout||5e3,this.streamQuerying=!1,this.handleFullUpdateStream(e.body.stream_seq,e.body.stream_info||[]),this.handleReconnectStream(e.body.stream_info),this.logger.info("zb.sh.hss call end")):this.logger.error("zb.sh.hss server response wrong")},e.prototype.onPublishStateUpdate=function(e,t,r){},e.prototype._updateStreamInfo=function(e,t,r,o,n){var i,s,a=this;void 0===r&&(r=""),this.logger.info("zb.sh.usi call");var u=r,l=null===(i=this.room)||void 0===i?void 0:i.streamList.find((function(t){return t.stream_id===e}));l||this.logger.info("zb.sh.usi stream not in room cmd "+t);var h={stream_id:e,extra_info:u};2002!==t&&2003!==t||(h.stream_sid=(null==l?void 0:l.stream_sid)||"");var c=JSON.stringify(h),d={sub_cmd:t,stream_msg:c,third_token:null===(s=this.room)||void 0===s?void 0:s.token},p=this.room;if(this.stateCenter.useNetAgent){var g=this.rtm.liveRoomHandler.sendStreamUpdate(d,(function(r,n){o&&o(r,n),a.handleStreamUpdateRsp(r,e,t)}),(function(i,s){var u=a.room,l=a.rtm.stateCenter.roomModulesList.find((function(e){return e.roomID===(null==u?void 0:u.roomID)})),h=function(){return(null==l?void 0:l.isTryLogin())||"CONNECTING"===(null==l?void 0:l.roomState)},c=function(){a.logger.warn("zb.sh.usi resend stream update "+t),a._updateStreamInfo(e,t,r,o,n)};if(u&&((null==l?void 0:l.isLogin())||h())&&i.code&&i.code==We.code&&u.streamInfoList[e].seq==s)setTimeout((function(){if(2001==t&&a.stateCenter.publishStreamList[e]&&a.stateCenter.publishStreamList[e].state==v||2002==t)if(h()){var r=function(e,t){var o=function(){a.rtm.stateCenter.offListener("_roomStateUpdate",r)};e===(null==u?void 0:u.roomID)&&"CONNECTED"===t?(c(),o()):e===(null==u?void 0:u.roomID)&&"DISCONNECTED"===t&&o()};a.rtm.stateCenter.onListener("_roomStateUpdate",r)}else c();else n&&n(We)}),0);else if(i.body&&i.body.err_code){var d=a.stateCenter.getServerError(i.body.err_code,a.stateCenter.useNetAgent,i.body.err_message);[1011,1000002002].includes(d.code)&&(d=Fe),n&&n(d,s),t===E&&a.onPublishStateUpdate(J,e,d)}}),{sessionID:null==p?void 0:p.sessionID,roomID:null==p?void 0:p.roomID,roomSessionID:null==p?void 0:p.roomSessionID});[2001,2002].includes(t)&&(this.room.streamInfoList[e]={seq:g})}this.logger.info("zb.sh.usi call success cmd "+t+", roomid: ".concat(null==p?void 0:p.roomID,", stream: ").concat(e))},e.prototype.updateStreamInfo=function(e,t,r,o,n){var i=this;if(void 0===r&&(r=""),this.room){var s;if(2001===t||2002===t)(s=this.stateCenter.reporter.createSpan(Y.H,{key:ut,par:this.roomID},{key:""},pt)).setAttributes({stream_update_type:gt(2001===t?"stream added":2002===t?"stream deleted":""),stream_extra_info:mt(r),stream_id:ft(e)});this._updateStreamInfo(e,t,r,(function(e,r){[2001,2002].includes(t)&&(s.setAttributes({send_seq:r}),s&&s.end()),o&&o(e,r)}),(function(e,r){[2001,2002].includes(t)&&(s.setAttributes({send_seq:r}),i.stateCenter.reporter.setError(s,e)),n&&n(e,r)}))}else this.logger.warn("zb.sh.usi room not exist")},e.prototype.handleStreamUpdateRsp=function(e,t,r){var o,n,i,s;if(this.rtm.isDisConnect())this.logger.warn("zb.sh.hsur not login");else if(0==e.body.err_code){this.logger.info("zb.sh.hsur stream seq "+this.streamSeq+" server seq "+e.body.stream_seq);var a=this.room;if(a){if(null===(o=null==e?void 0:e.body)||void 0===o?void 0:o.token_remain_time)this.stateCenter.getRoomByRoomID(null===(n=null==e?void 0:e.header)||void 0===n?void 0:n.room_id)?this.rtm.resetRoomTokenTimer(e.header.room_id,e.body.token_remain_time):this.logger.error("zb.sh.hsur room no found ignore "+JSON.stringify(null===(i=e.header)||void 0===i?void 0:i.room_id));if(this.stateCenter.useNetAgent){this.handleStreamSync(e,t,r);var u=a.streamInfoList[t],l=null===(s=e.header)||void 0===s?void 0:s.seq;u&&u.seq===l?delete a.streamInfoList[t]:this.logger.info("zb.sh.hsur ".concat(JSON.stringify(t)," udp stream info; rsp seq: ").concat(l,", cur seq: ").concat(null==u?void 0:u.seq," "))}}else this.logger.info("hsur.0 room no found")}else this.logger.error("zb.sh.hsur stream update error "+e.body.err_code)},e.prototype.handleStreamSync=function(e,t,r){if(this.handleStreamRsp(this.room,t,{stream_id:t,stream_sid:e.body.stream_sid,stream_ver:e.body.stream_ver,stream_nid:e.body.stream_nid},r),e.body.stream_seq>this.streamSeq+1)return this.logger.info("zb.sh.hss.1 seq diff server: "+e.body.stream_seq+" client "+this.streamSeq),void this.fetchStreamList();this.streamSeq=e.body.stream_seq;var o=this.room.streamList.find((function(e){return e.stream_id==t}));o&&e.body.stream_ver>o.stream_ver&&this.fetchStreamList(t)},e.prototype.handleStreamRsp=function(e,t,r,o){var n=this.stateCenter.publishStreamList[t],i=e.streamList.find((function(e){return e.stream_id==t}));if(this.logger.info("hsur.0 cmd "+o+" "+!!i),i&&2002===o){var s=e.streamList.findIndex((function(e){return e.stream_id==t}));this.logger.info("hsur.0 stream index "+s),s>-1&&e.streamList.splice(s,1)}n?(n.state==v&&(n.state=S,2001!==o||i||e.streamList.push(r),this.onPublishStateUpdate(Z,t,{code:0,message:""})),i&&i.stream_sid!==r.stream_sid&&(this.logger.info("hsur.0 update sid. "+t+" origin:"+i.stream_sid+", new:"+r.stream_sid),i.stream_sid=r.stream_sid)):this.logger.info("hsur.0 stream is not exist")},e.prototype.handleFetchStreamListRsp=function(e,t){var r,o,n,i,s,a;if(this.logger.info("zb.sh.hfslr call "+t),this.streamQuerying=!1,this.stateCenter.reporter.spanEnd({key:Xt.event,par:this.roomID},{stream_seq:Xt.stream_seq(null===(r=e.body)||void 0===r?void 0:r.stream_seq),stream_size:Xt.stream_size(null===(n=null===(o=e.body)||void 0===o?void 0:o.stream_info)||void 0===n?void 0:n.length),stream_list:Xt.stream_list(null===(i=e.body)||void 0===i?void 0:i.stream_info),error:(null===(s=null==e?void 0:e.body)||void 0===s?void 0:s.err_code)||(null==e?void 0:e.code),message:(null===(a=null==e?void 0:e.body)||void 0===a?void 0:a.err_message)||(null==e?void 0:e.msg)}),0===e.body.err_code)if(this.streamSeq!==e.body.stream_seq){if(this.streamSeq>e.body.stream_seq)return this.logger.error("zb.sh.hfslr less seq"),void this.fetchStreamList(t);if(this.maxFullStreamSeq>e.body.stream_seq)this.logger.info("zb.sh.hfslr less than max fetch stream seq ");else{var u=e.body.stream_info;this.stateCenter.useNetAgent&&t&&(u=e.body.stream_info.filter((function(e){return e.stream_id===t}))),this.handleFullUpdateStream(e.body.stream_seq,u),this.logger.info("zb.sh.hfslr call success")}}else this.logger.info("zb.sh.hfslr same seq");else this.logger.info("zb.sh.hfslr server error=",e.body.err_code)},e.prototype.syncPublishStreamList=function(){this.logger.info("zb.sh.spsl call");var e=function(e){var r=t.stateCenter.publishStreamList[e];if(r.state===S){var o=t.room.streamList.findIndex((function(t){return t.stream_id===e}));if(r.roomID===t.room.roomID&&-1===o)r.state=v,t.updateStreamInfo(e,E,r.extra_info,(function(e){}))}},t=this;for(var r in this.stateCenter.publishStreamList)e(r);this.logger.info("zb.sh.spsl call success")},e.prototype.handleFullUpdateStream=function(e,t){var r=this;this.logger.info("zb.sh.hfus call"),this.streamSeq=e,this.maxFullStreamSeq<e&&(this.maxFullStreamSeq=e),this.logger.debug("zb.sh.hfus server seq "+this.streamSeq),this.stateCenter.mergeStreamList(this.stateCenter.idName,this.room.streamList,t,(function(e,t,o){0!==e.length&&(r.logger.debug("zb.sh.hfus callback addstream"),r.onStreamUpdated(r.roomID,R,r.makeCallbackStreamList(e))),0!==t.length&&(r.logger.debug("zb.sh.hfus callback delstream"),r.onStreamUpdated(r.roomID,T,r.makeCallbackStreamList(t))),0!==o.length&&(r.logger.debug("zb.sh.hfus callback updatestream"),r.onStreamExtraInfoUpdated(r.roomID,r.makeCallbackStreamList(o)))})),this.syncPublishStreamList(),this.logger.info("zb.sh.hfus call success")},e.prototype.handlePushStreamUpdateMsg=function(e){if(this.logger.info("zb.sh.hpsum call "+JSON.stringify(e)),e.body.stream_info&&0!==e.body.stream_info.length){if(this.streamSeq+1!==e.body.stream_seq)return this.logger.info("zb.sh.hpsum call updatestream 1"),void this.fetchStreamList();if(e.body.stream_seq<this.maxFullStreamSeq)return this.logger.info("zb.sh.hpsum call updatestream 2"),void this.fetchStreamList();switch(this.streamSeq=e.body.stream_seq,e.body.stream_cmd){case M:this.handleAddedStreamList(e.body.stream_info);break;case L:this.handleDeletedStreamList(e.body.stream_info);break;case k:this.handleUpdatedStreamList(e.body.stream_info)}this.logger.info("zb.sh.hpsum call success")}else this.logger.info("zb.sh.hpsum, emtpy list")},e.prototype.handlePriPushStreamUpdateMsg=function(e){if(this.logger.info("zb.sh.hpsum call"),e.body.streams_info&&0!==e.body.streams_info.length){if(e.body.streams_info.length+this.streamSeq!==e.body.stream_seq)return this.logger.info("zb.sh.hpsum call updatestream"),void this.mergeStreamByStreamSeq(e.body.stream_cmd,e.body.stream_seq,e.body.streams_info);switch(this.streamSeq=e.body.stream_seq,e.body.stream_cmd){case N:this.handleAddedStreamList(e.body.streams_info);break;case A:this.handleDeletedStreamList(e.body.streams_info);break;case O:this.handleUpdatedStreamList(e.body.streams_info)}this.logger.info("zb.sh.hpsum call success")}else this.logger.info("zb.sh.hpsum, emtpy list")},e.prototype.handleAddedStreamList=function(e){this.logger.debug("zb.sh.hasl call");for(var t,r=[],o=0;o<e.length;o++)if(e[o].anchor_id_name!=this.stateCenter.idName&&e[o].id_name!=this.stateCenter.idName&&e[o].user_id!==this.stateCenter.idName){t=!1;for(var n=0;n<this.room.streamList.length;n++)if(e[o].stream_id===this.room.streamList[n].stream_id){t=!0;break}t||r.push(e[o])}else this.logger.debug("hdsl.0 have self stream added");if(0!==r.length){this.logger.debug("zb.sh.hasl callback addstream");for(var i=0;i<r.length;i++){this.room.streamList.push(r[i]);var s=this.streamCenter.playerList[r[i].stream_id];null==s||s.player.setStreamAdd()}this.onStreamUpdated(this.roomID,R,this.makeCallbackStreamList(r))}this.logger.info("zb.sh.hasl call success")},e.prototype.handleDeletedStreamList=function(e){this.logger.debug("zb.sh.hdsl call");for(var t=[],r=0;r<e.length;r++)if(e[r].anchor_id_name!=this.stateCenter.idName&&e[r].id_name!=this.stateCenter.idName&&e[r].user_id!==this.stateCenter.idName){for(var o=this.room.streamList.length-1;o>=0;o--)if(e[r].stream_id===this.room.streamList[o].stream_id){!this.stateCenter.connectChanged&&this.room.streamList.splice(o--,1),t.push(e[r]);break}}else this.logger.debug("zb.sh.hdsl have self stream deleted");0!==t.length&&(this.logger.debug("zb.sh.hdsl callback delstream"),this.onStreamUpdated(this.roomID,T,this.makeCallbackStreamList(t))),this.logger.info("zb.sh.hdsl call")},e.prototype.handleUpdatedStreamList=function(e){this.logger.debug("zb.sh.husl call");for(var t=[],r=0;r<e.length;r++)if(e[r].anchor_id_name!=this.stateCenter.idName&&e[r].id_name!=this.stateCenter.idName&&e[r].user_id!==this.stateCenter.idName){for(var o=0;o<this.room.streamList.length;o++)if(e[r].stream_id===this.room.streamList[o].stream_id){e[r].extra_info!==this.room.streamList[o].extra_info&&(this.room.streamList[o]=e[r],t.push(e[r]));break}}else this.logger.debug("hsul.0 have self stream updated");0!==t.length&&(this.logger.debug("zb.sh.husl callback updatestream"),this.onStreamExtraInfoUpdated(this.roomID,this.makeCallbackStreamList(t))),this.logger.info("zb.sh.husl call success")},e.prototype.fetchStreamList=function(e){var t,r,o,n=this;this.logger.info("zb.sh.fsl call");var i=this.stateCenter.reporter.createSpan(Y.H,{key:ut,par:this.roomID},{key:Xt.event,par:this.roomID},Xt.event,!0);return this.rtm.isDisConnect()?(this.logger.info("zb.sh.fsl state error"),void this.stateCenter.reporter.setError(i,Xt.error.NOT_LOGIN)):this.streamQuerying?(this.logger.info("zb.sh.fsl already doing"),void this.stateCenter.reporter.setError(i,Xt.error.kParamError," already doing")):(this.streamQuerying=!0,this.logger.info("zb.sh.fsl send fetch request"),this.stateCenter.useNetAgent&&this.rtm.liveRoomHandler.getStreamList({},(function(t){n.handleFetchStreamListRsp(t,e)}),(function(e){}),{roomID:null===(t=this.room)||void 0===t?void 0:t.roomID,sessionID:null===(r=this.room)||void 0===r?void 0:r.sessionID,roomSessionID:null===(o=this.room)||void 0===o?void 0:o.roomSessionID}),void this.logger.info("zb.sh.fsl call success"))},e.prototype.handleReconnectStream=function(e){var t,r,o,n,i,s,a;this.logger.info("zb.sh.hrs call");var u=this.streamCenter.publisherList,c=this.streamCenter.playerList;this.logger.info("zb.sh.hrs publish "+Object.keys(this.streamCenter.publisherList));var g=function(c){if((null===(r=null===(t=u[c])||void 0===t?void 0:t.room)||void 0===r?void 0:r.roomID)!==m.roomID)return"continue";var g=e.find((function(e){return e.stream_id==c})),f=g&&!(g.anchor_id_name===m.stateCenter.idName||g.id_name===m.stateCenter.idName||g.user_id===m.stateCenter.idName);if(m.logger.info("zb.sh.hrs stream ".concat(c," ").concat(!!g," ").concat(f," ").concat(null===(o=u[c].publisher)||void 0===o?void 0:o.state)),(null===(n=u[c].publisher)||void 0===n?void 0:n.state)!=l&&u[c].state!==d||g&&!f){if(((null===(i=u[c].publisher)||void 0===i?void 0:i.state)==h||u[c].state===p)&&!(null===(a=null===(s=u[c])||void 0===s?void 0:s.retryStreamHandler)||void 0===a?void 0:a.maxTimer)&&e.find((function(e){return e.stream_id==c}))){m.updateStreamInfo(c,b);for(var _=0;_<m.room.streamList.length;_++)if(m.room.streamList[_].stream_id==c){m.room.streamList.splice(_--,1);break}}}else m.updateStreamInfo(c,E,m.stateCenter.publishStreamList[c].extra_info)},m=this;for(var f in u)g(f);for(var f in u){if(u[f].room.roomID===this.roomID)if(u[f].isReDispatch)this.logger.info("zb.sh.hrs "+f+"retry dispatch"),(_=u[f].retryDispatchHandler).stopMaxTime(),_.invalid(),_.initStream(f,u[f].publishOption,!0),_.active(0),u[f].isReDispatch=!1}for(var f in c){var _;if(c[f].room.roomID===this.roomID)if(c[f].isReDispatch)this.logger.info("zb.sh.hrs "+f+"retry dispatch"),(_=c[f].retryDispatchHandler).stopMaxTime(),_.invalid(),_.initStream(f,c[f].playOption,!1),_.active(0),c[f].isReDispatch=!1}var y=this.streamCenter.stopedPlayerList,v=function(e){if(y[e].roomID!==S.roomID)return"continue";var t=S.streamCenter,r=y[e],o=r.playOption,n=r.playStream;t.setPlayStateStart(e,o,r.isDataChannel);var i=t.playerList[e].retryDispatchHandler;t.playSuccessCallBackList[e]=y[e].sucCallBack?y[e].sucCallBack:function(e){for(var t=document.querySelectorAll("video, audio"),r=0;r<t.length;r++){n&&t[r].srcObject===n&&(n.getTracks().forEach((function(e){return n.removeTrack(e)})),e.clone().getTracks().forEach((function(e){return n.addTrack(e)})))}},y[e].errCallBack&&(t.playErrorCallBackList[e]=y[e].errCallBack),t.onPlayStateUpdate(re,e,{code:0,message:""}),i.stopMaxTime(),i.invalid(),i.initStream(e,o,!1),i.startMaxTime(),i.active(0),delete y[e]},S=this;for(var f in y)v(f);this.logger.info("zb.sh.hrs end")},e.prototype.makeCallbackStreamList=function(e){var t,r=[];this.stateCenter.useNetAgent&&this.stateCenter.appConfig&&(t=this.stateCenter.appConfig.media_config.play_config.resource_info.filter((function(e){return[a.CDN,a.DG].includes(e.resource_type)})));if(e&&e.length>0)for(var o=0;o<e.length;o++){var n=e[o].stream_id;if(t&&t.length)for(var i=0;i<t.length;i++){for(var s=t[i].resource_type==a.DG?"_plus":"",l=[],h=[],c=[],d=0;d<t[i].service_info.length;d++){var p=t[i].service_info[d],g=p.protocol,m=p.url_template.replace("{STREAM_NAME}",n);switch(g){case u.FLV:l.push(m);break;case u.HLS:h.push(m);break;case u.RTMP:c.push(m)}}e[o]["urls_flv"+s]=l,e[o]["urls_m3u8"+s]=h,e[o]["urls_rtmp"+s]=c}var f={user:{userID:e[o].anchor_id_name||e[o].id_name,userName:e[o].anchor_nick_name||e[o].nick_name},extraInfo:e[o].extra_info,streamID:e[o].stream_id,roomID:"",urlFlv:"",urlFlvPlus:"",urlRtmp:"",urlHls:"",urlHlsPlus:"",urlHttpsFlv:"",urlHttpsHls:"",streamGID:e[o].stream_gid,closeType:e[o].close_type};this.setCDNInfo(f,e[o]),r.push(f)}return r},e.prototype.sendBizChannelRequestV3=function(e,t,r,o){var n=this,i=e.server,s=e.location,a=this.rtm.netAgent,u=this.room,l=void 0;t&&(l=JSON.stringify(t)),this.logger.info($t+" "+JSON.stringify(l)+" request "+JSON.stringify(e)),a.startHttpRequest({service:i,headers:[{"Token-Appid":this.stateCenter.appid+""},{"Token-Check":"true"},{"Token-Str":null==u?void 0:u.token},{"Token-Userid":this.stateCenter.idName},{"Token-Biztype":0}],body:t,idName:this.stateCenter.idName,method_no:2,ack:!1,location:s},(function(e){n.logger.info($t+" rsp "+JSON.stringify(e.body));var t=e.status_code,i=e.body;if(200===t){var s=i;if("string"==typeof i)try{s=JSON.parse(i)}catch(e){throw o(t),e}var a=s.code,u=s.data,l=void 0;try{l=JSON.parse(u)}catch(e){l=u}0===a?r(l):o(t,a,l)}else o(t)}),(function(e){o(-1,null==e?void 0:e.code,void 0,e)}))},e.prototype.sendHttpPBRequest=function(e,t,r,o,n){var i,s,a=this;void 0===n&&(n=2);var u=function(i,s){var u=i.status_code,l=i.body;if(200!==u)return n--,void(502===u&&n>0?a.sendHttpPBRequest(e,t,r,o,n):o&&o(u,l));r&&r(l,s)};null===(i=this.rtm.netAgent)||void 0===i||i.startHttpRequest2({interfaceID:e.interfaceID,resID:e.resID||"",body:t,ack:!1,idName:this.stateCenter.idName,method:2,token:null===(s=this.room)||void 0===s?void 0:s.token,mode:this.stateCenter.testEnvironment?2:1},(function(e,t){u(e,t)}),(function(e){u(e)}),null,{timeout:4e3,extras:{protoCmd:e.protoCmd}})},e.prototype.sendBizChannelRequestV2=function(e,t,r,o){var n=this,i=e.server,s=e.location,a=e.cmd,u=e.channel,l=this.rtm.netAgent,h=this.room,c=void 0,d=t.timestamp;t&&(c=JSON.stringify(t));var p={cmd:a,req_body:c,appid:this.stateCenter.appid,timestamp:d||Math.ceil((new Date).getTime()/1e3),token:null==h?void 0:h.token,user_id:this.stateCenter.idName,channel:u||"media"};this.logger.info(Kt+" "+JSON.stringify(p)+" request "+JSON.stringify(e)),l.startHttpRequest({service:i,headers:[],body:p,idName:this.stateCenter.idName,method_no:2,ack:!1,location:s},(function(e){n.logger.info(Kt+" rsp "+JSON.stringify(e.body));var t=e.status_code,i=e.body;if(200===t){var s=i;if("string"==typeof i)try{s=JSON.parse(i)}catch(e){throw o(t),e}var a=s.err_code,u=s.rsp_body,l=void 0;try{l=JSON.parse(u)}catch(e){l=u}0===a?r(l):o(t,a,l)}else o(t)}),(function(e){o(-1,null==e?void 0:e.code,void 0,e)}))},e.prototype.sendRTMPRequest=function(e,t,r,o){var n=this.rtm.netAgent,i=this.stateCenter.appid,s=e.streamID,a="/v1/jsrtmp/dispatch/".concat(i,"/").concat(s,"/").concat(e.actionType,"/").concat(n.clientIP),u=this.room;n.startHttpRequest({service:1,headers:[{name:"Token-Appid",val:i+""},{name:"Token-Str",val:(null==u?void 0:u.token)||""},{name:"Token-Userid",val:this.stateCenter.idName},{name:"Token-Biztype",val:"2"}],body:{},idName:this.stateCenter.idName,method_no:1,ack:!1,location:a},(function(e){var o=JSON.parse(e.body);o.hosts=o.hosts&&o.hosts.map((function(e){return"rtmp://".concat(e,"/").concat(i,"/").concat(s)})),o.seq=t,r(o)}),(function(e,t,r){o(e)}))},e.prototype._publishTarget=function(e,t,r){this.logger.info("zb.sh.ptcall")},e.prototype.updateStreamExtraInfo=function(e,t,r,o){this.logger.info("zb.sh.usei call");var n=C;this.stateCenter.publishStreamList[e]&&this.stateCenter.publishStreamList[e].state>=v?(this.stateCenter.publishStreamList[e].extra_info=t,this.updateStreamInfo(e,n,t,r,o)):this.stateCenter.publishStreamList[e]&&this.stateCenter.publishStreamList[e].state===y?(this.stateCenter.publishStreamList[e].extra_info=t,r({errorCode:0})):o(Ct.error.kUpdateStreamInfoFailError)},e.prototype.setStreamExtraInfo=function(e,t,r,o){this.updateStreamExtraInfo(e,t,r,o)},e.prototype._publishTargetWeb=function(e,t,r){},e.prototype.patchStreamList=function(e){var t=this;if("number"==typeof e.body.stream_refresh&&0!==e.body.stream_refresh)return this.logger.info(Yt+" stream refresh "),void this.fetchStreamList();this.logger.info(Yt+" stream seq "+this.streamSeq+" "+JSON.stringify(this.streamSeqMergeMap)),e.body.stream_seq>this.streamSeq&&!this.streamSeqMergeMap&&(this.streamSeqMergeMap={},this.logger.info(Yt+" call update stream "+this.streamSeq+" server "+e.body.stream_seq),this.streamSeqMergeTimer&&clearTimeout(this.streamSeqMergeTimer),this.streamSeqMergeTimer=setTimeout((function(){t.handleMergeTimeout()}),this.streamListHBMergeInterval)),this.minStreamSeq=e.body.stream_seq},e.prototype.getStreamSeq=function(){return this.streamSeq},e.prototype.mergeStreamByStreamSeq=function(e,t,r){var o=this;this.streamSeqMergeMap||(this.logger.warn(jt+" new merge stream list "+this.streamSeq+" server "+t),this.streamSeqMergeMap={},this.streamSeqMergeTimer&&clearTimeout(this.streamSeqMergeTimer),this.streamSeqMergeTimer=setTimeout((function(){o.handleMergeTimeout()}),this.streamListMergeInterval)),this.logger.info(jt+" ".concat(this.streamSeqMergeMap," ").concat(e," ").concat(t," ").concat(r)),this.streamSeqMergeMap[t]={cmd:e,streamList:r}},e.prototype.handleMergeTimeout=function(){if(this.streamSeqMergeMap){var e=Object.keys(this.streamSeqMergeMap).map((function(e){return+e})).sort((function(e,t){return e-t}));e[e.length-1]-e[0]+1===e.length||e[e.length-1]>=this.minStreamSeq?this.mergeStream(e):(this.streamSeqMergeMap=null,this.fetchStreamList())}},e.prototype.mergeStream=function(e){var t=this;this.logger.info(Ft+" merge streamList "+this.streamSeq+" streamSeqList "+e.join(","));var r=e[e.length-1],o=[];e.forEach((function(e){if(t.streamSeqMergeMap&&t.streamSeqMergeMap[e])switch(t.streamSeqMergeMap[e].cmd){case M:t.streamSeqMergeMap[e].streamList.forEach((function(e){var t=o.findIndex((function(t){return t.stream_id==e.stream_id}));-1!==t&&o.splice(t),o.push(e)}));break;case L:t.streamSeqMergeMap[e].streamList.forEach((function(e){var t=o.findIndex((function(t){return t.stream_id==e.stream_id}));-1!==t&&o.splice(t)}));break;case k:t.streamSeqMergeMap[e].streamList.forEach((function(e){var t=o.findIndex((function(t){return t.stream_id==e.stream_id}));-1!==t&&o.splice(t),o.push(e)}))}})),this.streamSeqMergeMap=null,this.logger.info(Ft+" "+o),this.handleFullUpdateStream(r,o)},e.prototype.reset=function(){this.minStreamSeq=0,this.streamSeqMergeMap=null,this.streamSeqMergeTimer&&(clearTimeout(this.streamSeqMergeTimer),this.streamSeqMergeTimer=void 0),this.streamListHBMergeInterval=2e3,this.streamListMergeInterval=5e3},e}(),Jt="/sdk/init",er="/sdk/check_system",tr={kCheckSystemGetSettingFailError:{code:1101001,message:"wx get setting fail"}},rr=it,or="/sdk/api/publish_request",nr={kPublishStreamIDNullError:Be,kPublishParamError:Ke,kPublishStreamIDTooLongError:qe,kPublishStreamIDInvalidCharacterError:Ge,kPublishNetworkTimeoutError:We,kPublishDispatchTimeoutError:Ye,kPublishDispatchError:je,kPublishNetworkBrokenError:ze,kPublishNoLoginError:He,kPublishRetryTimeoutError:Ze,kIsPublishing:et},ir=it,sr=it,ar={event:"/sdk/api/play_request",error:{kPlayStreamIDNullError:Be,kPlayParamError:tt,kPlayStreamIDTooLongError:qe,kPlayStreamIDInvalidCharacterError:Ge,kPlayNoLoginError:He,kPlayRepeatedPullError:Xe,kPlayStreamNotFound:nt,kPlayNetworkTimeoutError:We,kPlayDispatchTimeoutError:Ye,kPlayDispatchError:je,kPlayNetworkBrokenError:ze,kPlayRetryTimeoutError:rt,kIsPlaying:ot},playOption:it,message:it,session_id:it,stream:it,audio_activate:it,video_activate:it},ur="/sdk/stop_publish",lr="/sdk/stop_play",hr="/liveroom/get_stream_update_info",cr=it,dr=it,pr="/liveroom/get_stream_extra_info",gr=it,mr=function(){return mr=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},mr.apply(this,arguments)},fr=function(){function e(e,t,r,o,n){this.logger=e,this.dataReport=t,this.stateCenter=r,this.streamCenter=o,this.rtm=n,this.preferPublishSourceType=x.ultra,this.ultraPlaySourceType="rtmp_v2"}return e.prototype.startPublishingStream=function(e,t){var o=this;return new Promise((function(n,i){o.logger.info(ge+" call");var s=(0,r.getReportSeq)();o.stateCenter.reportSeqList.startPublish[e]=s,o.dataReport.newReport(s,or);var a=function(t,r){o.logger.error(ge+" "+(r||t.message)),o.dataReport.uploadReport(s,void 0,t,r),delete o.stateCenter.reportSeqList.startPublish[e],i(mr(mr({},t),{errorCode:t.code,extendedData:t.message+(r?" "+r:"")}))};if(Bt(e))if(Gt(e)){if(!zt(e,256))return a(nr.kPublishStreamIDTooLongError),!1;if(!Rt(e))return a(nr.kPublishStreamIDInvalidCharacterError),!1;if(o.stateCenter.isMultiRoom&&(!t||"string"!=typeof t.roomID||""==t.roomID))return a(nr.kPublishParamError,"  roomID is need if set multi room"),!1;var u=(null==t?void 0:t.roomID)?t.roomID:o.stateCenter.roomList[0].roomID,l=o.stateCenter.getRoomByRoomID(u);if(o.dataReport.addMsgInfo(s,{stream:sr(e),publish_room_id:u}),l){if(o.stateCenter.customUrl&&0!=o.stateCenter.customUrl.length){o.stateCenter.publishStreamList[e]={state:_,extra_info:t&&t.extraInfo?t.extraInfo:null,roomID:u};var h=o.streamCenter.updatePublishingState(l,e,t&&t.streamParams?t.streamParams:void 0,!0);if(!0!==h){var c=JSON.parse(JSON.stringify(h));return void a(c,"cannot start publish")}return o.streamCenter.publishSuccessCallBackList[e]=function(e,t){n({streamID:e,url:t})},o.streamCenter.startPublishingStream(e,o.stateCenter.customUrl,1)}if(o.rtm.isDisConnect())a(nr.kPublishNoLoginError);else{var d=o.streamCenter.updatePublishingState(l,e,t&&t.streamParams?t.streamParams:void 0,!0);if(!0===d)Mt("kZegoTaskPublishStart"+e,o.dataReport,s,o.stateCenter.reportList),l.streamHandler.onPublishStateUpdate(ee,e,{code:0,message:""}),o.dataReport.addMsgInfo(s,{publishOption:ir(t),mini_sys_infos:o.streamCenter.systemInfo}),!t||"CDN"!=t.sourceType&&"BGP"!=t.sourceType||o.setPreferPublishSourceType(H[t.sourceType]),o.stateCenter.publishStreamList[e]={state:_,extra_info:t&&t.extraInfo?t.extraInfo:null,roomID:null==l?void 0:l.roomID},o.logger.info(ge+" fetch stream url"),Lt("kZegoTaskPublishStart"+e,o.stateCenter.reportList,oe,"get_publish_url"),o.streamCenter.publishSuccessCallBackList[e]=function(e,t){Lt("kZegoTaskPublishStart"+e,o.stateCenter.reportList,ie,"get_publish_url"),n({streamID:e,url:t})},o.streamCenter.publishErrorCallBackList[e]=function(e){a(e)},o.fetchPublishStreamUrl(e,l);else{c=JSON.parse(JSON.stringify(d));a(c,"cannot start publish")}}}else a(nr.kPublishParamError,"room no found")}else a(nr.kPublishParamError);else a(nr.kPublishStreamIDNullError)}))},e.prototype.setPreferPublishSourceType=function(e,t){return this.logger.info(pe+" call"),e!==x.cdn&&e!==x.ultra&&e!==x.customUrl?(this.logger.error(pe+" sourceType only can be number 0 1 2"),!1):e!==x.customUrl||"string"==typeof t&&""!=t?(this.preferPublishSourceType=e,this.customCdnUrl=t,this.logger.info(pe+" call success"),!0):(this.logger.error(pe+" customUrl must be string and not empty"),!1)},e.prototype.fetchPublishStreamUrl=function(e,t){var r=this;if(this.logger.info(fe+" call"),this.logger.info(fe+" send fetch publish request"),this.preferPublishSourceType==x.cdn){var o=this.streamCenter.getCDNUrl(e,1).rtmps;o&&o.length?this.doPublishStream(e,o,t):this.handleStreamPublishFail(e,t,"the cdn url is empty from app config")}else{this.streamCenter.eventSeq+=1;var n=this.streamCenter.eventSeq;t.streamHandler.sendRTMPRequest({actionType:"push",streamID:e},n,(function(o){r.handleFetchStreamPublishUrlRsp(o,e,t.roomID)}),(function(o){r.handleStreamPublishFail(e,t)})),this.stateCenter.streamUrlMap[n]=e}this.logger.info(fe+" call success")},e.prototype.handleFetchStreamPublishUrlRsp=function(e,t,r){this.logger.info(_e+" call");var o=this.stateCenter.getRoomByRoomID(r);if(o){var n;if(this.stateCenter.streamUrlMap[t]&&delete this.stateCenter.streamUrlMap[t],0!==(n=e.code))return this.logger.info(_e+" server error= "+n),void(this.stateCenter.publishStreamList[t]&&(this.logger.error(_e+" liveRoom cmd error"),this.handleStreamPublishFail(t,o,"server error="+n)));e.hosts&&this.doPublishStream(t,e.hosts||[],o)}else this.logger.error(_e+" room no found")},e.prototype.handleStreamPublishFail=function(e,t,r){var o=nr.kPublishDispatchError;this.logger.error("zw.pu.hspf.0"+(r=r||o.message)),this.streamCenter.publishErrorCallBackList[e](o),this.streamCenter.stopPublishingStream(e,{code:o.code,message:r})},e.prototype.doPublishStream=function(e,t,r){return this.logger.info(ye+" call "+e+"streamUrl: "+JSON.stringify(t)),this.stateCenter.publishStreamList[e]?(this.stateCenter.publishStreamList[e].state=y,!t||t.length<=0?(this.handleStreamPublishFail(e,r),!1):(this.streamCenter.startPublishingStream(e,t,this.preferPublishSourceType),this.logger.info(ye+" call success"),!0)):(this.logger.error(ye+" cannot find stream"),!1)},e.prototype.stopPublishingStream=function(e){var t,o,n=this;this.logger.info(me+" call "+e);var i=(0,r.getReportSeq)();this.dataReport.newReport(i,ur),this.dataReport.addMsgInfo(i,{stream_id:e,room_id:null===(o=null===(t=this.streamCenter.publisherList[e])||void 0===t?void 0:t.room)||void 0===o?void 0:o.roomID});var s=function(t,r){n.logger.error(me+" "+(r||t.message)),n.dataReport.uploadReport(i,void 0,t,r),delete n.stateCenter.reportSeqList.startPublish[e]};if(!Bt(e))return s(nr.kPublishStreamIDNullError),!1;if(!Gt(e))return this.logger.error(me+" param error"),s(nr.kPublishParamError),!1;var a=this.streamCenter.publisherList[e];return(null==a?void 0:a.room)?(this.streamCenter.stopPublishingStream(e),this.dataReport.uploadReport(i),this.logger.info(me+" call success"),!0):(s(nr.kPublishParamError," room no found"),!1)},e}(),_r=function(){return _r=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},_r.apply(this,arguments)},yr=function(){function e(e,t,r,o,n){this.logger=e,this.dataReport=t,this.stateCenter=r,this.streamCenter=o,this.rtm=n,this.mixStreamList={},this.streamUrlRspList={},this.preferPlaySourceType=D.ultra,this.ultraPlaySourceType="rtmp_v2"}return Object.defineProperty(e.prototype,"isDisConnect",{get:function(){return this.rtm.isDisConnect()},enumerable:!1,configurable:!0}),e.prototype.startPlayingStream=function(e,t){var o=this;return new Promise((function(n,i){o.logger.info(ve+" call "+e);var s=(0,r.getReportSeq)();o.stateCenter.reportSeqList.startPlay[e]=s,o.dataReport.newReport(s,ar.event);var a=function(t,r){o.logger.error(ve+" "+(r||t.message)),o.dataReport.uploadReport(s,void 0,t,r),delete o.stateCenter.reportSeqList.startPlay[e],i(_r(_r({},t),{errorCode:t.code,extendedData:t.message+(r?" "+r:"")}))};if(Bt(e))if(Gt(e))if(zt(e,256))if(Rt(e)){if(o.stateCenter.customPlayUrl&&0!=o.stateCenter.customPlayUrl.length){var u=o.streamCenter.updatePlayingState(e,t?t.streamParams:void 0,!0);if(!0!==u){var l=JSON.parse(JSON.stringify(u));return void a(l,"cannot start play")}return o.streamCenter.playErrorCallBackList[e]=function(e){a(e)},o.streamCenter.startPlayingStream(e,o.stateCenter.customPlayUrl,1)}if(o.isDisConnect)a(ar.error.kPlayNoLoginError);else{var h=o.streamCenter.updatePlayingState(e,t?t.streamParams:void 0,!0);if(!0===h){if(o.streamCenter.onPlayStateUpdate(re,e,{code:0,message:""}),Mt("kZegoTaskPlayStart"+e,o.dataReport,s,o.stateCenter.reportList),o.dataReport.addMsgInfo(s,{stream:ar.stream(e),playOption:ar.playOption(t),mini_sys_infos:o.streamCenter.systemInfo}),o.streamCenter.playSuccessCallBackList[e]=function(e,t){Lt("kZegoTaskPlayStart"+e,o.stateCenter.reportList,ie,"get_play_url"),n({streamID:e,url:t})},o.streamCenter.playErrorCallBackList[e]=function(t){Lt("kZegoTaskPlayStart"+e,o.stateCenter.reportList,ie,"get_play_url"),a(t)},t&&t.isMix){o.mixStreamList[e]={ultra_url_rtmp:null};var c="BGP"==t.sourceType,d=c?"rtmp_v2":"rtmp_cdn",p=c?x.ultra:x.cdn;return o.logger.info(ve+" play mix: "+"".concat(d,", ").concat(p)),void o.fetchPlayStreamUrl(e,d,p)}Lt("kZegoTaskPlayStart"+e,o.stateCenter.reportList,oe,"get_play_url"),t&&"CDN"==t.sourceType||o.preferPlaySourceType===D.cdn?o.startPlayingStreamFromCDN(e):o.startPlayingStreamFromBGP(e)}else{l=JSON.parse(JSON.stringify(h));a(l)}}}else a(ar.error.kPlayStreamIDInvalidCharacterError);else a(ar.error.kPlayStreamIDTooLongError);else a(ar.error.kPlayParamError);else a(ar.error.kPlayStreamIDNullError)}))},e.prototype.stopPlayingStream=function(e){var t;this.logger.info(Se+" call "+e);var o=(0,r.getReportSeq)();if(this.dataReport.newReport(o,lr),this.dataReport.addMsgInfo(o,{stream_id:e,room_id:null===(t=this.streamCenter.playerList[e])||void 0===t?void 0:t.room.roomID}),"string"!=typeof e||""==e)return this.logger.error(Se+" stream ID must be string and not empty"),this.dataReport.addMsgInfo(o,ar.error.kPlayParamError),void this.dataReport.uploadReport(o);var n=this.streamCenter.playerList[e],i=n&&n.state!==p;for(var s in this.streamCenter.stopPlayingStream(e),i&&this.streamCenter.onPlayStateUpdate(te,e,{code:0,message:""}),this.stateCenter.streamUrlMap)if(this.stateCenter.streamUrlMap[s]===e){delete this.stateCenter.streamUrlMap[s];break}this.mixStreamList[e]&&delete this.mixStreamList[e],this.dataReport.uploadReport(o),this.logger.info(Se+" call success")},e.prototype.startPlayingStreamFromCDN=function(e){this.logger.info(Ee+" call "+e);var t=this.stateCenter.getPlayRoom(e)||this.stateCenter.roomList[0];if(!t)return this.logger.error(Ee+" room no found"),!1;for(var r=null,o=0;o<t.streamList.length;o++)if(t.streamList[o].stream_id===e){r=t.streamList[o].urls_rtmp||[];break}if(!r||r.length<=0){var n;if(!(n=this.streamCenter.getCDNUrl(e,0).rtmps)||!n.length)return this.logger.error(Ee+" cannot find stream url,Please check if CDN is configured "),this.streamCenter.onPlayStateUpdate(te,e,ar.error.kPlayDispatchError),!1;this.logger.info(Ee+"from app config"),r=n}return this.logger.info(Ee+" play stream"),this.doPlayStream(e,r,x.cdn)},e.prototype.startPlayingStreamFromBGP=function(e){return this.logger.info("zw.pl.spsfb fetch stream url"),this.fetchPlayStreamUrl(e,this.ultraPlaySourceType,x.ultra),!0},e.prototype.doPlayStream=function(e,t,r){return this.logger.info("zw.pl.dps call"),this.streamCenter.startPlayingStream(e,t,r),!0},e.prototype.fetchPlayStreamUrl=function(e,t,r){var o=this;if(this.logger.info(be+" call "+e),this.isDisConnect)this.logger.info(be+" state error");else{this.logger.info(be+" send fetch request");var n=this.stateCenter.roomList[0].roomID,i=this.stateCenter.getRoomByRoomID(n);if(this.streamCenter.eventSeq+=1,i){if(r==x.cdn){var s=this.streamCenter.getCDNUrl(e,0).rtmps;s&&s.length?this.doPlayStream(e,s,r):this.handleStreamUrlFail(e,ar.error.kPlayDispatchError.code)}else{var a=this.streamCenter.eventSeq;i.streamHandler.sendRTMPRequest({actionType:"pull",streamID:e},a,(function(t){o.handleFetchStreamUrlRsp(t,r,e,n)}),(function(t){o.handleStreamUrlFail(e,t.code)})),this.stateCenter.streamUrlMap[a]=e,this.streamCenter.playerList[e]&&(this.streamCenter.playerList[e].seq=a)}this.logger.info(be+" call success")}else this.logger.error(be+" room no found")}},e.prototype.handleFetchStreamUrlRsp=function(e,t,r,o){var n;if(this.logger.info(Ce+" call "),n=e.code,this.stateCenter.streamUrlMap[r]&&delete this.stateCenter.streamUrlMap[r],0!==n)return this.logger.error(Ce+" server error= "+n),void this.handleStreamUrlFail(r,n);var i=[];e.hosts&&e.hosts.length>0&&(i=e.hosts);var s=!1,a=this.stateCenter.getRoomByRoomID(o);if(a){if(e.seq===this.streamCenter.playerList[r].seq){for(var u=0;u<a.streamList.length;u++)if(a.streamList[u].stream_id==r){a.streamList[u].urltra_url_rtmp=i,s=!0;break}!s&&this.mixStreamList[r]&&(this.mixStreamList[r].urltra_url_rtmp=i,t=x.cdn,s=!0),s||(this.logger.info(Ce+"cannot find streamInfo in existing stream list"),this.streamUrlRspList[r]=i),this.doPlayStream(r,i,t),this.logger.info(Ce+" call success")}else this.logger.info(Ce+" seq is not match, ignore "+r)}else this.logger.error(Ce+" room no found")},e.prototype.handleStreamUrlFail=function(e,t){this.streamCenter.onPlayStateUpdate(te,e,1900001004===t?ar.error.kPlayStreamNotFound:ar.error.kPlayDispatchError)},e.prototype.setPreferPlaySourceType=function(e){return this.logger.info(le+" call"),e!==D.cdn&&e!==D.ultra?(this.logger.error(le+" sourceType can be number 0 or 1, which can be represented auto or ultra"),!1):(this.preferPlaySourceType=e,this.logger.info(le+" call success"),!0)},e}(),vr=function(e,t){var r,o={10001:"当前"+("WX"==process.env.PLAT_FORM||"WX_DC"==process.env.PLAT_FORM?"微信":"支付宝")+"版本过低，无法使用相关组件",10002:"需要摄像头和录音功能的授权"};r=my.getSystemInfoSync().version;var n={code:0,msg:""};(function(e,t){e=e.split("."),t=t.split(".");for(var r=Math.max(e.length,t.length);e.length<r;)e.push("0");for(;t.length<r;)t.push("0");for(var o=0;o<r;o++){var n=parseInt(e[o]),i=parseInt(t[o]);if(n>i)return 1;if(n<i)return-1}return 0})(r,"10.1.80")<0&&(n={code:10001,msg:o[10001]},e&&e(n)),my.getSetting({success:function(t){e&&e(n)},fail:function(e){console.error("get setting error",e),t&&t(e)}})};var Sr,Er,br=function(){function e(e,t,r,o){this.streamCenter=e,this.stateCenter=t,this.logger=r,this.rtm=o}return e.prototype.setStreamExtraInfo=function(e,t){var r=this;return new Promise((function(o,n){var i=r.streamCenter.getRoomByStreamID(e),s=Ct,a=r.stateCenter.reporter.createSpan(Y.H,i?{key:ut,par:null==i?void 0:i.roomID}:{key:ht},{key:""},s.event);a.setAttributes({stream_id:s.stream_id(e),stream_extra_info:s.stream_extra_info(t)});var u=function(e,t){void 0===t&&(t=""),r.logger.error("zb.ssei "+t),r.stateCenter.reporter.setError(a,e,t),n({errorCode:e.code,extendedData:e.message+" "+t})};"string"==typeof e&&""!=e?"string"==typeof t&&""!=t?r.rtm.isDisConnect()?u(s.error.kNoLoginError,"not login"):r.stateCenter.publishStreamList[e]?i?i.streamHandler.setStreamExtraInfo(e,t,(function(e,t){var i,u,l,h;if(0===(null===(i=null==e?void 0:e.body)||void 0===i?void 0:i.err_code)||0===(null==e?void 0:e.errorCode))a.setAttributes({send_seq:s.send_seq(t)}),a.end(),o({errorCode:0===(null===(u=null==e?void 0:e.body)||void 0===u?void 0:u.err_code)?null===(l=null==e?void 0:e.body)||void 0===l?void 0:l.err_code:null==e?void 0:e.errorCode,extendedData:""});else{var c={errorCode:(null===(h=null==e?void 0:e.body)||void 0===h?void 0:h.err_code)||(null==e?void 0:e.code)};r.stateCenter.reporter.setError(a,c),n(c)}}),u):u(s.error.kNoLoginError,"not login"):u(s.error.kPublishStreamNoFoundError):u(s.error.kParamError,"extraInfo must be string and no empty"):u(s.error.kParamError,"streamID must be string and not empty")}))},e}(),Cr=function(){function e(e,t,r,o,n,i){this.logger=e,this.dataReport=t,this.reporter=r,this.stateCenter=o,this.rtm=i,this.currentPlaySourceType=x.cdn,this.mixStreamList={},this.ultraPlaySourceType="rtmp_v2",this.streamCenter=n,this.publishModule=new fr(this.logger,this.dataReport,this.stateCenter,this.streamCenter,this.rtm),this.playModule=new yr(this.logger,this.dataReport,this.stateCenter,this.streamCenter,this.rtm),this.streamCommon=new br(n,o,e,i),this.init(),this.initStreamCDN()}return e.prototype.init=function(){this.bindRTMListener(),this.bindStreamCenterHandler()},e.prototype.initStreamCDN=function(){},e.prototype.bindRTMListener=function(){var e=this;this.rtm._on("roomLoginResponse",(function(t){e.logger.info("zc.rlr call "+JSON.stringify(t));var r=t.header.room_id;e.stateCenter.appid=e.rtm.getAppID(),e.stateCenter.idName=e.rtm.getUserID(),e.stateCenter.testEnvironment=e.rtm.isTestEnvironment(),e.stateCenter.isMultiRoom=e.rtm.getMultiRoom();var o=e.rtm.getToken(r),n=e.rtm.getSessionId(r),i=e.rtm.getRoomSessionID(r),s=e.stateCenter.getRoomByRoomID(r);if(!s){var a=new Zt(e.logger,e.stateCenter,e.rtm,e.streamCenter,r);e.bindStreamHandler(a),e.stateCenter.roomList.push(s={roomID:r,streamHandler:a,sessionID:n,roomSessionID:i,token:o,isResetRoom:!1,streamList:[],streamInfoList:[]})}if(s.sessionID=n,s.roomSessionID=i,s.token=s.token,s.streamHandler.handleStreamStart(t,s),e.logger.info("zc.rlr unsendmsg "+JSON.stringify(e.stateCenter.unSendMessageList)),e.stateCenter.unSendMessageList.length>0)for(var u=function(t){var o=e.stateCenter.unSendMessageList[t],n=o.streamid,i=o.cmd,a=o.stream_extra_info;if(r===o.roomID){var u=s.streamList.findIndex((function(e){return e.stream_id===n}));e.logger.warn("zc.rlr stream index "+u),2002===i&&u>=0&&(e.logger.warn("zc.rlr resend "+i+" "+n),s.streamHandler.updateStreamInfo(n,i,a),s.streamList.splice(u,1)),e.stateCenter.unSendMessageList.splice(t,1)}},l=e.stateCenter.unSendMessageList.length-1;l>=0;l--)u(l);e.logger.info("zc.rlr end "+r)})),this.rtm._on("_roomLogin",(function(t,r){e.stateCenter.useNetAgent=e.rtm.isUseNetAgent})),this.rtm._on("_appConfigRsp",(function(){e.logger.info("zw.acr call "),e.stateCenter.appConfig=e.rtm.getAppConfig()})),this.rtm._on("HBResponse",(function(t){var r,o=null===(r=null==t?void 0:t.header)||void 0===r?void 0:r.room_id,n=e.stateCenter.getRoomByRoomID(o);null==n||n.streamHandler.patchStreamList(t)})),this.rtm._on("_roomStateUpdate",(function(t,r,o,n){if("DISCONNECTED"==r){e.logger.info("zw.w.brl _roomStateUpdate "+t+" disconnected "+(o?o+" ":"")+(n||""));var i=e.stateCenter.getRoomByRoomID(t);if(i){var s=e.stateCenter.roomList.findIndex((function(e){return e.roomID==t}));i.isResetRoom=!0,i.streamHandler.reset(),e.streamCenter.reset(t,o),e.stateCenter.roomList.splice(s,1)}}else e.logger.info("zc.rsu "+t+" state: "+r)})),this.rtm.liveRoomHandler.handlePushStreamMsg=function(t){var r,o=(null===(r=null==t?void 0:t.header)||void 0===r?void 0:r.room_id)||"",n=e.stateCenter.getRoomByRoomID(o);t.body.stream_cmd=t.header.sub_cmd,t.body.stream_info=t.body.stream_info_list,delete t.body.stream_info_list,null==n||n.streamHandler.handlePushStreamUpdateMsg(t)}},e.prototype.bindStreamHandler=function(e){var t=this;e.onStreamUpdated=function(e,o,n){var i=n.map((function(r){var n=t.playModule.streamUrlRspList[r.streamID];if(n&&1===o){var i=t.stateCenter.getRoomByRoomID(e),s=i.streamList.findIndex((function(e){return e.stream_id==r.streamID}));-1!==s&&i.streamList[s]&&(i.streamList[s].urltra_url_rtmp=n)}else 1!==o&&delete t.playModule.streamUrlRspList[r.streamID];return{streamID:r.streamID,user:r.user,extraInfo:r.extraInfo}})),s=(0,r.getReportSeq)();if(t.dataReport.newReport(s,hr),t.dataReport.addMsgInfo(s,{stream_update_type:cr(1===o?"added":"deleted"),update_stream:dr(n)}),t.dataReport.uploadReport(s),t.stateCenter.actionListener("roomStreamUpdate",e,function(e){return 0==e?"DELETE":"ADD"}(o),i),1===o){var a=[];i.forEach((function(e){e.extraInfo&&a.push({streamID:e.streamID,user:e.user,extraInfo:e.extraInfo})})),a.length>0&&t.stateCenter.actionListener("streamExtraInfoUpdate",e,a)}},e.onPublishStateUpdate=function(e,r,o){t.logger.info("zw.w.opsu "+r);var n=t.stateCenter.reportSeqList.startPublish[r];t.streamCenter.publishingList[r]&&(0==e||1==e)&&n&&(t.dataReport.eventEndWithMsgInfo(n,"PublishState",{type:e}),1==e&&t.dataReport.addMsgInfo(n,o),t.dataReport.uploadReport(n),1012===o.code&&t.streamCenter.stopPublishingStream(r),delete t.stateCenter.reportSeqList.startPublish[r]),t.stateCenter.actionListener("publisherStateUpdate",{state:Ht(e),streamID:r,errorCode:o.code,extendedData:o.message})},e.onStreamExtraInfoUpdated=function(e,o){var n=o.map((function(e){return{streamID:e.streamID,user:e.user,extraInfo:e.extraInfo}})),i=(0,r.getReportSeq)();t.dataReport.newReport(i,pr),t.dataReport.addMsgInfo(i,{update_stream:gr(n)}),t.dataReport.uploadReport(i),t.stateCenter.actionListener("streamExtraInfoUpdate",e,n)}},e.prototype.bindStreamCenterHandler=function(){var e=this;this.streamCenter.onPlayStateUpdate=function(t,r,o){var n=e.stateCenter.reportSeqList.startPlay[r];e.streamCenter.playingList.find((function(e){return e.streamID===r}))&&(0==t||1==t)&&n&&(e.dataReport.eventEndWithMsgInfo(n,"PlayState",{type:t}),e.dataReport.uploadReport(n,void 0,1==t&&o?o:void 0),delete e.stateCenter.reportSeqList.startPlay[r]),e.stateCenter.actionListener("playerStateUpdate",{state:qt(t),streamID:r,errorCode:o&&o.code,extendedData:o&&o.message}),1===t&&e.streamCenter.playErrorCallBackList[r]&&(e.streamCenter.playErrorCallBackList[r](o),delete e.streamCenter.playErrorCallBackList[r])},this.streamCenter.onPublishStateUpdate=function(t,r,o){e.onPublishStateUpdateHandle(t,r,o)},this.streamCenter.onPublishQualityUpdate=function(t,r){e.stateCenter.actionListener("publishQualityUpdate",t,r)},this.streamCenter.onPlayQualityUpdate=function(t,r){e.stateCenter.actionListener("playQualityUpdate",t,r)}},e.prototype.onPublishStateUpdateHandle=function(e,t,r){var o=this;this.logger.info(ue+" call");var n=this.streamCenter.publisherList[t].room;if(n)if(0==e){if(this.stateCenter.publishStreamList[t]){var i=!n.streamList.find((function(e){return e.stream_id==t&&(e.anchor_id_name==o.stateCenter.idName||e.id_name==o.stateCenter.idName||e.user_id===o.stateCenter.idName)})),s=this.stateCenter.publishStreamList[t].state;if(this.logger.info("zc.opsuh.0  state: ".concat(s,", in room: ").concat(i)),s==y&&i)this.stateCenter.publishStreamList[t].state=v,n.streamHandler.updateStreamInfo(t,E,this.stateCenter.publishStreamList[t].extra_info,(function(e){})),this.dataReport.uploadReport(this.stateCenter.reportSeqList.startPublish[t]),delete this.stateCenter.reportSeqList.startPublish[t],Nt("kZegoTaskPublishStart"+t,this.stateCenter.reportList);else this.stateCenter.publishStreamList[t].state=S,n.streamHandler.onPublishStateUpdate(e,t,r),this.dataReport.uploadReport(this.stateCenter.reportSeqList.startPublish[t]),delete this.stateCenter.reportSeqList.startPublish[t],Nt("kZegoTaskPublishStart"+t,this.stateCenter.reportList)}}else n.streamHandler.onPublishStateUpdate(e,t,r),1==e&&(this.logger.info(ue+" stop publish called by sdk"),this.publishModule.stopPublishingStream(t));else this.logger.error("zc.opsuh.0 room not exist")},e.prototype.bindListener=function(e,t){return this.logger.info(he+" call"),this.stateCenter.listenerList[e]?"function"!=typeof t?(this.logger.error(he+" listener callBack must be function"),!1):(-1==this.stateCenter.listenerList[e].indexOf(t)&&this.stateCenter.listenerList[e].push(t),!0):(this.logger.error(he+" event "+e+" no found"),!1)},e.prototype.deleteListener=function(e,t){if(this.logger.info(ce+" call"),!this.stateCenter.listenerList[e])return this.logger.error(ce+" listener no found"),!1;var r=this.stateCenter.listenerList[e];return t?r.splice(r.indexOf(t),1):this.stateCenter.listenerList[e]=[],!0},e.prototype.checkSystemRequirements=function(){var e=this;return new Promise((function(t,r){var o=e.stateCenter.reporter.createSpan(Y.H,{key:Jt},{key:""},er);vr((function(e){o.setAttributes({capability:rr(e)}),o.end(),t(e)}),(function(t){e.stateCenter.reporter.setError(o,tr.kCheckSystemGetSettingFailError),r(t)}))}))},e.prototype.updatePlayerState=function(e,t){this.logger.info("zw.w.ups call "+e),this.streamCenter.updatePlayerState(e,t)},e.prototype.updatePlayerNetStatus=function(e,t){this.logger.info("zw.w.upns call "+e),this.streamCenter.updatePlayerNetStatus(e,t)},e.prototype.updateAudioVolumeNotify=function(e,t){this.streamCenter.updateAudioVolumeNotify(e,t)},e.prototype.getNextUrl=function(e){return"string"!=typeof e||""==e?(this.logger.error("zw.w.gnu stream ID must be string and not empty"),""):this.streamCenter.getNextUrl(e)},e.prototype.setCustomSignalUrl=function(e,t){if(void 0===t&&(t=!0),this.logger.info(de+" call: "+JSON.stringify(e)),!e||0==e.length)return this.logger.error(de+" param error"),!1;var r=!0;e.forEach((function(e){return 0!=e.indexOf("rtmp://")&&(r=!1)})),r?t?this.stateCenter.customUrl=e:this.stateCenter.customPlayUrl=e:this.logger.error(de+" url is not correct")},e}(),Rr=function(){this.publisherList={},this.playerList={},this.stopedPlayerList={}},Tr=function(){return Tr=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},Tr.apply(this,arguments)},Ir=function(){function e(e,t,r,o,n,i){this.logger=e,this.streamId=t,this.streamCenter=r,this.dataReport=o,this.stateCenter=n,this.room=i,this.urls=[],this.tryUrls=[],this.playUrlIndex=0,this.playUrlTryCount=0,this.currentUrl=null,this.retryIndex=0,this.reconnectCount=0,this.state=p,this.reconnectLimit=0,this.sourceType=0,this.playerType=0,this.playerSeq=0,this.playerReportSeq=0,this.publishQualitySeq=0,this.publishQualityCount=0,this.publishQulaityMaxCount=30,this.playQualitySeq=0,this.playQualityCount=0,this.playQulaityMaxCount=30,this.everSuccess=!1,this.pushBegin=!1,this.playBegin=!1,this.playerLogUploadTime=Date.now(),this.seq=-1,this.netStatusUpdateTime=0,this.cacheQualityInfo={},this.isDoubledQuality=!1}return e.prototype.resetPlayer=function(){this.state=p},e.prototype.newPlayer=function(){this.resetPlayer();var e=this.getCurrentPlayerUrl(),t=e;0!=this.params.length&&(t=e+"?"+this.params);var r=Date.now();return t=t.indexOf("?")>-1?t+"&zgseq="+r+"&zgdid="+this.room.sessionID:t+"?zgseq="+r+"&zgdid="+this.room.sessionID,e!==this.currentUrl?(this.currentUrl=e,this.streamCenter.onStreamUrlUpdate(this.streamId,t,this.playerType)):this.streamCenter.onPlayerRetry(this.streamId,this.playerType),0==this.everSuccess?0==this.playerType?(this.dataReport.eventStart(this.playerReportSeq,"PlayBegin"),this.dataReport.addEventInfo(this.playerReportSeq,"PlayBegin","url",t),this.tryUrls.push(t)):(this.dataReport.eventStart(this.playerReportSeq,"PublishBegin"),this.dataReport.addEventInfo(this.playerReportSeq,"PublishBegin","url",t),this.tryUrls.push(t)):this.dataReport.addEventInfo(this.playerSeq,0==this.playerType?"PlayRetry":"PublishRetry","url",t),this.state=c,!0},e.prototype.stopPlayer=function(){this.isDoubledQuality=!1,0==this.playerType?this.dataReport.eventEndWithMsg(this.playerReportSeq,"PlayStat",{quality:this.playerInfo}):(this.dataReport.addEventInfo(this.playerReportSeq,"PublishStat","quality",this.playerInfo),this.dataReport.eventEndWithMsg(this.playerReportSeq,"PublishStat",{quality:this.playerInfo}))},e.prototype.tryStartPlayer=function(e){for(this.logger.info(De+" call");this.playUrlTryCount<this.urls.length;)if(++this.reconnectCount>this.reconnectLimit)this.playUrlTryCount++,this.playUrlIndex=(this.playUrlIndex+1)%this.urls.length,this.reconnectCount=0;else if(this.logger.info(De+" index: "+this.playUrlIndex+", url: "+this.getCurrentPlayerUrl()),this.newPlayer())break;if(this.playUrlTryCount>=this.urls.length){this.logger.info(De+" stream: "+this.streamId),this.resetPlayer();var t="";0==this.playerType?t="PlayEnd":1==this.playerType&&(t="PublishEnd",this.reportQualityStatics()),this.dataReport.addEvent(this.playerSeq,t,{error:e,reason:"no url to retry"}),this.streamCenter.onPlayerStop(this.streamId,this.playerType,e)}},e.prototype.getPlayerUrl=function(){this.logger.info(xe+" call "+this.streamId);var e=this.urls[++this.retryIndex%this.urls.length],t=e;0!=this.params.length&&(t=e+"?"+this.params);var r=Date.now();return t=t.indexOf("?")>-1?t+"&zgseq="+r+"&zgdid="+this.room.sessionID:t+"?zgseq="+r+"&zgdid="+this.room.sessionID,this.tryUrls.push(t),this.logger.info(xe+" call streamId: "+this.streamId+" url: "+t),t},e.prototype.shouldRetryPlay=function(e){return!1},e.prototype.isPlayFailed=function(e){return"WX"===process.env.PLAT_FORM||"WX_DC"===process.env.PLAT_FORM?[-2301,2101,2102].includes(e):3803===e},e.prototype.isPlaySuccess=function(e){return"WX"===process.env.PLAT_FORM||"WX_DC"===process.env.PLAT_FORM?2004===e:3802===e},e.prototype.shouldRetryPublish=function(e){return!1},e.prototype.isPublishFailed=function(e){return"WX"===process.env.PLAT_FORM?e<=-1301&&e>=-1311:3801===e},e.prototype.isPublishSuccess=function(e){return"WX"===process.env.PLAT_FORM?1002==e:3800===e},e.prototype.updateEvent=function(e){var t=e.detail.code;if(this.logger.info(Ue+" ".concat(this.streamId," state code: ").concat(JSON.stringify(t))),0==this.playerType){if(this.playBegin||(this.playBegin=!0,It("kZegoTaskPlayStart"+this.streamId,this.stateCenter.reportList)&&It("kZegoTaskPlayStart"+this.streamId,this.stateCenter.reportList)(oe,"play_begin")),this.isPlaySuccess(t))this.everSuccess?this.dataReport.eventEnd(this.playerReportSeq,"PlayRetry"):(this.everSuccess=!0,this.dataReport.eventStart(this.playerReportSeq,"PlayStat"),It("kZegoTaskPlayStart"+this.streamId,this.stateCenter.reportList)&&(It("kZegoTaskPlayStart"+this.streamId,this.stateCenter.reportList)(ne,"play_begin","try_urls",this.tryUrls),It("kZegoTaskPlayStart"+this.streamId,this.stateCenter.reportList)(ie,"play_begin"),It("kZegoTaskPlayStart"+this.streamId,this.stateCenter.reportList)(oe,"play_state"))),this.logger.info(Ue+" play suc: "+this.streamId),this.state=d,this.streamCenter.onPlayerStart(this.streamId,this.playerType);else if(this.shouldRetryPlay(t));else if(this.isPlayFailed(t)){this.logger.info(Ue+" play error: "+this.streamId),this.resetPlayer();It("kZegoTaskPlayStart"+this.streamId,this.stateCenter.reportList)&&(It("kZegoTaskPlayStart"+this.streamId,this.stateCenter.reportList)(ne,"play_begin","error_code",t),It("kZegoTaskPlayStart"+this.streamId,this.stateCenter.reportList)(ne,"play_begin","try_urls",this.tryUrls),It("kZegoTaskPlayStart"+this.streamId,this.stateCenter.reportList)(ie,"play_begin"),It("kZegoTaskPlayStart"+this.streamId,this.stateCenter.reportList)(se,void 0,{})),this.playBegin=!1,this.streamCenter.onPlayerStop(this.streamId,this.playerType,{code:t,msg:"play fail"})}this.everSuccess||this.dataReport.eventEnd(this.playerReportSeq,"PlayBegin")}else 1==this.playerType&&(this.pushBegin||(this.pushBegin=!0,It("kZegoTaskPublishStart"+this.streamId,this.stateCenter.reportList)&&It("kZegoTaskPublishStart"+this.streamId,this.stateCenter.reportList)(oe,"push_begin")),this.isPublishSuccess(t)?this.handlePublisherSuccess():this.shouldRetryPublish(t)||this.isPublishFailed(t)&&(this.logger.info(Ue+" publish error: "+this.streamId),this.resetPlayer(),It("kZegoTaskPublishStart"+this.streamId,this.stateCenter.reportList)&&(It("kZegoTaskPublishStart"+this.streamId,this.stateCenter.reportList)(ne,"push_begin","error_code",t),It("kZegoTaskPublishStart"+this.streamId,this.stateCenter.reportList)(ne,"push_begin","try_urls",this.tryUrls),It("kZegoTaskPublishStart"+this.streamId,this.stateCenter.reportList)(ie,"push_begin"),It("kZegoTaskPublishStart"+this.streamId,this.stateCenter.reportList)(se,void 0,{})),this.pushBegin=!1,this.streamCenter.onPlayerStop(this.streamId,this.playerType,{code:t,msg:"publish fail"})),this.everSuccess||this.dataReport.eventEnd(this.playerReportSeq,"PublishBegin"))},e.prototype.updatePlayerNetStatus=function(e){var t,o,n,i=this,s=Tr({},e.detail.info),a=null===(t=this.streamCenter.systemInfo)||void 0===t?void 0:t.platform,u=Date.now(),l=u-this.netStatusUpdateTime;if(this.netStatusUpdateTime=u,!this.isDoubledQuality&&"ios"===a&&this.netStatusUpdateTime&&l<200)this.isDoubledQuality=!0;else{if(this.isDoubledQuality){if(l>200)return void(this.cacheQualityInfo=Tr({},s));Object.keys(this.cacheQualityInfo).forEach((function(e){void 0===s[e]&&void 0!==i.cacheQualityInfo[e]&&(s[e]=i.cacheQualityInfo[e])}))}var h={videoBitrate:s.videoBitrate,audioBitrate:s.audioBitrate,videoFPS:s.videoFPS,videoHeight:s.videoHeight,videoWidth:s.videoWidth,videoGOP:s.videoGOP,netSpeed:s.netSpeed,netJitter:s.netJitter};if(this.playerInfo=h,1==this.playerType){this.everSuccess||this.handlePublisherSuccess();var c=Tr({},s||{}),d=null===(n=null===(o=this.streamCenter.pusherInstance)||void 0===o?void 0:o.attributes)||void 0===n?void 0:n.enableCamera;if("ios"!==a||!1!==d||0===c.videoWidth&&0===c.videoHeight||(c.videoWidth=0,c.videoHeight=0,this.playerInfo.videoWidth=0,this.playerInfo.videoHeight=0),0==this.publishQualitySeq&&(this.publishQualitySeq=(0,r.getReportSeq)(),this.dataReport.newReport(this.publishQualitySeq),this.dataReport.addMsgInfo(this.publishQualitySeq,{stream_id:this.streamId})),this.dataReport.addEvent(this.publishQualitySeq,"PublishQuality",c),this.publishQualityCount+=1,this.publishQualityCount>=this.publishQulaityMaxCount)Date.now()-this.playerLogUploadTime>45e3&&this.reportQualityStatics()}else if(0==this.playerType){c=Tr({},s||{});if(0==this.playQualitySeq&&(this.playQualitySeq=(0,r.getReportSeq)(),this.dataReport.newReport(this.playQualitySeq),this.dataReport.addMsgInfo(this.playQualitySeq,{stream_id:this.streamId})),this.dataReport.addEvent(this.playQualitySeq,"PlayQuality",c),this.playQualityCount+=1,this.playQualityCount>=this.playQulaityMaxCount)Date.now()-this.playerLogUploadTime>45e3&&this.reportPlayQualityStatics()}this.streamCenter.onPlayerQuality(this.streamId,h,this.playerType)}},e.prototype.getCurrentPlayerUrl=function(){return this.urls[this.playUrlIndex%this.urls.length]},e.prototype.reportQualityStatics=function(){this.dataReport.addMsgInfo(this.publishQualitySeq,{itemtype:"WXPublishStateUpdate"}),this.dataReport.uploadReport(this.publishQualitySeq,"/sdk/publish_stat_report"),this.publishQualityCount=0,this.publishQualitySeq=0,this.playerLogUploadTime=Date.now()},e.prototype.reportPlayQualityStatics=function(){this.dataReport.addMsgInfo(this.playQualitySeq,{itemtype:"WXPlayStateUpdate"}),this.dataReport.uploadReport(this.playQualitySeq,"/sdk/play_stat_report"),this.playQualityCount=0,this.playQualitySeq=0,this.playerLogUploadTime=Date.now()},e.prototype.handlePublisherSuccess=function(){this.everSuccess?this.dataReport.eventEnd(this.playerReportSeq,"PublishRetry"):(this.everSuccess=!0,this.dataReport.eventStart(this.playerReportSeq,"PublishStat"),It("kZegoTaskPublishStart"+this.streamId,this.stateCenter.reportList)&&(It("kZegoTaskPublishStart"+this.streamId,this.stateCenter.reportList)(ne,"push_begin","try_urls",this.tryUrls),It("kZegoTaskPublishStart"+this.streamId,this.stateCenter.reportList)(ie,"push_begin"),this.stateCenter.publishStreamList[this.streamId]&&this.stateCenter.publishStreamList[this.streamId].state==y&&It("kZegoTaskPublishStart"+this.streamId,this.stateCenter.reportList)(oe,"publish_state"))),this.logger.info(Ue+" play suc: "+this.streamId),this.state=d,this.streamCenter.onPlayerStart(this.streamId,this.playerType)},e}(),Pr=(Sr=function(e,t){return Sr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},Sr(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}Sr(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),Mr=0,Lr=1,kr=2,Nr=0,Or=1,Ar=function(e){function t(t,r,o){var n,i=e.call(this)||this;return i.playerList={},i.publisherList={},i.playerCount=0,i.playingList=[],i.publishingList=[],i.eventSeq=0,i.streamEventMap={},i.streamReportMap={},i.livePlayerList=[],i.playerContextMap={},i.publishSuccessCallBackList={},i.publishErrorCallBackList={},i.playSuccessCallBackList={},i.playErrorCallBackList={},i.logger=t,i.dataReport=o,i.stateCenter=r,n=my.getSystemInfoSync(),i.systemInfo={brand:n.brand,model:n.model,system:n.system,platform:n.platform,version:n.version,SDKVersion:n.SDKVersion},i}return Pr(t,e),t.prototype.updatePlayingState=function(e,t,r,o){if(this.logger.info(Ne+" "+e),null==e)return ar.error.kPlayStreamIDNullError;if(r){var n=this.playerList[e],i=this.stateCenter.reportSeqList.startPlay[e];if(this.dataReport.eventStart(i,"updatePlayingState"),n)return this.logger.error(Ne+" player already exist"),this.dataReport.eventEndWithMsgInfo(i,"updatePlayingState",{message:"player already exist"}),this.dataReport.uploadReport(i,void 0),delete this.stateCenter.reportSeqList.startPlay[e],ar.error.kPlayRepeatedPullError;var s=this.stateCenter.getPlayRoom(e)||this.stateCenter.roomList[0];if(!s)return this.logger.error(Ne+" room no found"),ar.error.kPlayNoLoginError;this.playerList[e]=new Ir(this.logger,e,this,this.dataReport,this.stateCenter,s)}return this.updateStreamState(e,r,t,this.playingList),r?(this.streamEventMap[e]=this.stateCenter.reportSeqList.startPlay[e],this.eventSeq+=1,this.streamReportMap[e]=this.eventSeq,this.dataReport.newReport(this.eventSeq),this.dataReport.eventStart(this.eventSeq,"GotPlayInfo")):this.reportPlayEvent(e,o),!0},t.prototype.updatePublishingState=function(e,t,r,o,n){if(void 0===r&&(r=""),void 0===o&&(o=!1),this.logger.info(ke+" "+t),null==t)return nr.kPublishStreamIDNullError;if(o){var i=this.publisherList[t],s=this.stateCenter.reportSeqList.startPublish[t];if(this.dataReport.eventStart(s,"updatePublishingState"),i)return this.logger.error(ke+" publisher already exist"),this.dataReport.eventEndWithMsgInfo(s,"updatePublishingState",{message:"publisher already exist"}),this.dataReport.uploadReport(s,void 0),delete this.stateCenter.reportSeqList.startPublish[t],nr.kIsPublishing;this.publisherList[t]=new Ir(this.logger,t,this,this.dataReport,this.stateCenter,e)}return this.updateStreamState(t,o,r,this.publishingList),o?(this.streamEventMap[t]=this.stateCenter.reportSeqList.startPublish[t],this.eventSeq+=1,this.streamReportMap[t]=this.eventSeq,this.dataReport.newReport(this.eventSeq),this.dataReport.eventStart(this.eventSeq,"GotPublishInfo")):this.reportPublishEvent(t,n),!0},t.prototype.updateAudioVolumeNotify=function(e,t){var r;this.logger.info("zw.w.upvn "+e+" volume: "+(null===(r=null==t?void 0:t.detail)||void 0===r?void 0:r.volume))},t.prototype.updateStreamState=function(e,t,r,o){if(e)if(r&&"string"==typeof r||(r=""),1==t)o.push({streamID:e,params:r});else for(var n=0;n<o.length;n++)if(o[n].streamID==e){o.splice(n--,1);break}},t.prototype.isPlaying=function(){return 0!=this.playingList.length},t.prototype.isPublishing=function(){return 0!=this.publishingList.length},t.prototype.startPlayingStream=function(e,t,r){if(this.logger.info(Ie+" call "+e),this.streamEventMap[e]){0==r?"cdn":1==r&&"ultra_src",Lt("kZegoTaskPlayStart"+e,this.stateCenter.reportList,ne,"get_play_url"),Lt("kZegoTaskPlayStart"+e,this.stateCenter.reportList,ne,"get_play_url")}var o=this.streamReportMap[e];return o&&this.dataReport.eventEndWithMsg(o,"GotPlayInfo",{type:0==r?"cdn":"ultra_src",urls:t}),this.logger.info("".concat(Ie," call ").concat(e,", urls:").concat(JSON.stringify(t),", type:").concat(r)),this.startPlayer(e,t,r,Nr)},t.prototype.startPlayer=function(e,t,r,o){var n=this.playerList[e];if(o==Or&&(n=this.publisherList[e]),!n)return this.logger.error(Pe+" player don't exist"),!1;var i=[];o==Nr?i=this.playingList:o==Or&&(i=this.publishingList);for(var s=!1,a="",u=0;u<i.length;u++)if(i[u].streamID==e){s=!0,a=i[u].params;break}if(!s)return this.logger.warn(Pe+" should not start"),!1;if(n.urls=t,n.params=a,n.reconnectLimit=this.getReconnectLimit(r),n.dispatchType=r,n.playerType=o,n.playerSeq=this.streamEventMap[e],n.playerReportSeq=this.streamReportMap[e],!n)return this.logger.info(Pe+" new player failed"),!1;++this.playerCount;var l=n.tryStartPlayer(0);return this.logger.info(Pe+" call result: "+l),!0},t.prototype.getNextUrl=function(e){this.logger.info(Oe+" call "+e);var t,o=this.publisherList[e]||this.playerList[e];if(!o)return this.logger.error(Oe+" player don't exist"),"";this.publishingList.find((function(t){return t.streamID===e}))?(t=!0,this.onPublishStateUpdate(ee,e,{code:0,message:""})):(t=!1,this.onPlayStateUpdate(kr,e,{code:0,message:""}));var n=o.getPlayerUrl();if(t){if(!this.stateCenter.reportSeqList.startPublish[e]){var i=(0,r.getReportSeq)();this.stateCenter.reportSeqList.startPublish[e]=i,this.dataReport.newReport(i,"/sdk/republish"),o.pushBegin=!1,Mt("kZegoTaskPublishStart"+e,this.dataReport,i,this.stateCenter.reportList)}}else if(!this.stateCenter.reportSeqList.startPlay[e]){i=(0,r.getReportSeq)();this.stateCenter.reportSeqList.startPlay[e]=i,this.dataReport.newReport(i,"/sdk/replay"),o.playBegin=!1,Mt("kZegoTaskPlayStart"+e,this.dataReport,i,this.stateCenter.reportList)}return n},t.prototype.stopPlayingStream=function(e,t){this.logger.info("zw.scw.sps.1.0 call "+e),null!=e&&(this.stopPlayer(e),delete this.streamEventMap[e],this.updatePlayingState(e,void 0,void 0,t),delete this.streamReportMap[e],delete this.playSuccessCallBackList[e],delete this.playErrorCallBackList[e])},t.prototype.stopPlayer=function(e){this.logger.info(Ae+" call "+e);var t=this.playerList[e],r=this.publisherList[e];t||r?(t&&(t.stopPlayer(),t.reportPlayQualityStatics(),delete this.playerList[e]),r&&(r.stopPlayer(),r.reportQualityStatics(),delete this.publisherList[e]),--this.playerCount):this.logger.info(Ae+" play not exist "+e),this.logger.info(Ae+" call success")},t.prototype.startPublishingStream=function(e,t,r){if(this.logger.info(Te+" call "+e),this.streamEventMap[e]){0==r?"cdn":1==r&&"ultra_src",Lt("kZegoTaskPublishStart"+e,this.stateCenter.reportList,ne,"type"),Lt("kZegoTaskPublishStart"+e,this.stateCenter.reportList,ne,"urls")}var o=this.streamReportMap[e];return o&&this.dataReport.eventEndWithMsg(o,"GotPublishInfo",{type:0==r?"cdn":"ultra_src",urls:t}),this.logger.info("".concat(Te," call ").concat(e,", urls:").concat(JSON.stringify(t),", type:").concat(r)),this.startPlayer(e,t,r,Or)},t.prototype.stopPublishingStream=function(e,t){if(void 0===t&&(t={code:0,message:""}),this.logger.info("zw.scw.sps.0.0 call "+e),null!=e){var r=this.publisherList[e].room,o=this.publisherList[e];if(o&&o.state!==p&&r.streamHandler.onPublishStateUpdate(J,e,t),this.stopPlayer(e),delete this.streamEventMap[e],this.updatePublishingState(r,e,"",!1,t),delete this.streamReportMap[e],this.stateCenter.publishStreamList[e]){if(this.stateCenter.publishStreamList[e].state>=v){r.streamHandler.updateStreamInfo(e,b);for(var n=0;n<r.streamList.length;n++)if(r.streamList[n].stream_id==e){r.streamList.splice(n--,1);break}}delete this.stateCenter.publishStreamList[e]}this.stateCenter.streamUrlMap[e]&&delete this.stateCenter.streamUrlMap[e]}},t.prototype.updatePlayerState=function(e,t){var r=this.playerList[e],o=this.publisherList[e];r||o?(r&&r.updateEvent(t),o&&o.updateEvent(t)):this.logger.error(Me+" no player "+e),this.logger.info(Me+" updatePlayerEvent success")},t.prototype.updatePlayerNetStatus=function(e,t){var r=this.playerList[e],o=this.publisherList[e];r||o?(r&&r.updatePlayerNetStatus(t),o&&o.updatePlayerNetStatus(t)):this.logger.error(Le+" no player "+e),this.logger.info(Le+" updatePlayerNetStatus success"+e)},t.prototype.reset=function(e,t){var r,o;for(var n in this.logger.info(Re+" call"),this.publisherList){this.publisherList[n].room.roomID!=e&&e||(this.stopPublishingStream(n,{code:t||0,message:""}),this.pusherInstance&&this.pusherInstance.stop())}this.pusherInstance=void 0;var i=function(n){var i=s.playerList[n].room;if(i.roomID!=e||!i.streamList.find((function(e){return e.stream_id==n}))&&1!=s.stateCenter.roomList.length){if(i.roomID==e&&s.stateCenter.roomList.length>1){var a=s.stateCenter.roomList.find((function(t){return t.roomID!==e}));a?s.playerList[n].room=a:(s.stopPlayingStream(n,{code:t||0,message:""}),null===(o=s.livePlayerList.find((function(e){return e.attributes.id==n})))||void 0===o||o.stop())}}else s.stopPlayingStream(n,{code:t||0,message:""}),null===(r=s.livePlayerList.find((function(e){return e.attributes.id==n})))||void 0===r||r.stop()},s=this;for(var a in this.playerList)i(a);this.livePlayerList=[],this.playerContextMap={},this.logger.info(Re+" call success")},t.prototype.reportPublishEvent=function(e,t){if(this.streamReportMap[e]){var r=this.streamReportMap[e];this.dataReport.addMsgExt(r,{stream:e}),t&&t.code&&this.dataReport.addMsgInfo(r,{error:t.code}),this.dataReport.addMsgInfo(r,{itemtype:"WXPublishStream"}),this.dataReport.uploadReport(r,"WXPublishStream"),delete this.streamReportMap[e]}},t.prototype.reportPlayEvent=function(e,t){if(this.streamReportMap[e]){var r=this.streamReportMap[e];this.dataReport.addMsgExt(r,{stream:e}),t&&t.code&&this.dataReport.addMsgInfo(r,{error:t.code}),this.dataReport.addMsgInfo(r,{itemtype:"WXPlayStream"}),this.dataReport.uploadReport(r,"WXPlayStream"),delete this.streamReportMap[e]}},t.prototype.onPlayStateUpdate=function(e,t,r){},t.prototype.onPlayQualityUpdate=function(e,t){},t.prototype.onPublishStateUpdate=function(e,t,r){},t.prototype.onPublishQualityUpdate=function(e,t){},t.prototype.onPublisherStreamUrlUpdate=function(e,t){},t.prototype.onPublisherStreamUrlFail=function(e,t){},t.prototype.onPlayerStreamUrlUpdate=function(e,t){},t.prototype.getReconnectLimit=function(e){return 1},t.prototype.onPlayerStart=function(e,t){this.logger.info("zw.scw.ops.0 call "+e),t==Nr?this.onPlayStateUpdate(Mr,e,{code:0,message:""}):t==Or&&this.onPublishStateUpdate(Mr,e,{code:0,message:""})},t.prototype.onPlayerStop=function(e,t,r){this.logger.info(we+" call "+e),t==Nr?(this.reportPlayEvent(e,r),this.logger.warn(we+" play error"),this.onPlayStateUpdate(Lr,e,r)):t==Or&&(this.reportPublishEvent(e,r),this.logger.warn(we+" publish error"),this.onPublishStateUpdate(Lr,e,r))},t.prototype.onPlayerRetry=function(e,t){this.logger.info("zw.scw.opr call "+e),t==Nr?this.onPlayStateUpdate(kr,e,{code:0,message:""}):t==Or&&this.onPublishStateUpdate(kr,e,{code:0,message:""})},t.prototype.onPlayerQuality=function(e,t,r){var o={video:{videoBitrate:t.videoBitrate,videoFPS:t.videoFPS,videoWidth:t.videoWidth,videoHeight:t.videoHeight},audio:{audioBitrate:t.audioBitrate}};r==Nr?this.onPlayQualityUpdate(e,o):r==Or&&this.onPublishQualityUpdate(e,o)},t.prototype.onStreamUrlUpdate=function(e,t,r){this.logger.info("zw.scw.opuu.0 call "+e),0==r?this.playSuccessCallBackList[e](e,t):this.publishSuccessCallBackList[e](e,t)},t.prototype.getTotalStreamId=function(e){return e},t.prototype.getRealStreamId=function(e){return e},t.prototype.getRoomByStreamID=function(e){return this.publisherList[e]?this.publisherList[e].room:this.playerList[e]?this.playerList[e].room:void 0},t.prototype.getCDNUrl=function(e,t){this.logger.info("zw.scw.gcu call");var r=[],o=this.stateCenter.appConfig.media_config.play_config.resource_info;if(1==t&&(o=this.stateCenter.appConfig.media_config.publish_config.resource_info),o.length){var n=o.find((function(e){return 0==e.resource_type}));if(n)for(var i=0;i<n.service_info.length;i++){var s=n.service_info[i],a=s.protocol,l=s.url_template.replace("{STREAM_NAME}",e);if(a===u.RTMP)r.push(l)}}return this.logger.info("zw.scw.gcu rtmps:"+JSON.stringify(r)),{rtmps:r}},t}(Rr),wr=function(){function e(e,t,r,o,n){void 0===n&&(n=1),this.reporter=r,this.logger=e,this.dataReport=t,this.RTM=o,this.stateCenter=new Qt(this.logger,this.dataReport),this.stateCenter.clientType="wxMini",this.streamCenter=new Ar(this.logger,this.stateCenter,this.dataReport),this.wechatMiniModules=new Cr(this.logger,this.dataReport,r,this.stateCenter,this.streamCenter,this.RTM),this.initTracer(r)}return e.prototype.checkSystemRequirements=function(){return this.wechatMiniModules.checkSystemRequirements()},e.prototype.getVersion=function(){return"1.0.0"},e.prototype.on=function(e,t){return this.wechatMiniModules.bindListener(e,t)},e.prototype.off=function(e,t){return this.wechatMiniModules.deleteListener(e,t)},e.prototype.startPublishingStream=function(e,t){return this.wechatMiniModules.publishModule.startPublishingStream(e,t)},e.prototype.stopPublishingStream=function(e){return this.wechatMiniModules.publishModule.stopPublishingStream(e)},e.prototype.getNextUrl=function(e){return this.wechatMiniModules.getNextUrl(e)},e.prototype.setCustomSignalUrl=function(e,t){if(void 0===t&&(t=!0),this.logger.info(de+" call: "+JSON.stringify(e)),!e||0==e.length)return this.logger.error(de+" param error"),!1;var r=!0;return e.forEach((function(e){return 0!=e.indexOf("rtmp://")&&(r=!1)})),r?(t?this.stateCenter.customUrl=e:this.stateCenter.customPlayUrl=e,!0):(this.logger.error(de+" url is not correct"),!1)},e.prototype.addPublishCdnUrl=function(e,t){return this.logger.info("zw.apcu call "+e+" "+t),this.wechatMiniModules.streamCDNModule?this.wechatMiniModules.streamCDNModule.publishTarget({type:"addpush",streamID:e,pushUrl:t}):new Promise((function(e,t){console.error("should install advanced module"),e({errorCode:-1,extendedData:"should install advanced module"})}))},e.prototype.removePublishCdnUrl=function(e,t){return this.logger.info("zw.rpcu call "+e+" "+t),this.wechatMiniModules.streamCDNModule?this.wechatMiniModules.streamCDNModule.publishTarget({type:"delpush",streamID:e,pushUrl:t}):new Promise((function(e,t){console.error("should install advanced module"),e({errorCode:-1,extendedData:"should install advanced module"})}))},e.prototype.startMixerTask=function(e){return new Promise((function(e,t){console.error("未引入混流模块"),t()}))},e.prototype.setMixerTaskConfig=function(e){return new Promise((function(e,t){console.error("未引入混流模块"),t()}))},e.prototype.stopMixerTask=function(e){return new Promise((function(e,t){console.error("未引入混流模块"),t()}))},e.prototype.setStreamExtraInfo=function(e,t){return this.wechatMiniModules.streamCommon.setStreamExtraInfo(e,t)},e.prototype.startPlayingStream=function(e,t){return this.wechatMiniModules.playModule.startPlayingStream(e,t)},e.prototype.stopPlayingStream=function(e){this.wechatMiniModules.playModule.stopPlayingStream(e)},e.prototype.updatePlayerState=function(e,t){this.wechatMiniModules.updatePlayerState(e,t)},e.prototype.updatePlayerNetStatus=function(e,t){this.wechatMiniModules.updatePlayerNetStatus(e,t)},e.use=function(t){switch(t.type){case"MixStream":t.install(e,Zt,Cr);break;case"StreamCDN":t.install(e,Cr,Zt)}},e.prototype.updateAudioVolumeNotify=function(e,t){this.wechatMiniModules.updateAudioVolumeNotify(e,t)},e.prototype.initContext=function(e){e.wxContext&&(this.wxContext=e.wxContext),e.pushAtr&&(this.pushAtr=e.pushAtr),e.playAtr&&(this.playAtr=e.playAtr)},e.prototype.setPusherAttributes=function(e,t){var r;this.logger.info("zw.spa.0 call"),this.wechatMiniModules.streamCenter.pusherInstance?(null===(r=this.wechatMiniModules.streamCenter.pusherInstance)||void 0===r||r.setPusherAttributes(e,t),this.logger.info("zw.spa.0 call success")):this.logger.error("zw.spa.0 publisher no found")},e.prototype.setPlayerAttributes=function(e,t,r){if(this.logger.info("zw.spa.1 call"),"string"==typeof e&&"string"==typeof this.playAtr){var o=this.wechatMiniModules.streamCenter.livePlayerList.find((function(t){return t.attributes.id==e}));o?(o.setPlayerAttributes(t,r),this.logger.info("zw.spa.1 call success")):this.logger.error("zw.spa.1 player no found")}else this.logger.error("zw.spa.1 stream no found")},e.prototype.getPlayerList=function(e){if(this.logger.info("zw.gpl call"),void 0!==e&&"string"!=typeof e||"string"!=typeof this.playAtr)return this.logger.error("zw.gpl param error"),[];if(e){var t=this.wechatMiniModules.streamCenter.livePlayerList.find((function(t){return t.attributes.id==e}));return t?[t.attributes]:[]}return this.logger.info("zw.gpl call success"),this.wechatMiniModules.streamCenter.livePlayerList.map((function(e){return e.attributes}))},e.prototype.mutePublishStreamVideo=function(e){this.setPusherAttributes({enableCamera:!e})},e.prototype.mutePublishStreamAudio=function(e){this.setPusherAttributes({enableMic:!e})},e.prototype.mutePlayStreamVideo=function(e,t){this.setPlayerAttributes(e,{muteVideo:t})},e.prototype.mutePlayStreamAudio=function(e,t){this.setPlayerAttributes(e,{muteAudio:t})},e.prototype.setPlayData=function(e){if(this.logger.info("zw.spd call"),this.wxContext&&this.playAtr){void 0!==e&&"function"!=typeof e&&this.logger.error("zw.spd callBack is not function");var t={};t[this.playAtr]=this.wechatMiniModules.streamCenter.livePlayerList.map((function(e){return e.attributes})),this.wxContext.setData(t,e),this.logger.info("zw.spd call success")}else this.logger.error("zw.spd init context wrong")},e.prototype.initTracer=function(e){this.stateCenter.reporter=e},e}(),Dr=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),Ur=function(e){function t(t,o){var n=this;return r.ZegoExpressWebRTMEngine.version="1.0.0",(n=e.call(this,t,o,1)||this).zegoWechatMini=new wr(n.logger,n.dataReport,n.reporter,n.zegoWebRTM),n}return Dr(t,e),t.prototype.getNextUrl=function(e){return this.zegoWechatMini.getNextUrl(e)},t.prototype.startPlayingStream=function(e,t){return this.zegoWechatMini.startPlayingStream(e,t)},t.prototype.stopPlayingStream=function(e){return this.zegoWechatMini.stopPlayingStream(e)},t.prototype.updatePlayerNetStatus=function(e,t){return this.zegoWechatMini.updatePlayerNetStatus(e,t)},t.prototype.updatePlayerState=function(e,t){return this.zegoWechatMini.updatePlayerState(e,t)},t.prototype.updateAudioVolumeNotify=function(e,t){return this.zegoWechatMini.updateAudioVolumeNotify(e,t)},t.prototype.checkSystemRequirements=function(){return this.zegoWechatMini.checkSystemRequirements()},t.prototype.setMixerTaskConfig=function(e){return this.zegoWechatMini.setMixerTaskConfig(e)},t.prototype.startMixerTask=function(e){return this.zegoWechatMini.startMixerTask(e)},t.prototype.off=function(e,t){return this.zegoWebRTM.stateCenter.listenerList[e]?this.zegoWebRTM.off(e,t):!!this.zegoWechatMini.stateCenter.listenerList[e]&&this.zegoWechatMini.off(e,t)},t.prototype.stopMixerTask=function(e){return this.zegoWechatMini.stopMixerTask(e)},t.prototype.on=function(e,t){return this.zegoWebRTM.stateCenter.listenerList[e]?this.zegoWebRTM.on(e,t):!!this.zegoWechatMini.stateCenter.listenerList[e]&&this.zegoWechatMini.on(e,t)},t.prototype.startPublishingStream=function(e,t){return this.zegoWechatMini.startPublishingStream(e,t)},t.prototype.stopPublishingStream=function(e){return this.zegoWechatMini.stopPublishingStream(e)},t.prototype.addPublishCdnUrl=function(e,t){return 3===arguments.length?this.zegoWechatMini.addPublishCdnUrl(arguments[0],arguments[2]):this.zegoWechatMini.addPublishCdnUrl(e,t)},t.prototype.removePublishCdnUrl=function(e,t){return 3===arguments.length?this.zegoWechatMini.removePublishCdnUrl(arguments[0],arguments[2]):this.zegoWechatMini.removePublishCdnUrl(e,t)},t.prototype.setStreamExtraInfo=function(e,t){return this.zegoWechatMini.setStreamExtraInfo(e,t)},t.use=function(e){r.ZegoExpressWebRTMEngine.use(e),wr.use(e)},t.prototype.initContext=function(e){this.zegoWechatMini.initContext(e)},t.prototype.mutePublishStreamVideo=function(e){this.zegoWechatMini.mutePublishStreamVideo(e)},t.prototype.mutePublishStreamAudio=function(e){this.zegoWechatMini.mutePublishStreamAudio(e)},t.prototype.mutePlayStreamVideo=function(e,t){this.zegoWechatMini.mutePlayStreamVideo(e,t)},t.prototype.mutePlayStreamAudio=function(e,t){this.zegoWechatMini.mutePlayStreamAudio(e,t)},t.prototype.setPusherAttributes=function(e){this.zegoWechatMini.setPusherAttributes(e)},t.prototype.setPlayerAttributes=function(e,t){this.zegoWechatMini.setPlayerAttributes(e,t)},t.prototype.getPlayerList=function(e){return this.zegoWechatMini.getPlayerList(e)},t}(r.ZegoExpressWebRTMEngine),xr=__webpack_require__(533),Hr=__webpack_require__.n(xr);!function(e){e[e.I=0]="I",e[e.H=10]="H",e[e.M=100]="M",e[e.L=1e3]="L"}(Er||(Er={}));var qr={},Br={_sendCDNPublishByAccessHub:function(e,t,r,o){},_publishTarget:function(e,t,r){this.logger.info("zb.sh.ptcall");var o=e.streamID;this.stateCenter.testEnvironment&&(o="zegotest-"+this.stateCenter.appid+"-"+e.streamID),this.stateCenter.useNetAgent?this._sendCDNPublishByAccessHub(o,e,t,r):this._sendCDNPublishByAccessSvr(o,e,t,r)}},Gr={code:1103052,message:"publisher cdn push error"},zr=function(){function e(e,t,r,o){this.logger=e,this.dataReport=t,this.streamCenter=r,this.stateCenter=o,this.screenShotReady=!1}return e.prototype.publishTarget=function(e){var t=this,r="";switch(e.type){case"addpush":r=St;break;case"delpush":case"clearpush":r=Et}var o=this.stateCenter.reporter.createSpan(Er.H,{key:ct,par:e.streamID},{key:""},r);return o.setAttributes({url:bt(e.pushUrl)}),new Promise((function(r,n){var i=function(e,r){t.logger.error("zb.pt "+(r||e.message)),t.stateCenter.reporter.setError(o,e,r),n({errorCode:e.code,extendedData:e.message+(r?" "+r:"")})};if(-1==["addpush","delpush","clearpush"].indexOf(e.type))return t.logger.error("zb.sh.pt cdn push type error"),void i(Gr,"type error");if(e.streamID&&"string"==typeof e.streamID)if(e.pushUrl&&"string"==typeof e.pushUrl)if(t.stateCenter.publishStreamList[e.streamID]){var s=t.streamCenter.getRoomByStreamID(e.streamID);if(s){s.streamHandler._publishTarget(e,(function(e){o.end(),r(e)}),i)}else i(vt.kNoLoginError)}else i(vt.kPublishStreamNoFoundError);else i(vt.kParamError,"push url error");else i(vt.kParamError,"stream id type error")}))},e}();const Vr={type:"StreamCDN",install:function(e,t,r){for(var o in Object.defineProperty(t.prototype,"initStreamCDN",{value:function(){this.streamCDNModule=new zr(this.logger,this.dataReport,this.streamCenter,this.stateCenter)},writable:!1}),qr)Object.defineProperty(e.prototype,o,{value:qr[o],writable:!1});for(var o in Br)Object.defineProperty(r.prototype,o,{value:Br[o],writable:!1})}};var Wr,jr={NOT_LOGIN:{code:1000002,message:"not login room"},INPUT_PARAM:{code:1100001,message:"input param error."},TIMEOUT:{code:1100002,message:"network timeout."},MIXER_NO_SERVICES:{code:1005e3,message:"no mix stream service"},MIXER_TASK_ID_NULL:{code:1005001,message:"mixer task is null"},MIXER_TASK_ID_TOO_LONG:{code:1005002,message:"task ID is too long"},MIXER_TASK_ID_INVALID_CHARACTER:{code:1005003,message:"task ID contains illegal characters"},MIXER_NO_OUTPUT_TARGET:{code:1005005,message:"task configuration does not specify output"},MIXER_OUTPUT_TARGET_INVALID:{code:1005006,message:"stream output target is incorrect"},MIXER_START_REQUEST_ERROR:{code:1005010,message:"start mixer task fail, possibly due to network reasons"},MIXER_STOP_REQUEST_ERROR:{code:1005011,message:"stop mixer task fail, possibly due to network reasons"},MIXER_NOT_OWNER_STOP_MIXER:{code:1005012,message:" maxed task must be stopped by the start user of the task"},MIXER_INPUTLIST_NULL:{code:1005020,message:"Mixed stream task input list is null"},MIXER_OUTPUTLIST_NULL:{code:1005021,message:"Mixed stream task output list is null"},MIXER_VIDEO_CONFIG_INVALID:{code:1005023,message:"invalid mixed stream task video configuration"},MIXER_EXCEED_MAX_INPUT_COUNT:{code:1005025,message:"more than the maximum number of input streams"},MIXER_INPUT_STREAM_NOT_EXISTS:{code:1005026,message:"Input stream does not exist"},MIXER_INPUT_PARAMETERS_ERROR:{code:1005027,message:"mix stream input parameters are wrong"},MIXER_INPUT_LABEL_TOO_LONG:{code:1005028,message:"Input stream label text is too long"},MIXER_EXCEED_MAX_OUTPUT_COUNT:{code:1005030,message:"more than the maximum number of output streams"},MIXER_INPUT_IMAGE_URL_TOO_LONG:{code:1005034,message:"Input stream image url too long"},MIXER_INPUT_IMAGE_FORMAT_WRONG:{code:1005035,message:"Input stream image format wrong"},MIXER_INPUT_IMAGE_GET_FAIL:{code:1005036,message:"Input stream image get fail"},MIXER_AUTHENTICATION_FAILED:{code:1005050,message:"mixed stream authentication failed"},MIXER_WATERMARK_NULL:{code:1005061,mag:"input watermark is null"},MIXER_WATERMARK_PARAMETERS_ERROR:{code:1005062,message:"input watermark parameter is wrong"},MIXER_WATERMARK_URL_INVALID:{code:1005063,message:"illegal input watermark URL"},MIXER_BACKGROUND_IMAGE_URL_INVALID:{code:1005067,message:"illegal input background image URL"},MIXER_REPEAT_INPUT:{code:1005099,message:"mix stream input repeat"},MIXER_INNER_ERROR:{code:1005099,message:"mixer internal error"}},Fr="/sdk/init",Yr={event:"/mix/start_mix",error:{kParamError:jr.INPUT_PARAM,kTaskIDNullError:jr.MIXER_TASK_ID_NULL,kTaskIDToLongError:jr.MIXER_TASK_ID_TOO_LONG,kTaskIDInvalidCharacterError:jr.MIXER_TASK_ID_INVALID_CHARACTER,kInputListNullError:jr.MIXER_INPUTLIST_NULL,kOutputListNullError:jr.MIXER_OUTPUTLIST_NULL,kOutputTargetInvalidError:jr.MIXER_OUTPUT_TARGET_INVALID,kOutputNoTargetError:jr.MIXER_NO_OUTPUT_TARGET,kRequestError:jr.MIXER_START_REQUEST_ERROR,kInternalError:jr.MIXER_INNER_ERROR,kInputLabelTextTooLong:jr.MIXER_INPUT_LABEL_TOO_LONG,kInputImageURLTooLong:jr.MIXER_INPUT_IMAGE_URL_TOO_LONG,kInputImageFormatWrong:jr.MIXER_INPUT_IMAGE_FORMAT_WRONG,kMixerWatermarkURLInvalid:jr.MIXER_WATERMARK_URL_INVALID,kNoLoginError:jr.NOT_LOGIN},mix_stream_conf:it,stop_reason:st},Kr={event:"/mix/stop_mix",error:{kParamError:jr.INPUT_PARAM,kTaskIDNullError:jr.MIXER_TASK_ID_NULL,kRequestError:jr.MIXER_STOP_REQUEST_ERROR,kInternalError:jr.MIXER_INNER_ERROR,kNoLoginError:jr.NOT_LOGIN}},$r={event:"/mix/config_mix",error:{kParamError:jr.INPUT_PARAM,kVideoConfigInvalidError:jr.MIXER_VIDEO_CONFIG_INVALID,kBackgroundImageUrlInvalidError:jr.MIXER_BACKGROUND_IMAGE_URL_INVALID,kNoLoginError:jr.NOT_LOGIN},mix_params:it},Qr=function(){return Qr=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},Qr.apply(this,arguments)};function Xr(e,t){var r,o,n,i,s="",a=jr;return t.errorCode<2e9&&t.errorCode>1e9?(n={1:"MIXER_START_REQUEST_ERROR",2:"MIXER_START_REQUEST_ERROR",3:"MIXER_AUTHENTICATION_FAILED",141:"MIXER_INPUT_IMAGE_FORMAT_WRONG",142:"MIXER_INPUT_IMAGE_GET_FAIL",150:"MIXER_INPUT_STREAM_NOT_EXISTS",151:"MIXER_START_REQUEST_ERROR",152:"MIXER_STOP_REQUEST_ERROR",153:"MIXER_INPUT_PARAMETERS_ERROR",154:"MIXER_EXCEED_MAX_OUTPUT_COUNT",155:"MIXER_INPUT_PARAMETERS_ERROR",156:"MIXER_VIDEO_CONFIG_INVALID",157:"MIXER_NO_SERVICES",158:"MIXER_EXCEED_MAX_INPUT_COUNT",159:"MIXER_START_REQUEST_ERROR",160:"MIXER_NOT_OWNER_STOPMIXER",170:"MIXER_WATERMARK_PARAMETERS_ERROR",171:"MIXER_WATERMARK_NULL",175:"MIXER_REPEAT_INPUT",179:"MIXER_INPUT_LABEL_TOO_LONG",190:"MIXER_START_REQUEST_ERROR"},i="MIXER_INNER_ERROR",(o=t.errorCode-1e4)>1e9&&n[o-1e9]&&(i=n[o-1e9]),r=a[s=i]):t.errorCode<1e6&&(r=e.decodeServerError(t.errorCode,t.extendedData),s=e.getLiveRoomError(t.errorCode,this.stateCenter.useNetAgent)),{reportErr:r,actualError:a[s]}}!function(e){e[e.I=0]="I",e[e.H=10]="H",e[e.M=100]="M",e[e.L=1e3]="L"}(Wr||(Wr={}));var Zr={},Jr={startMixerTask:function(e){var t=this;return new Promise((function(r,o){var n,i,s,a,u,l,h,c,d,p,g,m=t.stateCenter.reporter.createSpan(Wr.H,{key:Fr},{key:Yr.event,par:e.taskID},Yr.event,!0),f={errorCode:jr.MIXER_INPUT_PARAMETERS_ERROR.code,extendedData:jr.MIXER_INPUT_PARAMETERS_ERROR.message};if(!!(null==e?void 0:e.inputList.find((function(e){return null==e.streamID&&(f.extendedData=f.extendedData+". streamID should be of string type",!0)}))))return t.stateCenter.reporter.setError(m,jr.MIXER_INPUT_PARAMETERS_ERROR),void o(f);e.outputConfig&&e.outputConfig.outputFps&&(e.outputConfig.outputFPS=e.outputConfig.outputFps);var _=function(r){var n=Xr(t.stateCenter,r),i=n.reportErr,s=n.actualError;1005026===r.errorCode&&m.setAttributes({stop_reason:"UnmatchStreamId"}),t.stateCenter.reporter.setError(m,i||r),t.stateCenter.reporter.spanEnd({key:Yr.event,par:e.taskID}),s&&(r.errorCode=null==s?void 0:s.code,r.extendedData=(null==s?void 0:s.message)||""),o(r)},y=t.stateCenter.roomList[0];if(y){var v,S=[];if(!e.noTaskID&&!e.taskID)return t.logger.error("zb.sh.ums no taskId found"),void _({errorCode:Yr.error.kTaskIDNullError.code,extendedData:Yr.error.kTaskIDNullError.message});if(!e.noTaskID&&"string"!=typeof e.taskID)return t.logger.error("zb.rh.lg taskId must be string"),void _({errorCode:Yr.error.kParamError.code,extendedData:Yr.error.kParamError.message});if(!e.noTaskID&&e.taskID.length>256)return t.logger.error("zb.sh.ums taskId is too long"),void _({errorCode:Yr.error.kTaskIDToLongError.code,extendedData:Yr.error.kTaskIDToLongError.message});if(!e.noTaskID&&!t.stateCenter.checkIllegalCharacters(e.taskID))return t.logger.error("zb.sh.ums task ID contains illegal characters"),void _({errorCode:Yr.error.kTaskIDInvalidCharacterError.code,extendedData:Yr.error.kTaskIDInvalidCharacterError.message});if(!e.inputList||0==e.inputList.length)return t.logger.error("zb.sh.ums input list wrong"),void _({errorCode:Yr.error.kInputListNullError.code,extendedData:Yr.error.kInputListNullError.message});e.inputList.forEach((function(e){"AUDIO"===e.contentType&&(!e.layout&&(e.layout={top:0,left:0,bottom:0,right:0}),e.layout.top=0,e.layout.left=0,e.layout.bottom=1,e.layout.right=1)}));for(var E=0;E<e.inputList.length;E++){var b=e.inputList[E],C={errorCode:Yr.error.kParamError.code,extendedData:Yr.error.kParamError.message};if("object"!=typeof b.layout)return t.logger.error("zb.sh.ums input layout must be object"),void _(C);if(!(t.stateCenter.checkInteger(b.layout.top,!1)&&t.stateCenter.checkInteger(b.layout.bottom,!1)&&t.stateCenter.checkInteger(b.layout.left,!1)&&t.stateCenter.checkInteger(b.layout.right,!1)))return t.logger.error("zb.sh.ums top、left、bottom、right must be integer number"),void _(C);if(void 0!==b.renderMode&&![0,1].includes(b.renderMode))return t.logger.error("zb.sh.ums render_mode is wrong"),void _(C);if(void 0!==b.imageInfo){if("string"!=typeof b.imageInfo.url)return t.logger.error("zb.sh.ums image url is require string"),void _(C);if(b.imageInfo.url.length>1024)return t.logger.error("zb.sh.ums input image url length too long"),void _({errorCode:Yr.error.kInputImageURLTooLong.code,extendedData:Yr.error.kInputImageURLTooLong.message})}if(void 0!==b.label){if("string"!=typeof(null===(n=b.label)||void 0===n?void 0:n.text)||(null===(i=b.label)||void 0===i?void 0:i.text.length)>=300)return t.logger.error("zb.sh.ums input label text is not string or too long"),void _({errorCode:Yr.error.kInputLabelTextTooLong.code,extendedData:Yr.error.kInputLabelTextTooLong.message});if(void 0!==(null===(s=b.label)||void 0===s?void 0:s.left)&&!t.stateCenter.checkInteger(null===(a=b.label)||void 0===a?void 0:a.left,!1)||void 0!==(null===(u=b.label)||void 0===u?void 0:u.top)&&!t.stateCenter.checkInteger(null===(l=b.label)||void 0===l?void 0:l.top,!1))return t.logger.error("zb.sh.ums input label left and top should be integer"),void _(C)}if(void 0!==b.cornerRadius&&!t.stateCenter.checkInteger(b.cornerRadius,!1))return t.logger.error("zb.sh.ums cornerRadius is wrong"),void _(C)}if(!e.outputList||0==e.outputList.length)return t.logger.error("zb.sh.ums no output list found"),void _({errorCode:Yr.error.kOutputListNullError.code,extendedData:Yr.error.kOutputListNullError.message});if(e.outputList.some((function(e){return"string"==typeof e&&!t.stateCenter.isUrl(e)&&!t.stateCenter.checkIllegalCharacters(e)||"object"==typeof e&&e.target&&!t.stateCenter.isUrl(e.target)&&!t.stateCenter.checkIllegalCharacters(e.target)})))return t.logger.error("zb.sh.ums stream output target is incorrect"),void _({errorCode:Yr.error.kOutputTargetInvalidError.code,extendedData:Yr.error.kOutputTargetInvalidError.message});if(!((v=e.inputList.every((function(e){return"AUDIO"===e.contentType})))||e.outputConfig&&"object"==typeof e.outputConfig))return t.logger.error("zb.sh.ums no output config found"),void _({errorCode:Yr.error.kOutputNoTargetError.code,extendedData:Yr.error.kOutputNoTargetError.message});if(v&&(e.outputConfig=Qr(Qr({},e.outputConfig||{}),{outputBitrate:.001,outputFPS:1,outputWidth:1,outputHeight:1})),!(v||e.outputConfig.outputBitrate&&t.stateCenter.checkInteger(e.outputConfig.outputBitrate)))return t.logger.error("zb.sh.ums bitrate param is required and must be integer number"),void _({errorCode:Yr.error.kParamError.code,extendedData:Yr.error.kParamError.message});if(!e.outputConfig.outputFPS||!t.stateCenter.checkInteger(e.outputConfig.outputFPS))return t.logger.error("zb.sh.ums fps param is required and must be integer number"),void _({errorCode:Yr.error.kParamError.code,extendedData:Yr.error.kParamError.message});if(!e.outputConfig.outputWidth||!t.stateCenter.checkInteger(e.outputConfig.outputWidth))return t.logger.error("zb.sh.ums width param is required and must be integer number"),void _({errorCode:Yr.error.kParamError.code,extendedData:Yr.error.kParamError.message});if(!e.outputConfig.outputHeight||!t.stateCenter.checkInteger(e.outputConfig.outputHeight))return t.logger.error("zb.sh.ums height param is required and must be integer number"),void _({errorCode:Yr.error.kParamError.code,extendedData:Yr.error.kParamError.message});if(void 0!==e.outputConfig.outputAudioCodecID&&!t.stateCenter.checkInteger(e.outputConfig.outputAudioCodecID,!1))return t.logger.error("zb.sh.ums AudioCodecID param must be integer number"),void _({errorCode:Yr.error.kParamError.code,extendedData:Yr.error.kParamError.message});if(void 0!==e.outputConfig.outputAudioBitrate&&!t.stateCenter.checkInteger(e.outputConfig.outputAudioBitrate))return t.logger.error("zb.sh.ums AudioBitrate param must be integer number"),void _({errorCode:Yr.error.kParamError.code,extendedData:Yr.error.kParamError.message});if(void 0!==e.outputConfig.outputAudioChannels&&!t.stateCenter.checkInteger(e.outputConfig.outputAudioChannels,!1))return t.logger.error("zb.sh.ums AudioChannels param must be integer number"),void _({errorCode:Yr.error.kParamError.code,extendedData:Yr.error.kParamError.message});if(void 0!==e.watermark&&"string"!=typeof(null===(h=e.watermark)||void 0===h?void 0:h.imageURL))return t.logger.error("zb.sh.ums watermark image type error"),void _({errorCode:Yr.error.kParamError.code,extendedData:Yr.error.kParamError.message});for(E=0;E<e.inputList.length;E++){var R=e.inputList[E],T=R.streamID;t.stateCenter.testEnvironment&&(T="zegotest-"+t.stateCenter.appid+"-"+R.streamID),S.push({stream_id:T,content_control:"AUDIO"===R.contentType?1:0,top:null===(c=R.layout)||void 0===c?void 0:c.top,left:null===(d=R.layout)||void 0===d?void 0:d.left,bottom:null===(p=R.layout)||void 0===p?void 0:p.bottom,right:null===(g=R.layout)||void 0===g?void 0:g.right,render_mode:R.renderMode,image:R.imageInfo,label:R.label})}var I=[];e.outputList.forEach((function(e){var t="";"string"==typeof e?t=e:"object"==typeof e&&e.target&&(t=e.target);var r=0;(t.startsWith("rtmp://")||t.startsWith("https://")&&t.endsWith(".flv")||t.startsWith("https://")&&t.endsWith(".m3u8"))&&(r=1),I.push({target:t,is_url:r?"true":"false"})}));var P=e.outputConfig;t.stateCenter.reporter.spanSetAttributes({key:Yr.event,par:e.taskID},{mix_stream_conf:Yr.mix_stream_conf({fps:P.outputFPS,bitrate:P.outputBitrate,w:P.outputWidth,h:P.outputHeight,stream_cnt:S.length,mix_task_id:e.taskID,input_stream_list:S,output_target_list:I})}),y.streamHandler.updateMixStream(e,Zr,(function(o){t.stateCenter.reporter.spanEnd({key:Yr.event,par:e.taskID}),r(o)}),_)}else _({errorCode:Yr.error.kNoLoginError.code,extendedData:Yr.error.kNoLoginError.message})}))},setMixerTaskConfig:function(e){var t=this;return new Promise((function(r,o){var n,i=t.stateCenter.reporter.createSpan(Wr.H,{key:Fr},{key:""},$r.event),s={},a=function(e){t.stateCenter.reporter.setError(i,e),o(e)};if(e&&e.videoCodec){var u=e.videoCodec.toLowerCase();if(-1==["vp8","h264"].indexOf(u))return t.logger.error("zb.sh.ums param videoCode error"),a({errorCode:$r.error.kVideoConfigInvalidError.code,extendedData:$r.error.kVideoConfigInvalidError.message}),!1;s.videoCodec=u}if(e.backgroundColor){if(!t.stateCenter.checkInteger(e.backgroundColor))return t.logger.error("zb.sh.ums param backgroundColor must be integer number"),a({errorCode:$r.error.kParamError.code,extendedData:$r.error.kParamError.message}),!1;s.backgroundColor=e.backgroundColor}if(e.backgroundImage){if("string"!=typeof e.backgroundImage)return t.logger.error("zb.sh.ums param outputBgImage error"),a({errorCode:$r.error.kParamError.code,extendedData:$r.error.kParamError.message}),!1;if(!e.backgroundImage.startsWith("preset-id://")||!e.backgroundImage.endsWith(".jpg")&&!e.backgroundImage.endsWith(".png"))return t.logger.error("zb.sh.ums illegal input background image URL"),a({errorCode:$r.error.kBackgroundImageUrlInvalidError.code,extendedData:$r.error.kBackgroundImageUrlInvalidError.message}),!1;s.backgroundImage=e.backgroundImage}if(e&&e.userData){if(!(e.userData instanceof Uint8Array))return t.logger.error("zb.sh.ums param userData required Uint8Array"),a({errorCode:$r.error.kParamError.code,extendedData:$r.error.kParamError.message}),!1;if(e.userData.byteLength>1e3)return t.logger.error("zb.sh.ums param userData should shorter than 1000"),a({errorCode:$r.error.kParamError.code,extendedData:$r.error.kParamError.message}),!1;s.userData=e.userData}e.extraParams&&(s.extraParams||(s.extraParams=[]),(n=s.extraParams).push.apply(n,e.extraParams)),Zr=s,i.setAttributes({mix_params:$r.mix_params(e)}),t.stateCenter.roomList[0]?(i.end(),r({errorCode:0,extendedData:""})):a({errorCode:$r.error.kNoLoginError.code,extendedData:$r.error.kNoLoginError.message})}))},stopMixerTask:function(e){var t=this;return new Promise((function(r,o){var n=t.stateCenter.reporter.createSpan(Wr.H,{key:Fr},{key:""},Kr.event);if(!e||"string"!=typeof e||e.length>256||!t.stateCenter.checkIllegalCharacters(e))return t.logger.error("zb.rh.lg taskID must be string less 256"),t.stateCenter.reporter.setError(n,Kr.error.kParamError," param taskID error"),void o({errorCode:Kr.error.kParamError.code,extendedData:Kr.error.kParamError.message+" param taskID error"});n.setAttributes({mix_task_id:e});var i=function(e){var r=Xr(t.stateCenter,e),i=r.actualError;t.stateCenter.reporter.setError(n,r.reportErr||e),i&&(e.errorCode=null==i?void 0:i.code,e.extendedData=(null==i?void 0:i.message)||""),o(e)},s=t.stateCenter.roomList[0];s?s.streamHandler.stopMixStream(e,(function(e){n.end(),r(e)}),i):i({errorCode:Kr.error.kNoLoginError.code,extendedData:Kr.error.kNoLoginError.message})}))}},eo={_sendMixStopReqByAccessHub:function(e,t,r){},stopMixStream:function(e,t,r,o,n){this.logger.info("zb.sh.sms call");var i=this.getStopMixStreamParams(e,o,n);this.stateCenter.useNetAgent&&this._sendMixStopReqByAccessHub(i.mixStopReq,t,r)},_sendMixStartReqByAccessHub:function(e,t,r,o){},getStartMixStreamParams:function(e,t){var r,o,n=this,i={request_seq:this.stateCenter.getSeq(),mix_protocol_version:1,task_id:e.taskID,room_id:this.roomID,mix_stream_common:{},input_stream:[],advance_config:[],output_stream:[]};e.outputConfig.singleStreamPassThrough&&"boolean"==typeof e.outputConfig.singleStreamPassThrough&&(i.mix_stream_common.single_stream_pass_through=e.outputConfig.singleStreamPassThrough?1:0);var s=t;return s&&(s.videoCodec&&(null===(r=i.advance_config)||void 0===r||r.push({key:"video_encode",value:s.videoCodec})),s.backgroundColor&&(i.mix_stream_common.output_bg_color=s.backgroundColor),s.backgroundImage&&(i.mix_stream_common.output_bg_image=s.backgroundImage),s.userData&&(i.mix_stream_common.user_data=this.stateCenter.uint8arrayToBase64(s.userData)),s.extraParams&&(null===(o=i.advance_config)||void 0===o||o.push.apply(o,s.extraParams))),e.inputList.forEach((function(e,t){var r,o,s,a,u,l,h,c,d,p,g,m,f,_,y,v,S,E,b,C,R=e.streamID;n.stateCenter.testEnvironment&&(R="zegotest-"+n.stateCenter.appid+"-"+e.streamID);var T={stream_input_common:{stream_id:R,content_control:"AUDIO"===e.contentType?1:0,layer_rect:{layer:t,top:null===(r=e.layout)||void 0===r?void 0:r.top,left:null===(o=e.layout)||void 0===o?void 0:o.left,bottom:null===(s=e.layout)||void 0===s?void 0:s.bottom,right:null===(a=e.layout)||void 0===a?void 0:a.right}},volume:100,audio_h_angle:-1,render_mode:e.renderMode,corner_radius:e.cornerRadius};if(null===(u=e.label)||void 0===u?void 0:u.text){var I={font_type:(null===(h=null===(l=e.label)||void 0===l?void 0:l.font)||void 0===h?void 0:h.type)||0,font_size:(null===(d=null===(c=e.label)||void 0===c?void 0:c.font)||void 0===d?void 0:d.size)||24,font_color:(null===(g=null===(p=e.label)||void 0===p?void 0:p.font)||void 0===g?void 0:g.color)||16777215,font_transparency:(null===(f=null===(m=e.label)||void 0===m?void 0:m.font)||void 0===f?void 0:f.transparency)||0};I.font_border_color=(null===(y=null===(_=e.label)||void 0===_?void 0:_.font)||void 0===y?void 0:y.border)?null===(S=null===(v=e.label)||void 0===v?void 0:v.font)||void 0===S?void 0:S.borderColor:-1;var P={text:null===(E=e.label)||void 0===E?void 0:E.text,text_left:(null===(b=e.label)||void 0===b?void 0:b.left)||0,text_top:(null===(C=e.label)||void 0===C?void 0:C.top)||0,font:I};T.label=P}e.imageInfo&&(T.image=e.imageInfo),i.input_stream.push(T)})),e.outputList.forEach((function(t){var r,o,a="";if("string"==typeof t?a=t:"object"==typeof t&&t.target?a=t.target:n.logger.error("zb.sh.ums output target required"),n.stateCenter.isUrl(a))r=1,o=a;else{r=0,o=n.stateCenter.testEnvironment?"zegotest-"+n.stateCenter.appid+"-"+a:a}var u={is_url:r,target:o,video_bitrate:1e3*e.outputConfig.outputBitrate,video_fps:e.outputConfig.outputFPS,video_width:e.outputConfig.outputWidth,video_height:e.outputConfig.outputHeight,output_quality:23};e.outputConfig.outputAudioCodecID&&(u.audio_enc_id=e.outputConfig.outputAudioCodecID),"vp8"===s.videoCodec?u.audio_enc_id=3:"h264"===s.videoCodec&&(u.audio_enc_id=0),e.outputConfig.outputAudioBitrate&&(u.audio_bitrate=1e3*e.outputConfig.outputAudioBitrate),i.output_stream.push({output_stream_common:u})})),e.watermark&&(i.water_mark={image:e.watermark.imageURL,layout_rect:e.watermark.layout}),isNaN(e.streamAlignmentMode)||(i.alignment_type=e.streamAlignmentMode),i.audio_channel_cnt=e.outputConfig.outputAudioChannels?e.outputConfig.outputAudioChannels:1,{mixStartReq:i}},updateMixStream:function(e,t,r,o){this.logger.info("zb.sh.ums call"),this.logger.info("zb.sh.ums send command");var n=this.getStartMixStreamParams(e,t).mixStartReq;return this.stateCenter.useNetAgent&&this._sendMixStartReqByAccessHub(n,"zegotest-"+this.stateCenter.appid+"-",r,o),!0},getStopMixStreamParams:function(e,t,r){var o={id_name:this.stateCenter.idName,live_channel:this.roomID,appid:this.stateCenter.appid,version:"1.0.0"},n={request_seq:this.stateCenter.getSeq(),room_id:this.roomID};if("string"==typeof e&&(o.task_id=e,n.task_id=e),null!=t){var i=void 0;o.stream_id=i=this.stateCenter.testEnvironment?"zegotest-"+this.stateCenter.appid+"-"+t:t,n.is_url=0,n.target=i}else null!=r&&(o.mixurl=r,n.is_url=1,n.target=r);return{req_body:o,mixStopReq:n}}};const to={type:"MixStream",install:function(e,t){for(var r in Jr)Object.defineProperty(e.prototype,r,{value:Jr[r],writable:!1});for(var r in eo)Object.defineProperty(t.prototype,r,{value:eo[r],writable:!1})}};var ro=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}();Ur.use(Hr()),Ur.use(Vr),Ur.use(to);var oo=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ro(t,e),t}(Ur)})(),__webpack_exports__})()));