!function(e,r){if("object"==typeof exports&&"object"==typeof module)module.exports=r();else if("function"==typeof define&&define.amd)define([],r);else{var o=r();for(var t in o)("object"==typeof exports?exports:e)[t]=o[t]}}("undefined"!=typeof self?self:this,(()=>(()=>{"use strict";var e={755:(e,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.AdvancedModule=void 0;var t=o(305),s=o(304),a=function(){function e(e,r,o,t){this.logger=e,this.dataReport=r,this.streamCenter=o,this.stateCenter=t,this.screenShotReady=!1}return e.prototype.publishTarget=function(e){var r=this,o=this.stateCenter.getReportSeq();switch(e.type){case"addpush":this.dataReport.newReport(o,s.ZegoRTCLogEvent.kZegoTaskAddPublishCdnUrl.event);break;case"delpush":case"clearpush":this.dataReport.newReport(o,s.ZegoRTCLogEvent.kZegoTaskRemovePublishCdnUrl.event)}return this.dataReport.addMsgInfo(o,{stream:s.ZegoRTCLogEvent.kZegoTaskRemovePublishCdnUrl.stream(e.streamID),target_url:s.ZegoRTCLogEvent.kZegoTaskRemovePublishCdnUrl.target_url(e.pushUrl)}),new Promise((function(a,n){var i=function(e,t){r.logger.error("zb.pt"+(t||e.message)),r.dataReport.addMsgInfo(o,{error:e.code,message:e.message+(t||"")}),r.dataReport.uploadReport(o),n({errorCode:e.code,extendedData:e.message+(t?" "+t:"")})};if(-1==["addpush","delpush","clearpush"].indexOf(e.type))return r.logger.error("zb.sh.pt cdn push type error"),void i(t.errorCodeList.PUBLISHER_CDN_PUSH_ERROR,"type error");if(e.streamID&&"string"==typeof e.streamID)if(e.pushUrl&&"string"==typeof e.pushUrl)if(r.stateCenter.publishStreamList[e.streamID]){var d=r.streamCenter.getRoomByStreamID(e.streamID);if(d){d.streamHandler._publishTarget(e,(function(e){r.dataReport.uploadReport(o),a(e)}),i)}else i(s.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kNoLoginError)}else i(s.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kPublishStreamNoFoundError);else i(s.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kParamError,"push url error");else i(s.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kParamError,"stream id type error")}))},e}();r.AdvancedModule=a},610:(e,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.streamHandler=r.zegoWebRTC=r.ENUM_PUBLISH_STREAM_STATE=r.ENUM_STREAM_CMD_PRI=r.ENUM_STREAM_SUB_CMD=r.PROTO_VERSION=void 0;var t=o(305),s=o(304);r.PROTO_VERSION="2.10.3",r.ENUM_STREAM_SUB_CMD={liveNone:0,liveBegin:2001,liveEnd:2002,liveUpdate:2003},r.ENUM_STREAM_CMD_PRI={liveBegin:"zegochat_js.room_stream_create_req",liveEnd:"zegochat_js.room_stream_delete_req",liveUpdate:"zegochat_js.room_stream_update_req"},r.ENUM_PUBLISH_STREAM_STATE={waiting_url:1,tryPublish:2,update_info:3,publishing:4,stop:5,retryPublish:6},r.zegoWebRTC={setStreamExtraInfo:function(e,r){var o=this;return new Promise((function(t,a){var n=o.stateCenter.getReportSeq();o.dataReport.newReport(n,s.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.event),o.dataReport.addMsgInfo(n,{stream:s.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.stream(e),stream_extra_info:s.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.stream_extra_info(r)});var i=function(e,r){o.logger.error("zb.ssei "+r),o.dataReport.addMsgInfo(n,{error:e.code,message:e.message+" "+r}),o.dataReport.uploadReport(n),a({errorCode:e.code,extendedData:e.message+" "+r})};if("string"==typeof e&&""!=e)if("string"==typeof r&&""!=r)if(o.RTM.isDisConnect())i(s.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kNoLoginError,"not login");else if(o.stateCenter.publishStreamList[e]){var d=o.streamCenter.getRoomByStreamID(e);d?(o.dataReport.addMsgInfo(n,{room_sid:s.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.room_sid(d.sessionID)}),d.streamHandler.setStreamExtraInfo(e,r,t,i),o.dataReport.uploadReport(n)):i(s.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kNoLoginError,"not login")}else i(s.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kPublishStreamNoFoundError,"publish stream no found");else i(s.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kParamError,"extraInfo must be string and no empty");else i(s.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kParamError,"streamID must be string and not empty")}))}},r.streamHandler={_publishTarget:function(e,o,a){var n=this;this.logger.info("zb.sh.ptcall");var i=Math.ceil((new Date).getTime()/1e3),d=e.streamID;this.stateCenter.testEnvironment&&(d="zegotest-"+this.stateCenter.appid+"-"+e.streamID);var g={appid:this.stateCenter.appid,biz_type:0,timestamp:i,seq:this.stateCenter.cdnSeq++,version:1*r.PROTO_VERSION,stream_id:d,pushurl:e.pushUrl};if(this.logger.debug("zb.sh.pt send command"),this.stateCenter.useNetAgent)this.sendBizChannelRequestV2({server:1,location:"/liveroomcmd/push",cmd:e.type},g,(function(r){n.logger.info("zb.sh.pt receive message");var s=r||{},i=s.code,d=s.message;i&&0!=i?(n.logger.error("zb.sh.pt "+e.type+" error code: "+i+" "+d),a(t.errorCodeList.UNKNOWN_SERVER_ERROR," cmd: ".concat(e.type," ").concat(i," ").concat(d))):(n.logger.info("zb.sh.pt "+e.type+" success"),o&&o({errorCode:0,extendedData:""}))}),(function(r,o,t,i){var d="";i||(i=s.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kUnknownServerError,200===r?(n.logger.info("zb.sh.pt error: "+o),i=s.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kUnknownServerError,2001==o?i=s.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kInvalidChannelError:2002==o&&(i=s.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kBizChannelError),d="cmd: ".concat(e.type,", biz_code: ").concat(o)):d="request media server fail, error: "+r,n.logger.error("zb.sh.pt "+d)),a&&a(i,d)}));else{var l={channel:"media",cmd:e.type,req_body:JSON.stringify(g)};this.sendBizChannelRequest(l,(function(r,i,d){if(n.logger.info("zb.sh.pt receive message"),0!=d.length){var g=JSON.parse(d),l=g.code,m=g.message;l&&0!=l?(n.logger.error("zb.sh.pt "+e.type+" error code: "+l+" "+m),a(t.errorCodeList.UNKNOWN_SERVER_ERROR," cmd: ".concat(e.type," ").concat(l," ").concat(m))):(n.logger.info("zb.sh.pt "+e.type+" success"),o&&o({errorCode:0,extendedData:""}))}else a(s.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kNoResponseError)}),(function(r,o,t){n.logger.info("zb.sh.pt error: "+r);var i=s.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kUnknownServerError;2001==r?i=s.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kInvalidChannelError:2002==r&&(i=s.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kBizChannelError),n.logger.error("zb.sh.pt "),a(i," cmd: ".concat(e.type," ").concat(r," ").concat("","  "))}))}},updateStreamExtraInfo:function(e,o,t,a){this.logger.info("zb.sh.usei call");var n=r.ENUM_STREAM_SUB_CMD.liveUpdate;this.stateCenter.publishStreamList[e]&&this.stateCenter.publishStreamList[e].state>=r.ENUM_PUBLISH_STREAM_STATE.update_info?(this.stateCenter.publishStreamList[e].extra_info=o,this.updateStreamInfo(e,n,o),t({errorCode:0})):this.stateCenter.publishStreamList[e]&&this.stateCenter.publishStreamList[e].state===r.ENUM_PUBLISH_STREAM_STATE.tryPublish?(this.stateCenter.publishStreamList[e].extra_info=o,t({errorCode:0})):a(s.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kUpdateStreamInfoFailError)},setStreamExtraInfo:function(e,r,o,t){this.updateStreamExtraInfo(e,r,o,t)}}},305:(e,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.errorCodeList=void 0,r.errorCodeList={NOT_LOGIN:{code:1000002,message:"not login room"},INPUT_PARAM:{code:1100001,message:"input param error."},PUBLISH_NOT_PUBLISH:{code:1103040,message:"publisher not found"},PUBLISH_NO_PREVIEW:{code:1103044,message:"stream is not from zego"},TRACK_NOT_FOUND:{code:1103047,message:"track is not found"},DEVICE_NOT_FOUND:{code:1103048,message:"device is not found"},PUBLISHER_CONSTRAINTS_ERROR:{code:1103029,message:"constraint error"},PUBLISHER_CDN_PUSH_ERROR:{code:1103052,message:"publisher cdn push error"},VIDEO_DEVICE_FALSE:{code:1103045,message:"video is false"},AUDIO_DEVICE_FALSE:{code:1103046,message:"audio is false"},UNKNOWN_SERVER_ERROR:{code:1100999,message:"unknown server error"},LOCALSTREAM_WRONG:{code:1000018,message:"local stream wrong"},PUBLISHER_STREAM_NO_FOUND:{code:1103055,message:"publish stream no found"},PUBLISH_TARGET_NO_RESPONSE:{code:1103063,message:"publish target no response"},BIZ_CHANNEL_ERROR:{code:1102021,message:"biz channel error."},INVALID_CHANNEL:{code:1102024,message:"invalid channel"},PUBLISHER_EXTRA_INFO_NULL:{code:1003050,message:"extra info of publishing stream is null"},PUBLISHER_UPDATE_STREAM_INFO_FAIL:{code:1103062,message:"update stream info fail"},TRACK_CAN_NOT_ADD:{code:1103063,message:"only stream which have one track and kind no exist can add track"},TRACK_CAN_NOT_REMOVE:{code:1103064,message:"stream which only has one track can not remove "},PUBLISHER_UPDATE_SDP_FAIL:{code:1103068,message:"update sdp fail"},PUBLISHER_STATE_WRONG:{code:1103069,message:"publisher state wrong"},HANDLE_TRACK_NOT_SUPPORTED:{code:1103070,message:"not support remove track"},VIDEO_EFFECT_IS_RUNNING:{code:1103071,message:"video effect processor is running"}}},304:(e,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.ZegoRTCLogEvent=void 0;var t=o(305),s=function(e){return e};r.ZegoRTCLogEvent={kZegoTaskPublishTarget:{event:"/sdk/publish_target",error:{kParamError:t.errorCodeList.INPUT_PARAM,kPublishStreamNoFoundError:t.errorCodeList.PUBLISHER_STREAM_NO_FOUND,kNoLoginError:t.errorCodeList.NOT_LOGIN,kNoResponseError:t.errorCodeList.PUBLISH_TARGET_NO_RESPONSE,kBizChannelError:t.errorCodeList.BIZ_CHANNEL_ERROR,kInvalidChannelError:t.errorCodeList.INVALID_CHANNEL,kUnknownServerError:t.errorCodeList.UNKNOWN_SERVER_ERROR}},kZegoTaskAddPublishCdnUrl:{event:"/sdk/add_publish_cdn_url",error:{kParamError:t.errorCodeList.INPUT_PARAM}},kZegoTaskRemovePublishCdnUrl:{event:"/sdk/remove_publish_cdn_url",error:{kParamError:t.errorCodeList.INPUT_PARAM},stream:s,target_url:s},kZegoTaskClearPublishCdnUrl:{event:"/sdk/clear_publish_cdn_url",error:{kParamError:t.errorCodeList.INPUT_PARAM}},kZegoTaskLiveRoomSendStreamExtraInfo:{event:"/liveroom/send_stream_extra_info",error:{kParamError:t.errorCodeList.INPUT_PARAM,kExtraInfoNullError:t.errorCodeList.PUBLISHER_EXTRA_INFO_NULL,kNoLoginError:t.errorCodeList.NOT_LOGIN,kPublishStreamNoFoundError:t.errorCodeList.PUBLISHER_STREAM_NO_FOUND,kUpdateStreamInfoFailError:t.errorCodeList.PUBLISHER_UPDATE_STREAM_INFO_FAIL},stream:s,stream_extra_info:s,room_sid:s}}}},r={};function o(t){var s=r[t];if(void 0!==s)return s.exports;var a=r[t]={exports:{}};return e[t](a,a.exports,o),a.exports}var t={};return(()=>{var e=t;Object.defineProperty(e,"__esModule",{value:!0});var r=o(755),s=o(610);e.default={type:"StreamCommon",install:function(e,o,t){for(var a in Object.defineProperty(o.prototype,"initStreamCommon",{value:function(){this.streamCommonModule=new r.AdvancedModule(this.logger,this.dataReport,this.streamCenter,this.stateCenter)},writable:!1}),s.zegoWebRTC)Object.defineProperty(e.prototype,a,{value:s.zegoWebRTC[a],writable:!1});for(var a in s.streamHandler)Object.defineProperty(t.prototype,a,{value:s.streamHandler[a],writable:!1})}}})(),t})()));