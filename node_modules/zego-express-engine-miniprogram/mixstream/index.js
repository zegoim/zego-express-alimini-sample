!function(e,r){if("object"==typeof exports&&"object"==typeof module)module.exports=r();else if("function"==typeof define&&define.amd)define([],r);else{var t=r();for(var o in t)("object"==typeof exports?exports:e)[o]=t[o]}}("undefined"!=typeof self?self:this,(()=>(()=>{"use strict";var e={454:function(e,r,t){var o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var r,t=1,o=arguments.length;t<o;t++)for(var a in r=arguments[t])Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a]);return e},o.apply(this,arguments)};Object.defineProperty(r,"__esModule",{value:!0}),r.streamHandler=r.zegoWebRTC=void 0;var a=t(548),s=t(249),n="2.10.3",i=1e4,g={},u="addMsgInfo",d=1005027,l="mix stream input parameters are wrong";function k(e,r){var t,o,s,n,g="",u=a.errorCodeList;return r.errorCode<2e9&&r.errorCode>1e9?(s={1:"MIXER_START_REQUEST_ERROR",2:"MIXER_START_REQUEST_ERROR",3:"MIXER_AUTHENTICATION_FAILED",150:"MIXER_INPUT_STREAM_NOT_EXISTS",151:"MIXER_START_REQUEST_ERROR",152:"MIXER_STOP_REQUEST_ERROR",153:"MIXER_INPUT_PARAMETERS_ERROR",154:"MIXER_EXCEED_MAX_OUTPUT_COUNT",155:"MIXER_INPUT_PARAMETERS_ERROR",156:"MIXER_VIDEO_CONFIG_INVALID",157:"MIXER_NO_SERVICES",158:"MIXER_EXCEED_MAX_INPUT_COUNT",159:"MIXER_START_REQUEST_ERROR",160:"MIXER_NOT_OWNER_STOPMIXER",170:"MIXER_WATERMARK_PARAMETERS_ERROR",171:"MIXER_WATERMARK_NULL",175:"MIXER_REPEAT_INPUT",190:"MIXER_START_REQUEST_ERROR"},n="MIXER_INNER_ERROR",(o=r.errorCode-i)>1e9&&s[o-1e9]&&(n=s[o-1e9]),t=u[g=n]):r.errorCode<1e6&&(t=e.decodeServerError(r.errorCode,r.extendedData),g=e.getLiveRoomError(r.errorCode,this.stateCenter.useNetAgent)),{reportErr:t,actualError:u[g]}}r.zegoWebRTC={startMixerTask:function(e){var r=this;return new Promise((function(t,o){var a=r.stateCenter.getReportSeq();r.dataReport.newReport(a,s.ZegoRTCLogEvent.kZegoTaskMixStart.event),r.stateCenter.logReportCallback("kZegoTaskMixStart"+e.taskID,r.dataReport,a,r.stateCenter.reportList);var n={errorCode:d,extendedData:l};if(!!(null==e?void 0:e.inputList.find((function(e){return null==e.streamID&&(n.extendedData=n.extendedData+". streamID should be of string type",!0)}))))return r.dataReport.addMsgInfo(a,n),r.dataReport.uploadReport(a),r.stateCenter.unregisterCallback("kZegoTaskMixStart"+e.taskID,r.stateCenter.reportList),void o(n);e.outputConfig&&e.outputConfig.outputFps&&(e.outputConfig.outputFPS=e.outputConfig.outputFps);var i=function(t){var s=k(r.stateCenter,t),n=s.reportErr,i=s.actualError;r.dataReport.addMsgInfo(a,n||t),r.dataReport.uploadReport(a),r.stateCenter.unregisterCallback("kZegoTaskMixStart"+e.taskID,r.stateCenter.reportList),i&&(t.errorCode=null==i?void 0:i.code,t.extendedData=(null==i?void 0:i.message)||""),o(t)},g=r.stateCenter.roomList[0];g?g.streamHandler.updateMixStream(e,(function(o){r.dataReport.uploadReport(a),r.stateCenter.unregisterCallback("kZegoTaskMixStart"+e.taskID,r.stateCenter.reportList),t(o)}),i):i({errorCode:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kNoLoginError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kNoLoginError.message})}))},setMixerTaskConfig:function(e){var r=this;return new Promise((function(t,o){var a=r.stateCenter.getReportSeq();r.dataReport.newReport(a,s.ZegoRTCLogEvent.kZegoTaskMixConfig.event),r.stateCenter.logReportCallback("kZegoTaskMixConfig",r.dataReport,a,r.stateCenter.reportList);var n=r.stateCenter.roomList[0];n?n.streamHandler.setMixerTaskConfig(e).then((function(e){r.dataReport.uploadReport(a),r.stateCenter.unregisterCallback("kZegoTaskMixConfig",r.stateCenter.reportList),t(e)})).catch((function(e){r.dataReport.addMsgInfo(a,e),r.dataReport.uploadReport(a),r.stateCenter.unregisterCallback("kZegoTaskMixConfig",r.stateCenter.reportList),o(e)})):o({errorCode:s.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kNoLoginError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kNoLoginError.message})}))},stopMixerTask:function(e){var r=this;return new Promise((function(t,o){var a=r.stateCenter.getReportSeq();if(r.dataReport.newReport(a,s.ZegoRTCLogEvent.kZegoTaskMixStop.event),!e||"string"!=typeof e||e.length>256||!r.stateCenter.checkIllegalCharacters(e))return r.logger.error("zb.rh.lg taskID must be string less 256"),r.dataReport.addMsgInfo(a,{error:s.ZegoRTCLogEvent.kZegoTaskMixStop.error.kParamError.code,message:s.ZegoRTCLogEvent.kZegoTaskMixStop.error.kParamError.message+" param taskID error"}),r.dataReport.uploadReport(a),void o({errorCode:s.ZegoRTCLogEvent.kZegoTaskMixStop.error.kParamError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskMixStop.error.kParamError.message+" param taskID error"});var n=function(e){var t=k(r.stateCenter,e),s=t.reportErr,n=t.actualError;r.dataReport.addMsgInfo(a,s||e),r.dataReport.uploadReport(a),n&&(e.errorCode=null==n?void 0:n.code,e.extendedData=(null==n?void 0:n.message)||""),o(e)},i=r.stateCenter.roomList[0];i?i.streamHandler.stopMixStream(e,(function(e){r.dataReport.uploadReport(a),t(e)}),n):n({errorCode:s.ZegoRTCLogEvent.kZegoTaskMixStop.error.kNoLoginError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskMixStop.error.kNoLoginError.message})}))}},r.streamHandler={setMixerTaskConfig:function(e){var r=this;return new Promise((function(t,o){var a,n={},i={};if(e&&e.videoCodec){var d=e.videoCodec.toLowerCase();if(-1==["vp8","h264"].indexOf(d))return r.logger.error("zb.sh.ums param videoCode error"),o({errorCode:s.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kVideoConfigInvalidError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kVideoConfigInvalidError.message}),!1;n.videoCodec=d,i.video_codec=d}if(e.backgroundColor){if(!r.stateCenter.checkInteger(e.backgroundColor))return r.logger.error("zb.sh.ums param backgroundColor must be integer number"),o({errorCode:s.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kParamError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kParamError.message}),!1;n.backgroundColor=e.backgroundColor,i.background_color=e.backgroundColor}if(e.backgroundImage){if("string"!=typeof e.backgroundImage)return r.logger.error("zb.sh.ums param outputBgImage error"),o({errorCode:s.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kParamError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kParamError.message}),!1;if(!e.backgroundImage.startsWith("preset-id://")||!e.backgroundImage.endsWith(".jpg")&&!e.backgroundImage.endsWith(".png"))return r.logger.error("zb.sh.ums illegal input background image URL"),o({errorCode:s.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kBackgroundImageUrlInvalidError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kBackgroundImageUrlInvalidError.message}),!1;n.backgroundImage=e.backgroundImage,i.background_image=e.backgroundImage}if(e.waterMark&&(n.waterMark=e.waterMark,i.water_mark=e.waterMark),e&&e.userData){if(!(e.userData instanceof Uint8Array))return r.logger.error("zb.sh.ums param userData required Uint8Array"),o({errorCode:s.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kParamError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kParamError.message}),!1;if(e.userData.byteLength>1e3)return r.logger.error("zb.sh.ums param userData should shorter than 1000"),o({errorCode:s.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kParamError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kParamError.message}),!1;n.userData=e.userData}e.extraParams&&(n.extraParams||(n.extraParams=[]),(a=n.extraParams).push.apply(a,e.extraParams)),g=n,r.stateCenter.actionSuccessCallback("kZegoTaskMixConfig",r.stateCenter.reportList)&&r.stateCenter.actionSuccessCallback("kZegoTaskMixConfig",r.stateCenter.reportList)(u,void 0,{config:s.ZegoRTCLogEvent.kZegoTaskMixConfig.config(i)}),t({errorCode:0,extendedData:""})}))},stopMixStream:function(e,r,t,o,g){var u=this;this.logger.info("zb.sh.sms call");var d={id_name:this.stateCenter.idName,live_channel:this.roomID,appid:this.stateCenter.appid,version:n};if("string"==typeof e&&(d.task_id=e),null!=o?d.stream_id=this.stateCenter.testEnvironment?"zegotest-"+this.stateCenter.appid+"-"+o:o:null!=g&&(d.mixurl=g),this.stateCenter.useNetAgent)this.sendBizChannelRequestV2({server:12,location:"/interface/command",cmd:"stop_mix"},d,(function(e){r&&r({errorCode:0,extendedData:""})}),(function(e,r,o,n){var g="";if(n)return n==a.errorCodeList.TIMEOUT&&(n=s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kRequestError),n.code&&20010===n.code&&(n=JSON.parse(JSON.stringify(a.errorCodeList.MIXER_NO_SERVICES))),void(t&&t(n,g));if(n=s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kInternalError,200===e){if("number"==typeof r)return u.logger.debug("zb.sh.sms error: "+r),r+=1e9,void(t&&t({errorCode:u.stateCenter.getServerError(i+r).code,extendedData:g}));u.logger.error("zb.sh.sms stop mix fail "+JSON.stringify(error));var d=s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kInternalError;t&&t({errorCode:d.code,extendedData:d.message})}else u.logger.error("zb.sh.sms "+(g="request mix server fail, error: "+e)),t&&t(n,g)}));else{var l={channel:"zeus",cmd:"stop_mix",req_body:JSON.stringify(d)};this.sendBizChannelRequest(l,(function(){r&&r({errorCode:0,extendedData:""})}),(function(e){if("number"==typeof e)t&&t({errorCode:u.stateCenter.getServerError(i+e).code,extendedData:""});else{u.logger.error("zb.sh.sms stop mix fail "+JSON.stringify(e));var r=void 0;r=e==a.errorCodeList.TIMEOUT?s.ZegoRTCLogEvent.kZegoTaskMixStop.error.kRequestError:s.ZegoRTCLogEvent.kZegoTaskMixStop.error.kInternalError,t&&t({errorCode:r.code,extendedData:r.message})}}))}return!0},updateMixStream:function(e,r,t){var d,l=this;this.logger.info("zb.sh.ums call");var k;if(!e.noTaskID&&!e.taskID)return this.logger.error("zb.sh.ums no taskId found"),t({errorCode:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDNullError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDNullError.message}),!1;if(!e.noTaskID&&"string"!=typeof e.taskID)return this.logger.error("zb.rh.lg taskId must be string"),t({errorCode:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(!e.noTaskID&&e.taskID.length>256)return this.logger.error("zb.sh.ums taskId is too long"),t({errorCode:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDToLongError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDToLongError.message}),!1;if(!e.noTaskID&&!this.stateCenter.checkIllegalCharacters(e.taskID))return this.logger.error("zb.sh.ums task ID contains illegal characters"),t({errorCode:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDInvalidCharacterError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDInvalidCharacterError.message}),!1;if(!e.inputList||0==e.inputList.length)return this.logger.error("zb.sh.ums input list wrong"),t({errorCode:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kInputListNullError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kInputListNullError.message}),!1;e.inputList.forEach((function(e){"AUDIO"===e.contentType&&(!e.layout&&(e.layout={top:0,left:0,bottom:0,right:0}),e.layout.top=0,e.layout.left=0,e.layout.bottom=1,e.layout.right=1)}));for(var C=0;C<e.inputList.length;C++){var m=e.inputList[C],p={errorCode:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message};if("object"!=typeof m.layout)return this.logger.error("zb.sh.ums input layout must be object"),t(p),!1;if(!(this.stateCenter.checkInteger(m.layout.top,!1)&&this.stateCenter.checkInteger(m.layout.bottom,!1)&&this.stateCenter.checkInteger(m.layout.left,!1)&&this.stateCenter.checkInteger(m.layout.right,!1)))return this.logger.error("zb.sh.ums top、left、bottom、right must be integer number"),t(p),!1;if(void 0!==m.renderMode&&![0,1].includes(m.renderMode))return this.logger.error("zb.sh.ums render_mode is wrong"),t(p),!1}if(!e.outputList||0==e.outputList.length)return this.logger.error("zb.sh.ums no output list found"),t({errorCode:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputListNullError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputListNullError.message}),!1;if(e.outputList.some((function(e){return"string"==typeof e&&!l.stateCenter.isUrl(e)&&!l.stateCenter.checkIllegalCharacters(e)||"object"==typeof e&&e.target&&!l.stateCenter.isUrl(e.target)&&!l.stateCenter.checkIllegalCharacters(e.target)})))return this.logger.error("zb.sh.ums stream output target is incorrect"),t({errorCode:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputTargetInvalidError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputTargetInvalidError.message}),!1;if(!((k=e.inputList.every((function(e){return"AUDIO"===e.contentType})))||e.outputConfig&&"object"==typeof e.outputConfig))return this.logger.error("zb.sh.ums no output config found"),t({errorCode:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputNoTargetError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputNoTargetError.message}),!1;if(k&&(e.outputConfig=o(o({},e.outputConfig||{}),{outputBitrate:.001,outputFPS:1,outputWidth:1,outputHeight:1})),!(k||e.outputConfig.outputBitrate&&this.stateCenter.checkInteger(e.outputConfig.outputBitrate)))return this.logger.error("zb.sh.ums bitrate param is required and must be integer number"),t({errorCode:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(!e.outputConfig.outputFPS||!this.stateCenter.checkInteger(e.outputConfig.outputFPS))return this.logger.error("zb.sh.ums fps param is required and must be integer number"),t({errorCode:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(!e.outputConfig.outputWidth||!this.stateCenter.checkInteger(e.outputConfig.outputWidth))return this.logger.error("zb.sh.ums width param is required and must be integer number"),t({errorCode:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(!e.outputConfig.outputHeight||!this.stateCenter.checkInteger(e.outputConfig.outputHeight))return this.logger.error("zb.sh.ums height param is required and must be integer number"),t({errorCode:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(void 0!==e.outputConfig.outputAudioCodecID&&!this.stateCenter.checkInteger(e.outputConfig.outputAudioCodecID,!1))return this.logger.error("zb.sh.ums AudioCodecID param must be integer number"),t({errorCode:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(void 0!==e.outputConfig.outputAudioBitrate&&!this.stateCenter.checkInteger(e.outputConfig.outputAudioBitrate))return this.logger.error("zb.sh.ums AudioBitrate param must be integer number"),t({errorCode:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(void 0!==e.outputConfig.outputAudioChannels&&!this.stateCenter.checkInteger(e.outputConfig.outputAudioChannels,!1))return this.logger.error("zb.sh.ums AudioChannels param must be integer number"),t({errorCode:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;var E={},T=0;e.outputConfig.singleStreamPassThrough&&"boolean"==typeof e.outputConfig.singleStreamPassThrough&&(T=e.outputConfig.singleStreamPassThrough?1:0),E={task_id:e.taskID,id_name:this.stateCenter.idName,live_channel:this.roomID,appid:this.stateCenter.appid,version:n,bypass:T,timestamp:Math.ceil((new Date).getTime()/1e3)};var R=g;R&&(R.videoCodec&&(E.extra_params=[{key:"video_encode",value:R.videoCodec}]),R.backgroundColor&&(E.output_bg_color=R.backgroundColor),R.backgroundImage&&(E.output_bg_image=R.backgroundImage),R.waterMark&&(E.watermark=R.waterMark),R.userData&&(E.userdata=this.stateCenter.uint8arrayToBase64(R.userData)),R.extraParams&&(!E.extra_params&&(E.extra_params=[]),(d=E.extra_params).push.apply(d,R.extraParams))),E.MixInput=e.inputList.map((function(e,r){var t=e.streamID;return l.stateCenter.testEnvironment&&(t="zegotest-"+l.stateCenter.appid+"-"+e.streamID),{stream_id:t,content_control:"AUDIO"===e.contentType?1:0,rect:{layer:r,top:e.layout.top,left:e.layout.left,bottom:e.layout.bottom,right:e.layout.right},render_mode:e.renderMode}})),this.stateCenter.actionSuccessCallback("kZegoTaskMixStart"+e.taskID,this.stateCenter.reportList)&&this.stateCenter.actionSuccessCallback("kZegoTaskMixStart"+e.taskID,this.stateCenter.reportList)(u,void 0,{mix_stream_id:s.ZegoRTCLogEvent.kZegoTaskMixStart.mix_stream_id(e.taskID),stream_cnt:s.ZegoRTCLogEvent.kZegoTaskMixStart.stream_cnt(E.MixInput.length),input_stream_list:s.ZegoRTCLogEvent.kZegoTaskMixStart.input_stream_list(E.MixInput)}),E.MixOutput=e.outputList.map((function(r){var o={},a="";if("string"==typeof r)a=r;else{if("object"!=typeof r||!r.target)return l.logger.error("zb.sh.ums output target required"),t({errorCode:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputTargetInvalidError.code,extendedData:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputTargetInvalidError.message}),!1;a=r.target}return a.startsWith("rtmp://")||a.startsWith("https://")&&a.endsWith(".flv")||a.startsWith("https://")&&a.endsWith(".m3u8")?o.mixurl=a:o.stream_id=l.stateCenter.testEnvironment?"zegotest-"+l.stateCenter.appid+"-"+a:a,o.bitrate=1e3*e.outputConfig.outputBitrate,o.fps=e.outputConfig.outputFPS,o.width=e.outputConfig.outputWidth,o.height=e.outputConfig.outputHeight,e.outputConfig.outputAudioCodecID&&(o.audio_enc_id=e.outputConfig.outputAudioCodecID),"vp8"===R.videoCodec?o.audio_enc_id=3:"h264"===R.videoCodec&&(o.audio_enc_id=0),e.outputConfig.outputAudioBitrate&&(o.audio_bitrate=1e3*e.outputConfig.outputAudioBitrate),e.outputConfig.outputAudioChannels&&(o.audio_channel_cnt=e.outputConfig.outputAudioChannels),o.testenv=l.stateCenter.testEnvironment?1:0,o})),this.stateCenter.actionSuccessCallback("kZegoTaskMixStart"+e.taskID,this.stateCenter.reportList)&&this.stateCenter.actionSuccessCallback("kZegoTaskMixStart"+e.taskID,this.stateCenter.reportList)(u,void 0,{output_target_list:s.ZegoRTCLogEvent.kZegoTaskMixStart.output_target_list(E.MixOutput)}),this.logger.debug("zb.sh.ums send command");var c="zegotest-"+this.stateCenter.appid+"-";if(this.stateCenter.useNetAgent)this.sendBizChannelRequestV2({server:12,location:"/interface/command",cmd:"start_mix"},E,(function(e){var t=e.play.map((function(e){var r={rtmpURL:"",hlsURL:"",flvURL:""},t=e.stream_alias||"";return l.stateCenter.testEnvironment&&t&&t.startsWith(c)&&(t=t.slice(c.length)),r.streamID=t,e.rtmp_url&&e.rtmp_url.length>0&&(r.rtmpURL=e.rtmp_url),e.hls_url&&e.hls_url.length>0&&(r.hlsURL=e.hls_url),e.hdl_url&&e.hdl_url.length>0&&(r.flvURL=e.hdl_url),r}));r&&r({errorCode:0,extendedData:JSON.stringify({mixerOutputList:t})})}),(function(e,r,o,n){var g="";if(n)return n==a.errorCodeList.TIMEOUT&&(n=s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kRequestError),n.code&&20010===n.code&&(n=JSON.parse(JSON.stringify(a.errorCodeList.MIXER_NO_SERVICES))),void(t&&t(n,g));if(n=s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kInternalError,200===e){if("number"==typeof r){if(l.logger.debug("zb.sh.ums error: "+r),1000000150==(r+=1e9)&&o){var u=o,d=(null==u?void 0:u.non_exist_streams.map((function(e){return l.stateCenter.testEnvironment&&e.startsWith(c)?e.slice(c.length):e})))||[];d.length>0&&(l.logger.debug("zb.sh.ums not exist streams: "+d),g=d.join(","))}return void(t&&t({errorCode:l.stateCenter.getServerError(i+r).code,extendedData:g}))}l.logger.debug("zb.sh.ums error code "+r);var k=s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kInternalError;t&&t({errorCode:k.code,extendedData:k.message})}else l.logger.error("zb.sh.ums "+(g="request mix server fail, error: "+e)),t&&t(n,g)}));else{var _={channel:"zeus",cmd:"start_mix",req_body:JSON.stringify(E)};this.sendBizChannelRequest(_,(function(e,o,a){if(l.logger.debug("zb.sh.ums receive message"),0!=a.length){for(var s=JSON.parse(a),n=[],i=0;i<s.play.length;i++){var g={rtmpURL:"",hlsURL:"",flvURL:""},u=s.play[i].stream_alias||"";l.stateCenter.testEnvironment&&u&&u.startsWith(c)&&(u=u.slice(c.length)),g.streamID=u,s.play[i].rtmp_url&&s.play[i].rtmp_url.length>0&&(g.rtmpURL=s.play[i].rtmp_url),s.play[i].hls_url&&s.play[i].hls_url.length>0&&(g.hlsURL=s.play[i].hls_url),s.play[i].hdl_url&&s.play[i].hdl_url.length>0&&(g.flvURL=s.play[i].hdl_url),n.push(g)}if(r)r({errorCode:0,extendedData:JSON.stringify({mixerOutputList:n})})}else t&&t({errorCode:l.stateCenter.getServerError(10001).code,extendedData:""})}),(function(e,r,o){if("number"==typeof e){l.logger.debug("zb.sh.ums error: "+e);var n=[];if(1000000150==e&&0!=o.length)for(var g=JSON.parse(o),u=0;u<g.non_exist_streams.length;u++){var d=g.non_exist_streams[u];l.stateCenter.testEnvironment&&d.startsWith(c)?n.push(d.slice(c.length)):n.push(d)}t&&t({errorCode:l.stateCenter.getServerError(i+e).code,extendedData:""})}else{l.logger.debug("zb.sh.ums error code "+e.code);var k=void 0;k=e==a.errorCodeList.TIMEOUT?s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kRequestError:s.ZegoRTCLogEvent.kZegoTaskMixStart.error.kInternalError,t&&t({errorCode:k.code,extendedData:k.message})}}))}return!0}}},548:(e,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.errorCodeList=void 0,r.errorCodeList={NOT_LOGIN:{code:1000002,message:"not login room"},INPUT_PARAM:{code:1100001,message:"input param error."},TIMEOUT:{code:1100002,message:"network timeout."},MIXER_NO_SERVICES:{code:1005e3,message:"no mix stream service"},MIXER_TASK_ID_NULL:{code:1005001,message:"mixer task is null"},MIXER_TASK_ID_TOO_LONG:{code:1005002,message:"task ID is too long"},MIXER_TASK_ID_INVALID_CHARACTER:{code:1005003,message:"task ID contains illegal characters"},MIXER_NO_OUTPUT_TARGET:{code:1005005,message:"task configuration does not specify output"},MIXER_OUTPUT_TARGET_INVALID:{code:1005006,message:"stream output target is incorrect"},MIXER_START_REQUEST_ERROR:{code:1005010,message:"start mixer task fail, possibly due to network reasons"},MIXER_STOP_REQUEST_ERROR:{code:1005011,message:"stop mixer task fail, possibly due to network reasons"},MIXER_NOT_OWNER_STOP_MIXER:{code:1005012,message:" maxed task must be stopped by the start user of the task"},MIXER_INPUTLIST_NULL:{code:1005020,message:"Mixed stream task input list is null"},MIXER_OUTPUTLIST_NULL:{code:1005021,message:"Mixed stream task output list is null"},MIXER_VIDEO_CONFIG_INVALID:{code:1005023,message:"invalid mixed stream task video configuration"},MIXER_EXCEED_MAX_INPUT_COUNT:{code:1005025,message:"more than the maximum number of input streams"},MIXER_INPUT_STREAM_NOT_EXISTS:{code:1005026,message:"Input stream does not exist"},MIXER_EXCEED_MAX_OUTPUT_COUNT:{code:1005030,message:"more than the maximum number of output streams"},MIXER_AUTHENTICATION_FAILED:{code:1005050,message:"mixed stream authentication failed"},MIXER_WATERMARK_NULL:{code:1005061,mag:"input watermark is null"},MIXER_WATERMARK_PARAMETERS_ERROR:{code:1005062,message:"input watermark parameter is wrong"},MIXER_WATERMARK_URL_INVALID:{code:1005063,message:"illegal input watermark URL"},MIXER_BACKGROUND_IMAGE_URL_INVALID:{code:1005067,message:"illegal input background image URL"},MIXER_REPEAT_INPUT:{code:1005099,message:"mix stream input repeat"},MIXER_INNER_ERROR:{code:1005099,message:"mixer internal error"}}},249:(e,r,t)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.ZegoRTCLogEvent=void 0;var o=t(548),a=function(e){return e};r.ZegoRTCLogEvent={kZegoTaskMixStart:{event:"/mix/start_mix",error:{kParamError:o.errorCodeList.INPUT_PARAM,kTaskIDNullError:o.errorCodeList.MIXER_TASK_ID_NULL,kTaskIDToLongError:o.errorCodeList.MIXER_TASK_ID_TOO_LONG,kTaskIDInvalidCharacterError:o.errorCodeList.MIXER_TASK_ID_INVALID_CHARACTER,kInputListNullError:o.errorCodeList.MIXER_INPUTLIST_NULL,kOutputListNullError:o.errorCodeList.MIXER_OUTPUTLIST_NULL,kOutputTargetInvalidError:o.errorCodeList.MIXER_OUTPUT_TARGET_INVALID,kOutputNoTargetError:o.errorCodeList.MIXER_NO_OUTPUT_TARGET,kRequestError:o.errorCodeList.MIXER_START_REQUEST_ERROR,kInternalError:o.errorCodeList.MIXER_INNER_ERROR,kNoLoginError:o.errorCodeList.NOT_LOGIN},mix_stream_id:a,stream_cnt:a,input_stream_list:a,output_target_list:a},kZegoTaskMixStop:{event:"/mix/stop_mix",error:{kParamError:o.errorCodeList.INPUT_PARAM,kTaskIDNullError:o.errorCodeList.MIXER_TASK_ID_NULL,kRequestError:o.errorCodeList.MIXER_STOP_REQUEST_ERROR,kInternalError:o.errorCodeList.MIXER_INNER_ERROR,kNoLoginError:o.errorCodeList.NOT_LOGIN}},kZegoTaskMixConfig:{event:"/mix/config_mix",error:{kParamError:o.errorCodeList.INPUT_PARAM,kVideoConfigInvalidError:o.errorCodeList.MIXER_VIDEO_CONFIG_INVALID,kBackgroundImageUrlInvalidError:o.errorCodeList.MIXER_BACKGROUND_IMAGE_URL_INVALID,kNoLoginError:o.errorCodeList.NOT_LOGIN},config:a}}}},r={};function t(o){var a=r[o];if(void 0!==a)return a.exports;var s=r[o]={exports:{}};return e[o].call(s.exports,s,s.exports,t),s.exports}var o={};return(()=>{var e=o;Object.defineProperty(e,"__esModule",{value:!0});var r=t(454);e.default={type:"MixStream",install:function(e,t){for(var o in r.zegoWebRTC)Object.defineProperty(e.prototype,o,{value:r.zegoWebRTC[o],writable:!1});for(var o in r.streamHandler)Object.defineProperty(t.prototype,o,{value:r.streamHandler[o],writable:!1})}}})(),o})()));